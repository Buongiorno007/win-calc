"use strict";function parseStringToDimension(e){e=e.toLowerCase();var t=e.split(" ");return t=updateDigits(t),t=updateFirstTwoToM(t),t=updateCM(t),t=updateMs(t),t=updateM(t),t=updateMM(t),e=summAll(t)}function updateDigits(e){for(var t=0;t<e.length;t++)"ноль"===e[t]&&(e[t]="0"),"раз"===e[t]&&(e[t]="1"),"один"===e[t]&&(e[t]="1"),"два"===e[t]&&(e[t]="2"),"три"===e[t]&&(e[t]="3"),"четыре"===e[t]&&(e[t]="4"),"пять"===e[t]&&(e[t]="5"),"шесть"===e[t]&&(e[t]="6"),"семь"===e[t]&&(e[t]="7"),"восемь"===e[t]&&(e[t]="8"),"девять"===e[t]&&(e[t]="9");return e}function updateCM(e){for(var t=0;t<e.length;t++)"и"===e[t]&&(e[t]="см"),t>0&&"см"===e[t]&&isNumber(e[t-1])&&(e[t-1]=10*parseInt(e[t-1],10),e.splice(t,1));return e}function updateMM(e){for(var t=0;t<e.length;t++)t>0&&"мм"===e[t]&&isNumber(e[t-1])&&e.splice(t,1);return e}function updateMs(e){for(var t=0;t<e.length;t++)"метр"!==e[t]&&"1м"!==e[0]&&"тыща"!==e[t]&&"тысяча"!==e[t]||(e[t]="м");return e}function updateM(e){for(var t=1;t<e.length;t++)"м"===e[t]&&isNumber(e[t-1])&&(e[t-1]=""+1e3*parseInt(e[t-1],10),e=upadtePostM(e,t),e.splice(t,1));return"м"===e[0]&&(e[0]="1000",e=upadtePostM(e,0)),e}function updateFirstTwoToM(e){return 2==e.length&&isNumber(e[0])&&isNumber(e[1])&&(e[2]=e[1],e[1]="м",parseInt(e[2],10)<100?e[3]="см":e[3]="мм"),e}function upadtePostM(e,t){return t===e.length-2?isNumber(e[t+1])&&parseInt(e[t+1],10)<100&&(e[t+1]=""+10*parseInt(e[t+1],10)):t<e.length-1&&isNumber(e[t+1])&&parseInt(e[t+1],10)<100&&isNumber(e[t+2])&&(e[t+1]=""+10*parseInt(e[t+1],10)),e}function summAll(e){for(var t=0,i=0;i<e.length;i++)t+=parseInt(e[i],10);return""+t}function isNumber(e){return""+parseInt(e,10)===e}function OkResult(e){this.status=!0,this.data=e}function ErrorResult(e,t){this.status=!1,this.code=e,this.message=t,console.error(this.code,this.message)}function doInit(){var e="cvq.nmdp.nuancemobility.net";speechKit.initialize("Credentials",e,443,!1,function(e){printResult(e)},function(e){printResult(e)})}function doCleanup(){speechKit.cleanup(function(e){printResult(e)},function(e){printResult(e)})}function startRecognition(e,t,i){function o(){console.log("FORCE STOP"+l),l===!0&&(console.log("FORCE STOP"),r())}function r(){speechKit.stopRecognition(function(e){a(e)},function(e){console.log(e)})}function a(e){"RecoVolumeUpdate"==e.event?(console.log("RecoVolumeUpdate"),t&&t(e.volumeLevel)):n(e)}function n(t){return console.log("parseAndCallback"+t.event),void 0!=t.results&&t.results.length>0?(e(t.results[0].value),void(l=!1)):"RecoStarted"!=t.event?(e("0"),void(l=!1)):void 0}var l=!0,s=i;console.log("Before startRecognition"),speechKit.startRecognition("dictation",s,function(e){a(e)},function(e){a(e)}),console.log("After startRecognition");setTimeout(o,5e3)}function stopRecognition(){speechKit.stopRecognition(function(e){printRecoResult(e)},function(e){console.log(e)})}function getResult(){speechKit.getResults(function(e){printResult(e)},function(e){console.log("getResult"+e)})}function printResult(e){console.log("printResult "+e.event)}function playTTS(e,t){function i(e){console.log("printTTSResult "+JSON.stringify(e))}if(e.length>0){console.log("Playing TTS");var o=(document.getElementById("tts-language"),t);speechKit.playTTS(e,o,null,function(e){i(e)},function(e){i(e)})}}var isDevice=/(Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone)/i.test(window.navigator.userAgent)?1:0;!function(){function e(e,t,i,o,r){e.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl as loginPage",title:"Login"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl as mainPage",title:"Main"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl as settingsPage",title:"Settings"}).when("/change-pass",{templateUrl:"views/change-pass.html",controller:"ChangePassCtrl as passwordPage",title:"Change Pass"}).when("/change-lang",{templateUrl:"views/change-lang.html",controller:"ChangeLangCtrl as languagePage",title:"Change Language"}).when("/location",{templateUrl:"views/location.html",controller:"LocationCtrl as locationPage",title:"Location"}).when("/history",{templateUrl:"views/history.html",controller:"HistoryCtrl as historyPage",title:"History"}).when("/cart",{templateUrl:"views/cart.html",controller:"CartCtrl as cartPage",title:"Cart"}).when("/design",{templateUrl:"views/design.html",controller:"DesignCtrl as designPage",title:"Design"}).otherwise({redirectTo:"/"}),r.imgSrcSanitizationWhitelist(/^\s*((https?|ftp|file|blob|chrome-extension):|data:image\/)/),o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.headers.common.Accept="application/json",o.defaults.headers.common["Content-Type"]="application/json",i.preferredLanguage("en"),i.useLoader("AsyncLoader")}e.$inject=["$routeProvider","$locationProvider","$translateProvider","$httpProvider","$compileProvider"],window.onload=function(){location.hash="#/";var e=document.getElementById("main-frame"),t=document.body.clientHeight/e.offsetHeight;t>1&&(t=1),t<.6&&(t=.6),1!=t&&(navigator.userAgent.indexOf("Firefox")!=-1&&(e.style.boxShadow="none"),e.style.webkitTransform="scale("+t+")",e.style.msTransform=e.style.mozTransform=e.style.transform="scale("+t+")")},window.onresize=function(e){var t=document.getElementById("main-frame"),i=document.body.clientHeight/t.offsetHeight;i>1&&(i=1),i<.6&&(i=.6),1!=i&&(navigator.userAgent.indexOf("Firefox")!=-1&&(t.style.boxShadow="none"),t.style.webkitTransform="scale("+i+")",t.style.msTransform=t.style.mozTransform=t.style.transform="scale("+i+")")},/(chrome|Chromium|safari|firefox|Opera|Yandex|internet explorer|Seamonkey)/i.test(window.navigator.userAgent)&&(isDevice=0),isDevice&&(window.PhonegapApp={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){doInit(),angular.element(document).ready(function(){angular.bootstrap(document,["BauVoiceApp","LoginModule"])})}},PhonegapApp.initialize()),angular.module("BauVoiceApp",["ngRoute","pascalprecht.translate","ngTouch","ngCordova","swipe","LoginModule","MainModule","DesignModule","CartModule","HistoryModule","SettingsModule"]).config(e),angular.module("LoginModule",[]),angular.module("MainModule",[]),angular.module("DesignModule",[]),angular.module("CartModule",[]),angular.module("HistoryModule",[]),angular.module("SettingsModule",[])}(),function(){angular.module("CartModule").controller("CartCtrl",["$filter","globalConstants","GlobalStor","OrderStor","ProductStor","UserStor","CartStor","CartServ","CartMenuServ",function(e,t,i,o,r,a,n,l,s){function d(e){n.cart.allAddElements[e].length>0&&(y.config.detailProductIndex=e,y.config.isAddElementDetail=!0)}function c(){y.config.isAddElementDetail=!1}function u(){y.config.isCartLightView=!y.config.isCartLightView}function p(e){var t=e+1;y.config.isProductComment=y.config.isProductComment===t?0:t}function g(e){e=e||window.event,13===e.keyCode&&s.approveNewDisc(0)}function m(e){e=e||window.event,13===e.keyCode&&s.approveNewDisc(1)}function f(e){e?(y.config.isShowDiscInput=0,y.config.isShowDiscInputAdd=1):(y.config.isShowDiscInput=1,y.config.isShowDiscInputAdd=0)}function h(e){13===e.which&&s.closeDiscountBlock()}var y=this;y.constants=t,y.G=i,y.O=o,y.U=a,y.C=n,y.config={currDisConstr:0,isAddElementDetail:0,isCartLightView:0,detailProductIndex:0,isShowDiscInput:0,isShowDiscInputAdd:0,isProductComment:0,element:e("translate")("add_elements.ELEMENT"),elementa:e("translate")("add_elements.ELEMENTA"),elements:e("translate")("add_elements.ELEMENTS"),DELAY_START:t.STEP,typing:"on"},y.ALL_ADD_ELEMENTS=e("translate")("cart.ALL_ADD_ELEMENTS"),y.ADD_ORDER=e("translate")("cart.ADD_ORDER"),y.LETTER_M=e("translate")("common_words.LETTER_M"),y.HEATCOEF_VAL=e("translate")("mainpage.HEATCOEF_VAL"),y.MM=e("translate")("mainpage.MM"),y.CONFIGMENU_SIZING=e("translate")("mainpage.CONFIGMENU_SIZING"),y.CONFIGMENU_PROFILE=e("translate")("mainpage.CONFIGMENU_PROFILE"),y.CONFIGMENU_GLASS=e("translate")("mainpage.CONFIGMENU_GLASS"),y.CONFIGMENU_HARDWARE=e("translate")("mainpage.CONFIGMENU_HARDWARE"),y.CONFIGMENU_LAMINATION_TYPE=e("translate")("mainpage.CONFIGMENU_LAMINATION_TYPE"),y.CONFIGMENU_LAMINATION=e("translate")("mainpage.CONFIGMENU_LAMINATION"),y.CONFIGMENU_ADDITIONAL=e("translate")("mainpage.CONFIGMENU_ADDITIONAL"),y.PRODUCT_QTY=e("translate")("cart.PRODUCT_QTY"),y.ORDER_COMMENT=e("translate")("cart.ORDER_COMMENT"),y.LIGHT_VIEW=e("translate")("cart.LIGHT_VIEW"),y.DISCOUNT_SELECT=e("translate")("cart.DISCOUNT_SELECT"),y.MAX=e("translate")("common_words.MAX"),y.DISCOUNT_WINDOW=e("translate")("cart.DISCOUNT_WINDOW"),y.DISCOUNT_ADDELEM=e("translate")("cart.DISCOUNT_ADDELEM"),y.DISCOUNT=e("translate")("cart.DISCOUNT"),y.DISCOUNT_WITHOUT=e("translate")("cart.DISCOUNT_WITHOUT"),y.DISCOUNT_WITH=e("translate")("cart.DISCOUNT_WITH"),y.FULL_VIEW=e("translate")("cart.FULL_VIEW"),y.ADDELEMENTS_EDIT_LIST=e("translate")("cart.ADDELEMENTS_EDIT_LIST"),y.WIDTH_LABEL=e("translate")("add_elements.WIDTH_LABEL"),y.HEIGHT_LABEL=e("translate")("add_elements.HEIGHT_LABEL"),y.QTY_LABEL=e("translate")("add_elements.QTY_LABEL"),y.ADDELEMENTS_PRODUCT_COST=e("translate")("cart.ADDELEMENTS_PRODUCT_COST"),y.GRID=e("translate")("add_elements.GRID"),y.VISOR=e("translate")("add_elements.VISOR"),y.SPILLWAY=e("translate")("add_elements.SPILLWAY"),y.OUTSIDE=e("translate")("add_elements.OUTSIDE"),y.LOUVERS=e("translate")("add_elements.LOUVERS"),y.INSIDE=e("translate")("add_elements.INSIDE"),y.CONNECTORS=e("translate")("add_elements.CONNECTORS"),y.FAN=e("translate")("add_elements.FAN"),y.WINDOWSILL=e("translate")("add_elements.WINDOWSILL"),y.HANDLEL=e("translate")("add_elements.HANDLEL"),y.OTHERS=e("translate")("add_elements.OTHERS"),y.NAME_LABEL=e("translate")("add_elements.NAME_LABEL"),y.TOTAL_PRICE_TXT=e("translate")("add_elements.TOTAL_PRICE_TXT"),y.LINK_BETWEEN_COUPLE=e("translate")("cart.LINK_BETWEEN_COUPLE"),y.LINK_BETWEEN_ALL=e("translate")("cart.LINK_BETWEEN_ALL"),i.global.currOpenPage="cart",o.order.products=_.sortBy(o.order.products,"product_id","0"),i.global.productEditNumber=0,s.joinAllAddElements(),s.calculateOrderPrice(),"main"===i.global.prevOpenPage&&(r.product=r.setDefaultProduct()),i.global.orderEditNumber||(n.cart.customer.customer_location=o.order.customer_location),y.decreaseProductQty=l.decreaseProductQty,y.increaseProductQty=l.increaseProductQty,y.addNewProductInOrder=l.addNewProductInOrder,y.clickDeleteProduct=l.clickDeleteProduct,y.createProductCopy=l.createProductCopy,y.addCloneProductInOrder=l.addCloneProductInOrder,y.openBox=l.openBox,y.showAddElementDetail=d,y.closeAddElementDetail=c,y.viewSwitching=u,y.switchProductComment=p,y.box=l.box,y.enterKeyPrice=g,y.enterKeyDop=m,y.showAllAddElements=l.showAllAddElements,y.openDiscountBlock=s.openDiscountBlock,y.closeDiscountBlock=s.closeDiscountBlock,y.approveNewDisc=s.approveNewDisc,y.openDiscInput=f,y.pressEnterInDisc=h}])}(),function(){angular.module("SettingsModule").controller("ChangeLangCtrl",["$location","$translate","$timeout","globalConstants","GlobalStor","UserStor","NavMenuServ","loginServ",function(e,t,i,o,r,a,n,l){function s(l){t.use(o.languages[l].label),a.userInfo.langLabel=o.languages[l].label,a.userInfo.langName=o.languages[l].name,r.global.isVoiceHelper&&(r.global.voiceHelperLanguage=n.setLanguageVoiceHelper()),1===r.global.isRoomElements?i(function(){e.path("/main")},200):i(function(){e.path("/")},200)}function d(){e.path("/settings")}var c=this;c.constants=o,c.U=a,c.config={DELAY_START:o.STEP,typing:"on"},c.getDeviceLanguage=l.getDeviceLanguage,c.switchLang=s,c.gotoSettingsPage=d}])}(),function(){angular.module("SettingsModule").controller("ChangePassCtrl",["$filter","globalConstants","SettingServ","UserStor","localDB",function(e,t,i,o,r){function a(){s.config.oldPassword&&o.userInfo.password==r.md5(s.config.oldPassword)&&s.config.newPassword&&s.config.confirmPassword&&s.config.newPassword===s.config.confirmPassword?(s.config.isErrorPassword=0,o.userInfo.password=r.md5(s.config.newPassword),r.updateLocalServerDBs(r.tablesLocalDB.users.tableName,o.userInfo.id,{password:o.userInfo.password}).then(function(){s.config.newPassword=s.config.confirmPassword="",i.gotoSettingsPage()})):s.config.oldPassword&&o.userInfo.password==r.md5(s.config.oldPassword)?s.config.isErrorPassword=1:s.config.isErrorOldPassword=1}function n(){s.config.isErrorPassword=0}function l(){s.config.isErrorOldPassword=0}var s=this;s.U=o,s.consts=t,s.config={DELAY_START:t.STEP,oldPassword:0,newPassword:0,confirmPassword:0,isErrorPassword:0,isErrorOldPassword:0,typing:"on"},s.WRONG_LOGIN=e("translate")("login.WRONG_LOGIN"),s.NO_CONFIRM_PASS=e("translate")("settings.NO_CONFIRM_PASS"),s.CHANGE_PASSWORD=e("translate")("settings.CHANGE_PASSWORD"),s.SAVE=e("translate")("settings.SAVE"),s.CURRENT_PASSWORD=e("translate")("settings.CURRENT_PASSWORD"),s.NEW_PASSWORD=e("translate")("settings.NEW_PASSWORD"),s.CONFIRM_PASSWORD=e("translate")("settings.CONFIRM_PASSWORD"),s.saveNewPassword=a,s.gotoSettingsPage=i.gotoSettingsPage,s.checkError=n,s.checkErrorOld=l}])}(),function(){angular.module("DesignModule").controller("DesignCtrl",["$filter","$timeout","globalConstants","DesignServ","GlobalStor","ProductStor","MainServ","DesignStor","localDB",function(e,t,i,o,r,a,n,l,s){function d(){l.design.activeMenuItem=0,l.design.activeSubMenuItem=0,l.design.isDropSubMenu=0}function c(){S.config.isDesignError=1,l.design.activeMenuItem=0,l.design.activeSubMenuItem=0,t(function(){S.config.isDesignError=0},800)}function u(e){if(l.design.activeSubMenuItem=e,!l.design.selectedGlass.length){var t=d3.selectAll("#tamlateSVG .glass");l.design.selectedGlass=t[0],t.classed("glass-active",!0)}}function p(e){var t,i=1,r=l.design.selectedGlass.length;if(1===e)for(d(),t=0;t<r;t+=1)o.deleteSash(l.design.selectedGlass[t]);else if(2!==e&&6!==e&&8!==e||(l.design.isDropSubMenu===e?l.design.isDropSubMenu=0:(l.design.isDropSubMenu=e,i=0)),i)for(d(),t=0;t<r;t+=1)o.createSash(e,l.design.selectedGlass[t])}function g(e){var t=d3.selectAll("#tamlateSVG .corner_mark");t[0].length?(l.design.activeSubMenuItem=e,t.transition().duration(300).ease("linear").attr("r",50),l.design.selectedCorner=t[0],t.on("click",function(){o.hideCornerMarks();var e=d3.select(this).transition().duration(300).ease("linear").attr("r",50);l.design.selectedCorner.push(e[0][0])})):c()}function m(e){d(),S.config.isTest=1,o.hideCornerMarks()}function f(e){var t=d3.selectAll("#tamlateSVG .frame")[0].filter(function(e){if("frame"===e.__data__.type||"arc"===e.__data__.type)return!0});if(t.length){if(l.design.activeSubMenuItem=e,!l.design.selectedArc.length){var i=d3.selectAll(t);l.design.selectedArc=i[0],i.classed("active_svg",!0)}}else c()}function _(e){d(),S.config.isTest=1,o.deselectAllArc()}function h(e){var i,r=1,a=l.design.selectedImpost.length;if(1===e){if(d(),a){for(i=0;i<a;i+=1)o.deleteImpost(l.design.selectedImpost[i]);t(function(){l.design.isImpostDelete=0},300)}}else if(2===e||3===e){if(4!==e&&8!==e&&12!==e||(l.design.isDropSubMenu===e?l.design.isDropSubMenu=0:(l.design.isDropSubMenu=e,r=0)),r)if(d(),a)o.deselectAllImpost();else{var n=l.design.selectedGlass.length;if(n)for(i=0;i<n;i+=1)o.createImpost(e,l.design.selectedGlass[i])}}else d(),S.config.isTest=1,o.deselectAllGlass(),o.deselectAllImpost()}function y(){d(),o.initMirror()}function E(){d(),o.positionAxises()}function b(){d(),o.positionGlasses()}function v(e){if(r.global.activePanel=0,l.design.tempSize.length)o.closeSizeCaclulator();else if(l.design.activeMenuItem=l.design.activeMenuItem===e?0:e,l.design.isDropSubMenu=0,o.hideCornerMarks(),o.deselectAllImpost(),4!==e&&o.deselectAllArc(),o.hideSizeTools(),l.design.activeMenuItem)switch(l.design.activeMenuItem){case 1:u(e),t(function(){l.design.isDropSubMenu=2},A),t(function(){l.design.isDropSubMenu=6},L),t(function(){l.design.isDropSubMenu=8},D),t(function(){l.design.isDropSubMenu=0},N);break;case 2:o.deselectAllGlass(),g(e);break;case 3:u(e),t(function(){l.design.isDropSubMenu=4},A),t(function(){l.design.isDropSubMenu=8},L),t(function(){l.design.isDropSubMenu=12},D),t(function(){l.design.isDropSubMenu=0},N);break;case 4:o.deselectAllGlass(),f(e);break;case 5:l.design.activeSubMenuItem=e}else l.design.activeSubMenuItem=0,o.deselectAllGlass(),o.deselectAllArc(),t(function(){l.design.isImpostDelete=0},300)}function T(){r.global.activePanel?(r.global.activePanel=0,o.initAllImposts(),o.initAllGlass(),o.initAllArcs(),o.initAllDimension()):r.global.activePanel=1}function I(){S.config.isTest=0,l.design.isDimExtra=0,l.design.isSquareExtra=0}var S=this,A=300,L=600,D=900,N=1200;S.constants=i,S.G=r,S.P=a,S.D=l,r.global.currOpenPage="design",S.config={isDesignError:0,isTest:0,DELAY_SHOW_FIGURE_ITEM:1e3,typing:"on"},S.TEXT1=e("translate")("natification.TEXT1"),S.TEXT2=e("translate")("natification.TEXT2"),S.TEXT3=e("translate")("natification.TEXT3"),S.EDIT_HARDWARE=e("translate")("natification.EDIT_HARDWARE"),S.EDIT_SIZE=e("translate")("natification.EDIT_SIZE"),S.IMPOST_SHAPE=e("translate")("design.IMPOST_SHAPE"),S.SASH_SHAPE=e("translate")("design.SASH_SHAPE"),S.ANGEL_SHAPE=e("translate")("design.ANGEL_SHAPE"),S.ARCH_SHAPE=e("translate")("design.ARCH_SHAPE"),S.POSITION_SHAPE=e("translate")("design.POSITION_SHAPE"),S.UNITS_DESCRIP=e("translate")("design.UNITS_DESCRIP"),S.PROJECT_DEFAULT=e("translate")("design.PROJECT_DEFAULT"),S.BACK=e("translate")("common_words.BACK"),S.SAVE=e("translate")("settings.SAVE"),S.CANCEL=e("translate")("add_elements.CANCEL"),S.DOOR_CONFIG_LABEL=e("translate")("design.DOOR_CONFIG_LABEL"),S.DOOR_CONFIG_DESCTIPT=e("translate")("design.DOOR_CONFIG_DESCTIPT"),S.SASH_CONFIG_DESCTIPT=e("translate")("design.SASH_CONFIG_DESCTIPT"),S.HANDLE_CONFIG_DESCTIPT=e("translate")("design.HANDLE_CONFIG_DESCTIPT"),S.LOCK_CONFIG_DESCTIPT=e("translate")("design.LOCK_CONFIG_DESCTIPT"),S.STEP=e("translate")("design.STEP"),S.LABEL_DOOR_TYPE=e("translate")("design.LABEL_DOOR_TYPE"),S.LABEL_SASH_TYPE=e("translate")("design.LABEL_SASH_TYPE"),S.LABEL_HANDLE_TYPE=e("translate")("design.LABEL_HANDLE_TYPE"),S.LABEL_LOCK_TYPE=e("translate")("design.LABEL_LOCK_TYPE"),S.NOT_AVAILABLE=e("translate")("design.NOT_AVAILABLE"),S.DIM_EXTRA=e("translate")("design.DIM_EXTRA"),S.SQUARE_EXTRA=e("translate")("design.SQUARE_EXTRA"),S.ROOM_SELECTION=e("translate")("mainpage.ROOM_SELECTION"),S.TEST_STAGE=e("translate")("design.TEST_STAGE"),S.VOICE_SPEACH=e("translate")("design.VOICE_SPEACH"),S.BY_AXIS=e("translate")("design.BY_AXIS"),S.BY_GLASS=e("translate")("design.BY_GLASS"),l.designSource.templateSourceTEMP=angular.copy(a.product.template_source),l.designSource.templateTEMP=angular.copy(a.product.template),l.design.templateSourceTEMP=angular.copy(a.product.template_source),l.design.templateTEMP=angular.copy(a.product.template),t(function(){o.initAllImposts(),o.initAllGlass(),o.initAllArcs(),o.initAllDimension()},50),S.designSaved=o.saveSizeCheck,S.designCancel=o.designCancel,S.selectMenuItem=v,S.setDefaultConstruction=o.setDefaultConstruction,S.showTemplates=T,S.toggleDoorConfig=o.toggleDoorConfig,S.selectDoor=o.selectDoor,S.selectSash=o.selectSash,S.selectHandle=o.selectHandle,S.selectLock=o.selectLock,S.closeDoorConfig=o.closeDoorConfig,S.saveDoorConfig=o.saveDoorConfig,S.setDoorConfigDefault=o.setDoorConfigDefault,S.insertSash=p,S.insertCorner=m,S.insertImpost=h,S.insertArc=_,S.initMirror=y,S.positionAxis=E,S.positionGlass=b,S.stepBack=o.stepBack,S.closeAttantion=I}])}(),function(){angular.module("HistoryModule").controller("HistoryCtrl",["$filter","GlobalStor","UserStor","HistoryStor","HistoryServ","CartServ",function(e,t,i,o,r,a){var n=this;n.G=t,n.H=o,n.U=i,n.FROM=e("translate")("history.FROM"),n.UNTIL=e("translate")("history.UNTIL"),n.DATE_RANGE=e("translate")("history.DATE_RANGE"),n.ALL_TIME=e("translate")("history.ALL_TIME"),n.SORTING=e("translate")("history.SORTING"),n.NEWEST_FIRST=e("translate")("history.NEWEST_FIRST"),n.NEWEST_LAST=e("translate")("history.NEWEST_LAST"),n.SORT_BY_TYPE=e("translate")("history.SORT_BY_TYPE"),n.SORT_SHOW=e("translate")("history.SORT_SHOW"),n.ALL=e("translate")("common_words.ALL"),n.SORT_SHOW_ACTIVE=e("translate")("history.SORT_SHOW_ACTIVE"),n.SORT_SHOW_WAIT=e("translate")("history.SORT_SHOW_WAIT"),n.SORT_SHOW_DONE=e("translate")("history.SORT_SHOW_DONE"),n.INCLUDED=e("translate")("history.INCLUDED"),n.DELIVERY=e("translate")("cart.DELIVERY"),n.AND=e("translate")("common_words.AND"),n.ASSEMBLING=e("translate")("cart.ASSEMBLING"),n.CLIENT=e("translate")("history.CLIENT"),n.PHONE=e("translate")("history.PHONE"),n.ADDRESS=e("translate")("history.ADDRESS"),n.PAYMENTS=e("translate")("history.PAYMENTS"),n.WAIT_MASTER=e("translate")("history.WAIT_MASTER"),n.ALLPRODUCTS=e("translate")("history.ALLPRODUCTS"),n.ON=e("translate")("history.ON"),n.CHANGE=e("translate")("common_words.CHANGE"),n.SEND_ORDER_TITLE=e("translate")("common_words.SEND_ORDER_TITLE"),n.BUTTON_C=e("translate")("common_words.BUTTON_C"),n.PRINT=e("translate")("common_words.PRINT"),n.BY_YOUR_REQUEST=e("translate")("history.BY_YOUR_REQUEST"),n.NOT_FIND=e("translate")("history.NOT_FIND"),n.DRAFT_VIEW=e("translate")("history.DRAFT_VIEW"),n.DRAFT=e("translate")("history.DRAFT"),n.DOWNLOAD_ORDERS=e("translate")("history.DOWNLOAD_ORDERS"),n.DURING_THE_WEEK=e("translate")("history.DURING_THE_WEEK"),n.PER_MOUNTH=e("translate")("history.PER_MOUNTH"),n.IN_A_YEAR=e("translate")("history.IN_A_YEAR"),n.HISTORY_VIEW=e("translate")("history.HISTORY_VIEW"),n.ORDER_DONE=e("translate")("history.ORDER_DONE"),n.ORDER_ERROR=e("translate")("history.ORDER_ERROR"),n.SYNCHRONIZE_ORDERS=e("translate")("history.SYNCHRONIZE_ORDERS"),n.time=[{name:e("translate")("history.DURING_THE_WEEK"),namb:1},{name:e("translate")("history.PER_MOUNTH"),namb:2},{name:e("translate")("history.IN_A_YEAR"),namb:3}],t.global.currOpenPage="history",n.createdDate="created",r.downloadOrders(),n.reqResult=r.reqResult,n.toCurrentCalculation=r.toCurrentCalculation,n.sendOrderToFactory=r.sendOrderToFactory,n.makeOrderCopy=r.makeOrderCopy,n.clickDeleteOrder=r.clickDeleteOrder,n.editOrder=r.editOrder,n.orderPrint=r.orderPrint,n.deleteOption=r.deleteOption,n.viewSwitching=r.viewSwitching,n.orderSearching=r.orderSearching,n.orderDateSelecting=r.orderDateSelecting,n.openCalendarScroll=r.openCalendarScroll,n.orderSorting=r.orderSorting,n.sortingInit=r.sortingInit,n.testFunc=r.testFunc,n.synchronizeOrders=r.synchronizeOrders}])}(),function(){angular.module("SettingsModule").controller("LocationCtrl",["localDB","GeneralServ","loginServ","SettingServ","GlobalStor","OrderStor","UserStor",function(e,t,i,o,r,a,n){function l(a){s.userNewLocation=a.fullLocation,n.userInfo.therm_coeff_id?n.userInfo.heatTransfer=t.roundingValue(1/a.heatTransfer):n.userInfo.heatTransfer=a.heatTransfer,"settings"===r.global.currOpenPage?(n.userInfo.city_id=a.cityId,n.userInfo.cityName=a.cityName,n.userInfo.countryId=a.countryId,n.userInfo.fullLocation=a.fullLocation,n.userInfo.climaticZone=a.climaticZone,e.updateLocalServerDBs(e.tablesLocalDB.users.tableName,n.userInfo.id,{city_id:a.cityId})):"main"===r.global.currOpenPage&&i.setUserGeoLocation(a.cityId,a.cityName,a.climaticZone,n.userInfo.heatTransfer,a.fullLocation),r.global.startProgramm=!1,o.closeLocationPage()}var s=this;s.userNewLocation=angular.copy(a.order.customer_location),s.locations=r.global.locations.cities.filter(function(e){return e.countryId===n.userInfo.countryId}),s.closeLocationPage=o.closeLocationPage,s.selectCity=l}])}(),function(){angular.module("LoginModule").controller("LoginCtrl",["$location","$timeout","$cordovaNetwork","$filter","globalConstants","localDB","loginServ","MainServ","GlobalStor","ProductStor","UserStor","HistoryServ",function(e,t,i,o,r,a,n,l,s,d,c,u){function p(e){p.list||(p.list=[]);var t,i,o=p.list;for(t=0;t<e.length;t+=1)i=new Image,i.onload=function(){var e=o.indexOf(this);e!==-1&&o.splice(e,1)},o.push(i),i.src=e[t]}function g(){l.saveUserEntry(),l.createOrderData(),l.setCurrDiscounts(),l.setCurrTemplate(),l.prepareTemplates(d.product.construction_type).then(function(){l.prepareMainPage(),l.laminatFiltering(),1===s.global.locations.cities.length&&(n.downloadAllCities(1),s.global.isLoader=0,e.path("/main"))})}function m(){R.isStartImport=1,a.importAllDB(c.userInfo.phone,c.userInfo.device_code).then(function(e){e?(n.downloadAllData().then(function(){g()}),R.isStartImport=0):console.log("Error!")})}function f(e){for(var t,i=e.length;--i>-1;)for(t=s.global.locations.cities.length;--t>-1;)e[i].city_id===s.global.locations.cities[t].cityId&&(e[i].location=s.global.locations.cities[t].fullLocation);return e}function _(){n.setUserLocation(),+c.userInfo.factory_id>0?n.isLocalDBExist().then(function(e){R.isLocalDB=e,R.isLocalDB?n.downloadAllData().then(function(){g()}):m(c.userInfo.factory_id)}):n.collectCityIdsAsCountry().then(function(e){a.importFactories(c.userInfo.phone,c.userInfo.device_code,e).then(function(e){s.global.isLoader=0,e.status?(R.factories=f(e.factories),R.isFactoryId=1):console.log("can not get factories!")})})}function h(e){e.locked?a.cleanLocalDB(a.tablesLocalDB).then(function(t){t&&a.createTablesLocalDB(a.tablesLocalDB).then(function(t){t&&(a.insertRowLocalDB(e,a.tablesLocalDB.users.tableName),angular.extend(c.userInfo,e),a.importLocation(c.userInfo.phone,c.userInfo.device_code).then(function(e){if(e){n.prepareLocationToUse().then(function(){_()});var t="UserStor.userInfo.phone",i=c.userInfo.phone;localforage.setItem(t,i,function(e,t){});var t="UserStor.userInfo.device_code",i=c.userInfo.device_code;localforage.setItem(t,i,function(e,t){})}}))})}):(s.global.isLoader=0,R.isUserNotActive=1)}function y(){a.importUser(R.user.phone).then(function(e){if(e.status){var t=angular.copy(e.user),i=a.md5(R.user.password);i===t.password?h(t):(s.global.isLoader=0,R.isUserPasswordError=1)}else s.global.isLoader=0,R.isUserNotExist=1})}function E(){var t=e.search(),i=["7d537b6746f925b1703aefa9b8a9a4bc","3f5f0c7d46d318e026f9ba60dceffc65","799e078b084c6d57cea0b0d53a7e3008","9aefeef9c7e53f9de9bb36f32649dc3f","a2da6d85764368b24392740020efbc92","ceb60bfed037baaa484bd7b88d274c98","632b3213660804acb71fe045c6e321ed","d11758b674ac02f0fcf128dcc906dbef","8155bc545f84d9652f1012ef2bdfb6eb","59e711d152de7bec7304a8c2ecaf9f0f","877466ffd21fe26dd1b3366330b7b560","f31c147335274c56d801f833d3c26a70","f68ec4f0c6df90137749af75a929a3eb","0f190e6e164eafe66f011073b4486975","a9588aa82388c0579d8f74b4d02b895f","66a516f865fca1c921dba625ede4a693","7cebd0178b69b2e88774529e1e59a7b0","ad1df793247a0e650d0d7166341b8d97","ffc14b7acfd31440e19d0431d4ab0cba","4736b2b496ba3de748c6eea6c6b9ca65","04fc711301f3c784d66955d98d399afb","768c1c687efe184ae6dd2420710b8799","f7a5c99c58103f6b65c451efd0f81826","27701bd8dd141b953b94a5c9a44697c0","7f7d5f9f3a660f2b09e3aae62a15e29b","23ff17389acbfd020043268fb49e7048","cd714cc33cfd23e74f414cbb8b9787fe","2959f1aea8db0f7fbba61f0f8474d0ef","a28a19e19b283845c851b4876b97cef4","661e67f8ce5eaf9d63c1b5be6fce1afb","0653e359db756493450c3fb1fc6790b2","ec5fefce8d1d81849b47923d6d1b52c0","d4ccb0f347163d9ee1cd5a106e1ec48b","c500ea6c5baf3deb447be25b90cf5f1c","59a6670111970ede6a77e9b43a5c4787","266021e24dd0bfaaa96f2b5e21d7c800","b8c4b7f74db12fadbe2d979ed93f392b","2482b711a07d1da3efa733aa7014f947","573b8926f015aa477cb6604901b92aea","b54d11c86eb7c8955a50d20f6b3be2f2","3a55b7218a5ca395ac71b3ec9904b6ed","3615d9213b1b3d5fe760901f43a8405f","e50137601a90943ce98b03e90d73272e","d4651afb4e1c749f0bacc7ff5d101982","988a8fa4855bf7ea54057717655d3fc9","82deec386376c6f81845e561f491e19a","f427fe660e069c2a1d03db07126c95b7"],o=["0950604425","0500505500","78124541170","22274313","9201922876","903528981","9301600441","89324310961","1000000","1000001","1000002","1000003","1000004","1000005","1000006","1000007","1000008","1000009","wd-op","op1","000001","000002","000003","000007","000008","000009","000010","000011","000012","000013","000014","000015","000016","000017","000018","000019","000020","000021","000022","000023","000024","000025","000026","000027","000028","vikna","5371"],r=["0950604425","0500505500","78124541170","22274313","9201922876","903528981","9301600441","89324310961","1000000","1000001","1000002","1000003","1000004","1000005","1000006","1000007","1000008","1000009","wd-op","op1op1","000001","000002","000003","000007","000008","000009","000010","000011","000012","000013","000014","000015","000016","000017","000018","000019","000020","000021","000022","000023","000024","000025","000026","000027","000028","vikna","5371"],n=i.length,l=0;if(t.access){for(;n>-1;)n-=1,i[n]===t.access&&(R.user.phone=o[n],R.user.password=r[n],l=1);l?R.user.phone&&R.user.password&&(s.global.isLoader=1,y()):a.importUser(t.access,1).then(function(e){var t=angular.copy(e.user);s.global.isLoader=1,h(t)})}}function b(){R.isOffline=!1}function v(){1===s.global.isLoader3&&1===s.global.isLoader&&(s.global.isLoader3=0),0===s.global.isLoader3&&(t(function(){s.global.isLoader3=1},1),t(function(){s.global.isLoader2=0},1),t(function(){s.global.isLoader2=25},100),t(function(){s.global.isLoader2=40},1500),t(function(){s.global.isLoader2=65},3e3),t(function(){s.global.isLoader2=90},4e3),t(function(){s.global.isLoader2=94},7e3),t(function(){s.global.isLoader2=95},9e3),t(function(){s.global.isLoader2=96},11e3),t(function(){s.global.isLoader2=97},15e3),t(function(){s.global.isLoader2=98},21e3),t(function(){s.global.isLoader2=99},3e4),t(function(){s.global.isLoader3=0},31e3))}function T(e){var t;R.submitted=1,e.$valid&&(s.global.isLoader=1,v(),R.isOnline?$("#updateDBcheck").prop("checked")?O&&navigator.onLine?(s.global.isLoader=1,u.synchronizeOrders().then(function(){s.global.isLoader=1,y()})):(s.global.isLoader=0,R.isOfflineImport=1):n.isLocalDBExist().then(function(e){R.isLocalDB=e,R.isLocalDB?(console.log("SYNC"),a.selectLocalDB(a.tablesLocalDB.users.tableName,{phone:R.user.phone}).then(function(e){e.length?(t=a.md5(R.user.password),t===e[0].password?e[0].locked?(angular.extend(c.userInfo,e[0]),n.prepareLocationToUse().then(function(){_()})):(s.global.isLoader=0,R.isUserNotActive=1):(s.global.isLoader=0,R.isUserPasswordError=1)):(console.log("Sync IMPORT"),y())})):(console.log("IMPORT"),y())}):R.isLocalDB?(console.log("OFFLINE"),a.selectLocalDB(a.tablesLocalDB.users.tableName,{phone:R.user.phone}).then(function(e){if(e.length){var t=a.md5(R.user.password);t===e[0].password?e[0].locked?e[0].factory_id>0?(angular.extend(c.userInfo,e[0]),n.prepareLocationToUse().then(function(){n.setUserLocation(),n.downloadAllData().then(function(){g()})})):(s.global.isLoader=0,R.isOffline=1):(s.global.isLoader=0,R.isUserNotActive=1):(s.global.isLoader=0,R.isUserPasswordError=1)}else s.global.isLoader=0,R.isUserNotExist=1})):(s.global.isLoader=0,R.isOffline=1))}function I(){R.user.factoryId>0?R.isOnline?(s.global.isLoader=1,c.userInfo.factory_id=angular.copy(R.user.factoryId),a.updateLocalServerDBs(a.tablesLocalDB.users.tableName,c.userInfo.id,{factory_id:c.userInfo.factory_id}).then(function(){R.isFactoryId=0,m()})):R.isOffline=1:R.isFactoryNotSelect=1}function S(){R.isFactoryNotSelect=0,R.isFactoryId=0,delete R.user.factoryId}function A(){R.isOnline?n.isLocalDBExist().then(function(e){R.isLocalDB=e,R.isLocalDB?(s.global.isLoader=1,n.prepareLocationToUse(1).then(function(){s.global.isLoader=0,R.isRegistration=1})):(s.global.isLoader=1,a.cleanLocalDB(a.tablesLocalDB).then(function(e){e&&a.createTablesLocalDB(a.tablesLocationLocalDB).then(function(e){e&&a.importLocation().then(function(e){e&&n.prepareLocationToUse(1).then(function(){s.global.isLoader=0,R.isRegistration=1})})})})),R.user={}}):R.isOffline=1}function L(){R.user={},R.isRegistration=0}function D(e){R.submitted=!0,e.$valid&&(R.isOnline?(s.global.isLoader=1,a.importUser(R.user.phone).then(function(e){if(e.status)s.global.isLoader=0,R.isUserExist=1;else{var t={name:R.user.name,phone:R.user.phone,email:R.user.mail,cityId:R.user.city.cityId,password:a.md5(R.user.phone)};console.log("CREATE USER!!!!!!!!!!!!",t),a.createUserServer(t),s.global.isLoader=0,R.isSendEmail=1,L()}})):R.isOffline=1)}function N(){R.user.country?R.user.region||delete R.user.city:(delete R.user.region,
delete R.user.city)}function x(){window.location.hash.length<10?0===s.global.gotoSettingsPage&&(t(function(){e.path("/change-lang")},1),t(function(){e.path("/")},1),s.global.gotoSettingsPage=1):s.global.gotoSettingsPage=1}var R=this;R.G=s,R.consts=r;var O;R.isOnline=1,R.isOffline=0,R.isOfflineImport=0,R.isAutoSyncInfo=0,R.isLocalDB=0,R.isRegistration=0,R.submitted=0,R.isUserExist=0,R.isUserNotExist=0,R.isUserPasswordError=0,R.isSendEmail=0,R.isUserNotActive=0,R.isFactoryId=0,R.isFactoryNotSelect=0,R.isStartImport=0,R.user={},R.factories=0,s.global.loader=0,R.onlineMode=0,$.get(r.serverIP,function(){O=!0}).fail(function(){O=!1}),R.OFFLINE=o("translate")("login.OFFLINE"),R.OK=o("translate")("common_words.OK"),R.USER_CHECK_EMAIL=o("translate")("login.USER_CHECK_EMAIL"),R.USER_NOT_EXIST=o("translate")("login.USER_NOT_EXIST"),R.USER_NOT_ACTIVE=o("translate")("login.USER_NOT_ACTIVE"),R.USER_PASSWORD_ERROR=o("translate")("login.USER_PASSWORD_ERROR"),R.IMPORT_DB=o("translate")("login.IMPORT_DB"),R.LOGIN=o("translate")("login.LOGIN"),R.PASSWORD=o("translate")("login.PASSWORD"),R.EMPTY_FIELD=o("translate")("login.EMPTY_FIELD"),R.WRONG_LOGIN=o("translate")("login.WRONG_LOGIN"),R.ENTER=o("translate")("login.ENTER"),R.REGISTRATION=o("translate")("login.REGISTRATION"),R.SELECT_FACTORY=o("translate")("login.SELECT_FACTORY"),R.SELECT_PRODUCER=o("translate")("login.SELECT_PRODUCER"),R.SELECT=o("translate")("common_words.SELECT"),R.USER_EXIST=o("translate")("login.USER_EXIST"),R.CLIENT_NAME=o("translate")("cart.CLIENT_NAME"),R.WRONG_NAME=o("translate")("login.WRONG_NAME"),R.SHORT_NAME=o("translate")("login.SHORT_NAME"),R.SELECT_COUNTRY=o("translate")("login.SELECT_COUNTRY"),R.SELECT_REGION=o("translate")("login.SELECT_REGION"),R.SELECT_CITY=o("translate")("login.SELECT_CITY"),R.CLIENT_EMAIL=o("translate")("cart.CLIENT_EMAIL"),R.WRONG_EMAIL=o("translate")("cart.WRONG_EMAIL"),R.OFFLINE_IMPORT=o("translate")("login.OFFLINE_IMPORT"),R.AUTO_SYNCHRONIZE=o("translate")("login.AUTO_SYNCHRONIZE"),R.SYNCHRONIZE_INFO=o("translate")("login.SYNCHRONIZE_INFO"),p(["img/room/1.png","img/room/4.png","img/room/6.png","img/room/7.png","img/room/8.png","img/room/9.png","img/room/10.png","img/room/11.png","img/room/12.png","img/room/26.png","img/room/121.png","img/room/122.png","img/room/123.png","img/room/fon.jpg","img/room/3333.png"]),window.location.hash.length>10&&v(),O||navigator.onLine||(localforage.getItem("UserStor.userInfo.phone",function(e,t){c.userInfo.phone=t}),localforage.getItem("UserStor.userInfo.device_code",function(e,t){c.userInfo.device_code=t})),setTimeout(function(){$("#jssj").trigger("click")},1e3),R.gotoSettingsPage=x,R.switchRegistration=A,R.closeRegistration=L,R.enterForm=T,R.loader=v,R.registrForm=D,R.selectLocation=N,R.selectFactory=I,R.closeFactoryDialog=S,R.closeOfflineAlert=b,n.getDeviceLanguage(),R.isOnline&&(n.initExport(),E())}])}(),function(){angular.module("MainModule").controller("MainCtrl",["$location","$timeout","$q","localDB","globalConstants","GeneralServ","loginServ","MainServ","SVGServ","DesignServ","AddElementMenuServ","GlobalStor","ProductStor","DesignStor","UserStor","AuxStor",function(e,t,i,o,r,a,n,l,s,d,c,u,p,g,m,f){function _(){u.global.templateTEMP=angular.copy(p.product),p.product.is_addelem_only||((u.global.isQtyCalculator||u.global.isSizeCalculator)&&c.finishCalculators(),u.global.showRoomSelectorDialog=0,u.global.configMenuTips=0,u.global.isShowCommentBlock=0,u.global.isTemplateTypeMenu=0,a.stopStartProg(),l.setDefaultAuxParam(),u.global.showGlassSelectorDialog&&d.closeGlassSelectorDialog(1),u.global.activePanel=0,g.design.isGlassExtra=0,e.path("/design"))}function h(){for(var e=1e6,t=0,i=0,o=0;o<10;o++){for(var r=+new Date,a=0;a<e;a++){var n=Math.sqrt(a)*Math.sin(a)*Math.cos(a/2)/2;t+=n}var l=+new Date,s=l-r;i+=s}return u.global.getPCPower=Math.round(1e6/i),u.global.loader=2,Math.round(1e6/i)}function y(){var e=i.defer();return 0===p.product.is_addelem_only&&o.selectLocalDB(o.tablesLocalDB.elements_profile_systems.tableName,{profile_system_id:p.product.profile.id}).then(function(t){u.global.dataProfiles=angular.copy(t),e.resolve(t)}),e.promise}var E=this;E.G=u,E.P=p,E.U=m,E.A=f,E.constants=r,E.D=g,u.global.currOpenPage="main",u.global.isReport=0,E.config={isDesignError:0,DELAY_SHOW_FIGURE_ITEM:1e3,typing:"on"},u.global.startProgramm&&d.setDefaultTemplate(),u.global.productEditNumber&&!p.product.is_addelem_only&&s.createSVGTemplate(p.product.template_source,p.product.profileDepths).then(function(e){p.product.template=e}),p.product.is_addelem_only||(y(),l.doorProfile(),l.laminationDoor()),h(),E.profile=y,E.getPCPower=h,E.goToEditTemplate=_,E.setDefaultConstruction=d.setDefaultConstruction}])}(),function(){angular.module("MainModule").controller("addElementMenuCtrl",["$timeout","$filter","globalConstants","GlobalStor","ProductStor","UserStor","AuxStor","MainServ","AddElementMenuServ","AddElementsServ","DesignServ",function(e,t,i,o,r,a,n,l,s,d,c){function u(){n.aux.isTabFrame=!n.aux.isTabFrame}var p=this;p.constants=i,p.G=o,p.P=r,p.U=a,p.A=n,p.config={DELAY_START:i.STEP,DELAY_SHOW_ELEMENTS_MENU:10*i.STEP,typing:"on"},n.aux.coordinats=0,p.TIP=t("translate")("add_elements_menu.TIP"),p.EMPTY_ELEMENT=t("translate")("add_elements_menu.EMPTY_ELEMENT"),p.NAME_LABEL=t("translate")("add_elements.NAME_LABEL"),p.QTY_LABEL=t("translate")("add_elements.QTY_LABEL"),p.WIDTH_LABEL=t("translate")("add_elements.WIDTH_LABEL"),p.HEIGHT_LABEL=t("translate")("add_elements.HEIGHT_LABEL"),p.ADD=t("translate")("add_elements.ADD"),p.TAB_NAME_SIMPLE_FRAME=t("translate")("add_elements_menu.TAB_NAME_SIMPLE_FRAME"),p.TAB_NAME_HARD_FRAME=t("translate")("add_elements_menu.TAB_NAME_HARD_FRAME"),p.TAB_EMPTY_EXPLAIN=t("translate")("add_elements_menu.TAB_EMPTY_EXPLAIN"),p.selectAddElementList=d.selectAddElementList,p.closeAddElementsMenu=s.closeAddElementsMenu,p.selectAddElement=d.selectAddElem,p.chooseAddElement=s.chooseAddElement,p.chooseAddElementList=s.chooseAddElementList,p.deleteAddElement=s.deleteAddElement,p.showFrameTabs=u,p.initAddElementTools=d.initAddElementTools,p.showInfoBox=l.showInfoBox,p.closeQtyCaclulator=s.closeQtyCaclulator,p.setValueQty=s.setValueQty,p.pressCulculator=s.pressCulculator,p.hideMenu=d.hideMenu}])}(),function(){angular.module("CartModule").controller("CartMenuCtrl",["$filter","globalConstants","GlobalStor","OrderStor","UserStor","CartStor","ProductStor","CartMenuServ",function(e,t,i,o,r,a,n,l){function s(e){p.config.activeMenuItem=p.config.activeMenuItem===e?0:e}function d(){o.order.is_instalment=0,o.order.instalment_id=0,o.order.selectedInstalmentPeriod=0,o.order.selectedInstalmentPercent=0,p.config.activeMenuItem=0}function c(){o.order.products.length&&(a.cart.isMasterDialog=1)}function u(){o.order.products.length&&(o.order.is_instalment?a.cart.isCreditDialog=1:a.cart.isOrderDialog=1)}var p=this;p.G=i,p.U=r,p.O=o,p.C=a,p.P=n,p.config={activeMenuItem:!1,month:e("translate")("common_words.MONTH_LABEL"),montha:e("translate")("common_words.MONTHA_LABEL"),months:e("translate")("common_words.MONTHS_LABEL"),DELAY_START:t.STEP,typing:"on"},p.DELIVERY=e("translate")("cart.DELIVERY"),p.SELF_EXPORT=e("translate")("cart.SELF_EXPORT"),p.FLOOR=e("translate")("cart.FLOOR"),p.ASSEMBLING=e("translate")("cart.ASSEMBLING"),p.WITHOUT_ASSEMBLING=e("translate")("cart.WITHOUT_ASSEMBLING"),p.FREE=e("translate")("cart.FREE"),p.PAYMENT_BY_INSTALMENTS=e("translate")("cart.PAYMENT_BY_INSTALMENTS"),p.WITHOUT_INSTALMENTS=e("translate")("cart.WITHOUT_INSTALMENTS"),p.DELIVERY_DATE=e("translate")("cart.DELIVERY_DATE"),p.FIRST_PAYMENT_LABEL=e("translate")("cart.FIRST_PAYMENT_LABEL"),p.DATE_DELIVERY_LABEL=e("translate")("cart.DATE_DELIVERY_LABEL"),p.MONTHLY_PAYMENT_LABEL=e("translate")("cart.MONTHLY_PAYMENT_LABEL"),p.TOTAL_PRICE_LABEL=e("translate")("cart.TOTAL_PRICE_LABEL"),p.ORDER=e("translate")("cart.ORDER"),p.MEASURE=e("translate")("cart.MEASURE"),p.ROOM_SELECTION=e("translate")("mainpage.ROOM_SELECTION"),p.COMMENT=e("translate")("mainpage.COMMENT"),p.selectMenuItem=s,p.closeInstalment=d,p.selectFloorPrice=l.selectFloorPrice,p.selectAssembling=l.selectAssembling,p.selectInstalment=l.selectInstalment,p.openMasterDialog=c,p.openOrderDialog=u,p.swipeDiscountBlock=l.swipeDiscountBlock}])}(),function(){angular.module("MainModule").controller("ConfigMenuCtrl",["$location","$filter","$timeout","globalConstants","GeneralServ","MainServ","AddElementMenuServ","DesignServ","GlobalStor","OrderStor","ProductStor","DesignStor","UserStor","InfoBoxServ",function(e,t,i,o,r,a,n,l,s,d,c,u,p,g){function m(t){a.laminatFiltering(),(s.global.isQtyCalculator||s.global.isSizeCalculator)&&n.finishCalculators(),s.global.showRoomSelectorDialog=0,s.global.configMenuTips=0,s.global.isShowCommentBlock=0,s.global.isTemplateTypeMenu=0,r.stopStartProg(),a.setDefaultAuxParam(),s.global.showGlassSelectorDialog&&l.closeGlassSelectorDialog(1),1===t?(s.global.templateTEMP=angular.copy(c.product),s.global.activePanel=0,u.design.isGlassExtra=0,e.path("/design")):4===c.product.construction_type?3===t||6===t||5===t?s.global.activePanel=s.global.activePanel===t?0:t:(s.global.activePanel=0,u.design.isGlassExtra=0,e.path("/design")):s.global.activePanel=s.global.activePanel===t?0:t,0!==s.global.activePanel&&0===s.global.setTimeout&&(s.global.setTimeout=1,i(function(){g.autoShow(t)},4e3))}function f(){s.global.continued=0,a.inputProductInOrder()&&a.goToCart()}function _(){s.global.nameAddElem=[];for(var e=0;e<c.product.chosenAddElements.length;e+=1)for(var t=0;t<c.product.chosenAddElements[e].length;t+=1){for(var i={name:"",product:0,tr:"",list:0},o=0;o<s.global.dataProfiles.length;o+=1)c.product.chosenAddElements[e][t].parent_element_id===s.global.dataProfiles[o].element_id?i.tr=c.product.chosenAddElements[e][t].name:(i.name=c.product.chosenAddElements[e][t].name,i.list=c.product.chosenAddElements[e][t].list_group_id);s.global.nameAddElem.push(i)}for(var r=0;r<s.global.nameAddElem.length;r+=1)s.global.nameAddElem[r].name!==s.global.nameAddElem[r].tr&&20!==s.global.nameAddElem[r].list||delete s.global.nameAddElem[r].name;for(var r=0;r<s.global.nameAddElem.length;r+=1)void 0!==s.global.nameAddElem[r].name&&0===s.global.continued&&0===c.product.is_addelem_only&&(s.global.dangerAlert=1)}function h(){c.product.is_addelem_only?f():(_(),s.global.dangerAlert<1&&(c.product.beadsData.length>0?f():r.isErrorProd(t("translate")("common_words.ERROR_PROD_BEADS"))))}function y(){var e=E.config.TOOLTIP.length;s.global.configMenuTips+=1,s.global.configMenuTips===e&&(s.global.configMenuTips=0)}var E=this;E.constants=o,E.G=s,E.O=d,E.P=c,E.U=p,E.config={TOOLTIP:["",t("translate")("mainpage.TEMPLATE_TIP"),t("translate")("mainpage.PROFILE_TIP"),t("translate")("mainpage.GLASS_TIP")],DELAY_START:o.STEP,DELAY_SHOW_CONFIG_LIST:5*o.STEP,DELAY_SHOW_FOOTER:5*o.STEP,DELAY_TYPE_ITEM_TITLE:10*o.STEP,DELAY_SHOW_U_COEFF:20*o.STEP,DELAY_GO_TO_CART:2*o.STEP,typing:"on"},E.CONFIGMENU_CONFIGURATION=t("translate")("mainpage.CONFIGMENU_CONFIGURATION"),E.CONFIGMENU_SIZING=t("translate")("mainpage.CONFIGMENU_SIZING"),E.MM=t("translate")("mainpage.MM"),E.CONFIGMENU_PROFILE=t("translate")("mainpage.CONFIGMENU_PROFILE"),E.CONFIGMENU_GLASS=t("translate")("mainpage.CONFIGMENU_GLASS"),E.CONFIGMENU_HARDWARE=t("translate")("mainpage.CONFIGMENU_HARDWARE"),E.CONFIGMENU_LAMINATION=t("translate")("mainpage.CONFIGMENU_LAMINATION"),E.CONFIGMENU_LAMINATION_TYPE=t("translate")("mainpage.CONFIGMENU_LAMINATION_TYPE"),E.CONFIGMENU_ADDITIONAL=t("translate")("mainpage.CONFIGMENU_ADDITIONAL"),E.CONFIGMENU_NO_ADDELEMENTS=t("translate")("mainpage.CONFIGMENU_NO_ADDELEMENTS"),E.CONFIGMENU_IN_CART=t("translate")("mainpage.CONFIGMENU_IN_CART"),E.SAVE=t("translate")("settings.SAVE"),E.LETTER_M=t("translate")("common_words.LETTER_M"),E.HEATCOEF_VAL=t("translate")("mainpage.HEATCOEF_VAL"),E.autoShowInfoBox=g.autoShowInfoBox,E.selectConfigPanel=m,E.inputProductInOrder=f,E.showNextTip=y,E.alert=_,E.checkForAddElem=h}])}(),function(){angular.module("MainModule").controller("NavMenuCtrl",["$location","$window","$filter","globalConstants","GeneralServ","NavMenuServ","GlobalStor","OrderStor","ProductStor","UserStor",function(e,t,i,o,r,a,n,l,s,d){function c(t){switch(p.activeMenuItem=p.activeMenuItem===t?0:t,t){case 1:r.stopStartProg(),e.path("/location");break;case 2:a.getCurrentGeolocation(),p.activeMenuItem=0;break;case 3:r.setPreviosPage(),e.path("/main");break;case 4:e.path("/cart");break;case 5:a.createAddElementsProduct();break;case 6:r.stopStartProg(),a.gotoHistoryPage();break;case 7:r.setPreviosPage(),e.path("/settings");break;case 8:p.activeMenuItem=0,d.userInfo.factoryLink&&d.userInfo.factoryLink.length&&r.goToLink(d.userInfo.factoryLink);break;case 9:a.switchVoiceHelper()}}function u(){p.activeMenuItem=0,a.clickNewProject()}var p=this;p.G=n,p.O=l,p.P=s,p.activeMenuItem=0,p.NAVMENU_GEOLOCATION=i("translate")("mainpage.NAVMENU_GEOLOCATION"),p.NAVMENU_CURRENT_GEOLOCATION=i("translate")("mainpage.NAVMENU_CURRENT_GEOLOCATION"),p.NAVMENU_CALCULATIONS=i("translate")("mainpage.NAVMENU_CALCULATIONS"),p.NAVMENU_CURRENT_CALCULATION=i("translate")("mainpage.NAVMENU_CURRENT_CALCULATION"),p.NAVMENU_CART=i("translate")("mainpage.NAVMENU_CART"),p.NAVMENU_ADD_ELEMENTS=i("translate")("mainpage.NAVMENU_ADD_ELEMENTS"),p.NAVMENU_ALL_CALCULATIONS=i("translate")("mainpage.NAVMENU_ALL_CALCULATIONS"),p.NAVMENU_APPENDIX=i("translate")("mainpage.NAVMENU_APPENDIX"),p.NAVMENU_SETTINGS=i("translate")("mainpage.NAVMENU_SETTINGS"),p.NAVMENU_MORE_INFO=i("translate")("mainpage.NAVMENU_MORE_INFO"),p.NAVMENU_VOICE_HELPER=i("translate")("mainpage.NAVMENU_VOICE_HELPER"),p.NAVMENU_NEW_CALC=i("translate")("mainpage.NAVMENU_NEW_CALC"),p.selectMenuItem=c,p.clickNewProject=u}])}(),function(){angular.module("CartModule").controller("AddElemCartCtrl",["globalConstants","GeneralServ","CartServ","CartMenuServ","OrderStor","CartStor","AuxStor",function(e,t,i,o,r,a,n){function l(){a.cart.isAllAddElems=0,a.cart.allAddElemsOrder.length=0,a.cart.addElemsOrderPriceTOTAL=0,a.cart.isSelectedProduct=0,n.aux.showAddElementsMenu=0,n.aux.addElementGroups.length=0,n.aux.searchingWord=""}function s(e){for(var t,i,o,a=r.order.products,n=a.length;--n>-1;)for(o=a[n].chosenAddElements,t=o.length;--t>-1;)if(i=o[t].length)if(e)for(;--i>-1;)o[t][i].id===e.id&&o[t][i].element_width===e.element_width&&o[t][i].element_height===e.element_height&&o[t].splice(i,1);else o[t].length=0}function d(e){s(e),o.joinAllAddElements(),a.cart.isExistAddElems?i.showAllAddElements():l(),i.calculateAddElemsProductsPrice(1),o.calculateOrderPrice()}function c(){s(),i.calculateAddElemsProductsPrice(),o.calculateOrderPrice(),o.joinAllAddElements(),l()}function u(){var e,t,i,o,n,l,s,d=a.cart.allAddElements.length;for(T.config.addElemUnitProducts.length=0,i=0;i<d;i+=1)for(s=a.cart.allAddElements[i],e=s.length,o=0;o<e;o+=1)if(s[o].id===T.config.selectedAddElemUnit.id&&s[o].element_width===T.config.selectedAddElemUnit.element_width&&s[o].element_height===T.config.selectedAddElemUnit.element_height)if(r.order.products[i].is_addelem_only)t={productIndex:i,is_addelem_only:r.order.products[i].is_addelem_only,name:s[o].name,element_width:s[o].element_width,element_height:s[o].element_height,element_qty:s[o].element_qty,elementPriceDis:s[o].elementPriceDis},T.config.addElemUnitProducts.push(t);else if(t={productIndex:i,is_addelem_only:r.order.products[i].is_addelem_only,element_qty:s[o].element_qty/r.order.products[i].product_qty},r.order.products[i].product_qty>1){for(n=[],l=+r.order.products[i].product_qty;--l>-1;)n.push(t);T.config.addElemUnitProducts.push(n)}else T.config.addElemUnitProducts.push(t)}function p(e){T.config.selectedAddElemUnit=e,u(),T.config.isAddElemUnitDetail=1}function g(){T.config.isAddElemUnitDetail=0,T.config.selectedAddElemUnit={id:0},T.config.isLinkExplodeMenu=0}function m(e){for(var t,i=r.order.products[e].chosenAddElements,o=i.length,a=T.config.selectedAddElemUnit;--o>-1;)if(t=i[o].length)for(;--t>-1;)i[o][t].id===a.id&&i[o][t].element_width===a.element_width&&i[o][t].element_height===a.element_height&&i[o].splice(t,1)}function f(){for(var e=a.cart.allAddElemsOrder,t=T.config.selectedAddElemUnit,i=e.length,o=1;--i>-1;)e[i].id===t.id&&(t.element_qty=angular.copy(e[i].element_qty),o-=1);o&&g()}function _(e,t){t?i.decreaseProductQty(e[0].productIndex):(m(e),o.joinAllAddElements()),a.cart.isExistAddElems?(i.showAllAddElements(),u(),f()):(g(),l()),i.calculateAddElemsProductsPrice(1),o.calculateOrderPrice()}function h(e,t){T.config.isLinkExplodeMenu=!T.config.isLinkExplodeMenu,T.config.explodeMenuTop=t.center.y-50,T.config.explodeMenuLeft=t.center.x-30}function y(e,t){var a=d3.max(r.order.products.map(function(e){return e.product_id})),n=angular.copy(r.order.products[e[0].productIndex]),l=n.product_qty-1;if(n.product_qty=1,t)for(r.order.products[e[0].productIndex].product_qty=1;--l>-1;)i.addCloneProductInOrder(n,a);else r.order.products[e[0].productIndex].product_qty-=1,i.addCloneProductInOrder(n,a);T.config.isLinkExplodeMenu=0,o.joinAllAddElements(),i.showAllAddElements(),u(),f(),i.calculateAddElemsProductsPrice(1),o.calculateOrderPrice()}function E(){T.config.isSwipeProdSelector=!T.config.isSwipeProdSelector}function b(){for(var e=0,t=a.cart.selectedProducts.length;--t>-1;)a.cart.selectedProducts[t].length&&(e+=1);a.cart.isSelectedProduct=e?1:0}function v(e){var t=a.cart.selectedProducts[e].length;t?(a.cart.selectedProducts[e].length=0,b()):(a.cart.selectedProducts[e].push(1),a.cart.isSelectedProduct=1)}var T=this;T.constants=e,T.config={addElementDATA:t.addElementDATA,selectedAddElemUnit:{id:0},isAddElemUnitDetail:0,addElemUnitProducts:[],isLinkExplodeMenu:0,explodeMenuTop:0,explodeMenuLeft:0,isSwipeProdSelector:0},T.closeAllAddElemsPanel=l,T.deleteAllAddElems=c,T.deleteAddElemsItem=d,T.showAddElemUnitDetail=p,T.closeAddElemUnitDetail=g,T.deleteAddElemUnit=_,T.toggleExplodeLinkMenu=h,T.explodeUnitToProduct=y,T.swipeProductSelector=E,T.selectProductToAddElem=v}])}(),function(){angular.module("MainModule").controller("AddElementsListCtrl",["$filter","globalConstants","GeneralServ","AddElementsServ","AddElementMenuServ","GlobalStor","ProductStor","UserStor","AuxStor",function(e,t,i,o,r,a,n,l,s){var d=this;d.G=a,d.P=n,d.U=l,d.A=s,d.config={addElementDATA:i.addElementDATA,DELAY_START:t.STEP,DELAY_SHOW_ELEMENTS_MENU:6*t.STEP,filteredGroups:[],typing:"on"},d.NAME_LABEL=e("translate")("add_elements.NAME_LABEL"),d.QTY_LABEL=e("translate")("add_elements.QTY_LABEL"),d.WIDTH_LABEL=e("translate")("add_elements.WIDTH_LABEL"),d.HEIGHT_LABEL=e("translate")("add_elements.HEIGHT_LABEL"),d.TOTAL_PRICE_TXT=e("translate")("add_elements.TOTAL_PRICE_TXT"),d.SCHEME_VIEW=e("translate")("add_elements.SCHEME_VIEW"),d.selectAddElement=o.selectAddElement,d.initAddElementTools=o.initAddElementTools,d.deleteAddElement=r.deleteAddElement,d.deleteAllAddElements=r.deleteAllAddElements,d.closeAddElementListView=o.closeAddElementListView,d.pressCulculator=r.pressCulculator}])}(),function(){angular.module("MainModule").controller("AddElementsCtrl",["$filter","$timeout","globalConstants","GeneralServ","AddElementsServ","AddElementMenuServ","DesignServ","GlobalStor","AuxStor","ProductStor",function(e,t,i,o,r,a,n,l,s,d){function c(){filterAddElem(),s.aux.isWindowSchemeDialog=!0,n.showAllDimension(i.SVG_ID_ICON)}function u(){s.aux.isWindowSchemeDialog=!1}function p(e){l.global.typeMenu=0,l.global.typeMenuID=e,t(function(e){l.global.typeMenu=l.global.typeMenuID,g.config.colorFilter=l.global.typeMenuID,5555===l.global.typeMenu?$(".aux-handle").css({left:"14.375rem",top:"82.625rem"}):$(".aux-handle").css({left:"34.375rem",top:"65.625rem"})},100)}var g=this;g.constants=i,g.G=l,g.P=d,g.A=s,g.config={DELAY_START:i.STEP,addElementDATA:o.addElementDATA,DELAY_SHOW_INSIDESLOPETOP:20*i.STEP,DELAY_SHOW_INSIDESLOPERIGHT:22*i.STEP,DELAY_SHOW_INSIDESLOPELEFT:21*i.STEP,DELAY_SHOW_FORCECONNECT:30*i.STEP,DELAY_SHOW_BALCONCONNECT:35*i.STEP,DELAY_SHOW_BUTTON:40*i.STEP,DELAY_SHOW_ELEMENTS_MENU:12*i.STEP,colorFilter:5555,typing:"on"},g.INSIDES=e("translate")("add_elements.INSIDES"),g.OUTSIDES=e("translate")("add_elements.OUTSIDES"),g.COMPONENTS=e("translate")("add_elements.COMPONENTS"),g.OTHERS=e("translate")("add_elements.OTHERS"),g.OTHER=e("translate")("add_elements.OTHER"),g.ALL=e("translate")("add_elements.ALL"),g.CHOOSE=e("translate")("add_elements.CHOOSE"),g.QTY_LABEL=e("translate")("add_elements.QTY_LABEL"),g.WIDTH_LABEL=e("translate")("add_elements.WIDTH_LABEL"),g.HEIGHT_LABEL=e("translate")("add_elements.HEIGHT_LABEL"),g.OTHER_ELEMENTS1=e("translate")("add_elements.OTHER_ELEMENTS1"),g.OTHER_ELEMENTS2=e("translate")("add_elements.OTHER_ELEMENTS2"),g.LIST_VIEW=e("translate")("add_elements.LIST_VIEW"),g.click=p,g.selectAddElement=r.selectAddElement,g.initAddElementTools=r.initAddElementTools,g.pressCulculator=a.pressCulculator,g.openAddElementListView=r.openAddElementListView,g.showWindowScheme=c,g.closeWindowScheme=u}])}(),function(){angular.module("MainModule").controller("GlassesCtrl",["$filter","globalConstants","MainServ","AnalyticsServ","DesignServ","SVGServ","GlobalStor","OrderStor","ProductStor","DesignStor","UserStor","GlassesServ",function(e,t,i,o,r,a,n,l,s,d,c,u){function p(){var e;d.design.selectedGlass.length=0,a.createSVGTemplate(s.product.template_source,s.product.profileDepths).then(function(t){s.product.template=angular.copy(t),e=s.product.hardware.id||0,i.preparePrice(s.product.template,s.product.profile.id,s.product.glass,e,s.product.lamination.lamination_in_id)})}function g(){i.setGlassToTemplateBlocks(n.global.selectGlassType,s.product.template_source,n.global.selectGlassId,n.global.selectGlassName),p(),r.closeGlassSelectorDialog()}function m(){var e,t=d.design.selectedGlass.length,o=angular.copy(s.product.glass);if(t||i.setGlassToTemplateBlocks(n.global.selectGlassType,s.product.template,n.global.selectGlassId,n.global.selectGlassName),i.setCurrentGlass(s.product,n.global.selectGlassId),i.checkGlassSizes(s.product.template),d.design.extraGlass.length)d.design.isGlassExtra=1,s.product.glass=angular.copy(o),i.setGlassToTemplateBlocks(n.global.selectGlassType,s.product.template,n.global.prevGlassId,n.global.prevGlassName);else if(t){for(;--t>-1;)e=d.design.selectedGlass[t].attributes.block_id.nodeValue,i.setGlassToTemplateBlocks(n.global.selectGlassType,s.product.template_source,n.global.selectGlassId,n.global.selectGlassName,e);p(),r.closeGlassSelectorDialog()}else g();a.createSVGTemplateIcon(s.product.template_source,s.product.profileDepths).then(function(e){s.product.templateIcon=angular.copy(e)})}var f=this;f.constants=t,f.G=n,f.P=s,f.config={prevGlassId:0,prevGlassName:"",glassLabels:["panels.CAMER_GLASS","panels.CAMER_1","panels.CAMER_1","panels.CAMER_2","panels.CAMER_2","panels.CAMER_2","panels.CAMER_2"],DELAY_START:5*t.STEP,DELAY_BLOCK:2*t.STEP,DELAY_TYPING:2.5*t.STEP,typing:"on"},f.ENERGY_SAVE=e("translate")("panels.ENERGY_SAVE"),f.HEAT_INSULATION=e("translate")("panels.HEAT_INSULATION"),f.NOICE_INSULATION=e("translate")("panels.NOICE_INSULATION"),f.selectGlass=u.selectGlass,f.confirmGlass=m,f.setGlassToAll=g,f.closeGlassSelectorDialog=r.closeGlassSelectorDialog,f.showInfoBox=i.showInfoBox}])}(),function(){angular.module("MainModule").controller("HardwaresCtrl",["$filter","globalConstants","GlobalStor","OrderStor","ProductStor","DesignStor","UserStor","MainServ","AnalyticsServ","HardwareServ",function(e,t,i,o,r,a,n,l,s,d){var c=this;c.G=i,c.P=r,c.config={DELAY_START:5*t.STEP,DELAY_BLOCK:2*t.STEP,DELAY_TYPING:2.5*t.STEP,typing:"on"},c.BRAND=e("translate")("panels.BRAND"),c.COUNTRY=e("translate")("panels.COUNTRY"),c.CORROSION_COEFF=e("translate")("panels.CORROSION_COEFF"),c.BURGLAR_COEFF=e("translate")("panels.BURGLAR_COEFF"),c.selectHardware=d.selectHardware,c.showInfoBox=l.showInfoBox}])}(),function(){angular.module("MainModule").controller("LaminationsCtrl",["$filter","globalConstants","MainServ","GlobalStor","OrderStor","ProductStor","UserStor",function(e,t,i,o,r,a,n){function l(e){for(var t=o.global.laminats.length;--t>-1;)o.global.laminats[t].type_id===e&&(o.global.laminats[t].isActive=!o.global.laminats[t].isActive,i.laminatFiltering())}function s(e){i.laminatFiltering(),i.setCurrLamination(a.product,e),i.setProfileByLaminat(e).then(function(){})}var d=this;d.G=o,d.P=a,d.config={DELAY_START:5*t.STEP,DELAY_BLOCK:2*t.STEP,DELAY_TYPING:2.5*t.STEP,typing:"on"},d.LAMINAT_INSIDE=e("translate")("panels.LAMINAT_INSIDE"),d.LAMINAT_OUTSIDE=e("translate")("panels.LAMINAT_OUTSIDE"),d.selectLaminat=s,d.initLaminatFilter=l,d.showInfoBox=i.showInfoBox}])}(),function(){angular.module("MainModule").controller("ProfilesCtrl",["$filter","globalConstants","GlobalStor","ProductStor","ProfileServ","MainServ",function(e,t,i,o,r,a){var n=this;n.G=i,n.P=o,n.config={camera:e("translate")("panels.CAMERa"),camer:e("translate")("panels.CAMER"),camers:e("translate")("panels.CAMERs"),DELAY_START:5*t.STEP,DELAY_BLOCK:2*t.STEP,DELAY_TYPING:2.5*t.STEP,typing:"on"},n.COUNTRY=e("translate")("panels.COUNTRY"),n.HEAT_INSULATION=e("translate")("panels.HEAT_INSULATION"),n.NOICE_INSULATION=e("translate")("panels.NOICE_INSULATION"),n.alert=alert,n.checkForAddElem=r.checkForAddElem,n.profileForAlert=r.profileForAlert,n.selectProfile=r.selectProfile,n.showInfoBox=a.showInfoBox}])}(),function(){angular.module("MainModule").controller("TemplatesCtrl",["$location","$filter","globalConstants","MainServ","GeneralServ","TemplatesServ","optionsServ","GlobalStor","DesignStor","OrderStor","ProductStor",function(e,t,i,o,r,a,n,l,s,d,c){function u(){l.global.isTemplateTypeMenu=!l.global.isTemplateTypeMenu}function p(e){l.global.activePanel=-1,l.global.selectedTemplate=-1,g.selected=e,e=3==e?4:e,l.global.templatesType=e,n.getTemplateImgIcons(function(t){t.status&&(l.global.templatesImgs=t.data.templateImgs.filter(function(t){return t.type===e}))}),o.downloadAllTemplates(e).then(function(e){e&&(l.global.templatesSourceSTORE=angular.copy(e),l.global.templatesSource=angular.copy(e))}),l.global.isTemplateTypeMenu=0}var g=this;g.constants=i,g.G=l,g.O=d,g.P=c,g.config={DELAY_TEMPLATE_ELEMENT:5*i.STEP,typing:"on"},g.templateName=["panels.TEMPLATE_WINDOW_HAND","panels.TEMPLATE_BALCONY_HAND","panels.TEMPLATE_DOOR_HAND"],g.selected=c.product.construction_type,g.TEMPLATE_WINDOW_HAND=t("translate")("panels.TEMPLATE_WINDOW_HAND"),g.TEMPLATE_BALCONY_HAND=t("translate")("panels.TEMPLATE_BALCONY_HAND"),g.TEMPLATE_DOOR_HAND=t("translate")("panels.TEMPLATE_DOOR_HAND"),g.TEMPLATE_WINDOW=t("translate")("panels.TEMPLATE_WINDOW"),g.TEMPLATE_DOOR=t("translate")("panels.TEMPLATE_DOOR"),g.TEMPLATE_BALCONY_ENTER=t("translate")("panels.TEMPLATE_BALCONY_ENTER"),g.TEMPLATE_BALCONY=t("translate")("panels.TEMPLATE_BALCONY"),n.getTemplateImgIcons(function(e){e.status?l.global.templatesImgs=e.data.templateImgs:console.log(e)}),g.selectNewTemplate=a.selectNewTemplate,g.toggleTemplateType=u,g.selectNewTemplateType=p}])}(),function(){angular.module("MainModule").controller("AddElemGroupMenuCtrl",["AddElementsServ","AddElementMenuServ","DesignServ","GlobalStor","ProductStor","AuxStor",function(e,t,i,o,r,a){function n(t){a.aux.isAddElement=0,e.selectAddElement(t)}var l=this;l.A=a,l.takeAddElemMenu=n,l.takeAddElemFilt=t.takeAddElemFilt}])}(),function(){angular.module("MainModule").controller("AlertCtrl",["$filter","GlobalStor",function(e,t){function i(){t.global.isAlert=0,t.global.confirmAction()}function o(){t.global.isAlert=0,t.global.confirmInActivity()}function r(){t.global.isAlert=0,t.global.isBox=0}var a=this;a.G=t,a.BUTTON_N=e("translate")("common_words.BUTTON_N"),a.BUTTON_Y=e("translate")("common_words.BUTTON_Y"),a.BUTTON_C=e("translate")("common_words.BUTTON_C"),a.BUTTON_E=e("translate")("common_words.BUTTON_E"),a.OK=e("translate")("common_words.OK"),a.isAlert=r,a.clickYes=i,a.clickCopy=o}])}(),function(){angular.module("MainModule").controller("AttantCtrl",["$filter","DesignStor","HistoryStor",function(e,t,i){function o(){t.design.isGlassExtra=0,t.design.isHardwareExtra=0,i.history.isNoPrint=0,t.design.isNoDoors=0}var r=this;r.D=t,r.H=i,r.NO_PRINT=e("translate")("history.NO_PRINT"),r.EXTRA_SASH=e("translate")("design.EXTRA_SASH"),r.CHANGE_SIZE=e("translate")("design.CHANGE_SIZE"),r.DOOR_ERROR=e("translate")("design.DOOR_ERROR"),r.closeAttantion=o}])}(),function(){angular.module("MainModule").controller("DoorCheckCtrl",["$filter","DesignStor","HistoryStor","GlobalStor","DesignServ",function(e,t,i,o,r){var a=this;a.D=t,a.G=o,a.TEXT1=e("translate")("natification.TEXT1"),a.TEXT2=e("translate")("natification.TEXT2"),a.TEXT3=e("translate")("natification.TEXT3"),a.EDIT_HARDWARE=e("translate")("natification.EDIT_HARDWARE"),a.EDIT_SIZE=e("translate")("natification.EDIT_SIZE"),a.stepBack=r.stepBack,a.toggleDoorConfig=r.toggleDoorConfig}])}(),function(){angular.module("MainModule").controller("DangerAlertCtrl",["$filter","GlobalStor","HistoryStor",function(e,t,i){function o(){t.global.nameAddElem=[],t.global.dangerAlert=0}function r(){t.global.nameAddElem=[],t.global.dangerAlert=0,t.global.continued=1}var a=this;a.G=t,a.H=i,a.DANGER_ALERT_FIRST_PAGE=e("translate")("danger-alert.DANGER_ALERT_FIRST_PAGE"),a.DANGER_ALERT_SECOND_PAGE=e("translate")("danger-alert.DANGER_ALERT_SECOND_PAGE"),a.IGNORE=e("translate")("danger-alert.IGNORE"),a.PRODUCT=e("translate")("danger-alert.PRODUCT"),a.close=o,a.continued=r}])}(),function(){angular.module("HistoryModule").controller("EditOrderCtrl",["$q","$filter","OrderStor","HistoryStor","CartStor","GlobalStor","ProductStor","RecOrderServ","MainServ","localDB","UserStor","HistoryServ","AddElementMenuServ","CartMenuServ",function(e,t,i,o,r,a,n,l,s,d,c,u,p,g){function m(){function e(e,l){i.order=i.setDefaultOrder(),n.product=n.setDefaultProduct(),async.waterfall([function(t){i.order.id=angular.copy(e.order_id),n.product.chosenAddElements=angular.copy(e.addElementDATA),n.product.order_id=angular.copy(e.order_id),n.product.template_source=angular.copy(e.template_source),n.product.template=angular.copy(e.template_source),n.product.templateIcon=angular.copy(e.template_source),n.product.hardware=angular.copy(e.hardware||{}),n.product.lamination=angular.copy(e.lamination),n.product.product_id=angular.copy(e.product_id),n.product.is_addelem_only=angular.copy(e.is_addelem_only),n.product.profile=angular.copy(e.profile),n.product.glass=angular.copy(e.glass_id),n.product.is_addelem_only=angular.copy(e.is_addelem_only),n.product.construction_type=angular.copy(e.construction_type),t(null)},function(e){0===n.product.is_addelem_only?s.setCurrentProfile(n.product,n.product.profile.id).then(function(t){s.saveTemplateInProductForOrder().then(function(t){var i=n.product.profile.id,o=n.product.hardware_id,r=n.product.lamination.lamination_in_id,a=n.product.glass;s.preparePrice(n.product.template,i,a,o,r).then(function(t){e()})})}):(n.product.glass=[],n.product.profile={},n.product.hardware={},n.product.lamination={id:0,img_in_id:1,img_out_id:1,laminat_in_name:"mainpage.WHITE_LAMINATION",laminat_out_name:"mainpage.WHITE_LAMINATION",lamination_in_id:1,lamination_out_id:1},e())},function(e){p.setAddElementsTotalPrice(n.product),e()},function(e){s.setProductPriceTOTAL(n.product),e()},function(e){i.order.products.push(n.product),e()},function(e){g.calculateAllProductsPrice(),e()},function(e){g.calculateOrderPrice(),e()},function(e){i.order.products.length;t=o.history.isBoxArray.order_style,r=o.history.isBoxArray.order_type,s.saveOrderInDB(o.history.isBoxArray.info,r,t).then(function(e){u.downloadOrders(),a.global.isEditBox=0,a.global.isBox=0}),e()},function(e){i.order=i.setDefaultOrder(),e()}],function(e,t){return e?l(e):void l(null)})}g.calculateAllProductsPrice(),g.calculateOrderPrice(),o.history.price=0;var t="",r=0;n.product=n.setDefaultProduct(),i.order=i.setDefaultOrder();var l,d=o.history.isBoxArray.products.length;for(l=0;l<d;l+=1){var c=angular.copy(o.history.isBoxArray.products[l].order_id);s.deleteOrderInDB(c)}var m=o.history.isBoxArray.products;async.eachSeries(m,e,function(e,t){console.log("end")}),o.history.listName=[],o.history.isBoxArrayCopy=[],o.history.listNameHardware=[],o.history.listNameProfiles=[];
}function f(){a.global.isEditBox=0,a.global.isAlertHistory=0,a.global.isBox=0,o.history.isBoxArray=[],o.history.isBoxArrayCopy=[],o.history.listName=[],o.history.listNameHardware=[],o.history.listNameProfiles=[]}function _(e){a.global.continued=0,l.nameListLaminat(e),l.nameListGlasses(e)}function h(){a.global.dangerAlert<1&&(l.extend(),m()),a.global.isAlertHistory=0}var y=this;y.O=i,y.C=r,y.H=o,y.G=a,y.P=n,y.CONFIGMENU_PROFILE=t("translate")("mainpage.CONFIGMENU_PROFILE"),y.CONFIGMENU_ALERT=t("translate")("mainpage.CONFIGMENU_ALERT"),y.CONFIGMENU_GLASS=t("translate")("mainpage.CONFIGMENU_GLASS"),y.CONFIGMENU_HARDWARE=t("translate")("mainpage.CONFIGMENU_HARDWARE"),y.CONFIGMENU_LAMINATION=t("translate")("mainpage.CONFIGMENU_LAMINATION"),y.WIDTH_LABEL=t("translate")("add_elements.WIDTH_LABEL"),y.HEIGHT_LABEL=t("translate")("add_elements.HEIGHT_LABEL"),y.QTY_LABEL=t("translate")("add_elements.QTY_LABEL"),y.checkProd=h,y.saveOrder=m,y.close=f,y.extend=l.extend,y.itemsForLists=_,y.box=l.box,y.downloadOrders=u.downloadOrders}])}(),function(){angular.module("MainModule").controller("ErrorProdCtrl",["$filter","GlobalStor",function(e,t){function i(){t.global.isErrorProd=0,t.global.isErrorProdTitle="title"}var o=this;o.G=t,o.BUTTON_N=e("translate")("common_words.DELETE_ORDER_TITLE"),o.close=i}])}(),function(){angular.module("MainModule").controller("GridSelectorCtrl",["$filter","AddElementMenuServ","globalConstants","ProductStor","AuxStor",function(e,t,i,o,r){var a=this;a.constants=i,a.P=o,a.A=r,a.SELECT_ALL=e("translate")("mainpage.SELECT_ALL"),a.SELECT_GLASS_WARN=e("translate")("mainpage.SELECT_GLASS_WARN"),a.confirmGrid=t.confirmGrid,a.setGridToAll=t.setGridToAll,a.closeGridSelectorDialog=t.closeGridSelectorDialog}])}(),function(){angular.module("MainModule").controller("infoBoxCtrl",["GlobalStor","InfoBoxServ","$filter",function(e,t,i){function o(t){t.stopPropagation(),1===e.global.showApply&&(e.global.inform=1),e.global.showApply=0,e.global.isInfoBox=0,e.global.infoTitle="",e.global.infoImg="",e.global.infoLink="",e.global.infoDescrip=""}var r=this;r.G=e,r.ASKING_PRICE=i("translate")("natification.ASKING_PRICE"),r.closeInfoBox=o,r.isApply=t.isApply}])}(),function(){angular.module("MainModule").controller("LoaderCtrl",["GlobalStor",function(e){var t=this;t.G=e}])}(),function(){angular.module("CartModule").controller("OrderFormCtrl",["$filter","GlobalStor","OrderStor","UserStor","CartStor","CartMenuServ",function(e,t,i,o,r,a){function n(e){r.cart.submitted=!0,e.$valid&&1===t.global.changeLocation?a.sendOrder():0===t.global.changeLocation?(r.cart.customer.customer_location=void 0,$("#impLocation").val(""),e.location.$viewValue="",e.location.$modelValue="",e.location.$valid=!1,$(".cart-dialogs").animate({scrollTop:0},500)):$(".cart-dialogs").animate({scrollTop:0},500)}var l=this;l.O=i,l.C=r,l.U=o,l.config={month:e("translate")("common_words.MONTH_LABEL"),montha:e("translate")("common_words.MONTHA_LABEL"),months:e("translate")("common_words.MONTHS_LABEL")},l.CALL_ORDER=e("translate")("cart.CALL_ORDER"),l.CALL_ORDER_DESCRIP=e("translate")("cart.CALL_ORDER_DESCRIP"),l.CALL_ORDER_CLIENT_INFO=e("translate")("cart.CALL_ORDER_CLIENT_INFO"),l.CLIENT_NAME=e("translate")("cart.CLIENT_NAME"),l.EMPTY_FIELD=e("translate")("login.EMPTY_FIELD"),l.MOBILE=e("translate")("login.MOBILE"),l.WRONG_NUMBER=e("translate")("login.WRONG_NUMBER"),l.CALL_ORDER_DELIVERY=e("translate")("cart.CALL_ORDER_DELIVERY"),l.CLIENT_LOCATION=e("translate")("cart.CLIENT_LOCATION"),l.CLIENT_ADDRESS=e("translate")("cart.CLIENT_ADDRESS"),l.CLIENT_HOUSE=e("translate")("cart.CLIENT_HOUSE"),l.CLIENT_FLAT=e("translate")("cart.CLIENT_FLAT"),l.CLIENT_FLOOR=e("translate")("cart.CLIENT_FLOOR"),l.CALL_ORDER_TOTAL_PRICE=e("translate")("cart.CALL_ORDER_TOTAL_PRICE"),l.CALL_ORDER_ADD_INFO=e("translate")("cart.CALL_ORDER_ADD_INFO"),l.CLIENT_EMAIL_ORDER=e("translate")("cart.CLIENT_EMAIL_ORDER"),l.WRONG_EMAIL=e("translate")("cart.WRONG_EMAIL"),l.ADD_PHONE=e("translate")("cart.ADD_PHONE"),l.CLIENT_SEX=e("translate")("cart.CLIENT_SEX"),l.CLIENT_SEX_M=e("translate")("cart.CLIENT_SEX_M"),l.CLIENT_SEX_F=e("translate")("cart.CLIENT_SEX_F"),l.CLIENT_AGE=e("translate")("cart.CLIENT_AGE"),l.EMPTY_FIELD_LOCATION=e("translate")("login.EMPTY_FIELD_LOCATION"),l.SELECT_PLACEHOLD=e("translate")("cart.SELECT_PLACEHOLD"),l.CLIENT_EDUCATION=e("translate")("cart.CLIENT_EDUCATION"),l.CLIENT_OCCUPATION=e("translate")("cart.CLIENT_OCCUPATION"),l.CLIENT_INFO_SOURCE=e("translate")("cart.CLIENT_INFO_SOURCE"),l.READY=e("translate")("cart.READY"),l.CALL_MASTER=e("translate")("cart.CALL_MASTER"),l.CALL_MASTER_DESCRIP=e("translate")("cart.CALL_MASTER_DESCRIP"),l.CALL_CREDIT=e("translate")("cart.CALL_CREDIT"),l.CALL_CREDIT_DESCRIP=e("translate")("cart.CALL_CREDIT_DESCRIP"),l.CALL_CREDIT_CLIENT_INFO=e("translate")("cart.CALL_CREDIT_CLIENT_INFO"),l.CREDIT_TARGET=e("translate")("cart.CREDIT_TARGET"),l.CLIENT_ITN=e("translate")("cart.CLIENT_ITN"),l.CALL_START_TIME=e("translate")("cart.CALL_START_TIME"),l.CALL_END_TIME=e("translate")("cart.CALL_END_TIME"),l.CALL_CREDIT_PARTIAL_PRICE=e("translate")("cart.CALL_CREDIT_PARTIAL_PRICE"),l.locations=t.global.locations.cities.filter(function(e){return e.countryId===o.userInfo.countryId}),l.submitForm=n,l.changeLocation=a.changeLocation,l.selectCity=a.selectCity,l.closeOrderDialog=a.closeOrderDialog}])}(),function(){angular.module("MainModule").controller("qtyCalculatorCtrl",["$filter","AddElementMenuServ",function(e,t){var i=this;i.QTY_LABEL=e("translate")("add_elements.QTY_LABEL"),i.setValueQty=t.setValueQty,i.closeQtyCaclulator=t.closeQtyCaclulator,i.pressCulculator=t.pressCulculator}])}(),function(){angular.module("MainModule").controller("ReportCtrl",["$rootScope","$filter","localDB","GeneralServ","GlobalStor","ProductStor","UserStor",function(e,t,i,o,r,a,n){function l(e){var t;t=e?a.product.report.filter(function(t){return t.element_group_id===e}):angular.copy(a.product.report),t.length?(c.config.reportPriceTotal=o.roundingValue(t.reduce(function(e,t){return{priceReal:e.priceReal+t.priceReal}}).priceReal,2),c.config.reportPriceBase=o.roundingValue(t.reduce(function(e,t){return{price:e.price+t.price}}).price,2)):(c.config.reportPriceTotal=0,c.config.reportPriceBase=0)}function s(e){l(e),e?c.config.reportFilterId=e:c.config.reportFilterId=void 0}function d(){r.global.isReport=!r.global.isReport,l(),r.global.isReport&&i.selectLocalDB(i.tablesLocalDB.elements_groups.tableName).then(function(e){c.config.reportMenu=e.filter(function(e){return e.position>0}),c.config.reportMenu.push({id:0,name:t("translate")("common_words.ALL")})}),e.$apply()}var c=this;c.G=r,c.P=a,c.U=n,c.config={reportMenu:[],reportFilterId:void 0,reportPriceTotal:0,reportPriceBase:0},c.NAME_LABEL=t("translate")("add_elements.NAME_LABEL"),c.ARTICUL_LABEL=t("translate")("add_elements.ARTICUL_LABEL"),c.QTY_LABEL=t("translate")("add_elements.QTY_LABEL"),c.SIZE_LABEL=t("translate")("add_elements.SIZE_LABEL"),c.LETTER_M=t("translate")("common_words.LETTER_M"),c.CALL_ORDER_TOTAL_PRICE=t("translate")("cart.CALL_ORDER_TOTAL_PRICE"),$(".main-content").off("keypress").keypress(function(e){5!==n.userInfo.user_type&&7!==n.userInfo.user_type||82!==e.keyCode&&114!==e.keyCode||d()}),c.sortReport=s}])}(),function(){angular.module("MainModule").controller("RoomInfoCtrl",["$filter","globalConstants","TemplatesServ","GlobalStor","OrderStor","ProductStor","UserStor",function(e,t,i,o,r,a,n){function l(){o.global.isShowCommentBlock||(o.global.showRoomSelectorDialog=!o.global.showRoomSelectorDialog)}function s(){o.global.isShowCommentBlock=!o.global.isShowCommentBlock}var d=this;d.G=o,d.O=r,d.P=a,d.U=n,d.config={DELAY_SHOW_COEFF:20*t.STEP,DELAY_SHOW_ALLROOMS_BTN:15*t.STEP,typing:"on"},d.CLIMATE_ZONE=e("translate")("mainpage.CLIMATE_ZONE"),d.THERMAL_RESISTANCE=e("translate")("mainpage.THERMAL_RESISTANCE"),d.ROOM_SELECTION=e("translate")("mainpage.ROOM_SELECTION"),d.COMMENT=e("translate")("mainpage.COMMENT"),d.showRoomSelectorDialog=l,d.switchComment=s}])}(),function(){angular.module("MainModule").controller("RoomSelectorCtrl",["$location","globalConstants","MainServ","TemplatesServ","GlobalStor","ProductStor","UserStor","optionsServ",function(e,t,i,o,r,a,n,l){function s(t){l.getTemplateImgIcons(function(e){e.status&&(r.global.templatesImgs=e.data.templateImgs.filter(function(e){return e.type===r.global.rooms[t].group_id}))}),i.downloadAllTemplates(r.global.rooms[t].group_id).then(function(e){e&&(r.global.templatesSourceSTORE=angular.copy(e),r.global.templatesSource=angular.copy(e))}),0===r.global.selectRoom?(e.path("/design"),r.global.templateTEMP=angular.copy(a.product),o.selectNewTemplate(r.global.rooms[t].template_id-1,t+1),r.global.selectRoom=1):o.selectNewTemplate(r.global.rooms[t].template_id-1,t+1)}var d=this;d.G=r,d.P=a,d.U=n,d.config={DELAY_SHOW_ROOM:2*t.STEP},d.selectRoom=s,d.closeRoomSelectorDialog=i.closeRoomSelectorDialog,r.global.selectRoom=0,r.global.showRoomSelectorDialog=0}])}(),function(){angular.module("MainModule").controller("searchCtrl",["$filter","GlobalStor","AuxStor","HistoryStor","AddElementsServ","AddElementMenuServ",function(e,t,i,o,r,a){function n(){p.searchingWord="",i.aux.addElementGroups.length=0,i.aux.searchingWord=p.searchingWord,a.closeAddElementsMenu()}function l(){""!==p.searchingWord?(i.aux.searchingWord=p.searchingWord,i.aux.searchingWord.length>3&&r.createAddElementGroups()):n()}function s(){p.searchingWord=p.searchingWord.slice(0,-1),""===p.searchingWord?n():i.aux.searchingWord=p.searchingWord}function d(){""!==p.searchingWord&&(o.history.searchingWord=p.searchingWord)}function c(){p.searchingWord="",o.history.searchingWord="",o.history.isOrderSearch=0}function u(){p.searchingWord=p.searchingWord.slice(0,-1),o.history.searchingWord=p.searchingWord}var p=this;p.G=t,p.CANCEL=e("translate")("add_elements.CANCEL"),"main"===t.global.currOpenPage||"cart"===t.global.currOpenPage?(p.placeholder=e("translate")("add_elements.INPUT_ADD_ELEMENT"),p.checkChanges=l,p.cancelSearching=n,p.deleteSearchChart=s):"history"===t.global.currOpenPage&&(p.placeholder=e("translate")("history.SEARCH_PLACEHOLDER"),p.checkChanges=d,p.cancelSearching=c,p.deleteSearchChart=u)}])}(),function(){angular.module("MainModule").controller("sizeCalculatorCtrl",["$filter","GlobalStor","DesignStor","AddElementMenuServ","DesignServ",function(e,t,i,o,r){var a=this;a.isDesignPage=!1,a.D=i,a.MIN=e("translate")("common_words.MIN"),a.MAX=e("translate")("common_words.MAX"),"main"===t.global.currOpenPage?(a.isDesignPage=!0,a.setValueSize=o.setValueSize,a.deleteLastNumber=o.deleteLastNumber,a.closeSizeCaclulator=o.closeSizeCaclulator):(a.isDesignPage=!0,a.setValueSize=r.setValueSize,a.deleteLastNumber=r.deleteLastNumber,a.closeSizeCaclulator=r.closeSizeCaclulator),t.global.activePanel=0,a.pressCulculator=o.pressCulculator}])}(),function(){angular.module("MainModule").controller("UserInfoCtrl",["globalConstants","GlobalStor","UserStor",function(e,t,i){function o(){t.global.isNavMenu=!t.global.isNavMenu,t.global.isConfigMenu=!t.global.isConfigMenu}function r(){t.global.isNavMenu&&(t.global.isNavMenu=0,t.global.isConfigMenu=1)}function a(){t.global.isNavMenu||(t.global.isNavMenu=1,t.global.isConfigMenu=0)}var n=this;n.G=t,n.U=i,n.config={DELAY_SHOW_USER_INFO:40*e.STEP,typing:"on",checked:!1},n.swipeMainPage=o,n.swipeLeft=r,n.swipeRight=a}])}(),function(){angular.module("SettingsModule").controller("SettingsCtrl",["$location","$timeout","$filter","globalConstants","localDB","SettingServ","GlobalStor","OrderStor","ProductStor","AuxStor","UserStor",function(e,t,i,o,r,a,n,l,s,d,c){function u(e,t){var i={};switch(e){case"user-name":i.name=t;break;case"user-address":i.address=t;break;case"user-email":var o=L.config.mailReg.test(t);o?(L.config.isEmailError=0,i.email=t):L.config.isEmailError=1}$.isEmptyObject(i)||r.updateLocalServerDBs(r.tablesLocalDB.users.tableName,c.userInfo.id,i)}function p(e){t(function(){$("#"+e).find("input").focus()},100)}function g(){t(function(){$(".set-input-phone").focus()},100)}function m(e,t){L.config.selectedSetting=e,p(t.target.id)}function f(e,t){13===event.which&&u(e,t)}function _(e,t){u(e,t)}function h(){L.config.isEmailError=0}function y(e){var t=e.join(",");c.userInfo.city_phone=t,r.updateLocalServerDBs(r.tablesLocalDB.users.tableName,c.userInfo.id,{city_phone:t}),L.config.tempAddPhone=""}function E(){var e=L.config.regex.test(L.config.tempAddPhone);e?(L.config.isInsertPhone=0,L.config.isErrorPhone=0,L.config.addPhones.push(L.config.tempAddPhone),y(L.config.addPhones)):L.config.isErrorPhone=1}function b(){L.config.isInsertPhone=!L.config.isInsertPhone,L.config.tempAddPhone="",L.config.isErrorPhone=0,g()}function v(){L.config.tempAddPhone&&""!==L.config.tempAddPhone?E():b()}function T(){L.config.isInsertPhone=0,L.config.isErrorPhone=0}function I(){13===event.which&&E()}function S(e){L.config.addPhones.splice(e,1),y(L.config.addPhones)}function A(){c.userInfo=c.setDefaultUser(),n.global=n.setDefaultGlobal(),l.order=l.setDefaultOrder(),s.product=s.setDefaultProduct(),d.aux=d.setDefaultAuxiliary(),e.path("/login")}var L=this;L.U=c,L.config={DELAY_START:o.STEP,DELAY_SHOW_ICONS:10*o.STEP,isInsertPhone:!1,isEmailError:!1,addPhones:[],tempAddPhone:"",regex:o.REG_PHONE,mailReg:o.REG_MAIL,typing:"on"},L.NAVMENU_SETTINGS=i("translate")("mainpage.NAVMENU_SETTINGS"),L.CHANGE=i("translate")("common_words.CHANGE"),L.AUTHORIZATION=i("translate")("settings.AUTHORIZATION"),L.CHANGE_PASSWORD=i("translate")("settings.CHANGE_PASSWORD"),L.CHANGE_LANGUAGE=i("translate")("settings.CHANGE_LANGUAGE"),L.PRIVATE_INFO=i("translate")("settings.PRIVATE_INFO"),L.USER_NAME=i("translate")("settings.USER_NAME"),L.CITY=i("translate")("settings.CITY"),L.CLIENT_ADDRESS=i("translate")("cart.CLIENT_ADDRESS"),L.CLIENT_EMAIL=i("translate")("cart.CLIENT_EMAIL"),L.WRONG_EMAIL=i("translate")("cart.WRONG_EMAIL"),L.ADD_PHONES=i("translate")("settings.ADD_PHONES"),L.INSERT_PHONE=i("translate")("settings.INSERT_PHONE"),L.WRONG_NUMBER=i("translate")("login.WRONG_NUMBER"),L.CLIENT_SUPPORT=i("translate")("settings.CLIENT_SUPPORT"),L.LOGOUT=i("translate")("settings.LOGOUT"),n.global.currOpenPage="settings",c.userInfo.city_phone&&(L.config.addPhones=c.userInfo.city_phone.split(",")),L.changeSettingData=m,L.appendInputPhone=b,L.cancelAddPhone=T,L.saveChanges=f,L.saveChangesBlur=_,L.changeEmail=h,L.addNewPhone=v,L.saveChangesPhone=I,L.deletePhone=S,L.gotoPasswordPage=a.gotoPasswordPage,L.gotoLanguagePage=a.gotoLanguagePage,L.gotoLocationPage=a.gotoLocationPage,L.closeSettingsPage=a.closeSettingsPage,L.logOut=A}])}(),function(){angular.module("HistoryModule").directive("calendarScroll",["$filter","HistoryStor",function($filter,HistoryStor){return{restrict:"E",transclude:!0,replace:!0,scope:{calendarType:"=",orderType:"="},template:function(e,t){var i=+t.calendarType,o="",r="",a="",n="",l="",s="",d="",c="",u="",p=$filter("translate")("common_words.MONTHS"),g=p.split(", "),m=g.length,f=1,_=0,h=2010,y=(new Date).getFullYear()+1;for(i?(r="date_range_from",a="date_from",n="from_date",l="from_date_"+t.orderType,s="from_month",d="from_month_"+t.orderType,c="from_fullYear",u="from_fullYear_"+t.orderType):(r="date_range_to",a="date_to",n="to_date",l="to_date_"+t.orderType,s="to_month",d="to_month_"+t.orderType,c="to_fullYear",u="to_fullYear_"+t.orderType),o='<div class="date_range outside"><div class="date_range_container"><div class="'+r+'"><form name="'+a+'"><div class="lines"><div></div></div><select class="date" id="'+n+'" name="'+l+'">';f<32;)o+='<option value="'+f+'">'+f+"</option>",f+=1;for(o+='</select><select class="date" id="'+s+'" name="'+d+'">';_<m;)o+='<option value="'+_+'">'+g[_]+"</option>",_+=1;for(o+='</select><select class="date" id="'+c+'" name="'+u+'">';h<=y;)o+='<option value="'+h+'">'+h+"</option>",h+=1;return o+="</select></form></div></div></div>"},link:function(scope){function getIndexForValue(e,t){for(var i=e.options.length;--i>-1;)if(e.options[i].value===t)return i}function update(e,t,i){$("."+e).find("#"+t+"_date").drum("setIndex",i.getDate()-1),$("."+e).find("#"+t+"_month").drum("setIndex",i.getMonth()),$("."+e).find("#"+t+"_fullYear").drum("setIndex",getIndexForValue($("#"+t+"_fullYear")[0],i.getFullYear()))}$(function(){$("select.date").drum({onChange:function(elem){var elemNameArr=elem.name.split("_"),section=elemNameArr[0],isOrder=+elemNameArr[2],arr={date:"setDate",month:"setMonth",fullYear:"setFullYear"},date=new Date,s,i;for(s in arr)i=$("form[name='date_"+section+"'] select[id='"+section+"_"+s+"']")[0].value,eval("date."+arr[s]+"("+i+")");isOrder?(update("history-view",section,date),"from"===section?HistoryStor.history.startDate=date:HistoryStor.history.finishDate=date):(update("draft-view",section,date),"from"===section?HistoryStor.history.startDateDraft=date:HistoryStor.history.finishDateDraft=date),scope.$apply()}});var now=new Date;update("history-view","from",new Date(now.getFullYear(),now.getMonth(),now.getDate())),update("history-view","to",new Date(now.getFullYear(),now.getMonth(),now.getDate())),update("draft-view","from",new Date(now.getFullYear(),now.getMonth(),now.getDate())),update("draft-view","to",new Date(now.getFullYear(),now.getMonth(),now.getDate()))})}}}])}(),function(){angular.module("CartModule").directive("calendar",["$filter","CartMenuServ","GlobalStor","OrderStor",function(e,t,i,o){return{restrict:"E",transclude:!0,link:function(r,a){var n=new Date(o.order.order_date).getDate(),l=(new Date).setDate(n+i.global.deliveryCoeff.min_time-1),s=e("date")(o.order.new_delivery_date,"dd.MM.yyyy"),d=e("date")(o.order.delivery_date,"dd.MM.yyyy");$(function(){var i={flat:!0,format:"d.m.Y",locale:{days:[],daysShort:[],daysMin:[],monthsShort:[],months:[]},date:s,min:l,change:function(e){t.checkDifferentDate(d,e),r.$apply()}};i.locale.monthsShort=e("translate")("common_words.MONTHS_SHOT").split(", "),i.locale.months=e("translate")("common_words.MONTHS").split(", "),a.pickmeup(i)})}}}])}(),function(){angular.module("BauVoiceApp").directive("fsClick",["GlobalStor",function(e){return function(t,i,o){var r=e.global.isDevice?"touchstart":"mousedown";i.on(r,function(){t.$apply(o.fsClick)})}}])}(),function(){angular.module("BauVoiceApp").directive("fileread",["SettingServ","UserStor",function(e,t){return{scope:{fileread:"="},link:function(i,o){o.bind("change",function(o){var r=new FormData,a=new FileReader;r.append("user",t.userInfo.id),r.append("file",o.target.files[0]),a.onload=function(t){i.$apply(function(){i.fileread=t.target.result,e.changeAvatar(i.fileread,r)})},a.readAsDataURL(o.target.files[0])})}}}])}(),function(){angular.module("BauVoiceApp").filter("locationFilter",["$filter",function(e){return function(t,i){var o,r=t.length,a=[];if(i&&i.length>2)for(o=i.toLowerCase();--r>-1;)0===t[r].fullLocation.toLowerCase().indexOf(o)&&a.push(t[r]);return a=e("orderBy")(a,"cityName",!1)}}])}(),function(){angular.module("HistoryModule").directive("orderDate",["$filter",function(e){return{restrict:"A",scope:{orderDate:"@",typeDate:"="},link:function(t,i,o){function r(t,o){var r,a,n,l,s;n=e("translate")("common_words.MONTHA").split(", "),""!==t?"order"===o?(r=t.split(" "),a=r[0].split("-"),s=parseInt(a[1],10)-1,l=a[2]+" "+n[s]+", "+a[0]):(a=t.split("/"),s=parseInt(a[0],10)-1,l=a[1]+" "+n[s]+", "+a[2]):(r=new Date,l=r.getDate()+" "+n[r.getMonth()]+", "+r.getFullYear()),o||""!==t?i.text(l):i.text("")}r(t.orderDate,t.typeDate),o.$observe("orderDate",function(){r(t.orderDate,t.typeDate)})}}}])}(),function(){angular.module("HistoryModule").filter("orderSorting",function(){return function(e,t){function i(e,t){angular.forEach(e,function(e){angular.equals(e.order_style,t)&&o.push(e)})}var o=[];return"type"===t?(i(e,"order"),i(e,"master"),i(e,"done")):"first"===t?(angular.forEach(e,function(e){o.push(e)}),o.reverse()):angular.forEach(e,function(e){o.push(e)}),o}})}(),function(){angular.module("BauVoiceApp").directive("priceFixed",function(){return{restrict:"A",scope:{priceFixed:"@",qtyElement:"@",currencyElement:"@"},link:function(e,t,i){function o(e,i,o){var r=parseFloat((Math.round(100*parseFloat(e))/100*i).toFixed(2))+" "+o;t.text(r)}o(e.priceFixed,e.qtyElement,e.currencyElement),i.$observe("qtyElement",function(){o(e.priceFixed,e.qtyElement,e.currencyElement)}),i.$observe("priceFixed",function(){o(e.priceFixed,e.qtyElement,e.currencyElement)})}}})}(),function(){angular.module("BauVoiceApp").directive("price",["globalConstants","SoundPlayServ",function(e,t){function i(o,r){var a,n,l,s,d,c=2*e.STEP,u=64,p=r.find("#price").children(),g=p.length,m=$(p[0]).children().length,f=0;for(void 0!==o&&(t.playSound(),a="string"==typeof o?o.split(""):o.toFixed(2).split("")),i.revertDigitState=function(){n.animate({top:0},"fast")},i.initDigit=function(){l=a.shift()},i.animateDigit=function(){s="."===l?(m-1)*u:(parseInt(l,10)+1)*u,n.delay(f*c).animate({top:-s/16+"rem"},"fast")},d=g;d>0;d-=1)n=$(p[f]),d>a.length?i.revertDigitState():(i.initDigit(),i.animateDigit()),f+=1}return{restrict:"E",replace:!0,transclude:!0,scope:{priceValue:"=",priceCurrency:"="},template:'<div class="price clearfix" data-output="priceValue"><div id="price" class="price-value"><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div></div><div id="currency" class="price-currency">{{ priceCurrency }}</div></div>',link:function(e,t,o){e.$watch(o.output,function(e){i(e,t)})}}}])}(),function(){angular.module("BauVoiceApp").directive("showDelay",function(){return{scope:{showDelay:"@"},link:function(e,t,i){function o(){var i="unvisible";setTimeout(function(){t.removeClass(i)},+e.showDelay)}i.$observe("showDelay",function(){o()})}}})}(),function(){angular.module("BauVoiceApp").directive("svgTemplate",["$location","globalConstants","GeneralServ","ProductStor","SVGServ","DesignServ","PointsServ","GlobalStor",function(e,t,i,o,r,a,n,l){return{restrict:"E",replace:!0,transclude:!0,scope:{typeConstruction:"=",template:"=",templateWidth:"=",templateHeight:"="},link:function(e,s){function d(e,t,i,o,r,a,n,l,s,d){e.append("marker").classed(d,!0).attr({id:t,viewBox:i,refX:o,refY:r,markerWidth:n,markerHeight:l,orient:a}).append("path").attr("d",s)}function c(e,t,i){var o,r=i.sashOpenDir.length;if(i.handlePos)return 1===r?2===i.handlePos?o=e?"url(#handleR)":"url(#hingeL)":1===i.handlePos?o=e?"url(#handleU)":"url(#hingeD)":4===i.handlePos?o=e?"url(#handleL)":"url(#hingeR)":3===i.handlePos&&(o=e?"url(#handleD)":"url(#hingeU)"):2===r&&(t.points[1].fi<45||t.points[1].fi>315?o=e?"url(#handleR)":"url(#hingeL)":t.points[1].fi>135&&t.points[1].fi<225&&(o=e?"url(#handleL)":"url(#hingeR)")),o}function u(i,o,r,a){if(e.typeConstruction!==t.SVG_ID_MAIN){var n,l,s=-150,d=50,c=-20,u=160,p=70,g=20,m=[],f=[],_=[],h={x:i?c:o.from,y:i?o.from:c},y={x:i?s:o.from,y:i?o.from:s},E={x:i?c:o.to,y:i?o.to:c},b={x:i?s:o.to,y:i?o.to:s},v={x:i?s+d:o.from,y:i?o.from:s+d},T={x:i?s+d:o.to,y:i?o.to:s+d};m.push(h,y),f.push(E,b),_.push(v,T),n=r.append("g").attr({"class":function(){var r;return r=e.typeConstruction===t.SVG_ID_ICON?i?o.level?"dim_blockY dim_shiftY":"dim_block":o.level?"dim_blockX dim_shiftX":"dim_block":i?o.level?"dim_blockY":"dim_block dim_hidden":o.level?"dim_blockX":"dim_block dim_hidden"},block_id:o.blockId,axis:o.axis}),n.append("path").classed("size-line",!0).attr("d",a(f)),n.append("path").classed("size-line",!0).attr("d",a(m)),n.append("path").classed("size-line",!0).attr({d:a(_),"marker-start":function(){return i?"url(#dimVertR)":"url(#dimHorL)"},"marker-end":function(){return i?"url(#dimVertL)":"url(#dimHorR)"}}),l=n.append("g").classed("size-box",!0),"tamlateSVG"===e.typeConstruction&&l.append("rect").classed("size-rect",!0).attr({x:function(){return i?s-.8*u:(o.from+o.to-u)/2},y:function(){return i?(o.from+o.to-p)/2:s-.8*p},rx:g,ry:g}),l.append("text").text(o.text).attr({"class":function(){return e.typeConstruction===t.SVG_ID_EDIT?"size-txt-edit":"size-txt"},x:function(){return i?s-.8*u:(o.from+o.to-u)/2},y:function(){return i?(o.from+o.to-p)/2:s-.8*p},dx:80,dy:40,type:"line",block_id:o.blockId,size_val:o.text,min_val:o.minLimit,max_val:o.maxLimit,dim_id:o.dimId,from_point:o.from,to_point:o.to,axis:o.axis,level:o.level})}}function p(i,o,r){var a,n,l=[],s=20,d={x:i.startX,y:i.startY},c={x:i.midleX,y:i.midleY};l.push(c,d),a=o.append("g").attr({"class":"dim_block_radius",block_id:i.blockId}),a.append("path").classed("size-line",!0).attr({d:r(l),style:"stroke: #000;","marker-end":"url(#dimArrow)"}),n=a.append("g").classed("size-box",!0),e.typeConstruction===t.SVG_ID_EDIT&&n.append("rect").classed("size-rect",!0).attr({x:i.midleX,y:i.midleY,rx:s,ry:s}),n.append("text").text(i.radius).attr({"class":"size-txt-edit",x:i.midleX,y:i.midleY,dx:80,dy:40,type:"curve",block_id:i.blockId,size_val:i.radius,min_val:i.radiusMax,max_val:i.radiusMin,dim_id:i.id,chord:i.lengthChord})}function g(i,r){e.typeConstruction===t.SVG_ID_MAIN&&(l.global.heightCheck=i,l.global.widthCheck=r,l.global.backgroundH=i/1680,l.global.backgroundW=r/1680,l.global.background=i/1680,l.global.backgroundH<l.global.backgroundW?l.global.background=l.global.backgroundW:l.global.background=l.global.backgroundH,1===o.product.construction_type||3===o.product.construction_type?l.global.imgLink="44.png":6===o.product.doorLock.stvorka_type?l.global.imgLink="31.jpg":7===o.product.doorLock.stvorka_type?l.global.imgLink="inner-wall_glass.png":l.global.imgLink="3333.png")}function m(i,r){if(e.typeConstruction===t.SVG_ID_MAIN){var a=.18*i-252+520,n=755;if(1===o.product.construction_type){var l=.18*r-234+520,s=90,d=720;if(i<1648)var c=456,u=100;if(1648<i&&i<1848)var c=526,u=60;if(1848<=i&&i<2148)var c=576,u=0;if(2148<=i)var c=637,u=-30;r>900&&i<1648?$(".elem5").css("left",109+.48*(r/2-224)/2+"px"):$(".elem5").css("left","5000px"),$(".elem15").css({width:.48*(r/2)+30+"px",height:s+"px",top:d+"px"}),$(".elem11").css("left","5000px"),$(".elem16").css("left","9px"),$(".elem8").css("left","5000px"),$(".elem7").css("opacity",0),$(".elem9").css("opacity",1),$(".elem23").css("left","5000px"),$(".elem10").css("opacity",0),$(".elem17").css({width:.4*(r/2*2+350)+"px",height:"41px",left:"215px",top:c+"px"}),$(".elem18").css({width:l+"px",height:a+"px",left:"3px",top:n-a-u+"px"}),$(".elem19").css({width:l+"px",height:a+"px",left:"3px",top:n-a-u+"px"}),$(".elem20").css({width:l+"px",height:a+"px",left:"3px",top:n-a-u+"px"}),$(".elem21").css({width:l+"px",height:a+"px",left:"3px",top:n-a-u+"px"}),$(".elem24").css({width:r/4.1+108+"px"})}if(4===o.product.construction_type||2===o.product.construction_type){var l=.18*r-234+420;$(".elem23").css({width:500+.7*(r-700)+"px",top:"665px",left:100-2.5*(.1*r-70)+"px"}),$(".elem15").css({top:"5000px"}),$(".elem17").css({width:"0px",height:"0px",left:"0px"}),$(".elem18").css({width:l+"px",height:a+"px",left:"130px",top:n-a+30+"px"}),$(".elem19").css({width:l+"px",height:a+"px",left:"130px",top:n-a+30+"px"}),$(".elem20").css({width:l+"px",height:a+"px",left:"130px",top:n-a+30+"px"}),$(".elem21").css({width:l+"px",height:a+"px",left:"130px",top:n-a+50+"px"}),$(".elem32").css({left:381+.48*(r/2-224)+"px"}),$(".elem34").css({left:.23*r+171+"px",top:.23*((i-2e3)*-1)+189+"px"}),$(".elem38").css({width:.23*r-135+"px",top:.23*((i-2e3)*-1)+189+"px"}),$(".elem39").css({left:.23*r+243+"px",top:.23*((i-2e3)*-1)+468+"px",height:.23*(i-2e3)+134+"px"}),$(".elem40").css({top:.23*((i-2e3)*-1)+468+"px",height:.23*(i-2e3)+140+"px"}),$(".elem33").css({top:.23*((i-2e3)*-1)+189+"px"}),$(".elem35").css("left",.23*r+204.9+"px"),$(".elem11").css("left",.23*(.991*r)+280+"px"),$(".elem8").css("left",.23*r+275+"px"),$(".elem5").css("left","5000px"),$(".elem10").css("opacity",1),$(".elem7").css("opacity",1),$(".elem16").css("left","5000px"),$(".elem9").css("opacity",0),$(".elem51").css("left",.23*r-443+"px"),$(".elem52").css("left",.23*r-571+"px"),$(".elem56").css("left",.23*r+215.42+"px"),$(".elem59").css({top:.23*((i-2e3)*-1)+417+"px",height:.23*(i-2e3)+27+"px"}),$(".elem60").css({left:.23*r+262+"px",top:.23*((i-2e3)*-1)+412.8+"px",height:.23*(i-2e3)+32+"px"}),$(".elem55").css({left:.23*r+177.9+"px",top:.23*((i-2e3)*-1)+172+"px"}),$(".elem58").css({width:.23*r-186.7+"px",top:.23*((i-2e3)*-1)+172.8+"px"}),$(".elem54").css({top:.23*((i-2e3)*-1)+173+"px"})}}}function f(f,_,h){if(f&&!$.isEmptyObject(f)){var y,E,b,v,T,I,S,A,L,D,N=document.createElement("div"),x=d3.svg.line().x(function(e){
return e.x}).y(function(e){return e.y}).interpolate("linear"),R=.7,O={x:0,y:0},C=n.templatePoints(f);if(e.typeConstruction===t.SVG_CLASS_ICON?R=1:e.typeConstruction===t.SVG_ID_EDIT?R=.6:e.typeConstruction===t.SVG_ID_MAIN&&(R=.6),y=d3.select(N).append("svg").attr({width:_,height:h}),e.typeConstruction===t.SVG_CLASS_ICON?y.attr("class",e.typeConstruction):y.attr("id",e.typeConstruction),T=r.collectAllPointsOut(f.details),I=i.getMaxMinCoord(T),S=e.typeConstruction===t.SVG_ID_MAIN?r.setTemplateScaleMAIN(R):r.setTemplateScale(I,_,h,R),e.typeConstruction!==t.SVG_CLASS_ICON&&(O=e.typeConstruction===t.SVG_ID_MAIN?r.setTemplatePositionMAIN(I,h,S):r.setTemplatePosition(I,_,h,S)),E=y.append("g").attr({id:"main_group",transform:"translate("+O.x+", "+O.y+") scale("+S+","+S+")"}),e.typeConstruction===t.SVG_ID_EDIT,e.typeConstruction!==t.SVG_CLASS_ICON){var P=E.append("defs"),w=C.noVvPath,M=C.widthT,k=C.heightT;"main"===l.global.currOpenPage&&0===l.global.activePanel?(m(k,M),g(k,M)):k===l.global.heightCheck&&M===l.global.widthCheck||(g(k,M,P),m(k,M)),o.product.lamination.img_in_id>1&&6!==o.product.doorLock.stvorka_type?(P.append("pattern").attr("id","laminat").attr("patternUnits","userSpaceOnUse").attr("width",600).attr("height",400).append("image").attr("xlink:href","img/lamination/"+o.product.lamination.img_in_id+".jpg").attr("width",600).attr("height",400),P.append("pattern").attr("id","laminat1").attr("patternUnits","userSpaceOnUse").attr("width",150).attr("height",100).append("image").attr("xlink:href","img/lamination/"+o.product.lamination.img_in_id+".jpg").attr("width",150).attr("height",100)):6===o.product.doorLock.stvorka_type&&(P.append("pattern").attr("id","laminat").attr("patternUnits","userSpaceOnUse").attr("width",600).attr("height",400).append("image").attr("xlink:href","img/lamination/"+o.product.lamination.img_out_id+".jpg").attr("width",600).attr("height",400),P.append("pattern").attr("id","laminat1").attr("patternUnits","userSpaceOnUse").attr("width",150).attr("height",100).append("image").attr("xlink:href","img/lamination/"+o.product.lamination.img_out_id+".jpg").attr("width",150).attr("height",100)),P.append("pattern").attr("id","background").attr("patternUnits","userSpaceOnUse").attr("width",2202.92*l.global.background).attr("height",1661.3*l.global.background).append("image").attr("xlink:href","img/room/"+l.global.imgLink).attr("width",2202.92*l.global.background).attr("height",1661.3*l.global.background);var G="M4.5,0C2.015,0,0,2.015,0,4.5v6c0,1.56,0.795,2.933,2,3.74V7.5C2,6.119,3.119,5,4.5,5S7,6.119,7,7.5v6.74c1.205-0.807,2-2.18,2-3.74v-6C9,2.015,6.985,0,4.5,0zM7,26.5C7,27.881,5.881,29,4.5,29l0,0C3.119,29,2,27.881,2,26.5v-19C2,6.119,3.119,5,4.5,5l0,0C5.881,5,7,6.119,7,7.5V26.5z",B="M0,0L5,0L5,15L0,15z";6!==o.product.doorLock.stvorka_type?(d(P,"handleR","0 -1 9 32",-4.5,5,0,8,80,G,"handle-mark"),d(P,"handleL","0 -1 9 32",13.5,5,0,8,80,G,"handle-mark"),d(P,"handleU","0 -1 9 32",-4.5,5,270,8,80,G,"handle-mark"),d(P,"handleD","0 -1 9 32",13.5,5,270,8,80,G,"handle-mark")):(d(P,"handleR","0 -1 9 32",-5,17,90,8,80,G,"handle-mark"),d(P,"handleL","0 -1 9 32",14,17,270,8,80,G,"handle-mark"),d(P,"handleU","0 -1 9 32",-5.3,5,180,8,80,G,"handle-mark"),d(P,"handleD","0 -1 9 32",14.3,5,180,8,80,G,"handle-mark")),d(P,"hingeR","-1 0 9 4",-17,5,0,7,80,B,"hinge-mark"),d(P,"hingeL","-1 0 9 4",22,5,0,7,80,B,"hinge-mark"),d(P,"hingeU","-1 0 9 4",-16.5,5,270,7,80,B,"hinge-mark"),d(P,"hingeD","-1 0 9 4",21.5,5,270,7,80,B,"hinge-mark"),d(P,"dimHorL","-5, -5, 1, 8",-5,-2,0,50,50,"M 0,0 L -4,-2 L0,-4 z","size-line"),d(P,"dimHorR","-5, -5, 1, 8",-5,-2,180,50,50,"M 0,0 L -4,-2 L0,-4 z","size-line"),d(P,"dimVertL","4.2, -1, 8, 9",5,2,90,100,60,"M 0,0 L 4,2 L0,4 z","size-line"),d(P,"dimVertR","4.2, -1, 8, 9",5,2,270,100,60,"M 0,0 L 4,2 L0,4 z","size-line"),d(P,"dimArrow","4.2, -1, 8, 9",5,2,"auto",100,60,"M 0,0 L 4,2 L0,4 z","size-line")}if(e.typeConstruction===t.SVG_ID_MAIN){var V=4.4*S;if(1===o.product.construction_type||3===o.product.construction_type){var H=O.x-160,U=18,F=O.x-340,z=-100;E.append("g").append("polygon").attr({id:"clipPolygonWindow1",fill:"#FFFAFA",points:w,transform:"translate("+H+", "+U+") scale("+V+","+V+")"}),E.append("g").append("polygon").attr({id:"clipPolygonWindow2",fill:"#FFFAFA",points:w,transform:"translate("+F+", "+U+") scale("+V+","+V+")"}),E.append("g").append("polygon").attr({id:"clipPolygonWindow3",fill:"#FFFAFA",points:w,transform:"translate("+H+", "+z+") scale("+V+","+V+")"}),E.append("g").append("polygon").attr({id:"clipPolygonWindow4",fill:"#FFFAFA",points:w,transform:"translate("+F+", "+z+") scale("+V+","+V+")"})}else E.append("g").append("polygon").attr({id:"clipPolygonDoor3",fill:"#FFFAFA",points:w,transform:"translate("+(O.x-215)+", "+-80+") scale("+V+","+V+")"}),E.append("g").append("polygon").attr({id:"clipPolygonDoor4",fill:"#FFFAFA",points:w,transform:"translate("+(O.x-336)+", "+-80+") scale("+V+","+V+")"})}for(b=E.append("g").attr({id:"elem_group"}),v=E.append("g").attr({id:"dim_group"}),A=f.details.length,L=1;L<A;L+=1)if(b.selectAll("path."+f.details[L].id).data(f.details[L].parts).enter().append("path").attr({block_id:f.details[L].id,parent_id:f.details[L].parent,"class":function(i){var o;return o=e.typeConstruction===t.SVG_CLASS_ICON?"glass"===i.type?3===i.glass_type?"glass-sandwich":4===i.glass_type?"glass-brown":"glass-icon":"frame-icon":i.doorstep?"doorstep":"glass"===i.type?"glass":"frame"},item_type:function(e){return e.type},item_dir:function(e){return e.dir},item_id:function(e){return e.points[0].id},d:function(e){return 6!==o.product.doorLock.stvorka_type?e.path:6===o.product.doorLock.stvorka_type&&"bead"!==e.type?e.path:void 0},fill:function(i){var r;return r="glass"===i.type?e.typeConstruction===t.SVG_ID_MAIN?3===i.glass_type?"#ececec":4===i.glass_type?"#A52A2A":"url(#background)":3===i.glass_type?"#ececec":4===i.glass_type?"#A52A2A":"rgba(155, 204, 255, 0.20)":o.product.lamination.img_in_id>1&&6!==o.product.doorLock.stvorka_type?"frame"===i.type||"impost"===i.type?"glass"!==i.type?"url(#laminat)":"":"glass"!==i.type?"url(#laminat1)":"":o.product.lamination.img_out_id>1&&6===o.product.doorLock.stvorka_type?"frame"===i.type||"impost"===i.type?"glass"!==i.type?"url(#laminat)":"":"glass"!==i.type?"url(#laminat1)":"":e.typeConstruction===t.SVG_ID_MAIN?"#DCDCDC":"#f9f9f9"},"fill-opacity":function(i){var r;return"glass"===i.type?e.typeConstruction===t.SVG_ID_MAIN&&(r=2===i.glass_type?.5:1):"bead"===i.type&&6===o.product.doorLock.stvorka_type&&(r=0),r}}),e.typeConstruction!==t.SVG_CLASS_ICON){if(f.details[L].sashOpenDir&&0===f.details[L].children.length?b.selectAll("path.sash_mark."+f.details[L].id).data(f.details[L].sashOpenDir).enter().append("path").classed("sash_mark",!0).attr({d:function(e){return x(e.points)},"marker-mid":function(e){return c(1,e,f.details[L])},"marker-start":function(e){return c(0,e,f.details[L])},"marker-end":function(e){return c(0,e,f.details[L])}}):f.details[L].sashOpenDir&&0!==f.details[L].children.length&&l.global.createHandle.push(L),L+1===A&&l.global.createHandle.length>0)for(var Y=l.global.createHandle,W=0;W<Y.length;W+=1)b.selectAll("path.sash_mark."+f.details[Y[W]].id).data(f.details[Y[W]].sashOpenDir).enter().append("path").classed("sash_mark",!0).attr({d:function(e){return x(e.points)},"marker-mid":function(e){return c(1,e,f.details[Y[W]])},"marker-start":function(e){return c(0,e,f.details[Y[W]])},"marker-end":function(e){return c(0,e,f.details[Y[W]])}});e.typeConstruction===t.SVG_ID_EDIT&&1===f.details[L].level&&(D=f.details[L].pointsOut.filter(function(e){return e.corner>0}),b.selectAll("circle.corner_mark."+f.details[L].id).data(D).enter().append("circle").attr({block_id:f.details[L].id,"class":"corner_mark",parent_id:function(e){return e.id},cx:function(e){return e.x},cy:function(e){return e.y},r:0})),"tamlateGlassSVG"===e.typeConstruction&&(f.details[L].children.length||b.append("text").text(f.details[L].glassTxt).attr({block_id:f.details[L].id,"class":"glass-txt",x:f.details[L].center.x,y:f.details[L].center.y})),"tamlateGridSVG"===e.typeConstruction&&f.details[L].gridId&&b.append("text").text(f.details[L].gridTxt).attr({"class":"glass-txt",x:f.details[L].center.x,y:f.details[L].center.y})}if(e.typeConstruction!==t.SVG_CLASS_ICON){var q,j,Q,K=f.dimension.dimX.length,X=f.dimension.dimY.length,Z=f.dimension.dimQ.length;for(q=0;q<K;q+=1)u(0,f.dimension.dimX[q],v,x);for(j=0;j<X;j+=1)u(1,f.dimension.dimY[j],v,x);for(Q=0;Q<Z;Q+=1)p(f.dimension.dimQ[Q],v,x)}s.html(N),l.global.createHandle=[],a.removeAllEventsInSVG(),e.typeConstruction===t.SVG_ID_EDIT&&(a.initAllImposts(),a.initAllGlass(),a.initAllArcs(),a.initAllDimension())}}e.$watch("template",function(){f(e.template,e.templateWidth,e.templateHeight)})}}}])}(),function(){angular.module("BauVoiceApp").directive("typing",function(){return{scope:{output:"@",typingDelay:"@"},link:function(e,t,i){function o(){t.text(e.output)}i.$observe("typing",function(e){"on"===e.toString()&&o()}),i.$observe("output",function(){o()})}}})}();var NuanceSpeechKitPlugin=function(){};NuanceSpeechKitPlugin.prototype.initialize=function(e,t,i,o,r,a){return Cordova.exec(r,a,"PhoneGapSpeechPlugin","initSpeechKit",[e,t,i,o])},NuanceSpeechKitPlugin.prototype.cleanup=function(e,t){return Cordova.exec(e,t,"PhoneGapSpeechPlugin","cleanupSpeechKit",[])},NuanceSpeechKitPlugin.prototype.startRecognition=function(e,t,i,o){return Cordova.exec(i,o,"PhoneGapSpeechPlugin","startRecognition",[e,t])},NuanceSpeechKitPlugin.prototype.stopRecognition=function(e,t){return Cordova.exec(e,t,"PhoneGapSpeechPlugin","stopRecognition",[])},NuanceSpeechKitPlugin.prototype.getResults=function(e,t){return Cordova.exec(e,t,"PhoneGapSpeechPlugin","getRecoResult",[])},NuanceSpeechKitPlugin.prototype.playTTS=function(e,t,i,o,r){return Cordova.exec(o,r,"PhoneGapSpeechPlugin","startTTS",[e,t,i])},NuanceSpeechKitPlugin.prototype.stopTTS=function(e,t){return Cordova.exec(e,t,"PhoneGapSpeechPlugin","stopTTS",[])},String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1},function(){angular.module("MainModule").factory("AddElementMenuServ",["$q","$timeout","GlobalStor","OrderStor","ProductStor","CartStor","AuxStor","DesignStor","UserStor","localDB","GeneralServ","loginServ","MainServ","SVGServ","DesignServ","AnalyticsServ","CartServ","CartMenuServ",function(e,t,i,o,r,a,n,l,s,d,c,u,p,g,m,f,h,y){function E(){n.aux.auxParameter=0,i.global.isQtyCalculator=0,i.global.isSizeCalculator=0,i.global.isWidthCalculator=0}function b(e){var r,a=e.chosenAddElements.length;for(e.addelem_price=0,e.addelemPriceDis=0;--a>-1;)if(r=e.chosenAddElements[a].length,r>0)for(;--r>-1;)e.addelem_price+=e.chosenAddElements[a][r].element_qty*e.chosenAddElements[a][r].element_price;e.addelem_price=c.roundingValue(e.addelem_price),e.addelemPriceDis=c.setPriceDis(e.addelem_price,o.order.discount_addelem),t(function(){"history"!==i.global.currOpenPage&&p.setProductPriceTOTAL(e)},50)}function v(e){var t=n.aux.currentAddElementId,i=n.aux.auxParameter.split("-")[0]-1;return!(r.product.chosenAddElements[i][t].element_qty<2&&e<0)&&(!(r.product.chosenAddElements[i][t].element_qty<6&&e==-5)&&void(n.aux.tempSize.length?(r.product.chosenAddElements[i][t].element_qty=parseInt(n.aux.tempSize.join(""),10)+e,n.aux.tempSize.length=0):r.product.chosenAddElements[i][t].element_qty+=e))}function T(){E(),n.aux.tempSize.length=0,b(r.product)}function I(e,t,r){var a,l=r[e][t];return 20===l.list_group_id?(a={currencyId:s.userInfo.currencyId,element:l},d.calculationGridPrice(a).then(function(e){return e&&(l.element_price=angular.copy(c.roundingValue(c.addMarginToPrice(e.priceTotal,i.global.margins.margin))),l.elementPriceDis=angular.copy(c.roundingValue(c.setPriceDis(l.element_price,o.order.discount_addelem))),n.aux.currAddElementPrice=angular.copy(l.elementPriceDis)),e})):(a={currencyId:s.userInfo.currencyId,elementId:l.id,elementWidth:l.element_width/1e3,elementHeight:l.element_height/1e3},d.getAdditionalPrice(a).then(function(e){return e&&(l.element_price=c.roundingValue(c.addMarginToPrice(e.priceTotal,i.global.margins.margin)),l.elementPriceDis=c.roundingValue(c.setPriceDis(l.element_price,o.order.discount_addelem)),n.aux.currAddElementPrice=angular.copy(l.elementPriceDis)),e}))}function S(){var e=n.aux.currentAddElementId,t=n.aux.auxParameter.split("-")[0]-1;n.aux.tempSize.length=0,r.product.chosenAddElements[t][e].element_width<=i.global.maxSizeAddElem?(E(),l.design.isMinSizeRestriction=0,l.design.isMaxSizeRestriction=0,I(t,e,r.product.chosenAddElements).then(function(){b(r.product)})):(l.design.isMinSizeRestriction=0,l.design.isMaxSizeRestriction=1,r.product.chosenAddElements[t][e].element_width=1e3)}function A(){var e="",t=n.aux.currentAddElementId,o=n.aux.auxParameter.split("-")[0]-1;e=parseInt(n.aux.tempSize.join(""),10),i.global.isQtyCalculator?r.product.chosenAddElements[o][t].element_qty=e:i.global.isSizeCalculator&&(i.global.isWidthCalculator?r.product.chosenAddElements[o][t].element_width=e:r.product.chosenAddElements[o][t].element_height=e)}function L(e){var t=n.aux.tempSize.length;(4===t||1===t&&!n.aux.tempSize[0])&&(n.aux.tempSize.length=0),"0"===e?t&&n.aux.tempSize[0]&&(n.aux.tempSize.push(e),A()):"00"===e?t&&n.aux.tempSize[0]&&(t<3?n.aux.tempSize.push(0,0):3===t&&n.aux.tempSize.push(0),A()):(n.aux.tempSize.push(e),A())}function D(){n.aux.tempSize.pop(),n.aux.tempSize.length<1&&n.aux.tempSize.push(0),A()}function N(e){var t;if(13===e.which)i.global.isQtyCalculator?T():i.global.isSizeCalculator&&S();else if(8===e.which)D();else{switch(e.which){case 48:case 96:t=0;break;case 49:case 97:t=1;break;case 50:case 98:t=2;break;case 51:case 99:t=3;break;case 52:case 100:t=4;break;case 53:case 101:t=5;break;case 54:case 102:t=6;break;case 55:case 103:t=7;break;case 56:case 104:t=8;break;case 57:case 105:t=9}void 0!==t&&L(t)}}function x(){i.global.isSizeCalculator?S():i.global.isQtyCalculator&&T(),n.aux.currentAddElementId=0}function R(){$("#"+n.aux.trfal).css({color:"#363636"}),(i.global.isQtyCalculator||i.global.isSizeCalculator)&&x(),n.aux.isFocusedAddElement=0,n.aux.isTabFrame=0,n.aux.isGridSelectorDialog=0,n.aux.selectedGrid=0,n.aux.showAddElementsMenu=0,n.aux.isAddElement=0}function O(e){var t;if(r.product.template_source.details[e].gridId)for(t=r.product.chosenAddElements[0].length;--t>-1;)r.product.chosenAddElements[0][t].block_id===r.product.template_source.details[e].id&&(1===r.product.chosenAddElements[0][t].element_qty?r.product.chosenAddElements[0].splice(t,1):r.product.chosenAddElements[0][t].element_qty>1&&(r.product.chosenAddElements[0][t].element_qty-=1))}function C(e,t,i){var o,a=r.product.template.details[t].pointsLight.map(function(e){return e.x}),l=r.product.template.details[t].pointsLight.map(function(e){return e.y});return r.product.template_source.details[t].gridId=n.aux.addElementsList[i[0]][i[1]].id,r.product.template_source.details[t].gridTxt=n.aux.addElementsList[i[0]][i[1]].name,o=angular.copy(n.aux.addElementsList[i[0]][i[1]]),o.element_width=Math.round(d3.max(a)-d3.min(a)),o.element_height=Math.round(d3.max(l)-d3.min(l)),o.block_id=e,o}function P(e,t){for(var i=r.product.template_source.details.length,o=[];--i>0;)if(e){if(r.product.template_source.details[i].id===e&&"sash"===r.product.template_source.details[i].blockType){O(i),o.push(C(e,i,t));break}}else"sash"===r.product.template_source.details[i].blockType&&(O(i),o.push(C(r.product.template_source.details[i].id,i,t)));return o}function w(){g.createSVGTemplate(r.product.template_source,r.product.profileDepths).then(function(e){r.product.template=angular.copy(e)})}function M(){m.removeGlassEventsInSVG(),l.design.selectedGlass.length=0,n.aux.selectedGrid=0,n.aux.isGridSelectorDialog=!n.aux.isGridSelectorDialog}function k(e,t){for(var i=e.length,o=0;--i>-1;)if(e[i].id===t.id&&(t.element_width&&t.element_height&&e[i].element_width===t.element_width&&e[i].element_height===t.element_height&&(o+=1),t.element_width&&!t.element_height&&e[i].element_width===t.element_width&&(o+=1),t.element_width||t.element_height||(o+=1),o)){e[i].element_qty+=1;break}return o}function G(e,t){var i,o=n.aux.isFocusedAddElement-1;if(0!==o&&(i=k(e.chosenAddElements[o],t)),!i||0==o){var r={element_type:o,element_width:0,element_height:0,block_id:0},a=angular.extend(r,t);e.chosenAddElements[o].push(a),2===e.chosenAddElements[o].length&&(n.aux.isTabFrame=1)}}function B(e){u.getGridPrice(e).then(function(e){var t=e.length;if(n.aux.currAddElementPrice=0,t){for(;--t>-1;)G(r.product,e[t]),n.aux.currAddElementPrice+=e[t].elementPriceDis;n.aux.currAddElementPrice=c.roundingValue(n.aux.currAddElementPrice),n.aux.isAddElement=n.aux.selectedGrid[0]+"-"+n.aux.selectedGrid[1],b(r.product),w(),M()}})}function V(){var e=[],t=[];i.global.sashTypeBlock.length>0&&(e=i.global.sashTypeBlock.map(function(e){var t=e;return P(t,n.aux.selectedGrid)[0]})),l.design.selectedGlass.length&&(t=l.design.selectedGlass.map(function(e){var t=e.attributes.block_id.nodeValue;return P(t,n.aux.selectedGrid)[0]})),t=_.union(_.compact(t),e),t.length>0&&B(t)}function H(){var e=P(0,n.aux.selectedGrid);B(e)}function U(e){for(var t=r.product.template_source.details.length;--t>0;)if(e){if(r.product.template_source.details[t].id===e&&r.product.template_source.details[t].gridId){delete r.product.template_source.details[t].gridId,delete r.product.template_source.details[t].gridTxt;break}}else r.product.template_source.details[t].gridId&&(delete r.product.template_source.details[t].gridId,delete r.product.template_source.details[t].gridTxt);w()}function F(t,i){var o=e.defer();return n.aux.isAddElement=t+"-"+i,I(t,i,n.aux.addElementsList).then(function(){o.resolve(angular.copy(n.aux.addElementsList[t][i]))}),o.promise}function z(e,t){if((i.global.isQtyCalculator||i.global.isSizeCalculator)&&x(),n.aux.currAddElementPrice=0,void 0===e&&void 0===t){1===n.aux.isFocusedAddElement&&U();var o=n.aux.isFocusedAddElement-1;n.aux.isAddElement=0,r.product.chosenAddElements[o].length=0,b(r.product)}else F(e,t).then(function(e){G(r.product,e),b(r.product)})}function Y(e,t){var l,s;if("main"===i.global.currOpenPage)1===n.aux.isFocusedAddElement?r.product.is_addelem_only?(G(r.product,n.aux.addElementsList[e][t]),b(r.product)):(n.aux.selectedGrid=[e,t],n.aux.isGridSelectorDialog=1,m.initAllGlassXGrid()):(G(r.product,n.aux.addElementsList[e][t]),b(r.product));else if("cart"===i.global.currOpenPage)for(l=a.cart.selectedProducts.length,s=0;s<l;s+=1)a.cart.selectedProducts[s].length&&(G(o.order.products[s],n.aux.addElementsList[e][t]),h.calculateAddElemsProductsPrice(1),y.joinAllAddElements(),h.collectAllAddElems(),h.getAddElemsPriceTotal(),y.calculateOrderPrice());n.aux.currAddElementPrice=0,n.aux.isAddElement=0}function W(e,t,i){I(t,i,n.aux.addElementsList).then(function(){var o,a=e-1,l=angular.copy(n.aux.addElementsList[t][i]);if(o=k(r.product.chosenAddElements[a],l),!o){var s={element_type:a,element_width:0,element_height:0,block_id:0},d=angular.extend(s,l);r.product.chosenAddElements[a].push(d)}b(r.product)})}function q(e,t,o,a){a.stopPropagation(),R(),n.aux.addElementsList=angular.copy(i.global.addElementsAll[e-1].elementsList),1===e?r.product.is_addelem_only?W(e,t,o):(n.aux.isFocusedAddElement=e,n.aux.selectedGrid=[t,o],n.aux.isGridSelectorDialog=1,m.initAllGlassXGrid()):W(e,t,o)}function j(e,t){(i.global.isQtyCalculator||i.global.isSizeCalculator)&&x(),(1===n.aux.isFocusedAddElement||n.aux.isAddElementListView)&&U(r.product.chosenAddElements[e][t].block_id),r.product.chosenAddElements[e].splice(t,1),b(r.product)}function Q(){var e,t=r.product.chosenAddElements.length;for(e=0;e<t;e+=1)e||r.product.chosenAddElements[e].length&&U(),r.product.chosenAddElements[e].length=0;r.product.addelem_price=0,r.product.addelemPriceDis=0,b(r.product),R()}var K=this;return K.publicObj={closeAddElementsMenu:R,chooseAddElement:z,setAddElementsTotalPrice:b,chooseAddElementList:Y,getAddElementPrice:F,deleteAddElement:j,deleteAllAddElements:Q,finishCalculators:x,takeAddElemFilt:q,pushSelectedAddElement:G,confirmGrid:V,setGridToAll:H,closeGridSelectorDialog:M,pressCulculator:N,setValueQty:v,closeQtyCaclulator:T,setValueSize:L,deleteLastNumber:D,changeElementSize:A,closeSizeCaclulator:S},K.publicObj}])}(),function(){angular.module("MainModule").factory("AddElementsServ",["$filter","$timeout","globalConstants","GeneralServ","AddElementMenuServ","GlobalStor","ProductStor","AuxStor","DesignServ","DesignStor",function(e,t,i,o,r,a,n,l,s,d){function c(e){var t,r=e-1;l.aux.addElementsMenuStyle=o.addElementDATA[r].typeClass+"-theme",l.aux.addElementsType=angular.copy(a.global.addElementsAll[r].elementType),v&&navigator.onLine&&(l.aux.addElementsType=l.aux.addElementsType.filter(function(e){return console.log("globalConstants.serverIP + res.img",i.serverIP,e.img),e.img=i.serverIP+e.img,e})),1===l.aux.isFocusedAddElement?n.product.is_addelem_only?(t=angular.copy(a.global.addElementsAll[r].elementsList)[0].filter(function(e){return!e.profile_id}),l.aux.addElementsList=[t]):(t=angular.copy(a.global.addElementsAll[r].elementsList)[0].filter(function(e){return e.profile_id===n.product.profile.id}),l.aux.addElementsList=[t]):l.aux.addElementsList=angular.copy(a.global.addElementsAll[r].elementsList),console.log(l.aux.addElementsList)}function u(e){l.aux.isFocusedAddElement=e,l.aux.currAddElementPrice=0,c(e),l.aux.addElementsList.length&&l.aux.addElementsList[0].length&&(l.aux.showAddElementsMenu=i.activeClass),p("close")}function p(e){if("close"===e)if(l.aux.addElementsList.length>1)for(var t=0;t<l.aux.addElementsList.length;t+=1)$("#"+t).css({width:"100%",height:"7%"}),$("#"+t+"open").css({visibility:"visible"}),$("#"+t+"close").css({visibility:"hidden"}),l.aux.truefalse=0;else $("#0").css({width:"100%",height:"auto"}),$("#0open").css({visibility:"hidden"}),$("#0close").css({visibility:"visible"}),l.aux.truefalse=1;else 1===l.aux.truefalse?($("#"+l.aux.trfal+"prod").css({color:"#363636"}),$("#"+e).css({width:"100%",height:"7%"}),$("#"+e+"open").css({visibility:"visible"}),$("#"+e+"close").css({visibility:"hidden"}),l.aux.truefalse=0):($("#"+l.aux.trfal+"prod").css({color:"#363636"}),$("#"+e).css({width:"100%",height:"auto"}),$("#"+e+"open").css({visibility:"hidden"}),$("#"+e+"close").css({visibility:"visible"}),l.aux.truefalse=1)}function g(e){(a.global.isQtyCalculator||a.global.isSizeCalculator)&&r.finishCalculators(),l.aux.showAddElementsMenu?l.aux.isFocusedAddElement===e?r.closeAddElementsMenu():(r.closeAddElementsMenu(),t(function(){u(e)},I)):u(e)}function m(e,t,i){var s;if(d.design.minSizeLimit=0,n.product.chosenAddElements[e-1][i].max_size?(d.design.maxSizeLimit=n.product.chosenAddElements[e-1][i].max_size,a.global.maxSizeAddElem=n.product.chosenAddElements[e-1][i].max_size):(d.design.maxSizeLimit=5e3,a.global.maxSizeAddElem=5e3),l.aux.auxParameter===e+"-"+t+"-"+i)r.finishCalculators();else switch((a.global.isQtyCalculator||a.global.isSizeCalculator)&&r.finishCalculators(),s=n.product.chosenAddElements[e-1][i],l.aux.auxParameter=e+"-"+t+"-"+i,l.aux.currentAddElementId=i,l.aux.calculatorStyle=o.addElementDATA[e-1].typeClass+"-theme",t){case 1:a.global.isQtyCalculator=1;break;case 2:a.global.isSizeCalculator=1,a.global.isWidthCalculator=1;break;case 3:a.global.isSizeCalculator=1,a.global.isWidthCalculator=0}}function f(){l.aux.isFocusedAddElement=0,l.aux.isTabFrame=0,l.aux.showAddElementsMenu=0,l.aux.isAddElement=0,l.aux.isGridSelectorDialog=0,(a.global.isQtyCalculator||a.global.isSizeCalculator)&&r.finishCalculators()}function _(){l.aux.isAddElementListView=1,f()}function h(){l.aux.isAddElementListView=0,f()}function y(){var t,i,r,s,d,c,u,p=o.addElementDATA.length,g=a.global.addElementsAll,m=l.aux.searchingWord.toLowerCase(),f=[];for(l.aux.addElementGroups.length=0,r=0;r<p;r+=1)if(g[r].elementsList){for(t={type:{},elems:[]},t.type.groupId=r+1,t.type.groupName=e("translate")(o.addElementDATA[r].name),t.type.groupClass=o.addElementDATA[r].typeClass+"-theme",u=r?g[r].elementsList:n.product.is_addelem_only?[angular.copy(g[r].elementsList)[0].filter(function(e){return!e.profile_id})]:[angular.copy(g[r].elementsList)[0].filter(function(e){return e.profile_id===n.product.profile.id})],s=u.length;--s>-1;)for(d=u[s].length;--d>-1;)c=u[s][d].name.toLowerCase(),c.indexOf(m)+1&&(i={typeInd:s,index:d,name:u[s][d].name},t.elems.push(i));f.push(t)}l.aux.addElementGroups=f.filter(function(e){return e.elems.length>0})}function E(e,t,i){e+"prod"+t===l.aux.trfal||l.aux.trfal===-1?$("#"+e+"prod"+t).css({color:"#0079ff"}):t!==l.aux.trfal&&($("#"+l.aux.trfal).css({color:"#363636"}),$("#"+e+"prod"+t).css({color:"#0079ff"})),l.aux.trfal=e+"prod"+t,(a.global.isQtyCalculator||a.global.isSizeCalculator)&&r.finishCalculators(),"main"===a.global.currOpenPage&&1===l.aux.isFocusedAddElement?n.product.is_addelem_only?r.chooseAddElement(e,t):(l.aux.selectedGrid=[e,t],l.aux.isGridSelectorDialog=1,l.aux.isAddElement=e+"-"+t,s.initAllGlassXGrid()):l.aux.isAddElementListView?b(e,t,i):r.chooseAddElement(e,t)}function b(e,i,o){var a;l.aux.isAddElement===e+"-"+i?l.aux.isAddElement=!1:l.aux.isAddElement===!1?(a=$(o.target).offset(),l.aux.coordinats={top:a.top-17},t(function(){r.getAddElementPrice(e,i)},500)):(l.aux.isAddElement=!1,t(function(){a=$(o.target).offset(),l.aux.coordinats={top:a.top-11}},500),t(function(){r.getAddElementPrice(e,i)},1e3))}var v,T=this,I=12*i.STEP;return $.get("http://api.steko.com.ua",function(e){return v=!0,!0}).fail(function(){return v=!1,!1}),T.publicObj={selectAddElementList:b,selectAddElement:g,initAddElementTools:m,selectAddElem:E,openAddElementListView:_,closeAddElementListView:h,createAddElementGroups:y,hideMenu:p,downloadAddElementsData:c},T.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("AnalyticsServ",["localDB","UserStor",function(e,t){function i(i,o,r,a,n){var l={user_id:i,order_id:o,calculation_id:r,element_id:a,date:new Date},s="";switch(n){case 1:s="profile_analytics";break;case 2:break;case 3:s="hardware_analytics";break;case 4:}e.insertServer(t.userInfo.phone,t.userInfo.device_code,s,l)}var o=this;return o.analyticsObjSource={user_id:0,order_id:0,element_id:0,element_type:0},o.publicObj={sendAnalyticsData:i},o.publicObj}])}(),function(){angular.module("CartModule").factory("CartMenuServ",["$location","GeneralServ","MainServ","GlobalStor","OrderStor","CartStor","UserStor",function(e,t,i,o,r,a,n){function l(){var e,t,i,o,n,l,s,d,c=r.order.products.length,u=0;for(a.cart.allAddElements.length=0,a.cart.isExistAddElems=0,l=0;l<c;l+=1){for(i=[],e=r.order.products[l].chosenAddElements.length,s=0;s<e;s+=1)if(t=r.order.products[l].chosenAddElements[s].length,t>0)for(d=0;d<t;d+=1)o=angular.copy(r.order.products[l].chosenAddElements[s][d]),n={id:o.id,list_group_id:o.list_group_id,name:o.name,elementPriceDis:o.elementPriceDis,element_price:o.element_price,element_qty:o.element_qty*r.order.products[l].product_qty,element_type:o.element_type,element_width:o.element_width,element_height:o.element_height},i.push(n);i.length&&(u+=1),a.cart.allAddElements.push(i)}u&&(a.cart.isExistAddElems=1)}function s(){var e=new Date(r.order.new_delivery_date).getDay(),i=0;switch(e){case 0:i=n.userInfo.mount_sun||0;break;case 1:i=n.userInfo.mount_mon||0;break;case 2:i=n.userInfo.mount_tue||0;break;case 3:i=n.userInfo.mount_wed||0;break;case 4:i=n.userInfo.mount_thu||0;break;case 5:i=n.userInfo.mount_fri||0;break;case 6:i=n.userInfo.mount_sat||0}r.order.mounting_price=t.roundingValue(r.order.mounting_price*(1+i/100))}function d(e,i,o,a){r.order.is_instalment&&(r.order.payment_first=t.roundingValue(e*r.order.selectedInstalmentPercent/100),r.order.payment_monthly=t.roundingValue((e-r.order.payment_first)/r.order.selectedInstalmentPeriod),r.order.paymentFirstDis=t.roundingValue(o*r.order.selectedInstalmentPercent/100),r.order.paymentMonthlyDis=t.roundingValue((o-r.order.paymentFirstDis)/r.order.selectedInstalmentPeriod),i&&(r.order.payment_first_primary=t.roundingValue(i*r.order.selectedInstalmentPercent/100),r.order.payment_monthly_primary=t.roundingValue((i-r.order.payment_first_primary)/r.order.selectedInstalmentPeriod),r.order.paymentFirstPrimaryDis=t.roundingValue(a*r.order.selectedInstalmentPercent/100),r.order.paymentMonthlyPrimaryDis=t.roundingValue((a-r.order.paymentFirstPrimaryDis)/r.order.selectedInstalmentPeriod)))}function c(){if(r.order.order_price=0,r.order.order_price_dis=0,s(),r.order.order_price=r.order.products_price,r.order.order_price_dis=t.roundingValue(r.order.productsPriceDis+r.order.floor_price+r.order.mounting_price),r.order.order_price_primary=angular.copy(r.order.order_price),r.order.orderPricePrimaryDis=angular.copy(r.order.order_price_dis),r.order.delivery_price)if(r.order.is_date_price_more)a.cart.marginDeliveyPlant&&(r.order.order_price+=r.order.products_price*a.cart.marginDeliveyPlant/100),r.order.order_price_dis+=r.order.delivery_price;else if(r.order.is_date_price_less)a.cart.discountDeliveyPlant&&(r.order.order_price-=r.order.products_price*a.cart.discountDeliveyPlant/100),r.order.order_price_dis-=r.order.delivery_price;else{var e=o.global.deliveryCoeff.percents[o.global.deliveryCoeff.standart_time];e&&(r.order.order_price-=r.order.products_price*e/100)}r.order.order_price=t.roundingValue(r.order.order_price),r.order.order_price_dis=t.roundingValue(r.order.order_price_dis),a.cart.discountPriceDiff=t.roundingValue(r.order.order_price-r.order.productsPriceDis),d(r.order.order_price,r.order.order_price_primary,r.order.order_price_dis,r.order.orderPricePrimaryDis)}function u(e){r.order.floor_id!==e.id&&(r.order.floor_id=e.id,e.id?(r.order.floorName=e.name,r.order.floor_price=e.priceReal,r.order.delivery_user_id=e.user_id):(r.order.floorName="",r.order.floor_price=0,r.order.delivery_user_id=0),c())}function p(e){r.order.mounting_id!==e.id&&(r.order.mounting_id=e.id,e.id?(r.order.mountingName=e.name,r.order.mounting_price=e.priceReal,r.order.mounting_user_id=e.user_id):(r.order.mountingName="",r.order.mounting_price=0,r.order.mounting_user_id=0),c())}function g(e,t,i){r.order.instalment_id!==e&&(r.order.is_instalment=1,r.order.instalment_id=e,r.order.selectedInstalmentPeriod=t,r.order.selectedInstalmentPercent=i,d(r.order.order_price,r.order.order_price_primary,r.order.order_price_dis,r.order.orderPricePrimaryDis))}function m(e){for(var i,o=r.order.products.length;--o>-1;)i=t.setPriceDis(r.order.products[o].template_price,e)+r.order.products[o].addelemPriceDis,r.order.products[o].productPriceDis=angular.copy(t.roundingValue(i))}function f(){var e=r.order.products.length;for(r.order.templates_price=0,r.order.addelems_price=0,r.order.products_price=0,r.order.productsPriceDis=0,a.cart.squareTotal=0,a.cart.perimeterTotal=0,a.cart.qtyTotal=0;--e>-1;)r.order.addelems_price+=r.order.products[e].addelem_price*r.order.products[e].product_qty,r.order.templates_price+=r.order.products[e].template_price*r.order.products[e].product_qty,r.order.products_price+=r.order.products[e].product_price*r.order.products[e].product_qty,r.order.productsPriceDis+=r.order.products[e].productPriceDis*r.order.products[e].product_qty,a.cart.squareTotal+=r.order.products[e].template_square*r.order.products[e].product_qty,a.cart.perimeterTotal+=.002*(r.order.products[e].template_width+r.order.products[e].template_height)*r.order.products[e].product_qty,a.cart.qtyTotal+=r.order.products[e].product_qty;r.order.addelems_price=t.roundingValue(r.order.addelems_price),r.order.templates_price=t.roundingValue(r.order.templates_price),r.order.products_price=t.roundingValue(r.order.products_price),a.cart.squareTotal=t.roundingValue(a.cart.squareTotal),a.cart.perimeterTotal=t.roundingValue(a.cart.perimeterTotal),a.cart.qtyTotal=t.roundingValue(a.cart.qtyTotal),r.order.productsPriceDis?r.order.productsPriceDis=t.roundingValue(r.order.productsPriceDis):r.order.productsPriceDis=angular.copy(r.order.products_price)}function _(e){var i,o,a,n,s,d,c=r.order.products.length;for(n=0;n<c;n++)for(i=r.order.products[n].productPriceDis-r.order.products[n].addelemPriceDis,r.order.products[n].addelemPriceDis=t.setPriceDis(r.order.products[n].addelem_price,e),
r.order.products[n].productPriceDis=t.roundingValue(i+r.order.products[n].addelemPriceDis),o=r.order.products[n].chosenAddElements.length,s=0;s<o;s++)if(a=r.order.products[n].chosenAddElements[s].length,a>0)for(d=0;d<a;d++)r.order.products[n].chosenAddElements[s][d].elementPriceDis=t.setPriceDis(r.order.products[n].chosenAddElements[s][d].element_price,e);l()}function h(){r.order.delivery_price=t.roundingValue(r.order.productsPriceDis*a.cart.discountDeliveyPlant/100)}function y(){r.order.delivery_price=t.roundingValue(r.order.productsPriceDis*a.cart.marginDeliveyPlant/100)}function E(){r.order.is_date_price_less=0,r.order.is_date_price_more=0,r.order.is_old_price=0}function b(e,t){var l=e.split("."),s=t.split("."),d=new Date(l[2],l[1]-1,l[0]),u=new Date(s[2],s[1]-1,s[0]),p=Math.floor((u-d)/864e5);if(r.order.delivery_price=0,p&&p>0){var g=p/7,b=0,v=0,T=0;g<=1?(b=o.global.deliveryCoeff.week_1,v=n.userInfo.discConstrByWeek[0],T=n.userInfo.discAddElemByWeek[0]):g>1&&g<=2?(b=o.global.deliveryCoeff.week_2,v=n.userInfo.discConstrByWeek[1],T=n.userInfo.discAddElemByWeek[1]):g>2&&g<=3?(b=o.global.deliveryCoeff.week_3,v=n.userInfo.discConstrByWeek[2],T=n.userInfo.discAddElemByWeek[2]):g>3&&g<=4?(b=o.global.deliveryCoeff.week_4,v=n.userInfo.discConstrByWeek[3],T=n.userInfo.discAddElemByWeek[3]):g>4&&g<=5?(b=o.global.deliveryCoeff.week_5,v=n.userInfo.discConstrByWeek[4],T=n.userInfo.discAddElemByWeek[4]):g>5&&g<=6?(b=o.global.deliveryCoeff.week_6,v=n.userInfo.discConstrByWeek[5],T=n.userInfo.discAddElemByWeek[5]):g>6&&g<=7?(b=o.global.deliveryCoeff.week_7,v=n.userInfo.discConstrByWeek[6],T=n.userInfo.discAddElemByWeek[6]):g>7&&(b=o.global.deliveryCoeff.week_8,v=n.userInfo.discConstrByWeek[7],T=n.userInfo.discAddElemByWeek[7]),v?(r.order.discount_construct=v,m(v),f()):(r.order.discount_construct=angular.copy(n.userInfo.discountConstr),m(r.order.discount_construct),f()),T?(r.order.discount_addelem=T,_(T),f()):(r.order.discount_addelem=angular.copy(n.userInfo.discountAddElem),_(r.order.discount_addelem),f()),b?(a.cart.discountDeliveyPlant=b,h(),r.order.is_date_price_less=1,r.order.is_date_price_more=0,r.order.is_old_price=1):(f(),E())}else if(p&&p<0){i.setCurrDiscounts(),_(r.order.discount_addelem),m(r.order.discount_construct),f();var I=Math.abs(o.global.deliveryCoeff.standart_time+p);a.cart.marginDeliveyPlant=+o.global.deliveryCoeff.percents[I],a.cart.marginDeliveyPlant?(y(),r.order.is_date_price_more=1,r.order.is_date_price_less=0,r.order.is_old_price=1):E()}else i.setCurrDiscounts(),_(r.order.discount_addelem),m(r.order.discount_construct),f(),E();r.order.new_delivery_date=u.getTime(),c()}function v(e){if(e)for(var t=e.length;--t>-1;)if(e[t].type)switch(e[t].type){case 1:e[t].priceReal=Math.round(e[t].price*a.cart.qtyTotal);break;case 2:e[t].priceReal=Math.round(e[t].price*a.cart.squareTotal);break;case 3:e[t].priceReal=Math.round(e[t].price*a.cart.perimeterTotal);break;case 4:e[t].priceReal=Math.round(r.order.productsPriceDis*e[t].price/100);break;default:e[t].priceReal=Math.round(e[t].price)}}function T(){f(),a.cart.discountDeliveyPlant&&h(),a.cart.marginDeliveyPlant&&y(),c(),v(o.global.supplyData),v(o.global.assemblingData)}function I(){a.cart.tempConstructDisc=+r.order.discount_construct,a.cart.tempAddelemDisc=+r.order.discount_addelem,a.cart.isShowDiscount=1}function S(){a.cart.isShowDiscount=0}function A(){a.cart.isShowDiscount||(a.cart.tempConstructDisc=+r.order.discount_construct,a.cart.tempAddelemDisc=+r.order.discount_addelem),a.cart.isShowDiscount=!a.cart.isShowDiscount}function L(e){return null==e?e=0:e%1&&(e=parseFloat(e.toFixed(1))),e}function D(e){e?(a.cart.tempAddelemDisc=L(a.cart.tempAddelemDisc),a.cart.tempAddelemDisc>n.userInfo.discountAddElemMax&&(a.cart.tempAddelemDisc=+n.userInfo.discountAddElemMax),r.order.discount_addelem=+a.cart.tempAddelemDisc,_(r.order.discount_addelem)):(a.cart.tempConstructDisc=L(a.cart.tempConstructDisc),a.cart.tempConstructDisc>n.userInfo.discountConstrMax&&(a.cart.tempConstructDisc=+n.userInfo.discountConstrMax),r.order.discount_construct=+a.cart.tempConstructDisc,m(r.order.discount_construct)),T()}function N(){a.cart.customer.customer_city_id=arguments[0],a.cart.customer.customer_city=arguments[1],a.cart.customer.customer_location=arguments[2]}function x(){a.cart.submitted=0,a.cart.isCityBox=0,o.global.orderEditNumber>0?a.fillOrderForm():(N(r.order.customer_city_id,r.order.customer_city,r.order.customer_location),a.cart.customer.customer_sex=0),a.cart.isMasterDialog=0,a.cart.isOrderDialog=0,a.cart.isCreditDialog=0}function R(){var r;o.global.isLoader=1,r=a.cart.isMasterDialog?"master":"order",i.saveOrderInDB(a.cart.customer,1,r).then(function(){x(),t.setPreviosPage(),o.global.isLoader=0,e.path("/history")})}function O(){o.global.changeLocation=0,a.cart.customer.customer_location?a.cart.isCityBox=1:a.cart.isCityBox=0}function C(e){o.global.changeLocation=1,N(e.cityId,e.cityName,e.fullLocation),a.cart.isCityBox=0}var P=this;return P.publicObj={joinAllAddElements:l,selectFloorPrice:u,selectAssembling:p,selectInstalment:g,checkDifferentDate:b,calculateOrderPrice:T,calculateAllProductsPrice:f,calculateTotalOrderPrice:c,changeProductPriceAsDiscount:m,changeAddElemPriceAsDiscount:_,openDiscountBlock:I,closeDiscountBlock:S,swipeDiscountBlock:A,approveNewDisc:D,closeOrderDialog:x,changeLocation:O,selectCity:C,sendOrder:R},P.publicObj}])}(),function(){angular.module("CartModule").factory("CartServ",["$location","$filter","GeneralServ","MainServ","CartMenuServ","GlobalStor","OrderStor","ProductStor","CartStor","AuxStor",function(e,t,i,o,r,a,n,l,s,d){function c(){i.setPreviosPage(),o.createNewProduct()}function u(e){n.order.products[e].product_qty+=1,r.joinAllAddElements(),r.calculateOrderPrice()}function p(e){function o(){n.order.products.splice(e,1),s.cart.allAddElements.splice(e,1),r.calculateOrderPrice();var t=n.order.products;if(t.length>0)for(var i=0;i<t.length;i+=1)t[i].product_id=i+1}i.confirmAlert(t("translate")("common_words.DELETE_PRODUCT_TITLE"),t("translate")("common_words.DELETE_PRODUCT_TXT"),o)}function g(e){1===n.order.products[e].product_qty?p(e):(n.order.products[e].product_qty-=1,r.calculateOrderPrice()),r.joinAllAddElements()}function m(s,d){function c(){if(l.product=angular.copy(n.order.products[s]),a.global.productEditNumber=l.product.product_id,a.global.isCreatedNewProduct=1,a.global.isChangedTemplate=1,o.prepareMainPage(),"auxiliary"===d&&(a.global.activePanel=6),l.product.is_addelem_only)a.global.activePanel=6,a.global.isBox=!a.global.isBox,e.path("/main");else{i.setPreviosPage();var t,r=l.product.profile.id;t=angular.copy(l.product),o.setCurrentProfile(l.product,r).then(function(){o.saveTemplateInProduct(l.product.template_id).then(function(){o.checkGlassSizes(l.product.template),l.product=angular.copy(t),e.path("/main")})}),a.global.isBox=!a.global.isBox}}function u(e,t){t+=1,e.product_id=t,n.order.products.push(e)}function p(){var e=d3.max(n.order.products.map(function(e){return e.product_id})),t=angular.copy(n.order.products[s]);a.global.isBox=!a.global.isBox,u(t,e),r.joinAllAddElements(),r.calculateOrderPrice()}a.global.isBox=!a.global.isBox,i.confirmAlert(t("translate")("common_words.EDIT_COPY_TXT"),t("translate")("  "),c),i.confirmPath(p)}function f(){var e,t,o,r=angular.copy(s.cart.allAddElements),a=r.length;for(s.cart.allAddElemsOrder.length=0;--a>-1;)if(e=r[a].length)for(;--e>-1;)if(t=s.cart.allAddElemsOrder.length){for(o=1;--t>-1;)s.cart.allAddElemsOrder[t].id===r[a][e].id&&s.cart.allAddElemsOrder[t].element_width===r[a][e].element_width&&s.cart.allAddElemsOrder[t].element_height===r[a][e].element_height&&(s.cart.allAddElemsOrder[t].element_qty=i.roundingValue(s.cart.allAddElemsOrder[t].element_qty+r[a][e].element_qty),o-=1);o&&s.cart.allAddElemsOrder.push(r[a][e])}else s.cart.allAddElemsOrder.push(r[a][e]);console.warn(s.cart.allAddElemsOrder)}function _(){var e=n.order.products.length;for(s.cart.addElemsOrderPriceTOTAL=0;--e>-1;)s.cart.addElemsOrderPriceTOTAL+=n.order.products[e].addelemPriceDis*n.order.products[e].product_qty;s.cart.addElemsOrderPriceTOTAL=i.roundingValue(s.cart.addElemsOrderPriceTOTAL)}function h(){s.cart.selectedProducts.length=0,s.cart.selectedProducts=n.order.products.map(function(){return[]})}function y(){f(),_(),h(),s.cart.isAllAddElems=1,d.aux.isAddElementListView=1}function E(e){for(var t,r,a=n.order.products.length;--a>-1;){if(n.order.products[a].addelem_price=0,n.order.products[a].addelemPriceDis=0,e)for(t=n.order.products[a].chosenAddElements.length;--t>-1;)if(r=n.order.products[a].chosenAddElements[t].length){for(;--r>-1;)n.order.products[a].addelem_price+=n.order.products[a].chosenAddElements[t][r].element_qty*n.order.products[a].chosenAddElements[t][r].element_price;n.order.products[a].addelem_price=i.roundingValue(n.order.products[a].addelem_price),n.order.products[a].addelemPriceDis=i.setPriceDis(n.order.products[a].addelem_price,n.order.discount_addelem)}o.setProductPriceTOTAL(n.order.products[a])}}function b(e,t){t+=1,e.product_id=t,n.order.products.push(e)}function v(e){var t=d3.max(n.order.products.map(function(e){return e.product_id})),i=angular.copy(n.order.products[e]);b(i,t),r.joinAllAddElements(),r.calculateOrderPrice()}var T=this;return T.publicObj={increaseProductQty:u,decreaseProductQty:g,addNewProductInOrder:c,clickDeleteProduct:p,box:m,showAllAddElements:y,collectAllAddElems:f,getAddElemsPriceTotal:_,calculateAddElemsProductsPrice:E,createProductCopy:v,addCloneProductInOrder:b},T.publicObj}])}(),function(){angular.module("BauVoiceApp").constant("globalConstants",{serverIP:"http://api.orange.windowscalculator.net",printIP:"http://api.orange.windowscalculator.net/orders/get-order-pdf/",localPath:"/local/",STEP:50,REG_LOGIN:/^[a-zA-Z?0-9?_?.?@?\-?]+$/,REG_PHONE:/^\d+$/,REG_NAME:/^[a-zA-Z]+$/,REG_MAIL:/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,SVG_CLASS_ICON:"tamlateIconSVG",SVG_ID_EDIT:"tamlateSVG",SVG_ID_MAIN:"tamlateMainSVG",SVG_ID_ICON:"tamlateIconBigSVG",SVG_ID_GLASS:"tamlateGlassSVG",SVG_ID_GRID:"tamlateGridSVG",svgTemplateIconWidth:70,svgTemplateIconHeight:70,svgTemplateIconBigWidth:500,svgTemplateIconBigHeight:450,svgTemplateWidth:1022,svgTemplateHeight:767,squareLimit:.15,minSizeLimit:100,minSizeLimitStulp:300,minRadiusHeight:10,activeClass:"active",languages:[{label:"uk",name:"Українська"},{label:"ru",name:"Русский"},{label:"en",name:"English"},{label:"de",name:"Deutsch"},{label:"ro",name:"Român"},{label:"it",name:"Italiano"}]})}(),function(){angular.module("DesignModule").factory("DesignServ",["$rootScope","$location","$timeout","$filter","$q","globalConstants","GeneralServ","localDB","loginServ","MainServ","AnalyticsServ","SVGServ","GlobalStor","DesignStor","OrderStor","ProductStor","UserStor",function(e,t,i,o,r,a,n,l,s,d,c,u,p,g,m,f,h){function y(){d3.selectAll("#"+a.SVG_ID_EDIT+" .dim_blockX").classed("dim_shiftX",!1),d3.selectAll("#"+a.SVG_ID_EDIT+" .dim_blockY").classed("dim_shiftY",!1),d3.selectAll("#"+a.SVG_ID_EDIT+" .dim_block").classed("dim_hidden",!0)}function E(){g.design.selectedCorner.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" .corner_mark").transition().duration(300).ease("linear").attr("r",0)}function b(){g.design.selectedImpost.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" [item_type=impost]").classed("frame-active",!1)}function v(){g.design.selectedArc.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" .frame").classed("active_svg",!1)}function T(){g.design.selectedGlass.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" .glass").classed("glass-active",!1)}function I(){d3.selectAll("#"+a.SVG_ID_EDIT+" .size-rect").classed("active",!1),d3.selectAll("#"+a.SVG_ID_EDIT+" .size-txt-edit").classed("active",!1)}function S(){I(),p.global.isSizeCalculator=0,g.design.openVoiceHelper=0}function A(){u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){g.design.templateTEMP=angular.copy(e)})}function L(e,t){var i=t||a.SVG_ID_EDIT,o=d3.select("#"+i+" .glass[block_id="+e+"]"),r=1;o.classed("error_glass",!0);var n=setInterval(function(){11===r&&clearInterval(n),r%2?o.classed("error_glass",!1):o.classed("error_glass",!0),r+=1},50)}function D(){d3.selectAll("#"+a.SVG_ID_EDIT+" [item_type=impost]").each(function(){d3.select(this).on(ut,null)}),d3.selectAll("#"+a.SVG_ID_EDIT+" .glass").each(function(){d3.select(this).on(ut,null)}),d3.selectAll("#"+a.SVG_ID_EDIT+" .frame").each(function(){d3.select(this).on(ut,null)}),d3.selectAll("#"+a.SVG_ID_EDIT+" .size-box").each(function(){d3.select(this).on(ut,null)}),d3.select(window).on("keydown",null)}function N(){d3.selectAll("#"+a.SVG_ID_GLASS+" .glass").each(function(){d3.select(this).on(ut,null).classed("glass-active",!1)}),d3.selectAll("#"+a.SVG_ID_GRID+" .glass").each(function(){d3.select(this).on(ut,null).classed("glass-active",!1)}),d3.select(window).on("keydown",null)}function x(){g.design.tempSize.length=0,g.design.isMinSizeRestriction=0,g.design.isMaxSizeRestriction=0,g.design.isDimExtra=0,g.design.isSquareExtra=0}function R(e,t){return n.roundingValue(t-Math.sqrt(Math.pow(t,2)-Math.pow(e,2)/4),1)}function O(e){var t,i,o,r,a,l,s=g.design.templateSourceTEMP.details,d=g.design.oldSize.attributes[5].nodeValue,c=g.design.oldSize.attributes[6].nodeValue,u=g.design.oldSize.attributes[10].nodeValue,p=+g.design.oldSize.attributes[11].nodeValue,m=+g.design.oldSize.attributes[12].nodeValue,f=g.design.oldSize.attributes[13].nodeValue,_=+g.design.oldSize.attributes[14].nodeValue,h=p+e,y=m-e,E=s.length,b=0,v=[];if(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),"curve"===d){i=R(p,e);e:for(o=1;o<E;o+=1)if(s[o].id===c){if(s[o].pointsQ)for(a=s[o].pointsQ.length;--a>-1;)if(s[o].pointsQ[a].id===u){s[o].pointsQ[a].heightQ=i;break e}if(s[o].impost&&s[o].impost.impostAxis[2].id===u){s[o].impost.impostAxis[2].heightQ=i;break e}}}else if(u.indexOf("qa")+1){for(o=1;o<E;o+=1)if(1===s[o].level&&(a=s[o].pointsQ.length))for(;--a>-1;)s[o].pointsQ[a].id===u&&(s[o].pointsQ[a].heightQ=e)}else{if(!_){for(o=1;o<E;o+=1)1===s[o].level&&v.push(n.getMaxMinCoord(s[o].pointsOut));for(t=v.length;--t>-1;)"x"===f?v[t].maxX===m&&(b=1):"y"===f&&v[t].maxY===m&&(b=1)}for(o=1;o<E;o+=1){if(l=s[o].pointsOut.length)for(;--l>-1;)b||("x"===f?s[o].pointsOut[l].x===m&&(s[o].pointsOut[l].x=h):"y"===f&&s[o].pointsOut[l].y===m&&(s[o].pointsOut[l].y=h));if(s[o].impost)for(r=0;r<2;r+=1)b?"x"===f?s[o].impost.impostAxis[r].x===p&&(s[o].impost.impostAxis[r].x=y):"y"===f&&s[o].impost.impostAxis[r].y===p&&(s[o].impost.impostAxis[r].y=y):"x"===f?s[o].impost.impostAxis[r].x===m&&(s[o].impost.impostAxis[r].x=h):"y"===f&&s[o].impost.impostAxis[r].y===m&&(s[o].impost.impostAxis[r].y=h)}}}function C(e){var t,i,o,r,a=g.design.templateTEMP.details,n=a.length,l=+g.design.oldSize.attributes[11].nodeValue,s=+g.design.oldSize.attributes[12].nodeValue,d=g.design.oldSize.attributes[13].nodeValue;for(i=1;i<n;i+=1)if(1===a[i].level&&(o=a[i].pointsOut.length,o&&(r=0,r=a[i].pointsOut.some(function(e){return"x"===d?e.x===s:"y"===d?e.y===s:void 0}))))for(t=angular.copy(a[i].pointsOut);--o>-1;)"x"===d?a[i].pointsOut[o].x===s&&(t[o].x=l+e):"y"===d&&a[i].pointsOut[o].y===s&&(t[o].y=l+e);return t}function P(e,t){p.global.timeoutFunc=0,e=e.priceElements.sashesBlock;var i=[],o=[];if(4===f.product.construction_type||4===t)return o=e[0].sizes?e[0].sizes[0]:0,i=e[0].sizes?e[0].sizes[1]:0,w(e),{widthT:o,heightT:i}}function w(e){var t=setInterval(function(){if(f.product.doorLock.width_min){clearInterval(t);for(var i=0,o=0,r=f.product.doorLock,a=0;a<e.length;a+=1)if(1!==p.global.checkDoors){if(o=p.global.widthTEMP=e[a].sizes[0],i=p.global.heightTEMP=e[a].sizes[1],p.global.heightLim="("+r.width_min+" - "+r.width_max+") x ("+r.height_min+" - "+r.height_max+")",!(i<=r.height_max&&i>=r.height_min)){p.global.checkDoors=1;break}if(!(o<=r.width_max&&o>=r.width_min)){p.global.checkDoors=1;break}}p.global.timeoutFunc=1}},50)}function M(e){var t=r.defer();if(g.design.tempSize.length){var i=parseInt(g.design.tempSize.join(""),10),a=C(i),n=a?u.calcSquare(a):0;n<p.global.maxSquareLimit?i>=g.design.minSizeLimit&&i<=g.design.maxSizeLimit?(O(i),S(),u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){g.design.templateTEMP=angular.copy(e),g.design.resultSize=angular.copy(e),P(e),x(),t.resolve(1)})):(i<g.design.minSizeLimit?p.global.isVoiceHelper?playTTS(o("translate")("construction.VOICE_SMALLEST_SIZE"),p.global.voiceHelperLanguage):(g.design.isMinSizeRestriction=1,g.design.isMaxSizeRestriction=0):i>=g.design.maxSizeLimit&&(p.global.isVoiceHelper?playTTS(o("translate")("construction.VOICE_BIGGEST_SIZE"),p.global.voiceHelperLanguage):(g.design.isMinSizeRestriction=0,g.design.isMaxSizeRestriction=1),i>p.global.maxSizeLimit&&(g.design.isDimExtra=1)),d3.select(g.design.oldSize).text(g.design.prevSize),g.design.tempSize.length=0,t.resolve(1)):(g.design.isSquareExtra=1,d3.select(g.design.oldSize).text(g.design.prevSize),g.design.tempSize.length=0,t.resolve(1))}else S(),t.resolve(1);if(g.design.openVoiceHelper=0,g.design.loudVoice=0,g.design.quietVoice=0,e)return t.promise}function k(){var e=g.design.tempSize.join("");d3.select(g.design.oldSize).text(e),p.global.isVoiceHelper&&M()}function G(e){p.global.activePanel=0;var t=g.design.tempSize.length;if(p.global.isVoiceHelper){var i=parseInt(e,10);g.design.voiceTxt="",g.design.openVoiceHelper=!1,i>0&&i<1e4&&(g.design.tempSize=(""+i).split(""),k()),I()}else(4===t||1===t&&!g.design.tempSize[0])&&(g.design.tempSize.length=0),"0"===e?t&&g.design.tempSize[0]&&(g.design.tempSize.push(e),k()):"00"===e?t&&g.design.tempSize[0]&&(t<3?g.design.tempSize.push(0,0):3===t&&g.design.tempSize.push(0),k()):(g.design.tempSize.push(e),k())}function B(){g.design.tempSize.pop(),g.design.tempSize.length<1&&g.design.tempSize.push(0),k()}function V(t){var i;if(13===t.which)M(),e.$apply();else if(8===t.which)B();else{switch(t.which){case 48:case 96:i=0;break;case 49:case 97:i=1;break;case 50:case 98:i=2;break;case 51:case 99:i=3;break;case 52:case 100:i=4;break;case 53:case 101:i=5;break;case 54:case 102:i=6;break;case 55:case 103:i=7;break;case 56:case 104:i=8;break;case 57:case 105:i=9}void 0!==i&&G(i)}}function H(t){g.design.voiceTxt=t,e.$apply(),i(function(){var i=parseStringToDimension(t);"NaN"===i&&(i=o("translate")("construction.VOICE_NOT_UNDERSTAND")),playTTS(i),G(i),e.$apply()},1e3)}function U(t){t>100?(g.design.loudVoice=!0,g.design.quietVoice=!1):(g.design.loudVoice=!1,g.design.quietVoice=!0),e.$apply()}function F(){p.global.activePanel=0,d3.selectAll("#"+a.SVG_ID_EDIT+" .size-box").each(function(){var t=d3.select(this);t.on(ut,function(){var i=t.select(".size-rect"),o=i[0][0].attributes[0].nodeValue.indexOf("active")+1;if(g.design.tempSize.length)M(),x();else{if(o)S();else{I(),i.classed("active",!0);var r=t.select(".size-txt-edit");r.classed("active",!0),g.design.oldSize=r[0][0],g.design.prevSize=r[0][0].textContent,g.design.minSizeLimit=+r[0][0].attributes[8].nodeValue,g.design.maxSizeLimit=+r[0][0].attributes[9].nodeValue,p.global.isVoiceHelper?(g.design.openVoiceHelper=1,startRecognition(H,U,p.global.voiceHelperLanguage)):(p.global.isSizeCalculator=1,g.design.isMinSizeRestriction=0,g.design.isMaxSizeRestriction=0,g.design.isDimExtra=0,g.design.isSquareExtra=0)}e.$apply()}})}),d3.select(window).on("keydown",function(){p.global.isSizeCalculator&&V(d3.event)})}function z(){var e,t,i,o,r,a=angular.copy(f.product.chosenAddElements[0]),n=a.length,l=f.product.template.details,s=l.length,d=0,c=[];if(n){for(;--s>0;)if(l[s].gridId)for(r=0;r<n;r+=1)l[s].id===a[r].block_id&&(o=a[r],i={},e=l[s].pointsLight.map(function(e){return e.x}),t=l[s].pointsLight.map(function(e){return e.y}),i.width=Math.round(d3.max(e)-d3.min(e)),i.height=Math.round(d3.max(t)-d3.min(t)),o.element_width===i.width&&o.element_height===i.height||(o.element_width=i.width,o.element_height=i.height,d=1),c.push(o));f.product.chosenAddElements[0]=angular.copy(c)}return d}function Y(){g.designSource.templateSourceTEMP=angular.copy(f.product.template_source),g.designSource.templateTEMP=angular.copy(f.product.template),g.design.templateSourceTEMP=angular.copy(f.product.template_source),g.design.templateTEMP=angular.copy(f.product.template)}function W(){g.design=g.setDefaultDesign(),p.global.activePanel=0,p.global.isNavMenu=0,p.global.isConfigMenu=1,p.global.isLoader=0,t.path("/main")}function q(){d.setCurrentGlassForTemplate(g.design.templateSourceTEMP,f.product),f.product.template_source=angular.copy(g.design.templateSourceTEMP),p.global.checkDoors=0,g.design.steps.isDoorConfig=1,M()}function j(e,t){var i,o,r=g.design.doorShapeData.length,a=angular.copy(p.global.doorsLaminations),n=angular.copy(p.global.doorsGroups),l=p.global.doorKitsT1,s=[],d=[];g.design.doorShapeList.length=[],g.designSource.doorShapeList.length=[];for(var c=0;c<n.length;c+=1)for(var u=0;u<a.length;u+=1)if(t.lamination.lamination_in_id===a[u].lamination_in_id&&t.lamination.lamination_out_id===a[u].lamination_out_id&&n[c].id===a[u].group_id){n[c].door_sill_list_id=a[u].door_sill_list_id,n[c].impost_list_id=a[u].impost_list_id,n[c].rama_list_id=a[u].rama_list_id,n[c].shtulp_list_id=a[u].shtulp_list_id,n[c].stvorka_list_id=a[u].stvorka_list_id,n[c].doorstep_type=0,n[c].profileId=n[c].profile_id||345,g.design.doorsGroups.push(n[c].id);for(var m=0;m<l.length;m+=1)n[c].door_sill_list_id===l[m].id&&(n[c].doorstep_type=l[m].doorstep_type);break}for(i=0;i<r;i+=1){var f=s=n.filter(function(e){return 2===e.doorstep_type}),_=s=n.filter(function(e){return 1===e.doorstep_type});o=0,2===i&&f.length?o=1:3===i&&_.length?o=1:i&&1!==i||(o=1),o&&2!==i&&d.push(g.design.doorShapeData[i])}switch(s.length=0,e){case 0:case 1:n.length&&(s=angular.copy(n));break;case 3:if(n.length){s=n.filter(function(e){return 2===e.doorstep_type});break}case 2:if(n.length){s=n.filter(function(e){return 1===e.doorstep_type});break}}return s[e]}function Q(e,t){var i,o,r=g.design.doorShapeData.length,a=angular.copy(p.global.doorsLaminations),n=angular.copy(p.global.doorsGroups),l=[],s=p.global.doorKitsT1;g.design.doorShapeList.length=[],g.designSource.doorShapeList.length=[];for(var d=0;d<n.length;d+=1)for(var c=0;c<a.length;c+=1)if(t.lamination.lamination_in_id===a[c].lamination_in_id&&t.lamination.lamination_out_id===a[c].lamination_out_id&&n[d].id===a[c].group_id){n[d].door_sill_list_id=a[c].door_sill_list_id,n[d].impost_list_id=a[c].impost_list_id,n[d].rama_list_id=a[c].rama_list_id,n[d].shtulp_list_id=a[c].shtulp_list_id,n[d].stvorka_list_id=a[c].stvorka_list_id,n[d].doorstep_type=0,n[d].profileId=n[d].profile_id||345,g.design.doorsGroups.push(n[d].id);for(var u=0;u<s.length;u+=1)n[d].door_sill_list_id===s[u].id&&(n[d].doorstep_type=s[u].doorstep_type);l.push(n[d]);break}for(n=angular.copy(l),i=0;i<r;i+=1){var m=g.design.sashShapeList=n.filter(function(e){return 2===e.doorstep_type}),f=g.design.sashShapeList=n.filter(function(e){return 1===e.doorstep_type});o=0,2===i&&m.length?o=1:3===i&&f.length?o=1:i&&1!==i||(o=1),o&&2!==i&&(g.design.doorShapeList.push(g.design.doorShapeData[i]),g.designSource.doorShapeList.push(g.designSource.doorShapeData[i]))}if(!g.design.steps.selectedStep2){if(g.design.doorConfig.doorShapeIndex!==e){switch(g.design.sashShapeList.length=0,e){case 0:case 1:n.length&&(g.design.sashShapeList=angular.copy(n));break;case 3:if(n.length){g.design.sashShapeList=n.filter(function(e){return 2===e.doorstep_type});break}case 2:if(n.length){g.design.sashShapeList=n.filter(function(e){return 1===e.doorstep_type});break}}return g.design.doorConfig.doorShapeIndex=e,g.design.doorConfig.doorTypeIndex=g.design.doorShapeList[e].id,g.design.steps.selectedStep1=1,g.design.sashShapeList[e]}g.design.doorConfig.doorShapeIndex="",g.design.steps.selectedStep1=0}}function K(e,t){var i=r.defer();return g.design.handleShapeList=[],g.design.steps.selectedStep3||(g.design.doorConfig.sashShapeIndex===e?(g.design.doorConfig.sashShapeIndex="",g.design.steps.selectedStep2=0):(g.design.doorConfig.sashShapeIndex=e,g.design.steps.selectedStep2=1)),d.setGlassDefault(g.design.sashShapeList[e].profileId,g.design.templateTEMP,t),d.setGlassDefault(g.design.sashShapeList[e].profileId,g.design.templateSourceTEMP,t),d.setGlassDefault(g.design.sashShapeList[e].profileId,t.template_source,t),d.setGlassDefault(g.design.sashShapeList[e].profileId,t.template,t),l.selectLocalDB(l.tablesLocalDB.doors_groups_dependencies.tableName,{doors_group_id:g.design.sashShapeList[e].id}).then(function(e){for(var t=0;t<=e.length;t+=1)t!==e.length?X(e[t]):i.resolve(1)}),i.promise}function X(e){var t;t=p.global.doorHandlers.filter(function(t){return t.profIds.indexOf("hel"+e.hardware_group_id+"lo")+1}),g.design.handleShapeList=g.design.handleShapeList.concat(t);var i={},o=g.design.handleShapeList.filter(function(e){return e.id in i?0:i[e.id]=1});g.design.handleShapeList=o}function Z(e,t){var i=P(g.design.templateTEMP,4),o=g.design.doorConfig.sashShapeIndex,r=[];if(!g.design.steps.selectedStep4){g.design.doorConfig.handleShapeIndex===e?(g.design.doorConfig.handleShapeIndex="",g.design.steps.selectedStep3=0):(g.design.doorConfig.handleShapeIndex=e,g.design.steps.selectedStep3=1);for(var a=p.global.doorLocks.filter(function(e){return e.profIds.indexOf(g.design.sashShapeList[o].id)+1}),n=a.filter(function(t){return g.design.handleShapeList[e].profIds.indexOf("hel"+t.id+"lo")+1}),l=t.template.priceElements.shtulpsSize,s=0;s<n.length;s+=1)i.heightT<=n[s].height_max&&i.heightT>=n[s].height_min&&i.widthT<=n[s].width_max&&i.widthT>=n[s].width_min&&n[s].hardware_type_id===l.length+1&&r.push(n[s]);g.design.lockShapeList=r}}function J(e,t){g.design.doorConfig.lockShapeIndex===e?(g.design.doorConfig.lockShapeIndex="",g.design.steps.selectedStep4=0):(g.design.doorConfig.lockShapeIndex=e,g.design.steps.selectedStep4=1)}function ee(){g.design.steps.selectedStep3?(g.design.steps.selectedStep3=0,g.design.steps.selectedStep4=0,g.design.doorConfig.lockShapeIndex="",g.design.doorConfig.handleShapeIndex=""):g.design.steps.selectedStep2?(g.design.steps.selectedStep2=0,g.design.doorConfig.sashShapeIndex=""):g.design.steps.selectedStep1?(g.design.steps.selectedStep1=0,g.design.doorConfig.doorShapeIndex=""):(g.design.steps.isDoorConfig=0,g.design.doorConfig=g.setDefaultDoor())}function te(e){e=e?e:f.product;var t=r.defer();return re(e,g.design).then(function(i){u.createSVGTemplate(e.template_source,e.profileDepths).then(function(i){g.design.templateTEMP=angular.copy(i),d.preparePrice(i,f.product.profile.id,f.product.glass,f.product.hardware.id,f.product.lamination.lamination_in_id).then(function(){f.product.template_source.doorSill&&(g.design.templateSourceTEMP.doorSill=angular.copy(f.product.template_source.doorSill)),u.createSVGTemplate(e.template_source,e.profileDepths).then(function(e){t.resolve(1)})})})}),g.design.steps.isDoorConfig=0,t.promise}function ie(e,t){function i(e){var t=e.templateTEMP.details.filter(function(e){if("sash"==e.blockType&&0!==e.handlePos)return e});return t}var o,r,a,n=[900],l=[2e3],s=e.door_lock_shape_id||0,d=angular.copy(p.global.doorsItems);o=p.global.widthTEMP.length>0?p.global.widthTEMP:n,r=p.global.widthTEMP.length>0?p.global.widthTEMP:l,t.lockShapeList[s].elem=[],e.door_group_id=angular.copy(t.sashShapeList[e.door_sash_shape_id].id),e.template_source.profile_window_id=angular.copy(t.sashShapeList[e.door_sash_shape_id].profileId),e.doorName=t.doorShapeList[e.door_shape_id].name,e.doorSashName=t.sashShapeList[e.door_sash_shape_id].name,e.doorHandle=t.handleShapeList[e.door_handle_shape_id],e.doorLock=t.lockShapeList[s],e.doorHandle.count=i(t).length;for(var c=0;c<t.templateTEMP.details.length;c+=1)if("sash"==t.templateTEMP.details[c].blockType&&0!==t.templateTEMP.details[c].handlePos){4===t.templateTEMP.details[c].openDir[0]&&(t.templateTEMP.details[c].openDir[0]=3);for(var u=0;u<d.length;u+=1)t.lockShapeList[s].id===d[u].hardware_group_id&&(t.templateTEMP.details[c].openDir[0]!==d[u].direction_id&&1!==d[u].direction_id||d[u].hardware_color_id!==e.lamination.id&&0!==d[u].hardware_color_id||(r<=d[u].max_height||0===d[u].max_height)&&(r>=d[u].min_height||0===d[u].min_height)&&(o<=d[u].max_width||0===d[u].max_width)&&(o>=d[u].min_width||0===d[u].min_width)&&(d[u].openDir=t.templateTEMP.details[c].openDir[0],a=angular.copy(d[u]),t.lockShapeList[s].elem.push(a)))}}function oe(e,t){var i=r.defer();return e.profile.name=t.sashShapeList[e.door_sash_shape_id].name,e.profile.short_name="",e.profile.description="",e.template_source.hardware_id=e.hardware.id,p.global.type_door=t.doorsGroups[e.door_sash_shape_id],e.profile.rama_list_id=t.sashShapeList[e.door_sash_shape_id].rama_list_id,e.profile.id=t.sashShapeList[e.door_sash_shape_id].profileId,e.profile.profileId=t.sashShapeList[e.door_sash_shape_id].profileId,e.profile.rama_still_list_id=t.sashShapeList[e.door_sash_shape_id].door_sill_list_id,e.profile.stvorka_list_id=t.sashShapeList[e.door_sash_shape_id].stvorka_list_id,e.profile.impost_list_id=t.sashShapeList[e.door_sash_shape_id].impost_list_id,e.profile.shtulp_list_id=t.sashShapeList[e.door_sash_shape_id].shtulp_list_id,e.doorLock.stvorka_type=t.sashShapeList[e.door_sash_shape_id].list_type_id,r.all([d.downloadProfileDepth(e.profile.rama_list_id),d.downloadProfileDepth(e.profile.rama_still_list_id),d.downloadProfileDepth(e.profile.stvorka_list_id),d.downloadProfileDepth(e.profile.impost_list_id),d.downloadProfileDepth(e.profile.shtulp_list_id)]).then(function(t){e.profileDepths.frameDepth=t[0],e.profileDepths.frameStillDepth=t[1],e.profileDepths.sashDepth=t[2],e.profileDepths.impostDepth=t[3],e.profileDepths.shtulpDepth=t[4],i.resolve(1)}),i.promise}function re(e,t){var i=r.defer();return e.door_type_index=t.doorConfig.doorTypeIndex,e.door_shape_id=t.doorConfig.doorShapeIndex,e.door_sash_shape_id=t.doorConfig.sashShapeIndex,e.door_handle_shape_id=t.doorConfig.handleShapeIndex,e.door_lock_shape_id=t.doorConfig.lockShapeIndex,p.global.type_door=t.doorConfig.doorShapeIndex,4===e.construction_type&&ie(e,t),oe(e,t).then(function(e){i.resolve(1)}),i.promise}function ae(e){var t=r.defer();return g.designSource.templateSourceTEMP=angular.copy(e.template_source),g.designSource.templateTEMP=angular.copy(e.template),g.design.templateSourceTEMP=angular.copy(e.template_source),g.design.templateTEMP=angular.copy(e.template),g.design.steps.selectedStep3=0,g.design.steps.selectedStep4=0,g.design.doorConfig.lockShapeIndex="",g.design.doorConfig.handleShapeIndex="",g.design.steps.selectedStep2=0,g.design.doorConfig.sashShapeIndex="",g.design.steps.selectedStep1=0,g.design.doorConfig.doorShapeIndex="",g.design.steps.isDoorConfig=0,g.design.doorConfig=g.setDefaultDoor(),Q(e.door_shape_id,e),K(e.door_sash_shape_id,e).then(function(i){Z(e.door_handle_shape_id,e),J(e.door_lock_shape_id,e),te(e).then(function(i){t.resolve(e),console.log(e)})}),t.promise}function ne(){S(),g.design=g.setDefaultDesign(),Y()}function le(e,t){for(var i=1,o=e.attributes.block_id.nodeValue,r=t.length;--r>-1;)if(t[r].attributes.block_id.nodeValue===o){t.splice(r,1),i=0;break}return i&&t.push(e),i}function se(){g.design.selectedImpost.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" [item_type=impost]").each(function(){var t=d3.select(this);t.on(ut,function(){if(g.design.tempSize.length)M(),x();else{var i=le(t[0][0],g.design.selectedImpost);i?(t.classed("frame-active",!0),g.design.activeMenuItem=3,g.design.isImpostDelete=1,g.design.activeSubMenuItem=3,E(),v(),S(),e.$apply()):(t.classed("frame-active",!1),g.design.selectedImpost.length||(g.design.activeMenuItem=0,g.design.activeSubMenuItem=0,e.$apply(),g.design.isImpostDelete=0))}})})}function de(e,t){var i,o=e[0].length,r=0,a=0;if(o){for(;--o>-1;)i=e[0][o].attributes.axis,i&&("x"===i.nodeValue?r=1:"y"===i.nodeValue&&(a=1));r&&d3.selectAll("#"+t+" .dim_blockX").classed("dim_shiftX",1),a&&d3.selectAll("#"+t+" .dim_blockY").classed("dim_shiftY",1),e.classed("dim_hidden",0)}}function ce(e){var t=d3.selectAll("#"+a.SVG_ID_EDIT+" .dim_block[block_id="+e+"]");de(t,a.SVG_ID_EDIT)}function ue(e){var t=d3.selectAll("#"+e+" .dim_block");de(t,e)}function pe(){g.design.selectedGlass.length=0,
d3.selectAll("#"+a.SVG_ID_EDIT+" .glass").each(function(){var t=d3.select(this);t.on(ut,function(){if(g.design.tempSize.length)M(),x();else{var i=le(t[0][0],g.design.selectedGlass),o=t[0][0].attributes.block_id.nodeValue;i?(t.classed("glass-active",!0),E(),b(),v(),S(),ce(o),e.$apply()):(t.classed("glass-active",!1),d3.selectAll("#"+a.SVG_ID_EDIT+" .dim_block[block_id="+o+"]").classed("dim_hidden",!0),g.design.selectedGlass.length||(g.design.activeMenuItem=0,g.design.activeSubMenuItem=0,y(),e.$apply()))}})})}function ge(){g.design.selectedGlass.length=0,d3.selectAll("#"+a.SVG_ID_GLASS+" .glass").each(function(){var e=d3.select(this);e.on(ut,function(){var t=le(e[0][0],g.design.selectedGlass),i=e[0][0].attributes.block_id.nodeValue;t?(e.classed("glass-active",!0),d3.select(".glass-txt[block_id="+i+"]").text(p.global.selectGlassName),d.setGlassToTemplateBlocks(p.global.selectGlassType,f.product.template,p.global.selectGlassId,p.global.selectGlassName,i)):(e.classed("glass-active",!1),d3.select(".glass-txt[block_id="+i+"]").text(p.global.prevGlassName),d.setGlassToTemplateBlocks(p.global.selectGlassType,f.product.template,p.global.prevGlassId,p.global.prevGlassName,i))})}),ue(a.SVG_ID_GLASS)}function me(e){e&&(p.global.selectGlassId=p.global.prevGlassId,p.global.selectGlassName=p.global.prevGlassName,u.createSVGTemplate(f.product.template_source,f.product.profileDepths).then(function(e){f.product.template=angular.copy(e)})),N(),p.global.showGlassSelectorDialog=0}function fe(){function e(i,o,r){if(r||"block_0"===!r){var n=i.filter(function(e){if(e.id===r)return e});if("sash"===n[0].blockType)if(t(n[0].children,i),p.global.sashTypeBlock.length>0){var l=p.global.sashTypeBlock.filter(function(e){if(e===n[0].id)return e});l.length>0?p.global.sashTypeBlock=p.global.sashTypeBlock.filter(function(e){if(!e===l)return e}):p.global.sashTypeBlock[p.global.sashTypeBlock.length]=n[0].id}else p.global.sashTypeBlock[p.global.sashTypeBlock.length]=n[0].id;else e(i,o,n[0].parent)}else L(p.global.allGlass[0].attributes.block_id.nodeValue,a.SVG_ID_GRID)}function t(e,o){var r=[];if(e.length>0){p.global.children=_.uniq(p.global.children.concat(e)),p.global.childrenTEMP=angular.copy(p.global.children);for(var a=0;a<o.length;a+=1)for(var n=0;n<e.length;n+=1)e[n]===o[a].id&&(r=_.union(r,o[a].children));t(r,o)}else i()}function i(){p.global.allGlass.filter(function(e){for(var t=0;t<p.global.children.length;t+=1)d3.select(e)[0][0].attributes.block_id.nodeValue==p.global.children[t]&&(le(d3.select(e)[0][0],g.design.selectedGlass)?d3.select(e).classed("glass-active",!0):d3.select(e).classed("glass-active",!1))})}p.global.sashTypeBlock=[],g.design.selectedGlass.length=0,d3.selectAll("#"+a.SVG_ID_GRID+" .glass").each(function(){var t=p.global.mosGlassRes=d3.select(this);t.on(ut,function(){p.global.parents=[],p.global.children=[];var i,o=f.product.template.details,r=o.length,a=t[0][0].attributes.block_id.nodeValue,n=t[0][0].attributes.parent_id.nodeValue,l=$(this).siblings(),s=[];s.push(this);for(var d=0;d<l.length;d+=1)l[d].__data__&&l[d].__data__.type&&"glass"===l[d].__data__.type&&s.push(l[d]);for(p.global.allGlass=s;--r>0;)o[r].id===a&&("sash"===o[r].blockType?(i=le(t[0][0],g.design.selectedGlass),i?t.classed("glass-active",!0):t.classed("glass-active",!1)):e(o,r,n))})}),ue(a.SVG_ID_GRID)}function _e(e,t){for(var i=1,o=e.attributes.item_id.nodeValue,r=t.length;--r>-1;)if(t[r].attributes.item_id.nodeValue===o){t.splice(r,1),i=0;break}return i&&t.push(e),i}function he(){var t=d3.selectAll("#"+a.SVG_ID_EDIT+" .frame")[0].filter(function(e){if("frame"===e.__data__.type||"arc"===e.__data__.type)return!0});t.length&&d3.selectAll(t).each(function(){var t=d3.select(this);t.on(ut,function(){if(g.design.tempSize.length)M(),x();else{var i=_e(t[0][0],g.design.selectedArc);i?(t.classed("active_svg",!0),T(),E(),b(),S(),e.$apply()):(t.classed("active_svg",!1),g.design.selectedArc.length||(g.design.activeMenuItem=0,g.design.activeSubMenuItem=0,e.$apply()))}})})}function ye(e,t){var i=1,o=40,r=t.x-e.x,a=t.y-e.y;return r>0&&r<o&&a>0&&a<o&&(i=0),i}function Ee(e,t,i,o,r,a){var n={type:"impost",id:"ip"+t,x:Math.round(e.x),y:Math.round(e.y),dir:"line",dimType:r};a&&(n.type="shtulp",n.id="sht"+t),o[i].impost||(o[i].impost={impostAxis:[],impostOut:[],impostIn:[],impostLight:[]}),o[i].impost.impostAxis.push(n)}function be(e,t,i,o,r){var a={type:"skylight",id:"block_"+e,level:i[t].level+1,blockType:"frame",parent:i[t].id,children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:i[t].glassId,glassTxt:i[t].glassTxt,glass_type:i[t].glass_type,glass_color:i[t].glass_color};o&&(a.blockType="sash",angular.extend(a,r)),i[t].children.push(a.id),i.push(a)}function ve(e){for(var t=5,i=e.length;--i>-1;)for(var o=e.length;--o>-1;){var r=Math.abs(e[i].x-e[o].x),a=Math.abs(e[i].y-e[o].y);if(r>0&&r<t&&a>0&&a<t){e.splice(i,1);break}}}function Te(e){for(var t,i=e.length,o=0;--i>0;)t=Number(e[i].id.replace(/\D+/g,"")),t>o&&(o=t);return o}function Ie(e,t){var i,o,r,a,n,l,s,d=[],c=t.length;for(i=0;i<c;i+=1)o=u.getCoordCrossPoint(e,t[i]),o.x>=0&&o.y>=0&&(r=u.checkLineOwnPoint(o,t[i].to,t[i].from),a=u.isInsidePointInLine(r),a&&(n=u.checkEqualPoints(o,d),n&&(l=ye(t[i].from,o),l&&(s=ye(t[i].to,o),s&&d.push(o)))));return d}function Se(e,t,i,o){var r=Ie(t,i);if(2===r.length){var a,l,s,d,c={from:r[0],to:r[1]},p=n.roundingValue(Math.hypot(c.from.x-c.to.x,c.from.y-c.to.y)/2,1),g=angular.copy(o),m=g.length,f=[];for(u.setLineCoef(c),s=u.setQPointCoord(e,c,p),c.coefA||1!==e?c.coefB||4!==e||(s.x-=2*p):s.y-=2*p,d=u.setPointLocationToLine(c.from,c.to,s);--m>-1;){var _=u.setPointLocationToLine(c.from,c.to,g[m]);_>0&&d>0?f.push(g[m]):_<0&&d<0&&f.push(g[m])}return f.push(c.from,c.to),a=u.centerBlock(f),l=n.roundingValue(Math.abs((c.coefA*a.x+c.coefB*a.y+c.coefC)/Math.hypot(c.coefA,c.coefB)),1),p<l?p/2:l/2}}function Ae(e,t,i,o,r){var a={blockId:r[o].id,dir:"curv",id:"qi"+i,heightQ:e,positionQ:t};r[o].impost.impostAxis.push(a)}function Le(e,t){var i,o,r,a,n,l=g.design.templateTEMP.details,s=l.length,d=g.design.templateSourceTEMP.details,c=90,p=0;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP));--s>0;)l[s].id===e&&(i=+s,o=Number(l[s].id.replace(/\D+/g,"")));r=Te(d),a=u.cteateLineByAngel(l[i].center,c),n=Ie(a,l[i].linesOut),n.length>2&&ve(n);var m=n.length;if(2===m){for(;--m>-1;)Ee(n[m],o,i,d,p,1),be(r+=1,i,d,1,t[m]);A()}else L(e)}function De(e,t){function i(e,t){function i(e,t){if(e)if("block_0"!==e){var r=t.filter(function(t){if(t.id===e)return t});"sash"!==r[0].blockType?i(r[0].parent,t):o.resolve("error")}else o.resolve("good");else o.resolve("good")}var o=r.defer();return i(e,t),o.promise}function o(e,t){if(8===e||9===e)m>=a.minSizeLimitStulp?(8===e?n=[{openDir:[4],handlePos:0,sashType:4},{openDir:4===f.product.construction_type?[2]:[1,2],handlePos:2,sashType:4===f.product.construction_type?2:17}]:9===e&&(n=[{openDir:4===f.product.construction_type?[4]:[1,4],handlePos:4,sashType:4===f.product.construction_type?2:17},{openDir:[2],handlePos:0,sashType:4}]),Le(d,n)):L(d);else if(m>=a.minSizeLimit||s.square>=a.squareLimit){for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),l=1;l<p;l+=1)if(u[l].id===d){switch(u[l].blockType="sash",u[l].gridId=0,u[l].gridTxt="",e){case 2:u[l].openDir=[4],u[l].handlePos=4,u[l].sashType=2;break;case 3:u[l].openDir=[2],u[l].handlePos=2,u[l].sashType=2;break;case 4:u[l].openDir=[1],u[l].handlePos=1,u[l].sashType=7;break;case 5:u[l].openDir=[3],u[l].handlePos=3,u[l].sashType=2;break;case 6:u[l].openDir=[1,2],u[l].handlePos=2,u[l].sashType=6;break;case 7:u[l].openDir=[1,4],u[l].handlePos=4,u[l].sashType=6}A()}}else L(d)}var n,l,s=t.__data__,d=t.attributes.block_id.nodeValue,c=t.attributes.parent_id.nodeValue,u=g.design.templateSourceTEMP.details,p=u.length,m=d3.min(s.sizes);i(c,u).then(function(i){"good"===i||4!==f.product.construction_type?o(e,t):L(d)})}function Ne(e,t,i){for(var o=0;--i>0;)t[i].id===e&&t[i].impost&&"shtulp"===t[i].impost.impostAxis[0].type&&(o=i);return o}function xe(e){e.blockType="frame",delete e.openDir,delete e.handlePos,delete e.sashType,delete e.gridId,delete e.gridTxt}function Re(e,t){for(var i,o=t.length;--o>0;)if(t[o].id===e){i=t[o].children.length,i?(Re(t[o].children[0],t),Re(t[o].children[1],t),t.splice(o,1)):t.splice(o,1);break}}function Oe(e){var t,i=e.attributes.block_id.nodeValue,o=g.design.templateSourceTEMP.details,r=o.length,a=0;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),t=1;t<r;t+=1)if(o[t].id===i){a=Ne(o[t].parent,o,r),a?(Re(o[a].children[0],o),Re(o[a].children[1],o),o[a].children.length=0,delete o[a].impost):xe(o[t]);break}A()}function Ce(e){for(var t,i,o=g.design.templateSourceTEMP.details,r=e.details.length,n=0;--r>0;)if(e.details[r].level&&"sash"===e.details[r].blockType)for(t=e.details[r].parts.length;--t>-1;)"glass"===e.details[r].parts[t].type&&(i=d3.min(e.details[r].parts[t].sizes),i<=a.minSizeLimit&&i<=a.minSizeLimit&&(xe(o[r]),n=1));return n}function Pe(e,t,i,o,r){var a=200,n={type:"corner",id:"c"+t+"-"+e,dir:"line"};1===e?(n.x=(i.from.x*(i.size-a)+i.to.x*a)/i.size,n.y=(i.from.y*(i.size-a)+i.to.y*a)/i.size):2===e&&(n.x=(i.from.x*a+i.to.x*(i.size-a))/i.size,n.y=(i.from.y*a+i.to.y*(i.size-a))/i.size),r[o].pointsOut.push(n)}function we(e,t,i,o,r){var a,n=i.length;for(a=0;a<n;a+=1)i[a].from.id===e?Pe(1,t,i[a],o,r):i[a].to.id===e&&Pe(2,t,i[a],o,r);for(var l=r[o].pointsOut.length;--l>-1;)r[o].pointsOut[l].id===e&&(r[o].pointsOut[l].view=0)}function Me(e,t,i){for(var o,r,a=i.length;--a>0;)if(i[a].id===t)for(o=i[a].pointsOut.length;--o>-1;)for(r=e.length;--r>-1;)if(i[a].pointsOut[o].id===e[r]){i[a].pointsOut.splice(o,1);break}}function ke(e,t,i,o,r,a){var n={type:e,blockId:a[r].id,id:t,heightQ:i.size/4,fromPId:i.from.id,toPId:i.to.id,positionQ:o};a[r].pointsQ||(a[r].pointsQ=[]),a[r].pointsQ.push(n)}function Ge(e,t,i){for(var o=i[t].pointsOut.length,r={};--o>-1;)"corner"===i[t].pointsOut[o].type&&(i[t].pointsOut[o].id==="c"+e+"-2"&&(r.from=i[t].pointsOut[o]),i[t].pointsOut[o].id==="c"+e+"-1"&&(r.to=i[t].pointsOut[o]));u.setLineCoef(r),r.size=n.roundingValue(Math.hypot(r.to.x-r.from.x,r.to.y-r.from.y),1),ke("corner","qc"+e,r,e,t,i)}function Be(e,t,i){for(var o,r=i.length;--r>0;)if(i[r].id===t&&i[r].pointsQ)for(o=i[r].pointsQ.length;--o>-1;)if(i[r].pointsQ[o].id===e){i[r].pointsQ.splice(o,1);break}}function Ve(e){var t=e.__data__.id,i=Number(t.replace(/\D+/g,"")),o=e.attributes.block_id.nodeValue,r=g.design.templateSourceTEMP.details,a=g.design.templateTEMP.details,n=a.length;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP));--n>0;)a[n].id===o&&(e.__data__.view?we(t,i,a[n].linesOut,n,r):Be("qc"+i,o,r));A()}function He(e){var t,i,o=e.__data__.id,r=Number(o.replace(/\D+/g,"")),a=e.attributes.block_id.nodeValue,n=g.design.templateSourceTEMP.details,l=g.design.templateTEMP.details,s=l.length;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP));--s>0;)if(l[s].id===a)if(e.__data__.view)we(o,r,l[s].linesOut,s,n),Ge(r,s,n);else for(t=l[s].linesOut.length,i=0;i<t;i+=1)l[s].linesOut[i].from.id==="c"+r+"-2"&&l[s].linesOut[i].to.id==="c"+r+"-1"&&ke("corner","qc"+r,l[s].linesOut[i],r,s,n);A()}function Ue(e){var t,i=e.__data__.id,o=Number(i.replace(/\D+/g,"")),r=e.attributes.block_id.nodeValue,a=g.design.templateSourceTEMP.details,n=a.length;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),Me(["c"+o+"-1","c"+o+"-2"],r,a),Be("qc"+o,r,a);--n>0;)if(a[n].id===r)for(t=a[n].pointsOut.length;--t>-1;)a[n].pointsOut[t].id===i&&(a[n].pointsOut[t].view=1);A()}function Fe(e,t,i,o,r){for(;--o>-1;)t?e?i[o].x+=r:i[o].x-=r:e?i[o].y+=r:i[o].y-=r}function ze(e,t,i,o){for(var r,a=o.length;--a>0;)o[a].level&&(o[a].pointsOut.length&&Fe(e,t,o[a].pointsOut,o[a].pointsOut.length,i),o[a].pointsIn.length&&Fe(e,t,o[a].pointsIn,o[a].pointsIn.length,i),o[a].impost&&(r=o[a].impost.impostAxis.length,r&&Fe(e,t,o[a].impost.impostAxis,r,i)))}function Ye(e,t,i){for(var o,r=u.centerBlock(i[t].pointsOut),a=u.sortingPoints(i[t].pointsOut,r),n=u.setLines(a),l=n.length;--l>-1;)n[l].from.id===e[0].id&&n[l].to.id===e[1].id&&(o=n[l]);return o}function $e(e){var t=r.defer();if(!$.isEmptyObject(e)){var i=e.__data__;if("frame"===i.type){var o,a,n,l,s,d=Number(i.points[0].id.replace(/\D+/g,"")),c=e.attributes.block_id.nodeValue,p=angular.copy(g.design.templateTEMP.details),m=p.length,_=g.design.templateSourceTEMP.details;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),l=1;l<m;l+=1)if(p[l].id===c)for(s=p[l].linesOut.length;--s>-1;)p[l].linesOut[s].from.id===i.points[0].id&&p[l].linesOut[s].to.id===i.points[1].id&&(o=l,a=p[l].linesOut[s]);i.points[0].fi<180&&i.points[1].fi<180?n=1:i.points[0].fi<90&&i.points[1].fi>270?n=2:i.points[0].fi>180&&i.points[1].fi>180?n=3:i.points[0].fi<270&&i.points[1].fi>90&&(n=4);var h=u.setQPointCoord(n,a,a.size/2);1===n?(ze(1,0,h.y,p),ze(1,0,h.y,_),h.y=0):4===n&&(ze(1,1,h.x,p),ze(1,1,h.x,_),h.x=0),h.y&&h.x||(a=Ye(i.points,o,_)),ke("arc","qa"+d,a,n,o,_),u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){var i=Ce(e);i?u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){g.design.templateTEMP=angular.copy(e),t.resolve("done")}):(g.design.templateTEMP=angular.copy(e),t.resolve("done"))})}else t.resolve("done")}return t.promise}function We(e){var t=r.defer();if(!$.isEmptyObject(e)){var i=e.__data__;if("arc"===i.type){var o=i.points[1].id,a=e.attributes.block_id.nodeValue,n=g.design.templateSourceTEMP.details;g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),Be(o,a,n),i.points[1].x?i.points[1].y||ze(0,0,i.points[0].y,n):ze(0,1,i.points[0].x,n),u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){var i=Ce(e);i?u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){g.design.templateTEMP=angular.copy(e),t.resolve("done")}):(g.design.templateTEMP=angular.copy(e),t.resolve("done"))})}else t.resolve("done")}return t.promise}function qe(e){var t=g.design.selectedArc.shift(),o=t.attributes.item_id.nodeValue,r=d3.select("#"+a.SVG_ID_EDIT+" [item_id="+o+"]");r[0].length&&(e?$e(r[0][0]).then(function(){g.design.selectedArc.length&&i(function(){qe(e)},1)}):We(r[0][0]).then(function(){g.design.selectedArc.length&&i(function(){qe(e)},1)}))}function je(e,t){var i,o,r,n,l,s,d,c,p=t.__data__,m=t.attributes.block_id.nodeValue,f=d3.min(p.sizes),_=g.design.templateTEMP.details,h=_.length,y=g.design.templateSourceTEMP.details,E=0,b=0;if(f>=a.minSizeLimit&&p.square>=a.squareLimit){switch(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),e){case 2:i=90;break;case 3:i=180,E=1;break;case 4:i=170,E=1;break;case 5:i=190,E=1;break;case 6:i=80;break;case 7:i=100;break;case 8:i=90,b=1,o=2;break;case 9:i=90,b=1,o=4;break;case 10:i=180,E=1,b=1,o=1;break;case 11:i=180,E=1,b=1,o=3;break;case 12:i=100,b=1,o=1;break;case 13:i=100,b=1,o=3;break;case 14:i=10,E=1,b=1,o=4;break;case 15:i=10,E=1,b=1,o=2}for(c=1;c<h;c+=1)_[c].id===m&&(r=c,n=Number(_[c].id.replace(/\D+/g,"")));l=Te(y),s=u.cteateLineByAngel(_[r].center,i),d=Ie(s,_[r].linesOut),d.length>2&&ve(d);var v=d.length;if(2===v){for(;--v>-1;)Ee(d[v],n,r,y,E),be(++l,r,y);if(b){var T=Se(o,s,_[r].linesIn,_[r].pointsIn);Ae(T,o,n,r,y)}A()}else L(m)}else L(m)}function Qe(e){var t=e.attributes.block_id.nodeValue,i=g.design.templateSourceTEMP.details,o=i.length;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP));--o>0;)if(i[o].id===t){Re(i[o].children[0],i),Re(i[o].children[1],i),i[o].children.length=0,delete i[o].impost;break}A()}function Ke(e,t){for(var i=t.length;--i>-1;)0===t[i].x?t[i].x=e:t[i].x===e?t[i].x=0:t[i].x=e-t[i].x}function Xe(e){4===e.positionQ?e.positionQ=2:2===e.positionQ&&(e.positionQ=4)}function Ze(e){4===e.positionQ?e.positionQ=3:2===e.positionQ?e.positionQ=1:1===e.positionQ?e.positionQ=2:3===e.positionQ&&(e.positionQ=4)}function Je(e,t,i){var o,r,a=i[e].children.length;if(a)for(o=i[e].children.pop(),i[e].children.unshift(o),r=1;r<t;r+=1)i[r].id!==i[e].children[0]&&i[r].id!==i[e].children[1]||Je(r,t,i)}function et(e,t,i){var o,r;for(r=1;r<i;r+=1){if(t[r].level&&t[r].pointsQ&&(o=t[r].pointsQ.length))for(;--o>-1;)t[r].pointsQ[o].id.indexOf("qa")+1?Xe(t[r].pointsQ[o]):t[r].pointsQ[o].id.indexOf("qc")+1&&Ze(t[r].pointsQ[o]);if(t[r].impost&&(Ke(e,t[r].impost.impostAxis),t[r].impost.impostAxis[2])){var a={from:t[r].impost.impostAxis[0],to:t[r].impost.impostAxis[1]};u.setLineCoef(a),a.coefA&&a.coefB?Ze(t[r].impost.impostAxis[2]):Xe(t[r].impost.impostAxis[2])}t[r].pointsOut.length&&Ke(e,t[r].pointsOut),t[r].pointsIn.length&&Ke(e,t[r].pointsIn)}}function tt(){var e,t=g.design.templateSourceTEMP.details,o=t.length,r=u.collectAllPointsOut(g.design.templateTEMP.details),a=d3.max(r,function(e){return e.x});for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),et(a,t,o),e=1;e<o;e+=1)1===t[e].level&&Je(e,o,t);A(),i(function(){g.design.activeMenuItem=0},500)}function it(e,t,i){var o,r={x:t,y:i},a=0,n=0,l=e.length;for(o=0;o<l;o+=1)if(n=e[o+1]?u.setPointLocationToLine(e[o],e[o+1],r):u.setPointLocationToLine(e[o],e[0],r),n>0){a=n;break}return a}function ot(){var e,t,i,o,r,a,n,l,s,d,c,p,m,f=g.design.templateSourceTEMP.details,_=f.length,h=g.design.templateTEMP.details,y=[],E=[];for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),c=1;c<_;c+=1)1===f[c].level&&y.push(f[c].pointsOut.map(function(e){return e.x}));for(e=y.length,p=0;p<e;p+=1){for(E=[],t=d3.min(y[p]),i=d3.max(y[p]),c=1;c<_;c+=1)f[c].impost&&f[c].impost.impostAxis&&f[c].impost.impostAxis[0].x===f[c].impost.impostAxis[1].x&&f[c].impost.impostAxis[0].x>t&&f[c].impost.impostAxis[0].x<i&&(o={ind:c,x:f[c].impost.impostAxis[0].x},E.push(o));for(r=Math.round(i/(E.length+1)),a=E.sort(u.sortByX),n=a.length,m=0;m<n;m+=1)l=m?a[m-1].x+r:t+r,s=it(h[a[m].ind].pointsOut,l,f[a[m].ind].impost.impostAxis[0].y),d=it(h[a[m].ind].pointsOut,l,f[a[m].ind].impost.impostAxis[1].y),s||d||(a[m].x=l,f[a[m].ind].impost.impostAxis[0].x=l,f[a[m].ind].impost.impostAxis[1].x=l)}A()}function rt(e,t){var i,o,r,a,n,l,s,d={imps:[]},c=e.pointsOut.filter(function(e){return"impost"===e.type||"shtulp"===e.type}),u=c.length;for(l=0;l<u;l+=1){for(i=0,o=0,s=0;s<u;s+=1)l!==s&&c[s].id===c[l].id&&(o=1,c[s].x===c[l].x&&(i=1));if(!o)break;if(i){for(r=1,a=d.imps.length;--a>-1;)d.imps[a].id===c[l].id&&(r=0);r&&d.imps.push(c[l])}}d.imps.length&&(n=e.glassPoints.map(function(e){return e.x}),d.minX=d3.min(n),d.maxX=d3.max(n),d.width=d.maxX-d.minX,t.push(d))}function at(){var e,t,i,o,r,a,l,s,d,c,u,p,m,f,_,h,y,E,b,v,T,I=g.design.templateTEMP.details,S=I.length,L=g.design.templateSourceTEMP.details,D=g.design.selectedGlass.length,N=[];if(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),D)for(m=0;m<D;m+=1)for(e=g.design.selectedGlass[m].attributes.block_id.nodeValue,f=1;f<S;f+=1)I[f].id===e&&rt(I[f],N);else for(f=1;f<S;f+=1)!I[f].children.length&&I[f].glassPoints&&rt(I[f],N);if(t=N.length,i=n.roundingValue(N.reduce(function(e,t){return{width:e.width+t.width}}).width/t),2===t){o=N[0].imps.length,r=N[1].imps.length,a=0;e:for(_=0;_<o;_+=1)for(h=0;h<r;h+=1)if(N[1].imps[h].id===N[0].imps[_].id){a=N[1].imps[h].id;break e}}for(y=0;y<t;y+=1)for(l=N[y].imps.length,d=Math.round(i-N[y].width),E=0;E<l;E+=1)if(!N[y].imps[E].isChanged&&(c=0,2===t?N[y].imps[E].id===a&&(c=1):c=1,c))for(N[y].imps[E].x<N[y].maxX&&(d*=-1),N[y].imps[E].x+=d,b=0;b<t;b+=1)if(E!==b)for(s=N[b].imps.length,v=0;v<s;v+=1)y!==b&&N[b].imps[v].id===N[y].imps[E].id&&(N[b].imps[v].isChanged=1,N[b].width-=d);for(y=0;y<t;y+=1)for(l=N[y].imps.length,E=0;E<l;E+=1)if(!N[y].imps[E].isChanged)for(u=Number(N[y].imps[E].id.replace(/\D+/g,"")),T=1;T<S;T+=1)p=Number(L[T].id.replace(/\D+/g,"")),p===u&&L[T].impost&&(L[T].impost.impostAxis[0].x=+N[y].imps[E].x,L[T].impost.impostAxis[1].x=+N[y].imps[E].x);A()}function nt(){p.global.checkDoors=0;var e=g.design.designSteps.length-1;g.design.templateSourceTEMP=angular.copy(g.design.designSteps[e]),A(),g.design.designSteps.pop(),x(),S()}function lt(){if(4===f.product.construction_type){g.design.steps.selectedStep3=0,g.design.steps.selectedStep4=0,g.design.doorConfig.lockShapeIndex="",g.design.doorConfig.handleShapeIndex="",g.design.steps.selectedStep2=0,g.design.doorConfig.sashShapeIndex="",g.design.steps.selectedStep1=0,g.design.doorConfig.doorShapeIndex="",g.design.steps.isDoorConfig=0,g.design.doorConfig=g.setDefaultDoor(),Q(f.product.door_shape_id,f.product),K(f.product.door_sash_shape_id,f.product).then(function(e){Z(f.product.door_handle_shape_id,f.product),J(f.product.door_lock_shape_id,f.product),te(f.product).then(function(e){A(),P(g.design.templateTEMP)})});var e=setInterval(function(){1===p.global.timeoutFunc&&(clearInterval(e),st())},50)}else f.product.doorLock={},st()}function st(){if(0===p.global.checkDoors){var e;g.design.doorConfig;p.global.isLoader=1,M(1).then(function(){if(d.checkGlassSizes(g.design.templateTEMP),g.design.extraGlass.length)p.global.isLoader=0,g.design.isGlassExtra=1;else if(e=d.checkSashInTemplate(g.design.templateSourceTEMP),e?(p.global.isSashesInTemplate||(p.global.isSashesInTemplate=1,f.product.hardware=p.global.hardwares[0][0]),d.checkHardwareSizes(g.design.templateTEMP)):(f.product.hardware={},f.product.hardware.id=0,p.global.isSashesInTemplate=0,g.design.extraHardware.length=0),g.design.extraHardware.length)p.global.isLoader=0,g.design.isHardwareExtra=1;else{f.product.template_source=angular.copy(g.design.templateSourceTEMP),f.product.template=angular.copy(g.design.templateTEMP),d.setGlassfilter(),d.setCurrentGlass(f.product,1),u.createSVGTemplateIcon(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){f.product.templateIcon=angular.copy(e)}),p.global.templatesSource[f.product.templateIndex]=angular.copy(f.product.template_source);var t=z();t&&s.getGridPrice(f.product.chosenAddElements[0]),u.createSVGTemplate(f.product.template_source,f.product.profileDepths).then(function(e){f.product.template=angular.copy(e),d.preparePrice(f.product.template,f.product.profile.id,f.product.glass,f.product.hardware.id,f.product.lamination.lamination_in_id).then(function(){u.createSVGTemplate(f.product.template_source,f.product.profileDepths).then(function(e){f.product.template=angular.copy(e),p.global.isChangedTemplate=1,W()})})})}})}}function dt(){f.product=angular.copy(p.global.templateTEMP),S(),W()}var ct=this,ut=p.global.isDevice?"touchstart":"mousedown";return ct.publicObj={setDefaultTemplate:Y,designSaved:st,designCancel:dt,checkSize:P,setDefaultConstruction:ne,initAllImposts:se,initAllGlass:pe,initAllGlassXGlass:ge,initAllGlassXGrid:fe,initAllArcs:he,initAllDimension:F,showAllDimension:ue,hideCornerMarks:E,deselectAllImpost:b,deselectAllArc:v,deselectAllGlass:T,rebuildSVGTemplate:A,createSash:De,deleteSash:Oe,setCornerPoints:Ve,setCurvCornerPoints:He,deleteCornerPoints:Ue,createArc:$e,deleteArc:We,workingWithAllArcs:qe,createImpost:je,deleteImpost:Qe,initMirror:tt,positionAxises:ot,positionGlasses:at,removeAllEventsInSVG:D,removeGlassEventsInSVG:N,closeGlassSelectorDialog:me,setValueSize:G,deleteLastNumber:B,closeSizeCaclulator:M,hideSizeTools:S,stepBack:nt,idsForNewTemplate:j,setNewDoorParamValue:re,setDoorConfigDefault:ae,saveSizeCheck:lt,toggleDoorConfig:q,selectDoor:Q,selectSash:K,selectHandle:Z,selectLock:J,closeDoorConfig:ee,saveDoorConfig:te},ct.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("GeneralServ",["$filter","$window","$document","globalConstants","GlobalStor",function(e,t,i,o,r){function a(){r.global.startProgramm&&"main"===r.global.currOpenPage&&(r.global.startProgramm=0)}function n(){r.global.prevOpenPage=r.global.currOpenPage}function l(e,t){var i,o,r=t||2,a=typeof e,n="1";for(i=0;i<r;i+=1)n+="0";return n*=1,"string"===a?o=parseFloat((Math.round(parseFloat(e)*n)/n).toFixed(r)):"number"===a&&(o=parseFloat((Math.round(e*n)/n).toFixed(r))),o}function s(e,t){return e*t}function d(e,t){return l(e*(1-t/100))}function c(e,t){return e-t}function u(e){return e.filter(function(e,t,i){return t===i.indexOf(e)})}function p(e){var t={minX:d3.min(e,function(e){return e.x}),maxX:d3.max(e,function(e){return e.x}),minY:d3.min(e,function(e){return e.y}),maxY:d3.max(e,function(e){return e.y})};return t}function g(e,t,i){r.global.isAlert=1,r.global.alertTitle=e||"",r.global.alertDescr=t||"",r.global.confirmAction=i}function m(e,t){r.global.isAlertInfo=1,r.global.alertTitle=e||"",r.global.alertDescr=t||""}function f(e){r.global.isErrorProd=1,r.global.isErrorProdTitle=e||""}function _(e){r.global.confirmInActivity=e}function h(e){if(r.global.isDevice){var i=window.open(e);i.close()}else t.open(e)}var y=this,E=[{id:20,name:"add_elements.GRIDS",typeClass:"aux-grid",typeMenu:3333,mainTypeMenu:5555,delay:5*o.STEP},{id:21,name:"add_elements.VISORS",typeClass:"aux-visor",typeMenu:2222,delay:6*o.STEP},{id:9,name:"add_elements.SPILLWAYS",typeClass:"aux-spillway",typeMenu:2222,delay:6*o.STEP},{id:19,name:"add_elements.OUTSIDE",typeClass:"aux-outside",typeMenu:2222,delay:10*o.STEP},{id:26,name:"add_elements.LOUVERS",typeClass:"aux-louver",typeMenu:1111,mainTypeMenu:5555,delay:15*o.STEP},{id:19,name:"add_elements.INSIDE",typeClass:"aux-inside",typeMenu:1111,mainTypeMenu:5555,delay:20*o.STEP},{id:12,name:"add_elements.CONNECTORS",typeClass:"aux-connectors",typeMenu:3333,mainTypeMenu:5555,delay:30*o.STEP},{id:27,name:"add_elements.FAN",typeClass:"aux-fan",typeMenu:3333,mainTypeMenu:5555,delay:31*o.STEP},{id:8,name:"add_elements.WINDOWSILLS",typeClass:"aux-windowsill",typeMenu:1111,mainTypeMenu:5555,delay:13*o.STEP},{id:24,name:"add_elements.HANDLELS",typeClass:"aux-handle",typeMenu:3333,mainTypeMenu:5555,delay:28*o.STEP},{id:18,name:"add_elements.OTHERS",typeClass:"aux-others",typeMenu:4444,mainTypeMenu:5555,delay:31*o.STEP},{id:99,name:"add_elements.BLIND",typeClass:"aux-blind",typeMenu:2222,delay:31*o.STEP},{id:9999,name:"add_elements.GRATING",typeClass:"aux-grating",typeMenu:2222,delay:31*o.STEP},{id:999,name:"add_elements.SHUTTERS",typeClass:"aux-shutters",typeMenu:2222,delay:31*o.STEP},{id:999,name:"add_elements.SHUTTERS",typeClass:"aux-shut",mainTypeMenu:5555,delay:31*o.STEP},{id:9999,name:"add_elements.GRATING",typeClass:"aux-grat",mainTypeMenu:5555,delay:31*o.STEP},{id:21,name:"add_elements.VISORS",typeClass:"aux-vis",mainTypeMenu:5555,delay:31*o.STEP},{id:9,name:"add_elements.SPILLWAYS",typeClass:"aux-spil",mainTypeMenu:5555,delay:31*o.STEP},{id:13,name:"add_elements.CONNECTORS",typeClass:"aux-connectors",typeMenu:3333,mainTypeMenu:5555,delay:30*o.STEP}];return t.onbeforeunload=function(){return e("translate")("common_words.PAGE_REFRESH")},t.addEventListener("keydown",function(e){8!==e.keyCode||$(e.target).is("input, textarea")||e.preventDefault()}),y.publicObj={isErrorProd:f,addElementDATA:E,stopStartProg:a,setPreviosPage:n,roundingValue:l,addMarginToPrice:s,setPriceDis:d,sorting:c,removeDuplicates:u,getMaxMinCoord:p,confirmAlert:g,goToLink:h,confirmPath:_,infoAlert:m},y.publicObj}])}(),function(){angular.module("HistoryModule").factory("GlassesServ",["$location","$filter","$q","GlobalStor","DesignServ",function(e,t,i,o,r){function a(e,t,i){o.global.prevGlassId=angular.copy(o.global.selectGlassId),o.global.prevGlassName=angular.copy(o.global.selectGlassName),o.global.selectGlassId=e,o.global.selectGlassName=t,o.global.selectGlassType=i,o.global.showGlassSelectorDialog=1,r.initAllGlassXGlass()}var n=this;return n.publicObj={selectGlass:a},n.publicObj}])}(),function(){angular.module("HistoryModule").factory("HardwareServ",["$location","$filter","$q","ProductStor","MainServ","DesignStor","AnalyticsServ","UserStor","OrderStor",function(e,t,i,o,r,a,n,l,s){function d(e){o.product.hardware.id!==e&&(r.checkHardwareSizes(o.product.template,e),a.design.extraHardware.length?a.design.isHardwareExtra=1:(r.setCurrentHardware(o.product,e),r.preparePrice(o.product.template,o.product.profile.id,o.product.glass,o.product.hardware.id,o.product.lamination.lamination_in_id),n.sendAnalyticsData(l.userInfo.id,s.order.id,o.product.template_id,e,3)))}var c=this;return c.publicObj={selectHardware:d},c.publicObj}])}(),function(){angular.module("HistoryModule").factory("HistoryServ",["$location","$filter","$q","$http","globalConstants","localDB","$timeout","GeneralServ","MainServ","RecOrderServ","SVGServ","DesignServ","GlobalStor","OrderStor","ProductStor","UserStor","HistoryStor","CartStor","DesignStor",function(e,t,i,o,r,a,n,l,s,d,c,u,p,g,m,f,_,h,y){function E(){$.get("http://api.steko.com.ua",function(e){return Q=!0,!0}).fail(function(){return Q=!1,!1})}function b(){l.setPreviosPage(),p.global.isCreatedNewProduct&&p.global.isCreatedNewProject?e.path("/main"):s.createNewProject()}function v(){a.selectLocalDB(a.tablesLocalDB.orders.tableName,{order_type:1}).then(function(e){var t=angular.copy(e),i=t.length;if(_.history.isEmptyResult=0,i){for(;--i>-1;)t[i].created=new Date(t[i].created),t[i].delivery_date=new Date(t[i].delivery_date),t[i].new_delivery_date=new Date(t[i].new_delivery_date),t[i].order_date=new Date(t[i].order_date);_.history.ordersSource=angular.copy(t),_.history.orders=angular.copy(t),p.global.isLoader=0}else _.history.isEmptyResult=1,p.global.isLoader=0})}function T(e,i){function o(){var e,t=_.history.orders.length;for(e=0;e<t;e+=1)_.history.orders[e].id===i&&(_.history.orders[e].order_style=Z,_.history.ordersSource[e].order_style=Z,a.updateLocalServerDBs(a.tablesLocalDB.orders.tableName,i,{order_style:Z,sended:new Date}));p.global.isLoader=0}e!==X&&f.userInfo.code_sync.length&&"null"!==f.userInfo.code_sync&&l.confirmAlert(t("translate")("common_words.SEND_ORDER_TITLE"),t("translate")("common_words.SEND_ORDER_TXT"),o),p.global.isLoader=0}function I(e,i){if(Q&&navigator.onLine){p.global.isLoader=1;var o=[];if(o=_.history.firstClick.filter(function(e){return e===i}),0!==o.length){p.global.isLoader=0;for(var a=0;a<o.length;a+=1)o[a]!==i&&_.history.firstClick.push(i)}else{_.history.firstClick.push(i);var n=new XMLHttpRequest;n.open("GET",r.serverIP+"/api/export?login="+f.userInfo.phone+"&access_token="+f.userInfo.device_code+"&orderId="+i,!1),n.send(),200===n.status?JSON.parse(n.response).status===!0?(T(e,i),_.history.resAPI=i+"doneOrder",p.global.isLoader=0):(p.global.textErrorOrder=JSON.parse(n.response).error,p.global.isLoader=0,_.history.resAPI=i+"errorOrder"):(p.global.isLoader=0,_.history.resAPI=i+"errorOrder")}}else $.get(r.serverIP,function(e){Q=!0}).fail(function(){Q=!1,alert("")}),l.infoAlert(t("translate")("login.OFFLINE"),t("translate")("login.OFFLINE_INFO"))}function S(){Q&&navigator.onLine?j().then(function(){p.global.isLoader=1;var e,t=new XMLHttpRequest,i={order_products:a.tablesLocalDB.order_products,orders:a.tablesLocalDB.orders,order_addelements:a.tablesLocalDB.order_addelements},o="http://admin.steko.com.ua/api/orders?login="+f.userInfo.phone+"&access_token="+f.userInfo.device_code+"&type="+_.history.resTimeBox.namb;t.open("GET",o,!1),t.send(),200!=t.status?(console.info(t.status+": "+t.statusText),p.global.isLoader=0):a.cleanLocalDB(i).then(function(o){o&&a.createTablesLocalDB(i).then(function(i){function o(e){return"done"===e?e="order":e}if(i){e=JSON.parse(t.response),e.tables.order_products.fields.splice(1,1),e.tables.order_products.fields.splice(2,1),e.tables.order_products.fields.splice(6,1),e.tables.order_products.fields.splice(27,1),e.tables.orders.fields.splice(1,1);for(var r=0;r<e.tables.order_products.rows.length;r+=1)e.tables.order_products.rows[r].splice(1,1),e.tables.order_products.rows[r].splice(2,1),e.tables.order_products.rows[r].splice(6,1),e.tables.order_products.rows[r].splice(27,1);for(var r=0;r<e.tables.orders.rows.length;r+=1)e.tables.orders.rows[r].splice(1,1),"1970-01-01T00:00:00.000Z"!==e.tables.orders.rows[r][24]?e.tables.orders.rows[r][55]="done":o(e.tables.orders.rows[r][55]),"1970-01-01T00:00:00.000Z"!==e.tables.orders.rows[r][25]?e.tables.orders.rows[r][55]="done":o(e.tables.orders.rows[r][55]),"1970-01-01T00:00:00.000Z"!==e.tables.orders.rows[r][26]?e.tables.orders.rows[r][55]="done":o(e.tables.orders.rows[r][55]);
a.insertTablesLocalDB(e).then(function(){v()})}})})}):($.get(r.serverIP,function(e){Q=!0}).fail(function(){Q=!1,alert("")}),l.infoAlert(t("translate")("login.OFFLINE"),t("translate")("login.OFFLINE_INFO")))}function A(){$("#deleteOption").remove()}function L(e,t,i){function o(e,t,i){a.selectLocalDB(i,{order_id:e}).then(function(e){if(e.length){var o,r=angular.copy(e),n=r.length;if(n>0)for(o=0;o<n;o+=1)delete r[o].id,r[o].modified=new Date,r[o].order_id=t,a.insertRowLocalDB(r[o],i),a.insertServer(f.userInfo.phone,f.userInfo.device_code,i,r[o])}else console.log("Empty result = ",e)})}function r(){var e,i,r=_.history.orders.length;for(i=0;i<r;i+=1)_.history.orders[i].id===t&&(e=angular.copy(_.history.orders[i]));e.id=s.createOrderID(),e.order_number=0,e.order_hz="---",e.sended=new Date(0),e.state_to=new Date(0),e.state_buch=new Date(0),e.created=new Date,e.modified=new Date,e.order_style="order","number"==typeof e.customer_age?e.customer_age=e.customer_age:e.customer_age=0,"number"==typeof e.customer_education?e.customer_education=e.customer_education:e.customer_education=0,"number"==typeof e.customer_occupation?e.customer_occupation=e.customer_occupation:e.customer_occupation=0,"number"==typeof e.customer_infoSource?e.customer_infoSource=e.customer_infoSource:e.customer_infoSource=0,a.insertServer(f.userInfo.phone,f.userInfo.device_code,a.tablesLocalDB.orders.tableName,e).then(function(t){console.log(t,"respond"),null!==t?t.status&&(e.order_number=t.order_number):e.order_number=0,_.history.orders.push(e),_.history.ordersSource.push(e),a.insertRowLocalDB(e,a.tablesLocalDB.orders.tableName),p.global.isLoader=0}),o(t,e.id,a.tablesLocalDB.order_products.tableName),o(t,e.id,a.tablesLocalDB.order_addelements.tableName)}p.global.isLoader=1,_.history.orderOk=0,Q&&navigator.onLine?_.history.orderEditNumber=t:_.history.orderEditNumber=0,r()}function D(){var e,t=i.defer();return w().then(function(i){_.history.isBoxArray=angular.copy(i[0]),C().then(function(i){_.history.isBoxArray.products=angular.copy(i);for(var o=0;o<_.history.isBoxArray.products.length;o+=1)_.history.isBoxArray.products[o].addElementDATA=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];P().then(function(i){if(i)for(var o=0;o<i.length;o+=1)for(var r=0;r<_.history.isBoxArray.products.length;r+=1)i[o].product_id===_.history.isBoxArray.products[r].product_id&&(e=i[o].element_type,i[o].id=angular.copy(i[o].element_id),delete i[o].element_id,delete i[o].modified,i[o].elementPriceDis=l.setPriceDis(i[o].element_price,_.history.isBoxArray.discount_addelem),i[o].list_group_id=l.addElementDATA[e].id,_.history.isBoxArray.products[r].addElementDATA[e].push(i[o]),o||t.resolve(1));else t.resolve(1)})})}),t.promise}function N(e,i){function o(){var t,o;e?(t=_.history.orders,o=_.history.ordersSource):(t=_.history.drafts,o=_.history.draftsSource);for(var r=t.length;--r>-1;)if(t[r].id===i){t.splice(r,1),o.splice(r,1);break}t.length||(_.history.isEmptyResult=1),s.deleteOrderInDB(i),e&&a.deleteOrderServer(f.userInfo.phone,f.userInfo.device_code,i)}l.confirmAlert(t("translate")("common_words.DELETE_ORDER_TITLE"),t("translate")("common_words.DELETE_ORDER_TXT"),o)}function x(e,t,i){if(t)for(var o=i.length;--o>-1;)if(i[o].id===t)switch(e){case 1:g.order.floorName=angular.copy(i[o].name);break;case 2:g.order.mountingName=angular.copy(i[o].name);break;case 3:g.order.selectedInstalmentPeriod=angular.copy(i[o].name),g.order.selectedInstalmentPercent=angular.copy(i[o].value)}}function R(e,t){var i=p.global.glassesAll.filter(function(t){return t.profileId===e.profile.id});i.length&&e.glass.unshift(s.fineItemById(t,i[0].glasses))}function O(){var e=i.defer();return a.selectLocalDB(a.tablesLocalDB.order_products.tableName,{order_id:p.global.orderEditNumber}).then(function(t){var o=angular.copy(t);if(o.length){var r=o.map(function(e){var t,o=i.defer(),r=m.setDefaultProduct();return angular.extend(r,e),delete r.id,delete r.modified,r.is_addelem_only?o.resolve(r):(r.template_source=JSON.parse(r.template_source),r.template_source.beads&&(r.beadsData=angular.copy(r.template_source.beads)),t=4===r.construction_type?r.template_source.profile_window_id:r.profile_id,s.setCurrentProfile(r,t).then(function(){if(r.glass_id){var e=r.glass_id.split(", "),t=e.length;if(t)for(;--t>-1;)R(r,+e[t])}p.global.isSashesInTemplate=s.checkSashInTemplate(r.template_source),4!==r.construction_type?s.setCurrentHardware(r,r.hardware_id):s.setCurrentHardware(r,r.template_source.hardware_id),s.setCurrLamination(r,r.lamination_id),delete r.lamination_id,delete r.lamination_in_id,delete r.lamination_out_id,o.resolve(r)}),4===r.construction_type&&(p.global.noDoorExist?(y.design.isNoDoors=1,o.reject(1)):y.design=y.setDefaultDesign())),o.promise});i.all(r).then(function(t){var o=t.map(function(e){var t=i.defer();return e.is_addelem_only?(e.addelemPriceDis=l.setPriceDis(e.addelem_price,g.order.discount_addelem),e.productPriceDis=l.setPriceDis(e.template_price,g.order.discount_construct)+e.addelemPriceDis,g.order.products.push(e),t.resolve(1)):c.createSVGTemplateIcon(e.template_source,e.profileDepths).then(function(i){e.templateIcon=i,c.createSVGTemplate(e.template_source,e.profileDepths).then(function(i){e.template=i,delete e.profile_id,delete e.glass_id,delete e.hardware_id,e.addelemPriceDis=l.setPriceDis(e.addelem_price,g.order.discount_addelem),e.productPriceDis=l.setPriceDis(e.template_price,g.order.discount_construct)+e.addelemPriceDis,g.order.products.push(e),t.resolve(1)})}),t.promise});e.resolve(i.all(o))})}else e.reject(o)}),e.promise}function C(){var e=i.defer();return a.selectLocalDB(a.tablesLocalDB.order_products.tableName,{order_id:_.history.orderEditNumber}).then(function(t){e.resolve(t)}),e.promise}function P(){var e=i.defer();return a.selectLocalDB(a.tablesLocalDB.order_addelements.tableName,{order_id:_.history.orderEditNumber}).then(function(t){e.resolve(t)}),e.promise}function w(){var e=i.defer();return a.selectLocalDB(a.tablesLocalDB.orders.tableName,{id:_.history.orderEditNumber},"order_type, order_style, discount_construct, discount_addelem, discount_construct_max, discount_addelem_max, customer_address, customer_age, customer_city, customer_city_id, customer_education, customer_flat, customer_floor, customer_house, customer_infoSource, customer_location, customer_name, customer_occupation, customer_phone, customer_sex").then(function(t){e.resolve(t)}),e.promise}function M(){var e=i.defer();return a.selectLocalDB(a.tablesLocalDB.order_addelements.tableName,{order_id:p.global.orderEditNumber}).then(function(t){for(var i,o,r=angular.copy(t),a=p.global.addElementsAll,n=r.length,s=g.order.products.length,d=0;d<n;d+=1)for(var c=0;c<a[r[d].element_type].elementsList.length;c+=1)for(var u=0;u<a[r[d].element_type].elementsList[c].length;u+=1)if(r[d].element_id===a[r[d].element_type].elementsList[c][u].id){r[d].max_size=a[r[d].element_type].elementsList[c][u].max_size,r[d].parent_element_id=a[r[d].element_type].elementsList[c][u].parent_element_id,r[d].list_group_id=a[r[d].element_type].elementsList[c][u].list_group_id,r[d].list_type_id=a[r[d].element_type].elementsList[c][u].list_type_id;break}if(n)for(;--n>-1;)for(i=0;i<s;i+=1)r[n].product_id===g.order.products[i].product_id&&(o=r[n].element_type,r[n].id=angular.copy(r[n].element_id),delete r[n].element_id,delete r[n].modified,r[n].elementPriceDis=l.setPriceDis(r[n].element_price,g.order.discount_addelem),r[n].list_group_id=l.addElementDATA[o].id,g.order.products[i].chosenAddElements[o].push(r[n]),n||e.resolve(1));else e.resolve(1)}),e.promise}function k(t,i){p.global.isLoader=1,p.global.orderEditNumber=i,g.order=g.setDefaultOrder();for(var o=t?_.history.orders.length:_.history.drafts.length;--o>-1;)t?_.history.orders[o].id===i&&(angular.extend(g.order,_.history.orders[o]),h.fillOrderForm()):_.history.drafts[o].id===i&&(angular.extend(g.order,_.history.drafts[o]),h.fillOrderForm());g.order.order_date=new Date(g.order.order_date).getTime(),g.order.delivery_date=new Date(g.order.delivery_date).getTime(),g.order.new_delivery_date=new Date(g.order.new_delivery_date).getTime(),g.order.order_edit=1,x(1,g.order.floor_id,p.global.supplyData),x(2,g.order.mounting_id,p.global.assemblingData),x(3,g.order.instalment_id,p.global.instalmentsData),delete g.order.additional_payment,delete g.order.created,delete g.order.sended,delete g.order.state_to,delete g.order.state_buch,delete g.order.batch,delete g.order.base_price,delete g.order.factory_margin,delete g.order.purchase_price,delete g.order.sale_price,delete g.order.modified,O().then(function(){function t(e,t){async.waterfall([function(t){4===e.construction_type?u.setDoorConfigDefault(e).then(function(e){t()}):t()}],function(e,i){return e?t(e):void t(null)})}var i=g.order.products;async.eachSeries(i,t,function(t,i){M().then(function(){p.global.isConfigMenu=1,p.global.isNavMenu=0,l.setPreviosPage(),p.global.isLoader=0,e.path("/cart")})})})}function G(){a.selectLocalDB(a.tablesLocalDB.orders.tableName,{order_type:0}).then(function(e){var t=angular.copy(e),i=t.length;if(_.history.isEmptyResultDraft=0,i){for(;--i>-1;)t[i].created=new Date(t[i].created),t[i].delivery_date=new Date(t[i].delivery_date),t[i].new_delivery_date=new Date(t[i].new_delivery_date),t[i].order_date=new Date(t[i].order_date);_.history.draftsSource=angular.copy(t),_.history.drafts=angular.copy(t)}else _.history.isEmptyResultDraft=1})}function B(){_.history.isOrderDate=0,_.history.isOrderDateDraft=0,_.history.isDraftView=!_.history.isDraftView,_.history.drafts.length||G()}function V(e){var t=r.printIP+e+"?userId="+f.userInfo.id;navigator.onLine?l.goToLink(t):_.history.isNoPrint=1}function H(){_.history.isOrderSearch=1,_.history.isOrderDate=0,_.history.isOrderSort=0}function U(e,t,i){var o,r,a,n,l;if(""!==t||""!==i){if(o=angular.copy(e),r=new Date(t).valueOf(),a=new Date(i).valueOf(),""!==t&&""!==i&&r>a)return!1;for(n=o.length-1;n>=0;n-=1)l=new Date(o[n].created).valueOf(),(l<r||l>a)&&o.splice(n,1);return o}return!1}function F(){var e;_.history.isDraftView?(_.history.isOrderDateDraft&&(e=U(_.history.draftsSource,_.history.startDateDraft,_.history.finishDateDraft),e&&(_.history.drafts=e)),_.history.isOrderDateDraft=!_.history.isOrderDateDraft,_.history.isOrderSortDraft=0):(_.history.isOrderDate&&(e=U(_.history.ordersSource,_.history.startDate,_.history.finishDate),e&&(_.history.orders=e)),_.history.isOrderDate=!_.history.isOrderDate,_.history.isOrderSearch=0,_.history.isOrderSort=0)}function z(e){_.history.isDraftView?"start-date"!==e||_.history.isStartDateDraft?"finish-date"!==e||_.history.isFinishDateDraft?"full-date"!==e||_.history.isAllPeriodDraft?(_.history.isStartDateDraft=0,_.history.isFinishDateDraft=0,_.history.isAllPeriodDraft=0):(_.history.isStartDateDraft=0,_.history.isFinishDateDraft=0,_.history.isAllPeriodDraft=1,_.history.startDateDraft="",_.history.finishDateDraft="",_.history.drafts=angular.copy(_.history.draftsSource)):(_.history.isStartDateDraft=0,_.history.isFinishDateDraft=1,_.history.isAllPeriodDraft=0):(_.history.isStartDateDraft=1,_.history.isFinishDateDraft=0,_.history.isAllPeriodDraft=0):"start-date"!==e||_.history.isStartDate?"finish-date"!==e||_.history.isFinishDate?"full-date"!==e||_.history.isAllPeriod?(_.history.isStartDate=0,_.history.isFinishDate=0,_.history.isAllPeriod=0):(_.history.isStartDate=0,_.history.isFinishDate=0,_.history.isAllPeriod=1,_.history.startDate="",_.history.finishDate="",_.history.orders=angular.copy(_.history.ordersSource)):(_.history.isStartDate=0,_.history.isFinishDate=1,_.history.isAllPeriod=0):(_.history.isStartDate=1,_.history.isFinishDate=0,_.history.isAllPeriod=0)}function Y(){_.history.isDraftView?(_.history.isOrderSortDraft=!_.history.isOrderSortDraft,_.history.isOrderDateDraft=0):(_.history.isOrderSort=!_.history.isOrderSort,_.history.isOrderSearch=0,_.history.isOrderDate=0)}function W(e,t){_.history.isDraftView?_.history.isSortTypeDraft===t?(_.history.isSortTypeDraft=0,_.history.reverseDraft=1):(_.history.isSortTypeDraft=t,"first"===_.history.isSortTypeDraft&&(_.history.reverseDraft=1),"last"===_.history.isSortTypeDraft&&(_.history.reverseDraft=0)):e?_.history.isFilterType===t?_.history.isFilterType=void 0:_.history.isFilterType=t:_.history.isSortType===t?(_.history.orders=angular.copy(_.history.ordersSource),_.history.isSortType="last"):_.history.isSortType=t}function q(e){console.log("da"),_.history.orderEditNumber=e,p.global.isBox=!p.global.isBox,p.global.isEditBox=!p.global.isEditBox,D().then(function(){d.box()})}function j(){if(E(),Q){var e,o=i.defer();return a.selectLocalDB(a.tablesLocalDB.orders.tableName).then(function(t){e=angular.copy(t),t?a.selectLocalDB(a.tablesLocalDB.order_products.tableName).then(function(t){var i=angular.copy(t);a.selectLocalDB(a.tablesLocalDB.order_addelements.tableName).then(function(t){function r(e,t){var i;async.waterfall([function(t){i=angular.copy(e),t(null)},function(e){a.insertServer(f.userInfo.phone,f.userInfo.device_code,a.tablesLocalDB.order_products.tableName,i).then(function(t){console.log("calculate1",t),e()})}],function(e,i){return e?t(e):void t(null)})}function n(e,t){var i;async.waterfall([function(t){i=angular.copy(e),t(null)},function(e){a.insertServer(f.userInfo.phone,f.userInfo.device_code,a.tablesLocalDB.order_addelements.tableName,i).then(function(t){console.log("calculate1",t),e()})}],function(e,i){return e?t(e):void t(null)})}function l(e,t){var i;async.waterfall([function(t){i=angular.copy(e),t(null)},function(e){a.insertServer(f.userInfo.phone,f.userInfo.device_code,a.tablesLocalDB.orders.tableName,i).then(function(t){console.log("respond",t),"undefined"!=typeof t.order_number&&(i.order_number=t.order_number,a.deleteRowLocalDB(a.tablesLocalDB.orders.tableName,{id:i.id}),a.insertRowLocalDB(i,a.tablesLocalDB.orders.tableName)),e()})}],function(e,i){return e?t(e):void t(null)})}var s=angular.copy(t);"number"!=typeof e.order_number&&(console.log("send local save"),async.eachSeries(i,r,function(e,t){o.resolve(1)}),async.eachSeries(s,n,function(e,t){o.resolve(1)}),async.eachSeries(e,l,function(e,t){v(),o.resolve(1)}))})}):o.resolve(1)}),o.promise}l.infoAlert(t("translate")("login.OFFLINE"),t("translate")("login.OFFLINE_INFO"))}var Q,Q,K=this,X="master",Z="done";return $.get(r.serverIP,function(e){Q=!0}).fail(function(){Q=!1}),K.publicObj={toCurrentCalculation:b,downloadOrders:v,sendOrderToFactory:I,makeOrderCopy:L,clickDeleteOrder:N,editOrder:k,orderPrint:V,orderItem:D,viewSwitching:B,dloadProducts:C,dloadAddElements:P,orderSearching:H,orderDateSelecting:F,openCalendarScroll:z,orderSorting:Y,sortingInit:W,reqResult:S,synchronizeOrders:j,deleteOption:A,testFunc:q},K.publicObj}])}(),function(){angular.module("HistoryModule").factory("InfoBoxServ",["$location","$filter","$q","GlobalStor","ProfileServ","GlassesServ","HardwareServ","AddElementsServ","ProductStor","AddElementMenuServ","AuxStor","globalConstants","localDB",function(e,t,i,o,r,a,n,l,s,d,c,u,p){function g(e){o.global.isPush=[],p.selectLocalDB(p.tablesLocalDB.lists.tableName,{is_push:1},"id, name, list_group_id, glass_type, glass_color, name").then(function(t){o.global.isPush=angular.copy(t),o.global.setTimeout=0,0!==o.global.activePanel&&e===o.global.activePanel&&(1!==o.global.inform?o.global.showApply=1:o.global.showApply=0,m(e))})}function m(e){function t(e,t){return Math.random()-0,5}var i=o.global.isPush,r=o.global.profiles,a=o.global.hardwares,n=o.global.inform,l={},s=[];if(3===e&&1!==n){for(var d=0;d<i.length;d+=1)if(6===i[d].list_group_id){var c=i[d].id,u=i[d].glass_color,p=i[d].name;break}o.global.infoBoxglassName=p,o.global.infoBoxglassType=u,o.global.infoBoxglasses=c,s=o.global.glasses}if(4===e&&1!==n&&o.global.checkSashInTemplate>0){for(var g=0;g<a.length;g+=1)for(var m=0;m<a[g].length;m+=1)if(1===a[g][m].is_push){var c=a[g][m].id;o.global.infoBoxhardwares=a[g][m].id}s=o.global.hardwares}if(2===e&&1!==n){for(var g=0;g<r.length;g+=1)for(var m=0;m<r[g].length;m+=1)if(1===r[g][m].is_push){var c=r[g][m].id;o.global.infoBoxprofiles=r[g][m].id}s=o.global.profiles}if(6===e&&1!==n){s=[],i.sort(t);for(var d=0;d<i.length;d+=1)if(6!==i[d].list_group_id){var c=i[d].id;o.global.infoBoxaddElem=i[d];break}for(var f=0;f<o.global.addElementsAll.length;f+=1)for(var _=0;_<o.global.addElementsAll[f].elementsList.length;_+=1)s.push(o.global.addElementsAll[f].elementsList[_])}if(s.length>0)for(var f=0;f<s.length;f+=1)for(var g=0;g<s[f].length;g+=1)if(s[f][g].id===c){l=s[f][g];break}$.isEmptyObject(l)||(o.global.infoTitle=l.name,o.global.infoImg=l.img,o.global.infoLink=l.link,o.global.infoDescrip=l.description,o.global.isInfoBox=c)}function f(){if(o.global.showApply=0,2===o.global.activePanel){var e=o.global.infoBoxprofiles;r.checkForAddElem(e),o.global.inform.push(o.global.activePanel)}if(3===o.global.activePanel){var e=o.global.infoBoxglasses,t=o.global.infoBoxglassName;a.selectGlass(e,t,o.global.infoBoxglassType),o.global.inform.push(o.global.activePanel)}if(4===o.global.activePanel){var e=o.global.infoBoxhardwares;n.selectHardware(e),o.global.inform.push(o.global.activePanel)}6===o.global.activePanel&&_(),o.global.isInfoBox=0,o.global.infoTitle="",o.global.infoImg="",o.global.infoLink="",o.global.infoDescrip=""}function _(){for(var e,t,i=[20,21,9,19,26,19,12,27,8,24,18,99,9999,999,999,9999],r=o.global.infoBoxaddElem,a=0,n=0;n<i.length;n+=1)if(r.list_group_id===i[n]){a=n+1;break}l.downloadAddElementsData(a);for(var s=0;s<c.aux.addElementsList.length;s+=1)for(var d=0;d<c.aux.addElementsList[s].length;d+=1)r.id===c.aux.addElementsList[s][d].id&&(e=s,t=d);c.aux.isFocusedAddElement=a,c.aux.showAddElementsMenu=u.activeClass,l.selectAddElem(e,t,void 0)}var h=this;return h.publicObj={isApply:f,infoBox:m,autoShow:g,addElemSelected:_},h.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("AsyncLoader",["$http","$q","globalConstants",function(e,t,i){return function(o){var r,a=t.defer(),n=i.localPath+o.key+".json";return isDevice?(r=window.location.href.replace("/index.html",""),r.indexOf("#/change-lang")+1&&(r=r.replace("#/change-lang","")),$.getJSON(r+n,function(e){a.resolve(e)})):e.get(n).then(function(e){a.resolve(e.data)},function(){console.log("Something went wrong with language json"),a.reject(o.key)}),a.promise}}])}(),function(){angular.module("BauVoiceApp").factory("localDB",["$http","$q","$filter","globalConstants","GeneralServ","UserStor","GlobalStor",function(e,t,i,o,r,a,n){function l(e){var i=Object.keys(e),o=i.map(function(e){var i=t.defer();return ee.transaction(function(t){t.executeSql("DROP TABLE IF EXISTS "+e,[],function(){i.resolve(1)},function(){console.log("not find deleting table"),i.resolve(0)})}),i.promise});return t.all(o)}function s(e){var i=Object.keys(e),o=i.map(function(e){var i=t.defer();return ee.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+te[e].tableName+" (id INTEGER PRIMARY KEY AUTOINCREMENT, "+te[e].prop+", modified TIMESTAMP DEFAULT CURRENT_TIMESTAMP"+te[e].foreignKey+")",[],function(){i.resolve(1)},function(){console.log("Something went wrong with creating table "+te[e].tableName),i.resolve(0)})}),i.promise});return t.all(o)}function d(e){return angular.isString(e)&&e.indexOf("'")+1?e.replace(/'/g,"''"):e}function c(e,t){var i=Object.keys(e),o=i.join(", "),r=i.map(function(t){return e[t]=d(e[t]),"'"+e[t]+"'"}).join(", ");ee.transaction(function(e){e.executeSql("INSERT INTO "+t+" ("+o+") VALUES ("+r+")",[],null,function(){console.log("Something went wrong with insert into "+t)})})}function u(e){for(var i=n.global.regionCoefs,o=[2,6,8,13,17,19,22,25],r=0;r<o.length;r+=1)if(i===o[r]&&e.tables.elements)for(var r=0;r<e.tables.elements.rows.length;r+=1)e.tables.elements.rows[r][28]>0&&(e.tables.elements.rows[r][21]=e.tables.elements.rows[r][21]*e.tables.elements.rows[r][28]);var a=[],l=Object.keys(e.tables),s=l.length;return ee.transaction(function(i){var o;for(o=0;o<s;o+=1){var r,n=e.tables[l[o]].fields.join(", "),c=e.tables[l[o]].rows.length;if(c)for(r=0;r<c;r+=1){var u=t.defer(),p=e.tables[l[o]].rows[r].map(function(e){return e=d(e),"'"+e+"'"}).join(", ");i.executeSql("INSERT INTO "+l[o]+" ("+n+") VALUES ("+p+")",[],function(){u.resolve(1)},function(e){u.resolve(0)}),a.push(u.promise)}}}),t.all(a)}function p(e,i,o){var r=t.defer(),a=o||"*",n="";if(i){n=" WHERE ";var l=Object.keys(i);n+=l[0]+" = '"+i[l[0]]+"'";var s,d=l.length;if(d>1)for(s=1;s<d;s+=1)n+=" AND "+l[s]+" = '"+i[l[s]]+"'"}return ee.transaction(function(t){t.executeSql("SELECT "+a+" FROM "+e+n,[],function(e,t){var i=t.rows.length;if(i){var o,a=[];for(o=0;o<i;o+=1)a.push(t.rows.item(o));r.resolve(a)}else r.resolve(0)},function(e,t){0===Object.keys(e).length&&5===t.code&&r.resolve(0)})}),r.promise}function g(e,t,i){var o,r,a="",n=Object.keys(t),l=n.length,s=Object.keys(i),d=s.length,c="";if(l)for(o=0;o<l;o+=1)c+=o?", "+n[o]+" = '"+t[n[o]]+"'":n[o]+" = '"+t[n[o]]+"'";if(d&&(a=" WHERE ",a+=s[0]+" = '"+i[s[0]]+"'",d>1))for(r=1;r<d;r+=1)a+=" AND "+s[r]+" = '"+i[s[r]]+"'";ee.transaction(function(t){t.executeSql("UPDATE "+e+" SET "+c+a,[],function(){},function(){console.log("Something went wrong with updating "+e+" record")})})}function m(e,t){var i="";if(t){var o,r=Object.keys(t),a=r.length;if(i=" WHERE "+r[0]+" = '"+t[r[0]]+"'",a>1)for(o=1;o<a;o+=1)i+=" AND "+r[o]+" = '"+t[r[o]]+"'"}ee.transaction(function(t){t.executeSql("DELETE FROM "+e+i,[],null,function(){console.log("Something went wrong with insert into "+e)})})}function f(i,r,a,n){var l=t.defer(),s={model:n,orderId:a};return e.post(o.serverIP+"/api/remove-order-properties?login="+i+"&access_token="+r,s).then(function(e){l.resolve(e.data)},function(){l.resolve({status:0})}),l.promise}function _(i,r){var a=t.defer(),n=r?"/api/login?type=1":"/api/login";return e.post(o.serverIP+n,{login:i}).then(function(e){a.resolve(e.data)},function(){console.log("Something went wrong with User recive!"),a.resolve({status:0})}),a.promise}function h(i,r){var a=t.defer();return e.get(o.serverIP+"/api/get/locations?login="+i+"&access_token="+r).then(function(e){e.data.status?u(e.data).then(function(){a.resolve(1)}):(console.log("Error!"),a.resolve(0))},function(){console.log("Something went wrong with Location!"),a.resolve(0)}),a.promise}function y(i,r,a){var n=t.defer();return e.get(o.serverIP+"/api/get/factories-by-country?login="+i+"&access_token="+r+"&cities_ids="+a).then(function(e){n.resolve(e.data)},function(){console.log("Something went wrong with get factories!"),n.resolve({status:0})}),n.promise}function E(i,r){var a=t.defer();return e.get(o.serverIP+"/api/sync?login="+i+"&access_token="+r).then(function(e){e.data.status?u(e.data).then(function(){a.resolve(1)}):(console.log("Error!"),a.resolve(0))},function(){a.resolve(0)}),a.promise}function b(i,r,a,n){var l=t.defer(),s={model:a,row:JSON.stringify(n)};return e.post(o.serverIP+"/api/insert?login="+i+"&access_token="+r,s).then(function(e){l.resolve(e.data)},function(e){console.log("send changes to server failed"),l.resolve(e.data)}),l.promise}function v(i,r,a,n,l){var s=t.defer();n.id&&delete n.id,n.modified&&delete n.modified;var d={model:a,rowId:1*l,field:JSON.stringify(n)};return e.post(o.serverIP+"/api/update?login="+i+"&access_token="+r,d).then(function(e){s.resolve(1)},function(e){s.resolve(0)}),s.promise}function T(i,r,a){var n=a.map(function(a){var n=t.defer();return e.post(o.serverIP+"/api/update?login="+i+"&access_token="+r,a).then(function(e){n.resolve(1)},function(){n.resolve(0)}),n.promise});return t.all(n)}function I(t){e.post(o.serverIP+"/api/register",t).then(function(e){console.log(e)},function(){console.log("Something went wrong when user creating!")})}function S(t,i){var r=new Date;e.get(o.serverIP+"/api/signed?login="+t+"&access_token="+i+"&date="+r).then(function(){console.log("Sucsess!")},function(){console.log("Something went wrong!")})}function A(t,i,r){var a={orderId:+r};e.post(o.serverIP+"/api/remove-order?login="+t+"&access_token="+i,a).then(function(e){},function(){console.log("Something went wrong with order delete!")})}function L(e,i,o){var r=t.defer(),n=[{model:e,rowId:i,field:JSON.stringify(o)}];return g(e,o,{id:i}),T(a.userInfo.phone,a.userInfo.device_code,n).then(function(e){e||c(n,te["export"].tableName),r.resolve(1)}),r.promise}function D(i){var r=t.defer();e.post(o.serverIP+"/api/load-avatar",i,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(e){r.resolve(1)},function(){console.log("send changes to server failed"),r.resolve(0)})}function N(e){function t(e,t){return e<<t|e>>>32-t}function i(e,t){var i,o,r,a,n;return r=2147483648&e,a=2147483648&t,i=1073741824&e,o=1073741824&t,n=(1073741823&e)+(1073741823&t),i&o?2147483648^n^r^a:i|o?1073741824&n?3221225472^n^r^a:1073741824^n^r^a:n^r^a}function o(e,t,i){return e&t|~e&i}function r(e,t,i){return e&i|t&~i}function a(e,t,i){return e^t^i}function n(e,t,i){return t^(e|~i)}function l(e,r,a,n,l,s,d){return e=i(e,i(i(o(r,a,n),l),d)),i(t(e,s),r)}function s(e,o,a,n,l,s,d){return e=i(e,i(i(r(o,a,n),l),d)),i(t(e,s),o)}function d(e,o,r,n,l,s,d){return e=i(e,i(i(a(o,r,n),l),d)),i(t(e,s),o)}function c(e,o,r,a,l,s,d){return e=i(e,i(i(n(o,r,a),l),d)),i(t(e,s),o)}function u(e){for(var t,i=e.length,o=i+8,r=(o-o%64)/64,a=16*(r+1),n=Array(a-1),l=0,s=0;s<i;)t=(s-s%4)/4,l=s%4*8,n[t]=n[t]|e.charCodeAt(s)<<l,s+=1;return t=(s-s%4)/4,l=s%4*8,n[t]=n[t]|128<<l,n[a-2]=i<<3,n[a-1]=i>>>29,n}function p(e){var t,i,o="",r="";for(i=0;i<=3;i+=1)t=e>>>8*i&255,r="0"+t.toString(16),o+=r.substr(r.length-2,2);return o}function g(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i+=1){var o=e.charCodeAt(i);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t}var m,f,_,h,y,E,b,v,T,I=Array(),S=7,A=12,L=17,D=22,N=5,x=9,R=14,O=20,C=4,P=11,w=16,M=23,k=6,G=10,B=15,V=21;for(e=g(e),I=u(e),E=1732584193,b=4023233417,v=2562383102,T=271733878,m=0;m<I.length;m+=16)f=E,_=b,h=v,y=T,E=l(E,b,v,T,I[m+0],S,3614090360),T=l(T,E,b,v,I[m+1],A,3905402710),v=l(v,T,E,b,I[m+2],L,606105819),b=l(b,v,T,E,I[m+3],D,3250441966),E=l(E,b,v,T,I[m+4],S,4118548399),T=l(T,E,b,v,I[m+5],A,1200080426),v=l(v,T,E,b,I[m+6],L,2821735955),b=l(b,v,T,E,I[m+7],D,4249261313),E=l(E,b,v,T,I[m+8],S,1770035416),T=l(T,E,b,v,I[m+9],A,2336552879),v=l(v,T,E,b,I[m+10],L,4294925233),b=l(b,v,T,E,I[m+11],D,2304563134),E=l(E,b,v,T,I[m+12],S,1804603682),T=l(T,E,b,v,I[m+13],A,4254626195),v=l(v,T,E,b,I[m+14],L,2792965006),b=l(b,v,T,E,I[m+15],D,1236535329),E=s(E,b,v,T,I[m+1],N,4129170786),T=s(T,E,b,v,I[m+6],x,3225465664),v=s(v,T,E,b,I[m+11],R,643717713),b=s(b,v,T,E,I[m+0],O,3921069994),E=s(E,b,v,T,I[m+5],N,3593408605),T=s(T,E,b,v,I[m+10],x,38016083),v=s(v,T,E,b,I[m+15],R,3634488961),b=s(b,v,T,E,I[m+4],O,3889429448),E=s(E,b,v,T,I[m+9],N,568446438),T=s(T,E,b,v,I[m+14],x,3275163606),v=s(v,T,E,b,I[m+3],R,4107603335),b=s(b,v,T,E,I[m+8],O,1163531501),E=s(E,b,v,T,I[m+13],N,2850285829),T=s(T,E,b,v,I[m+2],x,4243563512),v=s(v,T,E,b,I[m+7],R,1735328473),b=s(b,v,T,E,I[m+12],O,2368359562),E=d(E,b,v,T,I[m+5],C,4294588738),T=d(T,E,b,v,I[m+8],P,2272392833),v=d(v,T,E,b,I[m+11],w,1839030562),b=d(b,v,T,E,I[m+14],M,4259657740),E=d(E,b,v,T,I[m+1],C,2763975236),T=d(T,E,b,v,I[m+4],P,1272893353),v=d(v,T,E,b,I[m+7],w,4139469664),b=d(b,v,T,E,I[m+10],M,3200236656),E=d(E,b,v,T,I[m+13],C,681279174),T=d(T,E,b,v,I[m+0],P,3936430074),v=d(v,T,E,b,I[m+3],w,3572445317),b=d(b,v,T,E,I[m+6],M,76029189),E=d(E,b,v,T,I[m+9],C,3654602809),T=d(T,E,b,v,I[m+12],P,3873151461),v=d(v,T,E,b,I[m+15],w,530742520),b=d(b,v,T,E,I[m+2],M,3299628645),E=c(E,b,v,T,I[m+0],k,4096336452),T=c(T,E,b,v,I[m+7],G,1126891415),v=c(v,T,E,b,I[m+14],B,2878612391),b=c(b,v,T,E,I[m+5],V,4237533241),E=c(E,b,v,T,I[m+12],k,1700485571),T=c(T,E,b,v,I[m+3],G,2399980690),v=c(v,T,E,b,I[m+10],B,4293915773),b=c(b,v,T,E,I[m+1],V,2240044497),E=c(E,b,v,T,I[m+8],k,1873313359),T=c(T,E,b,v,I[m+15],G,4264355552),v=c(v,T,E,b,I[m+6],B,2734768916),b=c(b,v,T,E,I[m+13],V,1309151649),E=c(E,b,v,T,I[m+4],k,4149444226),T=c(T,E,b,v,I[m+11],G,3174756917),v=c(v,T,E,b,I[m+2],B,718787259),b=c(b,v,T,E,I[m+9],V,3951481745),E=i(E,f),b=i(b,_),v=i(v,h),T=i(T,y);var H=p(E)+p(b)+p(v)+p(T);return H.toLowerCase()}function x(e,i,o){var r=t.defer();return p(te.window_hardwares.tableName,{window_hardware_group_id:e}).then(function(e){var t,a,n,l,s,d,c=e.length,u=[],p=i.length;if(c){for(s=0;s<p;s+=1){for(t=angular.copy(e),a=[],n=[],l=i[s].openDir.length,d=0;d<l;d+=1)4===i[s].openDir[d]?i[s].openDir[d]=2:2===i[s].openDir[d]?i[s].openDir[d]=3:i[s].openDir[d]=1;a=t.filter(function(e){if(e.window_hardware_type_id==i[s].type&&(e.window_hardware_color_id==o||!e.window_hardware_color_id)){if(1==l)return e.direction_id==i[s].openDir[0]||1==e.direction_id;if(2==l)return e.direction_id==i[s].openDir[0]||e.direction_id==i[s].openDir[1]||1==e.direction_id}}),n=a.filter(function(e){if(e.min_width&&e.max_width&&!e.min_height&&!e.max_height){if(i[s].sizes[0]>=e.min_width&&i[s].sizes[0]<=e.max_width)return e}else if(!e.min_width&&!e.max_width&&e.min_height&&e.max_height){if(i[s].sizes[1]>=e.min_height&&i[s].sizes[1]<=e.max_height)return e}else if(e.min_width&&e.max_width&&e.min_height&&e.max_height){if(i[s].sizes[1]>=e.min_height&&i[s].sizes[1]<=e.max_height&&i[s].sizes[0]>=e.min_width&&i[s].sizes[0]<=e.max_width)return e}else if(!(e.min_width||e.max_width||e.min_height||e.max_height))return e}),u.push(n)}u.length?r.resolve(u):r.resolve(0)}else r.resolve(0)}),r.promise}function R(e){var i=t.defer(),o=e.sizes.map(function(i,o,r){var a=t.defer();if(i.length&&e.ids[o])if(o===r.length-1)x(e.ids[o],i,e.laminationId).then(function(e){e.length?a.resolve(e):a.resolve(0)});else if(angular.isArray(e.ids[o])){var n=e.ids[o].map(function(e){var i=t.defer();return p(te.lists.tableName,{id:e},"id, parent_element_id, name, waste, amendment_pruning").then(function(e){e.length?i.resolve(e):i.resolve(0)}),i.promise});t.all(n).then(function(e){var t,i=angular.copy(e),o=i.length,r=[];for(t=0;t<o;t+=1)i[t]&&(i[t][0].amendment_pruning&&(i[t][0].amendment_pruning/=1e3),r.push(i[t][0]));r.length>1?a.resolve(r):1===r.length?a.resolve(r[0]):a.resolve(0)})}else p(te.lists.tableName,{id:e.ids[o]},"id, parent_element_id, name, waste, amendment_pruning").then(function(e){var t=angular.copy(e);t&&t.length?(t[0].amendment_pruning&&(t[0].amendment_pruning/=1e3),a.resolve(t[0])):a.resolve(0)});else a.resolve(0);return a.promise});return i.resolve(t.all(o)),i.promise}function O(e){var i=t.defer();return p(te.lists.tableName,{id:e},"parent_element_id, name, waste, amendment_pruning").then(function(e){var t=angular.copy(e);t&&t.length?(t[0].amendment_pruning&&(t[0].amendment_pruning/=1e3),i.resolve(t[0])):i.resolve(0)}),i.promise}function C(e){var i=t.defer(),o=[],r=[];return angular.isArray(e)?o=e:o.push(e),function a(){if(o.length){var e=o.shift(0),t=0;t="object"==typeof e?e.childId:e,p(te.list_contents.tableName,{parent_list_id:t}).then(function(t){var i,n=t.length;if(n)for(i=0;i<n;i+=1)if("object"==typeof e&&(t[i].parentId=e.parentId),r.push(t[i]),"list"===t[i].child_type){var l={childId:t[i].child_id,parentId:t[i].id};o.push(l)}a()})}else r.length?i.resolve(r):i.resolve(0)}(),i.promise}function P(e){var t,i,o=[],r=[0,1,3,4,5,8],a=r.length,n=e.length;for(i=0;i<n;i+=1)e:for(t=0;t<a;t+=1)if(e[i].lamination_type_id===r[t]){o.push(e[i]);break e}return o}function w(e){var i=t.defer(),o=e.map(function(e,i,o){var r=t.defer();if(e)if(angular.isArray(e)){var a=e.map(function(e){var r=t.defer();if(i===o.length-1){if(angular.isArray(e)){var a=e.map(function(e){var i=t.defer();return C(e.child_id).then(function(e){e.length?i.resolve(P(e)):i.resolve(0)}),i.promise});r.resolve(t.all(a))}}else C(e.id).then(function(e){e.length?r.resolve(e):r.resolve(0)});return r.promise});t.all(a).then(function(e){var t,i=e.length,o=[];if(i)for(t=0;t<i;t+=1)angular.isArray(e[t])?o.push(e[t]):e[t][0]?o.push(e[t][0]):o.push(e[t]);o.length?r.resolve(o):r.resolve(0)})}else{var n=0;n=i===o.length-1?e.child_id:e.id,n?C(n).then(function(e){e.length?r.resolve(e):r.resolve(0);
}):r.resolve(0)}else r.resolve(0);return r.promise});return i.resolve(t.all(o)),i.promise}function M(e,i){var o=t.defer();return p(te.elements.tableName,{id:i},"id, sku, currency_id, price, name, element_group_id").then(function(t){t.length?e?o.resolve(t):o.resolve(t[0]):o.resolve(0)}),o.promise}function k(e){var i=t.defer(),o=e.map(function(e,i,o){var r=t.defer();if(e)if(angular.isArray(e)){var a=e.map(function(e){var r=t.defer();if(i===o.length-1){if(angular.isArray(e)){var a=e.map(function(e){var i=t.defer();return"element"===e.child_type?i.resolve(M(1,e.child_id)):O(e.child_id).then(function(t){angular.extend(e,t),i.resolve(M(1,t.parent_element_id))}),i.promise});r.resolve(t.all(a))}}else r.resolve(M(0,e.parent_element_id));return r.promise});t.all(a).then(function(e){var t,o=e.length,a=[];if(o)if(5===i||6===i)a=e;else for(t=0;t<o;t+=1)if(e[t])if(angular.isArray(e[t])){var n,l=[],s=e[t].length;for(n=0;n<s;n+=1)e[t][n]&&l.push(e[t][n][0]);a.push(l)}else a.push(e[t][0]);a.length?r.resolve(a):r.resolve(0)})}else i===o.length-1?"element"===e.child_type?r.resolve(M(0,e.child_id)):O(e.child_id).then(function(t){angular.extend(e,t),r.resolve(M(0,t.parent_element_id))}):r.resolve(M(0,e.parent_element_id));else r.resolve(0);return r.promise});return i.resolve(t.all(o)),i.promise}function G(e){var i=t.defer();if(e.length){var o=e.map(function(e){var i=t.defer();if(e&&e.length){var o=e.map(function(e){var i=t.defer();if(angular.isArray(e)){var o=e.map(function(e){var i=t.defer();if(e)if(angular.isArray(e)){var o=e.map(function(e){var i=t.defer();return e?"element"===e.child_type?i.resolve(M(0,e.child_id)):O(e.child_id).then(function(t){angular.extend(e,t),i.resolve(M(0,t.parent_element_id))}):i.resolve(0),i.promise});i.resolve(t.all(o))}else"element"===e.child_type?i.resolve(M(0,e.child_id)):O(e.child_id).then(function(t){angular.extend(e,t),i.resolve(M(0,t.parent_element_id))});else i.resolve(0);return i.promise});i.resolve(t.all(o))}else e?"element"===e.child_type?i.resolve(M(0,e.child_id)):O(e.child_id).then(function(t){angular.extend(e,t),i.resolve(M(0,t.parent_element_id))}):i.resolve(0);return i.promise});i.resolve(t.all(o))}else i.resolve(0);return i.promise});i.resolve(t.all(o))}else i.resolve(0);return i.promise}function B(e,t){var i,o,r,l=n.global.currencies.length;if(l)for(i=0;i<l;i+=1)n.global.currencies[i].id===a.userInfo.currencyId&&(o=i),n.global.currencies[i].id===t&&(r=i);return n.global.currencies[o]&&n.global.currencies[r]&&(e*=n.global.currencies[r].value),e}function V(e,t,o,n,l,s,d){var c,u=0,p=0,g=0,m=1,f={},_=t.waste?1+t.waste/100:1;if(6===e){for(c=0;c<l;c+=1)if(n[c].elemId===t.id)for(var h=n[c].sizes.length;--h>-1;)f=angular.copy(o),p=n[c].sizes[h]+t.amendment_pruning,u=p*f.price*_,a.userInfo.currencyId!=f.currency_id&&(u=B(u,f.currency_id)),f.qty=angular.copy(m),f.size=r.roundingValue(p,3),f.priceReal=r.roundingValue(u,3),s.priceTotal+=u,d.push(f)}else for(var y=0;y<l;y+=1){if(f=angular.copy(o),5===e){var E=0;n[y].elemId===t.id&&(p=n[y].square,g=r.roundingValue(n[y].square,3)+" "+i("translate")("common_words.LETTER_M")+"2 ("+n[y].sizes[0]+" x "+n[y].sizes[1]+")",u=p*f.price*_,E+=1)}else 7===e?(m=t.count,u=m*f.price*_):(p=n[y]+t.amendment_pruning,u=p*f.price*_);(5===e&&E||5!==e)&&(a.userInfo.currencyId!=f.currency_id&&(u=B(u,f.currency_id)),f.qty=angular.copy(m),f.size=r.roundingValue(p,3),f.sizeLabel=g,f.priceReal=r.roundingValue(u,3),s.priceTotal+=u,d.push(f))}}function H(e,t){var i,o=e.kitsElem.length,r=0,a=[];for(e.priceTotal=0,i=0;i<o;i+=1)if(e.kitsElem[i])if(r=t[i].length,angular.isArray(e.kitsElem[i])){var n,l=e.kitsElem[i].length;for(n=0;n<l;n+=1)if(angular.isArray(e.kitsElem[i][n])){var s,d=e.kitsElem[i][n].length;for(s=0;s<d;s+=1)V(i,e.kits[i][n][s],e.kitsElem[i][n][s],t[i][n],1,e,a)}else V(i,e.kits[i][n],e.kitsElem[i][n],t[i],r,e,a)}else V(i,e.kits[i],e.kitsElem[i],t[i],r,e,a);return a}function U(e,t,i){if(1==e.direction_id)return 1;var o,r=0;for(o=0;o<i;o+=1)t[o]===e.direction_id&&(r+=1);return r}function F(e,t,i){var o=0;switch(i){case 1:case 21:case 22:o=r.roundingValue(e-t,3);break;case 2:case 5:var a=e<1?1:parseInt(e);o=a*t;break;case 3:case 12:case 14:o=r.roundingValue(Math.round(e)*t,3);break;case 6:case 7:case 8:case 9:case 13:case 23:o=r.roundingValue(e*t,3);break;default:o=t}return o}function z(e,t,i){var o=0;switch(i){case 1:o=r.roundingValue(e-t,3);break;case 2:case 5:var a=e<1?1:parseInt(e);o=a*t;break;case 3:o=e;break;default:o=t}return o}function Y(e,t,i,o,n,l,s,d){if(o){var c=angular.copy(o),u=0,p=0,g=1;switch(9===c.element_group_id&&(p=t),i.rules_type_id){case 1:case 21:case 22:p=r.roundingValue(t+n-i.value,3);break;case 3:g=(t+n)*i.value;break;case 5:g=i.value;break;case 6:case 23:g=(t+n)*i.value;break;case 2:case 4:case 15:g=e*i.value;break;default:p=r.roundingValue(t+n,3)}u=p?p*g*o.price*l:g*o.price*l,a.userInfo.currencyId!=o.currency_id&&(u=B(u,o.currency_id)),c.priceReal=u,c.size=r.roundingValue(p,3),c.sizeLabel=d,c.qty=g,s.constrElements.push(c),s.priceTotal+=c.priceReal}}function $(e,t,o,a,n,l,s){if(a.parent_list_id===o.id){var d=1,c=1,u=0,p=o.waste?1+o.waste/100:1;5===e?5===a.rules_type_id?(d=t.square,c=t.square,u=r.roundingValue(t.square,3)+" "+i("translate")("common_words.LETTER_M")+"2 ("+t.sizes[0]+" x "+t.sizes[1]+")"):21===a.rules_type_id?(d=t.sizes[0],c=t.sizes[0]):22===a.rules_type_id?(d=t.sizes[1],c=t.sizes[1]):c=t.square:(d=r.roundingValue(t+o.amendment_pruning,3),c=t),"list"===a.child_type&&(a.newValue=F(d,a.value,a.rules_type_id)),Y(1,c,a,n,o.amendment_pruning,p,s,u)}else{var g,m=l.length;for(g=0;g<m;g+=1)if(a.parent_list_id===l[g].child_id&&a.parentId===l[g].id){var p=l[g].waste?1+l[g].waste/100:1,f=1;"list"===a.child_type&&(a.newValue=F(l[g].newValue,a.value,a.rules_type_id)),2===l[g].rules_type_id&&(2!==a.rules_type_id&&4!==a.rules_type_id&&15!==a.rules_type_id||(f=l[g].newValue)),Y(f,l[g].newValue,a,n,l[g].amendment_pruning,p,s)}}}function W(e,t,i,o,n,l){if(e===l.consist.length-1){if(angular.isArray(i)){var s,d=i.length,c=o.openDir.length;for(s=0;s<d;s+=1)if(angular.isArray(i[s])){var u,p=i[s].length;e:for(u=0;u<p;u+=1)if(U(t[s][u],o.openDir,c)){var g=angular.copy(i[s][u]),m=0,f=1;if(t[s][u].parent_list_id===n[s].child_id)f=n[s].waste?1+n[s].waste/100:1,g.qty=F(n[s].count,t[s][u].value,t[s][u].rules_type_id),"list"===t[s][u].child_type&&(t[s][u].newValue=angular.copy(g.qty));else for(var _=0;_<p;_+=1)if(t[s][u].parent_list_id===t[s][_].child_id&&t[s][u].parentId===t[s][_].id){if(!U(t[s][_],o.openDir,c))continue e;f=t[s][_].waste?1+t[s][_].waste/100:1,g.qty=F(t[s][_].newValue,t[s][u].value,t[s][u].rules_type_id),"list"===t[s][u].child_type&&(t[s][u].newValue=angular.copy(g.qty))}m=g.qty*i[s][u].price*f,m&&(a.userInfo.currencyId!=i[s][u].currency_id&&(m=B(m,i[s][u].currency_id)),g.priceReal=r.roundingValue(m,3),g.size=0,l.constrElements.push(g),l.priceTotal+=g.priceReal)}}}}else if(angular.isArray(i)){var h,y=i.length;for(h=0;h<y;h+=1)if(6===e)for(var E=o.sizes.length;--E>-1;)$(e,o.sizes[E],n,t[h],i[h],t,l);else $(e,o,n,t[h],i[h],t,l)}else if(6===e)for(var E=o.sizes.length;--E>-1;)$(e,o.sizes[E],n,t,i,l.consist[e],l);else $(e,o,n,t,i,l.consist[e],l)}function q(e,t){var i,o=e.consist.length;for(i=0;i<o;i+=1)if(e.consist[i]){var r=t.sizes[i].length,a=e.consist[i].length;if(a)if(angular.isArray(e.kits[i]))for(var n=0;n<a;n+=1)if(5===i||6===i)for(var l=t.sizes[i].length,s=0;s<l;s+=1)t.sizes[i][s].elemId===e.kits[i][n].id&&e.consistElem[i][n]&&W(i,e.consist[i][n],e.consistElem[i][n],t.sizes[i][s],e.kits[i][n],e);else e.consistElem[i][n]&&W(i,e.consist[i][n],e.consistElem[i][n],t.sizes[i][n],e.kits[i][n],e);else for(var s=0;s<r;s+=1)for(var n=0;n<a;n+=1)e.consistElem[i][n]&&W(i,e.consist[i][n],e.consistElem[i][n],t.sizes[i][s],e.kits[i],e)}}function j(e){var i=t.defer(),o={},a={};return R(e).then(function(t){o.kits=t,w(o.kits).then(function(t){o.consist=t,k(o.kits).then(function(t){o.kitsElem=t,G(o.consist).then(function(t){o.consistElem=t,o.constrElements=H(o,e.sizes),q(o,e),o.priceTotal=r.roundingValue(o.priceTotal),a.constrElements=angular.copy(o.constrElements),a.priceTotal=isNaN(o.priceTotal)?0:angular.copy(o.priceTotal),i.resolve(a)})})})}),i.promise}function Q(e,t,i){var o=angular.copy(t);a.userInfo.currencyId!=o.currency_id&&(o.price=r.roundingValue(B(o.price,o.currency_id),3)),t.count?o.qty=t.count:o.qty=i?i.value:1,o.size=0,o.priceReal=r.roundingValue(o.price*o.qty,3),e.priceTot+=o.priceReal,e.elements.push(o)}function K(e,i){var o=t.defer(),a={priceTot:0,elements:[]},n=i.filter(function(e){return e.child_id=e.parent_element_id,e.child_type=e.position,e.value=e.count,"list"===e.position}),l=i.filter(function(e){return e.child_id=e.parent_element_id,e.child_type=e.position,e.value=e.count,"element"===e.position});return M(0,e.parent_element_id).then(function(t){t.count=e.count,Q(a,t),function i(){if(n.length){var e=n.shift(0),t=0;t=e;var s={};p(te.lists.tableName,{id:t.parent_element_id}).then(function(e){var o=[];C(t.parent_element_id).then(function(r){function l(e,i){async.waterfall([function(i){"list"===e.child_type?(n.push(e),i()):(M(0,e.parent_element_id).then(function(e){t.count?s.value=t.count:s.value=t.value,Q(a,e,s)}),i())}],function(e,t){return e?i(e):void i(null)})}if(0!==r){o=angular.copy(r);for(var d=0;d<o.length;d+=1)o[d].parent_element_id=o[d].child_id;o=o.filter(function(e){if(1==e.direction_id||e.direction_id==t.openDir)return e})}e=e.concat(o);var c=e;async.eachSeries(c,l,function(e,t){i()})})})}else a.consist=l,G([a.consist]).then(function(e){a.consistElem=e[0];for(var t=a.consist.length;--t>-1;)Q(a,a.consistElem[t],a.consist[t]);a.priceTot=isNaN(a.priceTot)?0:r.roundingValue(a.priceTot),o.resolve(a)})}()}),o.promise}function X(e){0===e.elementWidth&&0===e.elementHeight&&(e.elementWidth=1);var i=t.defer(),o={},n={constrElements:[],priceTotal:0};return C(angular.copy(e.elementId)).then(function(t){n.consist=angular.copy(t),O(e.elementId).then(function(t){t?(n.kits=angular.copy(t),M(0,n.kits.parent_element_id).then(function(t){n.kitsElem=angular.copy(t),G([n.consist]).then(function(t){if(n.consistElem=angular.copy(t[0]),e.elementWidth>0){var l=0,s=0;e.elementHeight?(l=r.roundingValue(e.elementWidth*e.elementHeight,3),s=r.roundingValue((e.elementWidth+n.kits.amendment_pruning)*(e.elementHeight+n.kits.amendment_pruning),3)):(l=e.elementWidth,s=e.elementWidth+n.kits.amendment_pruning);var d=n.kits.waste?1+n.kits.waste/100:1,c=angular.copy(n.kitsElem),u=r.roundingValue(s*c.price*d);if(a.userInfo.currencyId!=c.currency_id&&(u=B(u,c.currency_id)),c.qty=1,c.size=s,c.priceReal=u,n.priceTotal+=u,n.constrElements.push(c),n.consistElem){var p=n.consist.length;if(p)for(var g=0;g<p;g++)if(n.consist[g])if(n.consist[g].parent_list_id===e.elementId)"list"===n.consist[g].child_type&&(n.consist[g].newValue=F(s,n.consist[g].value,n.consist[g].rules_type_id)),Y(1,l,n.consist[g],n.consistElem[g],n.kits.amendment_pruning,d,n);else for(var m=0;m<p;m++)n.consist[g].parent_list_id===n.consist[m].child_id&&n.consist[g].parentId===n.consist[m].id&&(d=n.consist[m].waste?1+n.consist[m].waste/100:1,"list"===n.consist[g].child_type&&(n.consist[g].newValue=F(n.consist[m].newValue,n.consist[g].value,n.consist[g].rules_type_id)),Y(n.consist[g].newValue,n.consist[m].newValue,n.consist[g],n.consistElem[g],n.consist[m].amendment_pruning,d,n))}}n.priceTotal=r.roundingValue(n.priceTotal),o.constrElements=angular.copy(n.constrElements),o.priceTotal=angular.copy(n.priceTotal),i.resolve(o)})})):i.resolve(n)})}),i.promise}function Z(e){var i=t.defer(),o=angular.copy(e.element),n={},l={constrElements:[],priceTotal:0};return o.element_width/=1e3,o.element_height/=1e3,t.all([O(o.cloth_id),O(o.top_id)]).then(function(e){var s=angular.copy(e[1]);l.kits=angular.copy(e),l.kits.push(s,s,s),t.all([M(0,e[0].parent_element_id),M(0,e[1].parent_element_id)]).then(function(e){var t,i,n,s,d,c,u=[o.cloth_waste,o.top_waste,o.right_waste,o.bottom_waste,o.left_waste],p=u.length;for(l.kitsElem=angular.copy(e),l.kitsElem.push(angular.copy(e[1]),angular.copy(e[1]),angular.copy(e[1])),t=0;t<p;t+=1)d=l.kits[t].waste?1+l.kits[t].waste/100:1,l.kitsElem[t]&&(i=o.element_width+l.kits[t].amendment_pruning-u[t]/1e3,n=o.element_height+l.kits[t].amendment_pruning-u[t]/1e3,s=1===t||3===t?r.roundingValue(i,3):2===t||4===t?r.roundingValue(n,3):r.roundingValue(i*n,3),c=r.roundingValue(s*l.kitsElem[t].price*d),a.userInfo.currencyId!=l.kitsElem[t].currency_id&&(c=r.roundingValue(B(c,l.kitsElem[t].currency_id))),l.kitsElem[t].qty=1,l.kitsElem[t].size=s,l.kitsElem[t].priceReal=c,l.priceTotal+=c,l.constrElements.push(l.kitsElem[t]))}),t.all([C(o.top_id),C(o.right_id),C(o.bottom_id),C(o.left_id)]).then(function(e){l.consist=angular.copy(e),G(l.consist).then(function(e){var t,o,a,s,d,c;if(l.consistElem=angular.copy(e),l.consistElem&&(t=l.consist.length))for(a=0;a<t;a+=1)if(o=l.consist[a].length)for(d=1,c=l.kitsElem[a+1].size,s=0;s<o;s+=1)l.consist[a][s].newValue=z(c,l.consist[a][s].value,l.consist[a][s].rules_type_id),Y(1,l.consist[a][s].newValue,l.consist[a][s],l.consistElem[a][s],0,d,l);l.priceTotal=r.roundingValue(l.priceTotal),n.constrElements=angular.copy(l.constrElements),n.priceTotal=angular.copy(l.priceTotal),i.resolve(n)})})}),i.promise}var J=this,ee=openDatabase("bauvoice","1.0","bauvoice",5e6),te={addition_folders:{tableName:"addition_folders",prop:"name VARCHAR(255), addition_type_id INTEGER, is_push INTEGER, factory_id INTEGER, position INTEGER, img VARCHAR, description VARCHAR, link VARCHAR, max_size INTEGER",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id), FOREIGN KEY(addition_type_id) REFERENCES addition_types(id)"},cities:{tableName:"cities",prop:"region_id INTEGER, name VARCHAR(255), transport VARCHAR(2), lat NUMERIC, long NUMERIC, is_capital INTEGER, code_sync INTEGER, name_sync VARCHAR(255), area_id INTEGER",foreignKey:", FOREIGN KEY(region_id) REFERENCES regions(id)"},countries:{tableName:"countries",prop:"name VARCHAR(255), currency_id INTEGER",foreignKey:", FOREIGN KEY(currency_id) REFERENCES currencies(id)"},currencies:{tableName:"currencies",prop:"name VARCHAR(100), value NUMERIC(10, 2), factory_id INTEGER, is_base INTEGER",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id)"},directions:{tableName:"directions",prop:"name VARCHAR(255)",foreignKey:""},elements_groups:{tableName:"elements_groups",prop:"name VARCHAR(255), base_unit INTEGER, position INTEGER",foreignKey:""},beed_profile_systems:{tableName:"beed_profile_systems",prop:"profile_system_id INTEGER, list_id INTEGER, glass_width INTEGER",foreignKey:", FOREIGN KEY(list_id) REFERENCES lists(id)"},glass_folders:{tableName:"glass_folders",prop:"name VARCHAR(255), img VARCHAR, is_push INTEGER, position INTEGER, factory_id INTEGER, description VARCHAR, link VARCHAR, is_base INTEGER",foreignKey:""},glass_prices:{tableName:"glass_prices",prop:"element_id INTEGER, col_1_range NUMERIC(10, 2), col_1_price NUMERIC(10, 2), col_2_range_1 NUMERIC(10, 2), col_2_range_2 NUMERIC(10, 2), col_2_price NUMERIC(10, 2), col_3_range_1 NUMERIC(10, 2), col_3_range_2 NUMERIC(10, 2), col_3_price NUMERIC(10, 2), col_4_range_1 NUMERIC(10, 2), col_4_range_2 NUMERIC(10, 2), col_4_price NUMERIC(10, 2), col_5_range NUMERIC(10, 2), col_5_price NUMERIC(10, 2), table_width INTEGER",foreignKey:""},lamination_factory_colors:{tableName:"lamination_factory_colors",prop:"name VARCHAR(255), lamination_type_id INTEGER, factory_id INTEGER",foreignKey:", FOREIGN KEY(lamination_type_id) REFERENCES lamination_default_colors(id), FOREIGN KEY(factory_id) REFERENCES factories(id)"},lamination_types:{tableName:"lamination_types",prop:"name VARCHAR(255)",foreignKey:""},lists_groups:{tableName:"lists_groups",prop:"name VARCHAR(255)",foreignKey:""},lists_types:{tableName:"lists_types",prop:"name VARCHAR(255), image_add_param VARCHAR(100)",foreignKey:""},options_coefficients:{tableName:"options_coefficients",prop:"rentability_percent INTEGER, rentability_hrn_m INTEGER, rentability_hrn INTEGER, others_percent INTEGER, others_hrn_m INTEGER, others_hrn INTEGER, transport_cost_percent INTEGER, transport_cost_hrn_m INTEGER, transport_cost_hrn INTEGER, salary_manager_percent INTEGER, salary_manager_hrn_m INTEGER, salary_manager_hrn INTEGER, rent_offices_percent INTEGER, rent_offices_hrn_m INTEGER, rent_offices_hrn INTEGER, salary_itr_percent INTEGER, salary_itr_hrn_m INTEGER, salary_itr_hrn INTEGER, rent_production_percent INTEGER, rent_production_hrn_m INTEGER, rent_production_hrn INTEGER, salary_glass_percent INTEGER, salary_glass_hrn_m INTEGER, salary_glass_hrn INTEGER, salary_assembly_percent INTEGER, salary_assembly_hrn_m INTEGER, salary_assembly_hrn INTEGER, estimated_cost INTEGER, factory_id INTEGER, plan_production INTEGER, margin NUMERIC(10, 2), coeff NUMERIC(10, 2)",foreignKey:""},options_discounts:{tableName:"options_discounts",prop:"factory_id INTEGER, min_time INTEGER, standart_time INTEGER, base_time INTEGER, week_1 INTEGER, week_2 INTEGER, week_3 INTEGER, week_4 INTEGER, week_5 INTEGER, week_6 INTEGER, week_7 INTEGER, week_8 INTEGER, percents ARRAY",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id)"},elements:{tableName:"elements",prop:"heat_coeff INTEGER, name VARCHAR(255), element_group_id INTEGER, currency_id INTEGER, supplier_id INTEGER, margin_id INTEGER, waste NUMERIC(10, 2), is_optimized INTEGER, is_virtual INTEGER, is_additional INTEGER, weight_accounting_unit NUMERIC(10, 3), glass_folder_id INTEGER, min_width NUMERIC, min_height NUMERIC, max_width NUMERIC, max_height NUMERIC, max_sq NUMERIC, transcalency NUMERIC(10, 2), glass_width INTEGER, factory_id INTEGER, price NUMERIC(10, 2), amendment_pruning NUMERIC(10, 2), noise_coeff NUMERIC, sku VARCHAR(100), lamination_in_id INTEGER, lamination_out_id INTEGER, reg_coeff NUMERIC",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id), FOREIGN KEY(glass_folder_id) REFERENCES glass_folders(id), FOREIGN KEY(margin_id) REFERENCES margin_types(id), FOREIGN KEY(supplier_id) REFERENCES suppliers(id), FOREIGN KEY(currency_id) REFERENCES currencies(id), FOREIGN KEY(element_group_id) REFERENCES elements_groups(id)"},profile_system_folders:{tableName:"profile_system_folders",prop:"name VARCHAR(255), factory_id INTEGER, position INTEGER, link VARCHAR, description VARCHAR, img VARCHAR",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id)"},profile_systems:{tableName:"profile_systems",prop:"name VARCHAR(255), short_name VARCHAR(100), folder_id INTEGER, rama_list_id INTEGER, rama_still_list_id INTEGER, stvorka_list_id INTEGER, impost_list_id INTEGER, shtulp_list_id INTEGER, is_editable INTEGER, is_default INTEGER, position INTEGER, country VARCHAR(100), cameras INTEGER, heat_coeff INTEGER, noise_coeff INTEGER, heat_coeff_value NUMERIC(5,2), link VARCHAR, description VARCHAR, img VARCHAR, is_push INTEGER",foreignKey:""},profile_laminations:{tableName:"profile_laminations",prop:"profile_id INTEGER, lamination_in_id INTEGER, lamination_out_id INTEGER, rama_list_id INTEGER, rama_still_list_id INTEGER, stvorka_list_id INTEGER, impost_list_id INTEGER, shtulp_list_id INTEGER, code_sync VARCHAR",foreignKey:""},rules_types:{tableName:"rules_types",prop:"name VARCHAR(255), parent_unit INTEGER, child_unit INTEGER, suffix VARCHAR(15)",foreignKey:""},regions:{tableName:"regions",prop:"name VARCHAR(255), country_id INTEGER, heat_transfer NUMERIC(10, 2), climatic_zone NUMERIC",foreignKey:", FOREIGN KEY(country_id) REFERENCES countries(id)"},users:{tableName:"users",prop:" email VARCHAR(255), password VARCHAR(255), factory_id INTEGER, name VARCHAR(255), phone VARCHAR(100), locked INTEGER, user_type INTEGER, city_phone VARCHAR(100), city_id INTEGER, fax VARCHAR(100), avatar VARCHAR(255), birthday DATE, sex VARCHAR(100), mount_mon NUMERIC(5,2), mount_tue NUMERIC(5,2), mount_wed NUMERIC(5,2), mount_thu NUMERIC(5,2), mount_fri NUMERIC(5,2), mount_sat NUMERIC(5,2), mount_sun NUMERIC(5,2), device_code VARCHAR(250), last_sync TIMESTAMP, address VARCHAR, therm_coeff_id INTEGER, factoryLink VARCHAR, code_sync VARCHAR",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id), FOREIGN KEY(city_id) REFERENCES cities(id)"},users_discounts:{tableName:"users_discounts",prop:"user_id INTEGER, max_construct NUMERIC(5,1), max_add_elem NUMERIC(5,1), default_construct NUMERIC(5,1), default_add_elem NUMERIC(5,1), week_1_construct NUMERIC(5,1), week_1_add_elem NUMERIC(5,1), week_2_construct NUMERIC(5,1), week_2_add_elem NUMERIC(5,1), week_3_construct NUMERIC(5,1), week_3_add_elem NUMERIC(5,1), week_4_construct NUMERIC(5,1), week_4_add_elem NUMERIC(5,1), week_5_construct NUMERIC(5,1), week_5_add_elem NUMERIC(5,1), week_6_construct NUMERIC(5,1), week_6_add_elem NUMERIC(5,1), week_7_construct NUMERIC(5,1), week_7_add_elem NUMERIC(5,1), week_8_construct NUMERIC(5,1), week_8_add_elem NUMERIC(5,1)",foreignKey:""},users_deliveries:{tableName:"users_deliveries",prop:"user_id INTEGER, active INTEGER, name VARCHAR, type INTEGER, price NUMERIC(6,1)",foreignKey:""},users_mountings:{tableName:"users_mountings",prop:"user_id INTEGER, active INTEGER, name VARCHAR, type INTEGER, price NUMERIC(6,1)",foreignKey:""},lists:{tableName:"lists",prop:"name VARCHAR(255), list_group_id INTEGER, list_type_id INTEGER, a NUMERIC(10, 2), b NUMERIC(10, 2), c NUMERIC(10, 2), d NUMERIC(10, 2), parent_element_id INTEGER, position NUMERIC, add_color_id INTEGER, addition_folder_id INTEGER, amendment_pruning NUMERIC(10, 2), waste NUMERIC(10, 2), cameras INTEGER, link VARCHAR, description VARCHAR, img VARCHAR, beed_lamination_id INTEGER, in_door INTEGER, is_push INTEGER, doorstep_type INTEGER, glass_type INTEGER, glass_image INTEGER, glass_color INTEGER",foreignKey:", FOREIGN KEY(parent_element_id) REFERENCES elements(id), FOREIGN KEY(parent_element_id) REFERENCES elements(id), FOREIGN KEY(list_group_id) REFERENCES lists_groups(id), FOREIGN KEY(add_color_id) REFERENCES addition_colors(id)"},list_contents:{tableName:"list_contents",prop:"parent_list_id INTEGER, child_id INTEGER, child_type VARCHAR(255), value NUMERIC(10, 7), rules_type_id INTEGER, direction_id INTEGER, window_hardware_color_id INTEGER, lamination_type_id INTEGER",foreignKey:", FOREIGN KEY(parent_list_id) REFERENCES lists(id), FOREIGN KEY(rules_type_id) REFERENCES rules_types(id), FOREIGN KEY(direction_id) REFERENCES directions(id), FOREIGN KEY(lamination_type_id) REFERENCES lamination_types(id), FOREIGN KEY(window_hardware_color_id) REFERENCES window_hardware_colors(id)"},window_hardware_types:{tableName:"window_hardware_types",prop:"name VARCHAR(255), short_name VARCHAR(100)",foreignKey:""},window_hardware_folders:{tableName:"window_hardware_folders",prop:"name VARCHAR, factory_id INTEGER, link VARCHAR, description VARCHAR, img VARCHAR",foreignKey:""},window_hardware_groups:{tableName:"window_hardware_groups",prop:"name VARCHAR(255), short_name VARCHAR(100), folder_id INTEGER, is_editable INTEGER, is_group INTEGER, is_in_calculation INTEGER, is_default INTEGER, position INTEGER, producer VARCHAR(255), country VARCHAR(255), noise_coeff INTEGER, heat_coeff INTEGER, min_height INTEGER, max_height INTEGER, min_width INTEGER, max_width INTEGER, is_push INTEGER, link VARCHAR, description VARCHAR, img VARCHAR",foreignKey:""},window_hardwares:{tableName:"window_hardwares",prop:"window_hardware_type_id INTEGER, min_width INTEGER, max_width INTEGER, min_height INTEGER, max_height INTEGER, direction_id INTEGER, window_hardware_color_id INTEGER, length INTEGER, count INTEGER, child_id INTEGER, child_type VARCHAR(100), position INTEGER, factory_id INTEGER, window_hardware_group_id INTEGER",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id), FOREIGN KEY(window_hardware_type_id) REFERENCES window_hardware_types(id), FOREIGN KEY(direction_id) REFERENCES directions(id), FOREIGN KEY(window_hardware_group_id) REFERENCES window_hardware_groups(id), FOREIGN KEY(window_hardware_color_id) REFERENCES window_hardware_colors(id)"},window_hardware_colors:{tableName:"window_hardware_colors",prop:"name VARCHAR(255)",foreignKey:""},window_hardware_handles:{tableName:"window_hardware_handles",prop:"element_id INTEGER, location VARCHAR(255), constant_value NUMERIC(10, 2)",foreignKey:""},elements_profile_systems:{tableName:"elements_profile_systems",prop:"profile_system_id INTEGER, element_id INTEGER",foreignKey:""},orders:{tableName:"orders",prop:"order_number VARCHAR, order_hz VARCHAR, order_date TIMESTAMP, order_type INTEGER, order_style VARCHAR, user_id INTEGER, created TIMESTAMP, additional_payment VARCHAR, sended TIMESTAMP, state_to TIMESTAMP, state_buch TIMESTAMP, batch VARCHAR, base_price NUMERIC(13, 2), factory_margin NUMERIC(11, 2), factory_id INTEGER, purchase_price NUMERIC(10, 2), sale_price NUMERIC(10, 2), climatic_zone INTEGER, heat_coef_min NUMERIC, products_qty INTEGER, templates_price NUMERIC, addelems_price NUMERIC, products_price NUMERIC, delivery_date TIMESTAMP, new_delivery_date TIMESTAMP, delivery_price NUMERIC, is_date_price_less INTEGER, is_date_price_more INTEGER, floor_id INTEGER, floor_price NUMERIC, mounting_id INTEGER, mounting_price NUMERIC, is_instalment INTEGER, instalment_id INTEGER, is_old_price INTEGER, payment_first NUMERIC, payment_monthly NUMERIC, payment_first_primary NUMERIC, payment_monthly_primary NUMERIC, order_price NUMERIC, order_price_dis NUMERIC, order_price_primary NUMERIC, discount_construct NUMERIC, discount_addelem NUMERIC, discount_construct_max NUMERIC, discount_addelem_max NUMERIC, delivery_user_id NUMERIC, mounting_user_id NUMERIC, default_term_plant NUMERIC, disc_term_plant NUMERIC, margin_plant NUMERIC, comment TEXT, customer_name TEXT, customer_email TEXT, customer_phone VARCHAR(30), customer_phone_city VARCHAR(20), customer_city_id INTEGER, customer_city VARCHAR, customer_address TEXT, customer_house TEXT, customer_flat TEXT, customer_floor TEXT, customer_location VARCHAR, customer_itn INTEGER, customer_starttime VARCHAR, customer_endtime VARCHAR, customer_target VARCHAR, customer_sex INTEGER, customer_age INTEGER, customer_education INTEGER, customer_occupation INTEGER, customer_infoSource INTEGER",foreignKey:""},order_products:{tableName:"order_products",prop:"order_id NUMERIC, product_id INTEGER, is_addelem_only INTEGER, room_id INTEGER, construction_type INTEGER, template_id INTEGER, template_source TEXT, template_width NUMERIC, template_height NUMERIC, template_square NUMERIC, profile_id INTEGER, door_group_id INTEGER, glass_id VARCHAR, hardware_id INTEGER, lamination_id INTEGER, lamination_out_id INTEGER, lamination_in_id INTEGER, door_type_index INTEGER, door_shape_id INTEGER, door_sash_shape_id INTEGER, door_handle_shape_id INTEGER, door_lock_shape_id INTEGER, heat_coef_total NUMERIC, template_price NUMERIC, addelem_price NUMERIC, product_price NUMERIC, comment TEXT, product_qty INTEGER",foreignKey:""},order_addelements:{tableName:"order_addelements",prop:"order_id NUMERIC, product_id INTEGER, element_type INTEGER, element_id INTEGER, name VARCHAR, element_width NUMERIC, element_height NUMERIC, element_price NUMERIC, element_qty INTEGER, block_id INTEGER",foreignKey:""},template_groups:{tableName:"template_groups",prop:"name VARCHAR(255)",foreignKey:""},templates:{tableName:"templates",prop:"group_id INTEGER,name VARCHAR(255),icon TEXT,template_object TEXT",foreignKey:""},background_templates:{tableName:"background_templates",prop:"factory_id INTEGER,desc_1 VARCHAR(255),desc_2 VARCHAR(255),template_id INTEGER,group_id INTEGER,position INTEGER,img VARCHAR",foreignKey:""},factories:{tableName:"factories",prop:"name VARCHAR,app_token VARCHAR,link VARCHAR,therm_coeff_id INTEGER,max_construct_square INTEGER,max_construct_size INTEGER",foreignKey:""},mosquitos:{tableName:"mosquitos",prop:"profile_id INTEGER,name VARCHAR,bottom_id INTEGER,bottom_waste INTEGER,left_id INTEGER,left_waste INTEGER,top_id INTEGER,top_waste INTEGER,right_id INTEGER,right_waste INTEGER,cloth_id INTEGER,cloth_waste INTEGER,group_id INTEGER",foreignKey:""},mosquitos_singles:{tableName:"mosquitos_singles",prop:"factory_id INTEGER,name VARCHAR,bottom_id INTEGER,bottom_waste INTEGER,left_id INTEGER,left_waste INTEGER,top_id INTEGER,top_waste INTEGER,right_id INTEGER,right_waste INTEGER,cloth_id INTEGER,cloth_waste INTEGER,group_id INTEGER",foreignKey:""},doors_groups_dependencies:{tableName:"doors_groups_dependencies",prop:"doors_group_id INTEGER,hardware_group_id INTEGER",foreignKey:""},doors_hardware_items:{tableName:"doors_hardware_items",prop:"hardware_group_id  INTEGER,min_width INTEGER,max_width INTEGER,min_height INTEGER,max_height INTEGER,direction_id   INTEGER,hardware_color_id  INTEGER,length INTEGER,count  INTEGER,child_id INTEGER,position INTEGER,child_type STRING",foreignKey:""},doors_hardware_groups:{tableName:"doors_hardware_groups",prop:"burglar_coeff INTEGER,anticorrosion_coeff INTEGER,image VARCHAR(255),description VARCHAR(255),link VARCHAR(255),country VARCHAR(255),producer VARCHAR(255),name VARCHAR(255),hardware_type_id INTEGER,factory_id INTEGER,type INTEGER,is_push INTEGER,height_max INTEGER,height_min INTEGER,width_max INTEGER,width_min INTEGER",foreignKey:""},doors_groups:{tableName:"doors_groups",prop:"code_sync_white INTEGER,rama_sill_list_id INTEGER,shtulp_list_id INTEGER,impost_list_id INTEGER,stvorka_list_id INTEGER,door_sill_list_id INTEGER,rama_list_id INTEGER,name VARCHAR,folder_id INTEGER,factory_id INTEGER",foreignKey:""},areas:{tableName:"areas",prop:"name VARCHAR(255),region_id INTEGER",foreignKey:", FOREIGN KEY (region_id) REFERENCES regions(id)"},doors_laminations_dependencies:{tableName:"doors_laminations_dependencies",prop:"group_id INTEGER,rama_sill_list_id INTEGER,lamination_in INTEGER,lamination_out INTEGER,rama_list_id INTEGER,door_sill_list_id INTEGER,stvorka_list_id INTEGER,impost_list_id INTEGER,shtulp_list_id INTEGER,code_sync VARCHAR",foreignKey:""},window_hardware_type_ranges:{tableName:"window_hardware_type_ranges",prop:"factory_id INTEGER,type_id INTEGER,max_width INTEGER,min_width INTEGER,max_height INTEGER,min_height INTEGER,group_id INTEGER",foreignKey:""},lock_lists:{tableName:"lock_lists",prop:"list_id INTEGER,accessory_id INTEGER",foreignKey:""},"export":{tableName:"export",prop:"model VARCHAR, rowId INTEGER, field TEXT",foreignKey:""}},ie={cities:{tableName:"cities",prop:"name VARCHAR(255), region_id INTEGER, transport VARCHAR(2)",foreignKey:", FOREIGN KEY(region_id) REFERENCES regions(id)"},countries:{tableName:"countries",prop:"name VARCHAR(255), currency_id INTEGER",foreignKey:", FOREIGN KEY(currency_id) REFERENCES currencies(id)"},regions:{tableName:"regions",prop:"name VARCHAR(255), country_id INTEGER, heat_transfer NUMERIC(10, 2), climatic_zone NUMERIC",foreignKey:", FOREIGN KEY(country_id) REFERENCES countries(id)"}};return J.publicObj={tablesLocalDB:te,tablesLocationLocalDB:ie,cleanLocalDB:l,createTablesLocalDB:s,insertRowLocalDB:c,insertTablesLocalDB:u,selectLocalDB:p,updateLocalDB:g,deleteRowLocalDB:m,importUser:_,importLocation:h,importFactories:y,importAllDB:E,insertServer:b,updateServer:T,updateOrderServer:v,createUserServer:I,exportUserEntrance:S,deleteOrderServer:A,updateLocalServerDBs:L,sendIMGServer:D,md5:N,calculationPrice:j,getAdditionalPrice:X,calculationGridPrice:Z,calcDoorElemPrice:K,currencyExgange:B,deleteProductServer:f},J.publicObj}])}(),function(){angular.module("LoginModule").factory("loginServ",["$q","$cordovaGlobalization","$cordovaFileTransfer","$translate","$filter","localDB","globalConstants","GeneralServ","optionsServ","GlobalStor","OrderStor","ProductStor","UserStor",function(e,t,i,o,r,a,n,l,s,d,c,u,p){function g(e){for(var t=n.languages.length;--t>-1;)if(n.languages[t].label.indexOf(e)+1){p.userInfo.langLabel=n.languages[t].label,p.userInfo.langName=n.languages[t].name;break}}function m(){if(d.global.isDevice=isDevice,d.global.isDevice)t.getPreferredLanguage().then(function(e){g(e.value),o.use(p.userInfo.langLabel)},function(e){console.log("No language defined",e)});else{var e=navigator.language||navigator.userLanguage;g(e),o.use(p.userInfo.langLabel);
}}function f(){var t=e.defer();return a.selectLocalDB(a.tablesLocalDB["export"].tableName).then(function(e){e.length&&a.selectLocalDB(a.tablesLocalDB.users.tableName).then(function(i){i.length&&a.updateServer(i[0].phone,i[0].device_code,e).then(function(e){e&&(a.cleanLocalDB({"export":1}),t.resolve(1))})})}),t.promise}function _(){var t=e.defer();return a.selectLocalDB("sqlite_sequence").then(function(e){e&&e.length>5?t.resolve(1):t.resolve(0)}),t.promise}function h(t){var i,o,r,n,l=e.defer(),s=t?null:{id:p.userInfo.city_id};return a.selectLocalDB(a.tablesLocalDB.cities.tableName,s,"id as cityId, area_id, name as cityName, region_id as regionId").then(function(e){if(r=e.length){for(d.global.locations.cities=angular.copy(e);--r>-1;){for(o=d.global.locations.regions.length,n=d.global.locations.areas.length;--n>-1;)d.global.locations.cities[r].area_id===d.global.locations.areas[n].id&&d.global.locations.areas[n].name&&(d.global.locations.cities[r].areasName=d.global.locations.areas[n].name);for(;--o>-1;)if(d.global.locations.cities[r].regionId===d.global.locations.regions[o].id)for(d.global.locations.cities[r].fullLocation=""+d.global.locations.cities[r].cityName+", "+d.global.locations.cities[r].areasName+", "+d.global.locations.regions[o].name,d.global.locations.cities[r].climaticZone=d.global.locations.regions[o].climaticZone,d.global.locations.cities[r].heatTransfer=d.global.locations.regions[o].heatTransfer,i=d.global.locations.countries.length;--i>-1;)d.global.locations.regions[o].countryId===d.global.locations.countries[i].id&&(d.global.locations.cities[r].countryId=d.global.locations.countries[i].id,d.global.locations.cities[r].currencyId=d.global.locations.countries[i].currency)}l.resolve(1)}else l.resolve(0)}),l.promise}function y(t){var i,o,r=e.defer();return a.selectLocalDB(a.tablesLocalDB.countries.tableName,null,"id, name, currency_id as currency").then(function(e){i=e.length,i&&(d.global.locations.countries=angular.copy(e))}).then(function(){a.selectLocalDB(a.tablesLocalDB.regions.tableName,null,"id, name, country_id as countryId, climatic_zone as climaticZone, heat_transfer as heatTransfer").then(function(e){o=e.length,o?d.global.locations.regions=angular.copy(e):console.log("Error!!!",e)}).then(function(){a.selectLocalDB(a.tablesLocalDB.areas.tableName).then(function(e){o=e.length,o&&(d.global.locations.areas=angular.copy(e))}).then(function(){h(t).then(function(){r.resolve(1)})})})}),r.promise}function E(){var t=e.defer(),i=d.global.locations.cities.map(function(e){if(e.countryId===p.userInfo.countryId)return e.cityId}).join(",");return t.resolve(i),t.promise}function b(e,t,i,o,r){c.order.customer_city_id=e,c.order.customer_city=t,c.order.climatic_zone=i,c.order.heat_coef_min=o,c.order.customer_location=r}function v(){a.selectLocalDB(a.tablesLocalDB.factories.tableName,null,"therm_coeff_id, link, max_construct_size, max_construct_square").then(function(e){var t,i=p.userInfo.heatTransfer;e&&(t=e.length,t&&(p.userInfo.therm_coeff_id=angular.copy(e[0].therm_coeff_id),p.userInfo.therm_coeff_id&&(p.userInfo.heatTransfer=l.roundingValue(1/i)),e[0].link.length&&"null"!==e[0].link&&(p.userInfo.factoryLink=angular.copy(e[0].link)),+e[0].max_construct_square>0&&(d.global.maxSquareLimit=angular.copy(+e[0].max_construct_square)),+e[0].max_construct_size>0&&(d.global.maxSizeLimit=angular.copy(+e[0].max_construct_size)))),b(p.userInfo.city_id,p.userInfo.cityName,p.userInfo.climaticZone,p.userInfo.heatTransfer,p.userInfo.fullLocation)})}function T(){for(var e=d.global.locations.cities.length,t=d.global.locations.regions.length;--e>-1;)if(d.global.locations.cities[e].cityId===p.userInfo.city_id)for(p.userInfo.cityName=d.global.locations.cities[e].cityName,p.userInfo.countryId=d.global.locations.cities[e].countryId,p.userInfo.climaticZone=d.global.locations.cities[e].climaticZone,p.userInfo.heatTransfer=d.global.locations.cities[e].heatTransfer,p.userInfo.fullLocation=d.global.locations.cities[e].fullLocation;--t>-1;)d.global.locations.cities[e].regionId===d.global.locations.regions[t].id&&(d.global.regionCoefs=d.global.locations.regions[t].id)}function I(){var t=e.defer();return a.selectLocalDB(a.tablesLocalDB.currencies.tableName,null,"id, is_base, name, value").then(function(e){var i=e.length;if(e&&i){for(d.global.currencies=e;--i>-1;)1===e[i].is_base&&(p.userInfo.currencyId=e[i].id,/uah/i.test(e[i].name)?p.userInfo.currency="₴":/rub/i.test(e[i].name)?p.userInfo.currency="":/(usd|\$)/i.test(e[i].name)?p.userInfo.currency="$":/eur/i.test(e[i].name)?p.userInfo.currency="€":p.userInfo.currency="¤");t.resolve(1)}else console.error("not find currencies!"),t.resolve(0)}),t.promise}function S(e,t){var i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var e=new FileReader;e.onloadend=function(){var i="userAvatar",o=e.result;localforage.setItem(i,o,function(e,t){}),t(e.result)},e.readAsDataURL(i.response)},i.open("GET",e,!0),i.send()}function A(){var t=e.defer();if(Z&&navigator.onLine){var i=n.serverIP+p.userInfo.avatar;p.userInfo.avatar=i,S(i,function(e){})}else localforage.getItem("userAvatar",function(e,t){p.userInfo.avatar=t});return a.selectLocalDB(a.tablesLocalDB.users_discounts.tableName).then(function(e){var i=angular.copy(e[0]);if(i){p.userInfo.discountConstr=+i.default_construct,p.userInfo.discountAddElem=+i.default_add_elem,p.userInfo.discountConstrMax=+i.max_construct,p.userInfo.discountAddElemMax=+i.max_add_elem;var o,r=Object.keys(i),a=r.length;for(o=0;o<a;o+=1)r[o].indexOf("week")+1&&(r[o].indexOf("construct")+1?p.userInfo.discConstrByWeek.push(+i[r[o]]):r[o].indexOf("add_elem")+1&&p.userInfo.discAddElemByWeek.push(+i[r[o]]));t.resolve(1)}else console.error("not find users_discounts!"),t.resolve(0)}),t.promise}function L(){return a.selectLocalDB(a.tablesLocalDB.options_coefficients.tableName,null,"margin, coeff").then(function(e){return e})}function D(){return a.selectLocalDB(a.tablesLocalDB.options_discounts.tableName).then(function(e){return e})}function N(e){if(e){if(/^.*\.(jpg|jpeg|png|gif|tiff)$/i.test(e)){var t=n.serverIP+""+e;if(d.global.isDevice){var o=e.split("/").pop(),r=cordova.file.dataDirectory+""+o,a=!0,l={};return i.download(t,r,l,a).then(function(e){console.log("Success!",e)},function(e){console.log("Error!",e)},function(e){}),r}return t}return""}}function x(t,i,o,r){var n=e.defer();return a.selectLocalDB(t).then(function(t){var s=angular.copy(t).sort(function(e,t){return l.sorting(e.position,t.position)}),d=s.length;if(d){o.length=0,angular.extend(o,s);var c=s.map(function(t){var o=e.defer();return t.img=N(t.img),a.selectLocalDB(i,{folder_id:t.id}).then(function(e){if(e.length){var t=angular.copy(e).sort(function(e,t){return l.sorting(e.position,t.position)});o.resolve(t)}else o.resolve(0)}),o.promise});e.all(c).then(function(e){var t,i=e.length,a=[];for(t=0;t<i;t+=1){var l=e[t].length;if(e[t]&&l){for(;--l>-1;)e[t][l].img=N(e[t][l].img);r.push(e[t]),a.push(e[t][0].folder_id)}}var s=a.length,d=o.length;if(s)for(;--d>-1;){var c,u=0;for(c=0;c<s;c+=1)o[d].id===a[c]&&(u=1);u||o.splice(d,1)}n.resolve(1)})}else n.resolve(0)}),n.promise}function R(){for(var t=e.defer(),i=d.global.profiles.length,o=[];--i>-1;)for(var r=d.global.profiles[i].length;--r>-1;)o.push(d.global.profiles[i][r].id);a.selectLocalDB(a.tablesLocalDB.lists.tableName,{list_type_id:2}).then(function(e){d.global.allDoorSills=angular.copy(e)});var n=o.map(function(t){var i=e.defer(),o={profileId:t,glassTypes:[],glasses:[]};return a.selectLocalDB(a.tablesLocalDB.glass_folders.tableName).then(function(e){e.length?(o.glassTypes=angular.copy(e),d.global.glassesAll.push(o),i.resolve(1)):i.resolve(0)}),i.promise});return e.all(n).then(function(i){if(i){var o=d.global.glassesAll.map(function(t){var i=e.defer();return a.selectLocalDB(a.tablesLocalDB.elements_profile_systems.tableName,{profile_system_id:t.profileId},"element_id").then(function(e){var t=e.length;t?i.resolve(e):i.resolve(0)}),i.promise});e.all(o).then(function(i){var o,r,n=i.length,l=[];for(r=0;r<n;r+=1){var s=e.defer(),c=i[r].map(function(t){var i=e.defer();return a.selectLocalDB(a.tablesLocalDB.lists.tableName,{parent_element_id:t.element_id,list_group_id:6},"id, name, parent_element_id, cameras, list_group_id, list_type_id, position, description, img, link, glass_image, glass_type, glass_color").then(function(e){var t=angular.copy(e),o=t.length;o?i.resolve(t[0]):i.resolve(0)}),i.promise});s.resolve(e.all(c)),l.push(s.promise)}e.all(l).then(function(i){var r=i.length,n=[];if(r){for(o=0;o<r;o+=1){var l=e.defer();d.global.glassesAll[o].glassLists=i[o].filter(function(e){return e});var s=d.global.glassesAll[o].glassLists.map(function(t){var i=e.defer();return a.selectLocalDB(a.tablesLocalDB.elements.tableName,{id:t.parent_element_id},"id, name, sku, glass_folder_id, glass_width, heat_coeff, noise_coeff, transcalency, max_width, min_width, max_height, min_height, max_sq, reg_coeff").then(function(e){var t=angular.copy(e),o=t.length;o?i.resolve(t[0]):i.resolve(0)}),i.promise});l.resolve(e.all(s)),n.push(l.promise)}e.all(n).then(function(e){var i=e.length;if(i)for(o=0;o<i;o+=1)d.global.glassesAll[o].glasses=e[o];t.resolve(1)})}})})}}),t.promise}function O(){var e,t=d.global.glassesAll.length;for(e=0;e<t;e+=1){var i,o=d.global.glassesAll[e].glassLists.length,r=d.global.glassesAll[e].glassTypes.length,a=[],n=[];for(i=0;i<o;i+=1)d.global.glassesAll[e].glassLists[i].parent_element_id===d.global.glassesAll[e].glasses[i].id&&(d.global.glassesAll[e].glasses[i].elem_id=angular.copy(d.global.glassesAll[e].glasses[i].id),d.global.glassesAll[e].glasses[i].id=angular.copy(d.global.glassesAll[e].glassLists[i].id),d.global.glassesAll[e].glasses[i].name=angular.copy(d.global.glassesAll[e].glassLists[i].name),d.global.glassesAll[e].glasses[i].cameras=angular.copy(d.global.glassesAll[e].glassLists[i].cameras),d.global.glassesAll[e].glasses[i].glass_type=angular.copy(d.global.glassesAll[e].glassLists[i].glass_type),d.global.glassesAll[e].glasses[i].glass_color=angular.copy(d.global.glassesAll[e].glassLists[i].glass_color),d.global.glassesAll[e].glasses[i].position=angular.copy(d.global.glassesAll[e].glassLists[i].position),d.global.glassesAll[e].glasses[i].img=angular.copy(d.global.glassesAll[e].glassLists[i].img),d.global.glassesAll[e].glasses[i].img=N(d.global.glassesAll[e].glasses[i].img),d.global.glassesAll[e].glasses[i].link=angular.copy(d.global.glassesAll[e].glassLists[i].link),d.global.glassesAll[e].glasses[i].description=angular.copy(d.global.glassesAll[e].glassLists[i].description),d.global.glassesAll[e].glasses[i].glass_image=angular.copy(d.global.glassesAll[e].glassLists[i].glass_image));for(d.global.glassesAll[e].glassTypes.sort(function(e,t){return l.sorting(e.position,t.position)});--r>-1;){d.global.glassesAll[e].glassTypes[r].img=N(d.global.glassesAll[e].glassTypes[r].img);var s=d.global.glassesAll[e].glasses.filter(function(t){return t.glass_folder_id===d.global.glassesAll[e].glassTypes[r].id});s.length&&(a.unshift(d.global.glassesAll[e].glassTypes[r]),s.sort(function(e,t){return l.sorting(e.position,t.position)}),n.unshift(s))}d.global.glassesAll[e].glassTypes=angular.copy(a),d.global.glassesAll[e].glasses=angular.copy(n),delete d.global.glassesAll[e].glassLists}}function C(){a.selectLocalDB(a.tablesLocalDB.window_hardware_type_ranges.tableName,null,"type_id, min_width, max_width, min_height, max_height, group_id").then(function(e){e&&e.length&&(d.global.hardwareLimits=angular.copy(e))})}function P(){var t=e.defer();return a.selectLocalDB(a.tablesLocalDB.background_templates.tableName).then(function(e){var i=angular.copy(e),o=i.length;o&&(i=i.sort(function(e,t){return l.sorting(e.position,t.position)}),i.forEach(function(e){if(e.img=n.serverIP+e.img,Z&&navigator.onLine){var t=String(e.img),i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var t=new FileReader;t.onloadend=function(){var i=String(e.img),o=t.result;localforage.setItem(i,o,function(t,i){e.img=i})},t.readAsDataURL(i.response)},i.open("GET",t,!0),i.send()}else{var o=String(e.img);localforage.getItem(o,function(t,i){e.img=i})}}),d.global.rooms=i),t.resolve(1)}),t.promise}function w(){return a.selectLocalDB(a.tablesLocalDB.lamination_factory_colors.tableName,null,"id, name, lamination_type_id as type_id").then(function(e){return e})}function M(){var t=e.defer();return a.selectLocalDB(a.tablesLocalDB.profile_laminations.tableName).then(function(e){if(e){d.global.laminatCouples=angular.copy(e);for(var i,o=d.global.laminatCouples.length,r=d.global.laminats.length;--o>-1;)for(delete d.global.laminatCouples[o].code_sync,delete d.global.laminatCouples[o].modified,i=0;i<r;i+=1)d.global.laminats[i].id===d.global.laminatCouples[o].lamination_in_id&&(d.global.laminatCouples[o].laminat_in_name=d.global.laminats[i].name,d.global.laminatCouples[o].img_in_id=d.global.laminats[i].type_id),d.global.laminats[i].id===d.global.laminatCouples[o].lamination_out_id&&(d.global.laminatCouples[o].laminat_out_name=d.global.laminats[i].name,d.global.laminatCouples[o].img_out_id=d.global.laminats[i].type_id);t.resolve(1)}else t.resolve(1)}),t.promise}function k(){var t=e.defer(),i=l.addElementDATA.map(function(e,t){return t?a.selectLocalDB(a.tablesLocalDB.lists.tableName,{list_group_id:e.id}):a.selectLocalDB(a.tablesLocalDB.mosquitos.tableName)});return e.all(i).then(function(e){e[18]&&(e[6]=e[6].concat(e[18]));var i,o,r=angular.copy(e),n=r.length;for(i=0;i<n;i+=1)o={elementType:[],elementsList:0},!i&&r[i].length?(o.elementType.push({addition_type_id:20,name:""}),o.elementsList=[r[i]]):o.elementsList=r[i],d.global.addElementsAll.push(o);a.selectLocalDB(a.tablesLocalDB.mosquitos_singles.tableName).then(function(e){var i=angular.copy(e),o=i.length;if(o){for(;--o>-1;)i[o].profile_id=0,delete i[o].factory_id;d.global.addElementsAll[0].elementsList?angular.isArray(d.global.addElementsAll[0].elementsList)&&(d.global.addElementsAll[0].elementsList[0]=d.global.addElementsAll[0].elementsList[0].concat(i)):(d.global.addElementsAll[0].elementType.push({addition_type_id:20,name:""}),d.global.addElementsAll[0].elementsList=[i])}t.resolve(1)})}),t.promise}function G(){var t=e.defer(),i=d.global.addElementsAll.map(function(t,i){var o=e.defer();if(i&&t.elementsList&&t.elementsList.length){var r=t.elementsList.map(function(t){var i=e.defer();return t.img=N(t.img),a.selectLocalDB(a.tablesLocalDB.elements.tableName,{id:t.parent_element_id}).then(function(e){e&&e.length?(d.global.tempAddElements.push(angular.copy(e[0])),i.resolve(1)):i.resolve(0)}),i.promise});o.resolve(e.all(r))}else o.resolve(0);return o.promise});return t.resolve(e.all(i)),t.promise}function B(t){var i=e.defer(),o=t.map(function(t){var i=e.defer(),o={currencyId:p.userInfo.currencyId,element:t};return a.calculationGridPrice(o).then(function(e){e?(t.element_price=angular.copy(l.roundingValue(l.addMarginToPrice(e.priceTotal,d.global.margins.margin))),t.elementPriceDis=angular.copy(l.roundingValue(l.setPriceDis(t.element_price,c.order.discount_addelem))),i.resolve(t)):i.reject(e)}),i.promise});return i.resolve(e.all(o)),i.promise}function V(){var t=e.defer();return a.selectLocalDB(a.tablesLocalDB.addition_folders.tableName).then(function(e){var i,o,n,s,c,u,p,g,m,f,_,h,y,E=d.global.addElementsAll,b=E.length,v={id:0,name:r("translate")("add_elements.OTHERS")};for(e&&e.length&&(i=e.sort(function(e,t){return l.sorting(e.position,t.position)}));--b>-1;)if(E[b].elementsList)if(b){for(i&&i.length&&(E[b].elementType=angular.copy(i)),E[b].elementType.push(v),o=[],n=[],s=E[b].elementType.length,c=E[b].elementsList.length,u=d.global.tempAddElements.length,p=0;p<s;p+=1){for(g=[],m=0;m<c;m+=1)if(E[b].elementType[p].id===E[b].elementsList[m].addition_folder_id){switch(f=0,_=0,E[b].elementsList[m].list_group_id){case 21:case 9:case 8:case 19:case 12:f=1e3;break;case 26:f=1e3,_=1e3}var T=E[b].elementsList[m].list_group_id;for(!E[b].elementType[p].max_size||12!==T&&21!==T&&9!==T&&8!==T?E[b].elementsList[m].max_size=5e3:E[b].elementsList[m].max_size=E[b].elementType[p].max_size,E[b].elementsList[m].element_width=f,E[b].elementsList[m].element_height=_,E[b].elementsList[m].element_qty=1,h=0;h<u;h+=1)d.global.tempAddElements[h].id===E[b].elementsList[m].parent_element_id&&(E[b].elementsList[m].element_price=l.roundingValue(a.currencyExgange(d.global.tempAddElements[h].price,d.global.tempAddElements[h].currency_id),2));g.push(angular.copy(E[b].elementsList[m]))}g.length?(g=r("orderBy")(g,"name"),o.push(g)):n.push(p)}if(o.length?E[b].elementsList=angular.copy(o):E[b].elementsList=0,y=n.length)for(;--y>-1;)E[b].elementType.splice(n[y],1)}else if(c=E[b].elementsList[0].length){for(m=0;m<c;m+=1)E[b].elementsList[0][m].element_width=1e3,E[b].elementsList[0][m].element_height=1e3,E[b].elementsList[0][m].element_qty=1,E[b].elementsList[0][m].list_group_id=20;B(E[b].elementsList[0])}t.resolve(1)}),t.promise}function H(){var t=e.defer();return k().then(function(){G().then(function(){V().then(function(){t.resolve(1)})})}),t.promise}function U(){a.selectLocalDB(a.tablesLocalDB.users_deliveries.tableName).then(function(e){e.length&&(d.global.supplyData=angular.copy(e))}),a.selectLocalDB(a.tablesLocalDB.users_mountings.tableName).then(function(e){e.length&&(d.global.assemblingData=angular.copy(e))}),s.getInstalment(function(e){e.status?d.global.instalmentsData=e.data.instalment:console.log(e)})}function F(){a.selectLocalDB(a.tablesLocalDB.doors_groups_dependencies.tableName).then(function(e){a.selectLocalDB(a.tablesLocalDB.doors_hardware_groups.tableName).then(function(t){for(var i=0;i<t.length;i+=1){t[i].profIds=[];for(var o=0;o<e.length;o+=1)t[i].id===e[o].hardware_group_id&&t[i].profIds.push(e[o].doors_group_id);t[i].profIds=t[i].profIds.join(", ")}d.global.doorLocks=angular.copy(t)})})}function z(){a.selectLocalDB(a.tablesLocalDB.lock_lists.tableName).then(function(e){d.global.locksList=angular.copy(e)})}function Y(e){var t,i,o,r=[],a=e.length;for(o=0;o<a;o+=1){for(t=d.global.locksList.length,i=0;--t>-1;)d.global.locksList[t].accessory_id===e[o].accessory_id&&(i=1);i&&r.push("hel"+e[o].accessory_id+"lo")}return r.join(", ")}function W(){var t="id, name, list_type_id, parent_element_id";a.selectLocalDB(a.tablesLocalDB.lists.tableName,{list_type_id:35},t).then(function(i){d.global.doorHandlers=d.global.doorHandlers.concat(i),a.selectLocalDB(a.tablesLocalDB.lists.tableName,{list_type_id:36},t).then(function(t){d.global.doorHandlers=d.global.doorHandlers.concat(t),F(),z(),K();var i=d.global.doorHandlers.map(function(t){var i=e.defer();return a.selectLocalDB(a.tablesLocalDB.lock_lists.tableName,{list_id:t.id},"accessory_id").then(function(e){i.resolve(e)}),i.promise});e.all(i).then(function(e){var t,i=d.global.doorHandlers.length;for(t=0;t<i;t+=1)d.global.doorHandlers[t].profIds=Y(e[t])})})})}function q(){a.selectLocalDB(a.tablesLocalDB.lists.tableName,{list_group_id:2},"id, name, doorstep_type").then(function(e){var t,i=angular.copy(e),o=(d.global.profiles,i.length);o?(t=i.filter(function(e){return 1===e.doorstep_type||2===e.doorstep_type}),d.global.doorKitsT1=angular.copy(t),W()):d.global.noDoorExist=1}),j(),Q()}function j(){a.selectLocalDB(a.tablesLocalDB.doors_groups.tableName).then(function(e){a.selectLocalDB(a.tablesLocalDB.lists.tableName).then(function(t){for(var i=0;i<t.length;i+=1)for(var o=0;o<e.length;o+=1)t[i].id===e[o].stvorka_list_id&&(e[o].list_id=t[i].parent_element_id,e[o].list_type_id=t[i].list_type_id);a.selectLocalDB(a.tablesLocalDB.elements_profile_systems.tableName).then(function(t){for(var i=0;i<t.length;i+=1)for(var o=0;o<e.length;o+=1)e[o].list_id===t[i].element_id&&(e[o].profile_id=t[i].profile_system_id);d.global.doorsGroups=angular.copy(e)})})})}function Q(){a.selectLocalDB(a.tablesLocalDB.doors_laminations_dependencies.tableName).then(function(e){d.global.doorsLaminations=angular.copy(e)})}function K(){a.selectLocalDB(a.tablesLocalDB.doors_hardware_items.tableName).then(function(e){for(var t=angular.copy(e),i=0;i<t.length;i+=1)t[i].parent_element_id=t[i].child_id,delete t[i].child_id;d.global.doorsItems=angular.copy(t)})}function X(){var t=e.defer();return I().then(function(e){e&&A().then(function(e){e&&L().then(function(e){e&&e.length?(d.global.margins=angular.copy(e[0]),D().then(function(e){e&&e.length?(d.global.deliveryCoeff=angular.copy(e[0]),d.global.deliveryCoeff.percents=e[0].percents.split(",").map(function(e){return+e}),v(),x(a.tablesLocalDB.profile_system_folders.tableName,a.tablesLocalDB.profile_systems.tableName,d.global.profilesType,d.global.profiles).then(function(e){e&&(d.global.profilesType.forEach(function(e){if(""!==e.img)if(Z&&navigator.onLine){var t=String(e.img),i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var t=new FileReader;t.onloadend=function(){var i=String(e.img),o=t.result;localforage.setItem(i,o,function(e,t){})},t.readAsDataURL(i.response)},i.open("GET",t,!0),i.send()}else{var o=String(e.img);localforage.getItem(o,function(t,i){e.img=i})}}),d.global.profiles.forEach(function(e){e.forEach(function(e){if(""!==e.img)if(Z&&navigator.onLine){var t=String(e.img),i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var t=new FileReader;t.onloadend=function(){var i=String(e.img),o=t.result;localforage.setItem(i,o,function(e,t){})},t.readAsDataURL(i.response)},i.open("GET",t,!0),i.send()}else{var o=String(e.img);localforage.getItem(o,function(t,i){e.img=i})}})}),R().then(function(e){e&&(O(),d.global.glassesAll.forEach(function(e){e.glassTypes.forEach(function(e){if(""!==e.img)if(Z&&navigator.onLine){var t=String(e.img),i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var t=new FileReader;t.onloadend=function(){var i=String(e.img),o=t.result;localforage.setItem(i,o,function(e,t){})},t.readAsDataURL(i.response)},i.open("GET",t,!0),i.send()}else{var o=String(e.img);localforage.getItem(o,function(t,i){e.img=i})}})}),d.global.glassesAll.forEach(function(e){e.glasses.forEach(function(e){e.forEach(function(e){if(""!==e.img)if(Z&&navigator.onLine){var t=String(e.img),i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var t=new FileReader;t.onloadend=function(){var i=String(e.img),o=t.result;localforage.setItem(i,o,function(e,t){})},t.readAsDataURL(i.response)},i.open("GET",t,!0),i.send()}else{var o=String(e.img);localforage.getItem(o,function(t,i){e.img=i})}})})}),x(a.tablesLocalDB.window_hardware_folders.tableName,a.tablesLocalDB.window_hardware_groups.tableName,d.global.hardwareTypes,d.global.hardwares).then(function(e){e&&(d.global.hardwares.forEach(function(e){e.forEach(function(e){if(""!==e.img)if(Z&&navigator.onLine){var t=String(e.img),i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var t=new FileReader;t.onloadend=function(){var i=String(e.img),o=t.result;localforage.setItem(i,o,function(e,t){})},t.readAsDataURL(i.response)},i.open("GET",t,!0),i.send()}else{var o=String(e.img);localforage.getItem(o,function(t,i){e.img=i})}})}),d.global.hardwareTypes.forEach(function(e){if(""!==e.img)if(Z&&navigator.onLine){var t=String(e.img),i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var t=new FileReader;t.onloadend=function(){var i=String(e.img),o=t.result;localforage.setItem(i,o,function(e,t){})},t.readAsDataURL(i.response)},i.open("GET",t,!0),i.send()}else{var o=String(e.img);localforage.getItem(o,function(t,i){e.img=i})}}),q(),C(),P().then(function(){H().then(function(){d.global.addElementsAll.forEach(function(e){e.elementType.forEach(function(e){if(""!==e.img)if(Z&&navigator.onLine){var t=String(n.serverIP+e.img),i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){var t=new FileReader;t.onloadend=function(){var i=String(e.img),o=t.result;localforage.setItem(i,o,function(e,t){})},t.readAsDataURL(i.response)},i.open("GET",t,!0),i.send()}else{var o=String(e.img);localforage.getItem(o,function(t,i){e.img=i})}})}),w().then(function(e){e&&e.length&&(d.global.laminats=angular.copy(e).map(function(e){return e.isActive=0,e}),d.global.laminats.push({id:1,type_id:1,isActive:0,name:"mainpage.WHITE_LAMINATION"}),M().then(function(){d.global.laminatCouples.push(angular.copy(u.product.lamination))})),U(),t.resolve(1)})})}))}))}))})):(console.error("not find options_discounts!"),t.resolve(0))})):(console.error("not find options_coefficients!"),t.resolve(0))})})}),t.promise}var Z,J=this;$.get("http://api.steko.com.ua",function(e){return Z=!0,!0}).fail(function(){return Z=!1,!1});var Z;return $.get(n.serverIP,function(e){Z=!0}).fail(function(){Z=!1}),localforage.setDriver([localforage.WEBSQL]),J.publicObj={getDeviceLanguage:m,initExport:f,isLocalDBExist:_,prepareLocationToUse:y,downloadAllCities:h,collectCityIdsAsCountry:E,setUserLocation:T,setUserGeoLocation:b,downloadAllData:X,getGridPrice:B},J.publicObj}])}(),function(){angular.module("MainModule").factory("MainServ",["$location","$q","$filter","$timeout","localDB","GeneralServ","SVGServ","loginServ","optionsServ","AnalyticsServ","GlobalStor","OrderStor","ProductStor","UserStor","AuxStor","CartStor","DesignStor","HistoryStor",function(e,t,i,o,r,a,n,l,s,d,c,u,p,g,m,f,h,y){function E(){c.global.showRoomSelectorDialog=0,c.global.selectRoom=1,c.global.configMenuTips=c.global.startProgramm?1:0}function b(){p.product.door_shape_id=0,p.product.door_type_index=0,p.product.door_sash_shape_id=0,p.product.door_handle_shape_id=0,p.product.door_lock_shape_id=0,p.product.doorName="",p.product.doorSashName="",p.product.doorHandle={},p.product.doorLock={},h.design.steps.selectedStep1=0,h.design.steps.selectedStep2=0,h.design.steps.selectedStep3=0,h.design.steps.selectedStep4=0,h.designSource.steps.selectedStep1=0,h.designSource.steps.selectedStep2=0,h.designSource.steps.selectedStep3=0,h.designSource.steps.selectedStep4=0}function v(){m.aux.isWindowSchemeDialog=0,m.aux.isAddElementListView=0,m.aux.isFocusedAddElement=0,m.aux.isTabFrame=0,m.aux.isAddElementListView=0,m.aux.showAddElementsMenu=0,m.aux.addElementGroups.length=0,m.aux.searchingWord="",m.aux.isGridSelectorDialog=0}function T(){c.global.isNavMenu=0,c.global.isConfigMenu=1,c.global.activePanel=0,v(),c.global.startProgramm&&o(function(){c.global.showRoomSelectorDialog=1},2e3)}function I(){o(function(){r.exportUserEntrance(g.userInfo.phone,g.userInfo.device_code)},5e3)}function S(){var e=(new Date).getTime().toString();return 1*(g.userInfo.id+""+e.slice(4,e.length))}function A(){var e;u.order.id=S(),u.order.order_date=(new Date).getTime(),e=new Date(u.order.order_date).getDate()+c.global.deliveryCoeff.standart_time,u.order.delivery_date=(new Date).setDate(e),u.order.new_delivery_date=angular.copy(u.order.delivery_date)}function L(){u.order.discount_construct=angular.copy(g.userInfo.discountConstr),u.order.discount_addelem=angular.copy(g.userInfo.discountAddElem)}function D(){p.product.construction_type=c.global.rooms[0].group_id,p.product.template_id=c.global.rooms[0].template_id-1}function N(e){var o=t.defer();switch(e){case 1:s.getTemplatesWindow(function(e){e.status?(c.global.templateLabel=i("translate")("panels.TEMPLATE_WINDOW"),o.resolve(e.data.windows)):console.log(e)});break;case 2:s.getTemplatesWindowDoor(function(e){e.status?(c.global.templateLabel=i("translate")("panels.TEMPLATE_BALCONY_ENTER"),o.resolve(e.data.windowDoor)):console.log(e)});break;case 3:s.getTemplatesBalcony(function(e){e.status?(c.global.templateLabel=i("translate")("panels.TEMPLATE_BALCONY"),o.resolve(e.data.balconies)):console.log(e)});break;case 4:s.getTemplatesDoor(function(e){e.status?(c.global.templateLabel=i("translate")("panels.TEMPLATE_DOOR"),o.resolve(e.data.doors)):console.log(e)})}return o.promise}function x(e,t){for(var i,o=t.length;--o>-1;)for(i=t[o].length;--i>-1;)if(t[o][i].id===e)return t[o][i]}function R(e){var i=t.defer();return r.selectLocalDB(r.tablesLocalDB.lists.tableName,{id:e}).then(function(e){var t={};e.length&&(t.a=e[0].a,t.b=e[0].b,t.c=e[0].c,t.d=e[0].d),i.resolve(t)}),i.promise}function O(e,i){var o=t.defer();return i?e.profile=angular.copy(x(i,c.global.profiles)):e.profile=angular.copy(c.global.profiles[0][0]),t.all([R(e.profile.rama_list_id),R(e.profile.rama_still_list_id),R(e.profile.stvorka_list_id),R(e.profile.impost_list_id),R(e.profile.shtulp_list_id)]).then(function(t){e.profileDepths.frameDepth=t[0],e.profileDepths.frameStillDepth=t[1],e.profileDepths.sashDepth=t[2],e.profileDepths.impostDepth=t[3],e.profileDepths.shtulpDepth=t[4],o.resolve(e)}),o.promise}function C(e){var i=t.defer();return t.all([R(e.profile.rama_list_id),R(e.profile.rama_still_list_id),R(e.profile.stvorka_list_id),R(e.profile.impost_list_id),R(e.profile.shtulp_list_id)]).then(function(t){e.profileDepths.frameDepth=t[0],e.profileDepths.frameStillDepth=t[1],e.profileDepths.sashDepth=t[2],e.profileDepths.impostDepth=t[3],e.profileDepths.shtulpDepth=t[4],i.resolve(e)}),i.promise}function P(){function e(e,i){async.waterfall([function(t){r.selectLocalDB(r.tablesLocalDB.lists.tableName,{id:e.rama_list_id},"parent_element_id").then(function(e){t(null,e)})},function(i,o){r.selectLocalDB(r.tablesLocalDB.elements_profile_systems.tableName,{element_id:i[0].parent_element_id},"profile_system_id").then(function(i){e.profileId=i[0].profile_system_id,t.push(e),o(null,e.profileId)})}],function(e,t){return e?i(e,t):void i(null,t)})}var t=[];async.eachSeries(c.global.doorsLaminations,e,function(e,i){c.global.doorsLaminations=angular.copy(t)})}function w(e){for(var t=e.details.length,i=[];--t>0;)e.details[t].children.length||e.details[t].glassId&&i.push(angular.copy(e.details[t].glassId));return i}function M(e,t,i,o,r){for(var a=t.details.length;--a>0;)if(r){if(t.details[a].id===r){t.details[a].glassId=i,t.details[a].glassTxt=o,t.details[a].glass_type=e;break}}else t.details[a].glassId=i,t.details[a].glassTxt=o,t.details[a].glass_type=e}function k(e,t){if(e.glass.length=0,t)for(var i=a.removeDuplicates(w(e.template)),o=i.length;--o>-1;)e.glass.push(x(i[o],c.global.glasses));else{var r=c.global.glassesAll.filter(function(t){return e.profile.profileId&&4==e.construction_type?t.profileId===e.profile.profileId:t.profileId===e.profile.id});r.length&&(c.global.glassTypes=angular.copy(r[0].glassTypes),c.global.glasses=angular.copy(r[0].glasses),e.glass.push(angular.copy(c.global.glasses[0][0])),c.global.selectGlassId=e.glass[0].id,c.global.selectGlassName=e.glass[0].sku,M(e.glass[0].glass_type,p.product.template_source,e.glass[0].id,e.glass[0].sku))}}function G(e,t){var i=c.global.glassesAll.filter(function(e){return t.profile.profileId&&4==t.construction_type?e.profileId===t.profile.profileId:e.profileId===t.profile.id});i.length&&(c.global.glassTypes=angular.copy(i[0].glassTypes),c.global.glasses=angular.copy(i[0].glasses),t.glass.push(angular.copy(c.global.glasses[0][0])),c.global.selectGlassId=t.glass[0].id,c.global.selectGlassName=t.glass[0].sku,M(t.glass[0].glass_type,e,t.glass[0].id,t.glass[0].sku))}function B(e){for(var t=e.details.length,i=0;--t>0;)"sash"===e.details[t].blockType&&(i+=1,c.global.checkSashInTemplate=i);return i}function V(e){var i=t.defer();return c.global.isChangedTemplate||(p.product.template_source=angular.copy(c.global.templatesSource[e])),k(p.product),n.createSVGTemplate(p.product.template_source,p.product.profileDepths).then(function(e){p.product.template=angular.copy(e),c.global.isSashesInTemplate=B(p.product.template_source),n.createSVGTemplateIcon(p.product.template_source,p.product.profileDepths).then(function(e){c.global.isRoomElements=1,p.product.templateIcon=angular.copy(e),i.resolve(1)})}),i.promise}function H(e){var i=t.defer(),o=c.global.glassesAll.filter(function(e){return e.profileId===p.product.profile.id});return o.length&&(c.global.glassTypes=angular.copy(o[0].glassTypes),c.global.glasses=angular.copy(o[0].glasses),c.global.selectGlassId=p.product.glass[0].id,c.global.selectGlassName=p.product.glass[0].sku),p.product.template_source,n.createSVGTemplate(p.product.template_source,p.product.profileDepths).then(function(e){p.product.template=angular.copy(e),c.global.isSashesInTemplate=B(p.product.template_source),c.global.isRoomElements=1,i.resolve(1)}),i.promise;
}function U(e,t){t?e.hardware=x(t,c.global.hardwares):c.global.isSashesInTemplate?e.hardware=c.global.hardwares[0][0]:e.hardware={}}function F(e,i){var o=t.defer(),a=p.product.glass.map(function(o){var a=t.defer();return o.glass_width?r.selectLocalDB(r.tablesLocalDB.beed_profile_systems.tableName,{profile_system_id:e,glass_width:o.glass_width},"list_id").then(function(e){var n=e.length,l={glassId:o.id,beadId:0};if(n)if(n>1){var s=e.map(function(e){var o=t.defer();return r.selectLocalDB(r.tablesLocalDB.lists.tableName,{id:e.list_id},"beed_lamination_id as id").then(function(e){e&&e[0].id===i?o.resolve(1):o.resolve(0)}),o.promise});t.all(s).then(function(t){for(var i=t.length;--i>-1;)t[i]&&(l.beadId=e[i].list_id,a.resolve(l));l.beadId||(console.log("Error in bead!!"),a.resolve(0))})}else l.beadId=e[0].list_id,a.resolve(l);else console.log("Error in bead!!"),a.resolve(0)}):(console.log("item.glass_width === 0"),a.resolve(0)),a.promise});return o.resolve(t.all(a)),o.promise}function z(e){var t=c.global.deliveryCoeff.percents[c.global.deliveryCoeff.standart_time],i=a.setPriceDis(e.template_price,u.order.discount_construct);e.product_price=a.roundingValue(e.template_price+e.addelem_price),e.productPriceDis=i+e.addelemPriceDis,t&&(e.productPriceDis=a.setPriceDis(e.productPriceDis,t)),c.global.isLoader=0}function Y(e){var i=t.defer();return r.calculationPrice(e).then(function(e){var t,o,n=angular.copy(e);n.priceTotal?4===p.product.construction_type?r.calcDoorElemPrice(p.product.doorHandle,p.product.doorLock.elem).then(function(e){o=angular.copy(e),n.priceTotal+=o.priceTot,n.constrElements=n.constrElements.concat(o.elements),t=a.addMarginToPrice(n.priceTotal,c.global.margins.coeff),p.product.template_price=a.roundingValue(t,2),z(p.product),i.resolve(n)}):(t=a.addMarginToPrice(n.priceTotal,c.global.margins.coeff),p.product.template_price=a.roundingValue(t,2),z(p.product),i.resolve(n)):(p.product.template_price=0,i.resolve(0))}),i.promise}function W(e){var t,i,o,r,n,l=[],s=e.length;if(s){for(t=0;t<s;t+=1)if(i=angular.copy(e[t]),i.element_id=angular.copy(i.id),i.amount=angular.copy(i.qty),delete i.id,delete i.amendment_pruninng,delete i.currency_id,delete i.qty,delete i.waste,t){if(o=l.length,r=0,o){for(;--o>-1;)l[o].element_id===i.element_id&&l[o].size===i.size&&(r++,l[o].amount+=i.amount,l[o].priceReal+=i.priceReal);r||l.push(i)}}else l.push(i);for(o=l.length;--o>-1;)l[o].amount=a.roundingValue(l[o].amount,3),n=a.addMarginToPrice(l[o].priceReal,c.global.margins.coeff),l[o].priceReal=a.roundingValue(n,2)}return l}function q(e){for(var t,i=0,o=e.sizes[5].length,r=p.product.glass.length,n=0,l=0,s=0,d=0,u={},m=[0,.05,.06,.01,.01,.01],f=0;f<p.product.template.details.length;f+=1)p.product.template.details[f].children.length||(u=_.findWhere(_.flatten(c.global.glasses),{id:p.product.template.details[f].glassId}),d+=(2*p.product.template.details[f].pointsIn[0].x+2*p.product.template.details[f].pointsIn[0].y)/1e3*m[u.glass_type]);for(;--o>-1;){for(t=0;t<r;t+=1)e.sizes[5][o].elemId==p.product.glass[t].id&&(angular.isNumber(p.product.glass[t].transcalency)||(p.product.glass[t].transcalency=1),n+=e.sizes[5][o].square/p.product.glass[t].transcalency);i+=e.sizes[5][o].square}n=a.roundingValue(n),i=a.roundingValue(i,3),angular.isNumber(p.product.profile.heat_coeff_value)||(p.product.profile.heat_coeff_value=1),l=(p.product.template_square-i)/p.product.profile.heat_coeff_value,s=l+n+d,g.userInfo.therm_coeff_id?p.product.heat_coef_total=a.roundingValue(p.product.template_square/s):p.product.heat_coef_total=a.roundingValue(p.product.template_square/s)}function j(e,i,r,n,l){var s=t.defer();return c.global.isLoader=1,F(i,l).then(function(t){if(t.length&&t[0]){var i=a.removeDuplicates(angular.copy(t).map(function(t){for(var i=e.priceElements.beadsSize.length;--i>-1;)e.priceElements.beadsSize[i].glassId===t.glassId&&(e.priceElements.beadsSize[i].elemId=t.beadId);return t.beadId})),m={laminationId:l,ids:[p.product.profile.rama_list_id,p.product.profile.rama_still_list_id,p.product.profile.stvorka_list_id,p.product.profile.impost_list_id,p.product.profile.shtulp_list_id,r.length>1?r.map(function(e){return e.id}):r[0].id,i.length>1?i:i[0],4===p.product.construction_type?0:n],sizes:[]};p.product.beadsData=angular.copy(e.priceElements.beadsSize);for(var f in e.priceElements)m.sizes.push(angular.copy(e.priceElements[f]));p.product.template_width=0,p.product.template_height=0,p.product.template_square=0;for(var _=p.product.template.details[0].overallDim.length;--_>-1;)p.product.template_width+=p.product.template.details[0].overallDim[_].w,p.product.template_height+=p.product.template.details[0].overallDim[_].h,p.product.template_square+=p.product.template.details[0].overallDim[_].square;Y(m).then(function(e){s.resolve(1),e&&(5!==g.userInfo.user_type&&7!==g.userInfo.user_type||(p.product.report=W(e.constrElements)))}),q(m),c.global.startProgramm&&o(function(){d.sendAnalyticsData(g.userInfo.id,u.order.id,p.product.template_id,p.product.profile.id,1)},5e3)}else s.resolve(1)}),s.promise}function Q(){var e=t.defer();return V(p.product.template_id).then(function(){U(p.product);var t=p.product.hardware.id||0;j(p.product.template,p.product.profile.id,p.product.glass,t,p.product.lamination.lamination_in_id).then(function(){e.resolve(1)})}),e.promise}function K(e){var i=t.defer();return N(e).then(function(e){e?(c.global.templatesSourceSTORE=angular.copy(e),c.global.templatesSource=angular.copy(e),O(p.product).then(function(){Q().then(function(){i.resolve(1)})})):i.resolve(0)}),i.promise}function X(e){for(var t=c.global.lamGroupFiltered.length,i=1;--t>-1;)c.global.lamGroupFiltered[t].id===e&&(i=0);return i}function Z(){for(var e,t=c.global.doorsLaminations.length,i=c.global.laminats.length;--t>-1;)for(e=0;e<i;e+=1)c.global.laminats[e].id===c.global.doorsLaminations[t].lamination_in&&(c.global.doorsLaminations[t].laminat_in_name=c.global.laminats[e].name,c.global.doorsLaminations[t].img_in_id=c.global.laminats[e].type_id,c.global.doorsLaminations[t].lamination_in_id=c.global.doorsLaminations[t].lamination_in,delete c.global.doorsLaminations[t].lamination_in),c.global.laminats[e].id===c.global.doorsLaminations[t].lamination_out&&(c.global.doorsLaminations[t].laminat_out_name=c.global.laminats[e].name,c.global.doorsLaminations[t].img_out_id=c.global.laminats[e].type_id,c.global.doorsLaminations[t].lamination_out_id=c.global.doorsLaminations[t].lamination_out,delete c.global.doorsLaminations[t].lamination_out)}function J(){if(4!==p.product.construction_type)var e,t=c.global.laminats.length,i=c.global.laminatCouples.filter(function(e){return!e.profile_id||e.profile_id===p.product.profile.id}),o=0;else for(var e,t=c.global.laminats.length,i=c.global.doorsLaminations.filter(function(e){return e.group_id===c.global.type_door}),o=0,r=0;r<i.length;r+=1)i[r].rama_still_list_id=i[r].door_sill_list_id;for(c.global.lamGroupFiltered.length=0;--t>-1;)if(c.global.laminats[t].isActive)for(o=1,e=i.length;--e>-1;)i[e].img_in_id===c.global.laminats[t].type_id?X(i[e].id)&&c.global.lamGroupFiltered.push(i[e]):i[e].img_out_id===c.global.laminats[t].type_id&&X(i[e].id)&&c.global.lamGroupFiltered.push(i[e]);c.global.lamGroupFiltered.length||o||(c.global.lamGroupFiltered=i)}function ee(){for(var e=c.global.laminats.length;--e>-1;)c.global.laminats[e].isActive=0}function te(e,t){var i=[];i=4!==p.product.construction_type?angular.copy(c.global.laminatCouples):angular.copy(c.global.doorsLaminations);var o=i.length;for(ee();--o>-1;)if(t)i[o].id===t&&(e.lamination=i[o]);else if(!i[o].id){var r=angular.copy(x(e.profile.id,c.global.profiles));e.lamination=i[o],e.lamination.rama_list_id=r.rama_list_id,e.lamination.rama_still_list_id=r.rama_still_list_id,e.lamination.stvorka_list_id=r.stvorka_list_id,e.lamination.impost_list_id=r.impost_list_id,e.lamination.shtulp_list_id=r.shtulp_list_id}}function ie(e){var i=t.defer();return(e||0==e)&&(4!==p.product.construction_type?(p.product.profile.rama_list_id=p.product.lamination.rama_list_id,p.product.profile.rama_still_list_id=p.product.lamination.rama_still_list_id,p.product.profile.stvorka_list_id=p.product.lamination.stvorka_list_id,p.product.profile.impost_list_id=p.product.lamination.impost_list_id,p.product.profile.shtulp_list_id=p.product.lamination.shtulp_list_id):(p.product.profile=angular.copy(oe(p.product.door_shape_id,p.product)),p.product.profile.rama_still_list_id=p.product.profile.door_sill_list_id)),t.all([R(p.product.profile.rama_list_id),R(p.product.profile.rama_still_list_id),R(p.product.profile.stvorka_list_id),R(p.product.profile.impost_list_id),R(p.product.profile.shtulp_list_id)]).then(function(e){p.product.profileDepths.frameDepth=e[0],p.product.profileDepths.frameStillDepth=e[1],p.product.profileDepths.sashDepth=e[2],p.product.profileDepths.impostDepth=e[3],p.product.profileDepths.shtulpDepth=e[4];var t=4!==p.product.construction_type?p.product.profile.id:p.product.profile.profileId;n.createSVGTemplate(p.product.template_source,p.product.profileDepths).then(function(e){p.product.template=angular.copy(e);var o=p.product.hardware.id||0;j(p.product.template,t,p.product.glass,o,p.product.lamination.lamination_in_id).then(function(){i.resolve(1)}),n.createSVGTemplateIcon(p.product.template_source,p.product.profileDepths).then(function(e){p.product.templateIcon=angular.copy(e)})})}),i.promise}function oe(e,t){for(var i=angular.copy(c.global.lamGroupFiltered),o=0;o<i.length;o+=1)if(t.lamination.lamination_in_id===i[o].lamination_in_id&&t.lamination.lamination_out_id===i[o].lamination_out_id){t.profile.door_sill_list_id=i[o].door_sill_list_id,t.profile.impost_list_id=i[o].impost_list_id,t.profile.rama_list_id=i[o].rama_list_id,t.profile.shtulp_list_id=i[o].shtulp_list_id,t.profile.stvorka_list_id=i[o].stvorka_list_id;break}return t.profile}function re(e){var t,o,r,n,l,s,d,c,u=e.details,g=u.length;h.design.extraGlass.length=0,p.product.glass.forEach(function(e){if(e.max_sq||e.max_width&&e.max_height&&e.min_width&&e.min_height)for(c=1;c<g;c+=1)s=0,d=0,u[c].glassId===e.id&&u[c].glassPoints&&u[c].glassPoints.length&&(o=a.getMaxMinCoord(u[c].glassPoints),r=Math.round(o.maxX-o.minX),n=Math.round(o.maxY-o.minY),l=a.roundingValue(r*n/1e6,3),l>e.max_sq&&(t=i("translate")("design.GLASS")+" "+e.name+" "+i("translate")("design.GLASS_SQUARE")+" "+l+" "+i("translate")("design.MAX_VALUE_HIGHER")+" "+e.max_sq+" "+i("translate")("common_words.LETTER_M")+"2.",h.design.extraGlass.push(t)),(r>e.max_width||r<e.min_width)&&(s=1),(n>e.max_height||n<e.min_height)&&(d=1),s&&d?(t=i("translate")("design.GLASS")+" "+e.name+" "+i("translate")("design.GLASS_SIZE")+" "+r+" x "+n+" "+i("translate")("design.NO_MATCH_RANGE")+" "+i("translate")("design.BY_WIDTH")+" "+e.min_width+" - "+e.max_width+", "+i("translate")("design.BY_HEIGHT")+" "+e.min_height+" - "+e.max_height+".",h.design.extraGlass.push(t)):s&&!d?(t=i("translate")("design.GLASS")+" "+e.name+" "+i("translate")("design.GLASS_SIZE")+" "+r+" x "+n+" "+i("translate")("design.NO_MATCH_RANGE")+" "+i("translate")("design.BY_WIDTH")+" "+e.min_width+" - "+e.max_width+".",h.design.extraGlass.push(t)):!s&&d&&(t=i("translate")("design.GLASS")+" "+e.name+" "+i("translate")("design.GLASS_SIZE")+" "+r+" x "+n+" "+i("translate")("design.NO_MATCH_RANGE")+" "+i("translate")("design.BY_HEIGHT")+" "+e.min_height+" - "+e.max_height+".",h.design.extraGlass.push(t)))})}function ae(e,t){if(4!==p.product.construction_type){var o,r,n,l,s,d,u,g=e.details,m=g.length,f=t||p.product.hardware.id,_=c.global.hardwareLimits.filter(function(e){return e.group_id===f}),y=_.length,E=0;if(h.design.extraHardware.length=0,y)for(d=1;d<m;d+=1)if(s=0,"sash"===g[d].blockType){for(u=0;u<y;u+=1)if(_[u].type_id===g[d].sashType){_[u].max_width&&_[u].max_height&&_[u].min_width&&_[u].min_height&&(E=_[u]);break}E&&g[d].hardwarePoints.length&&(o=a.getMaxMinCoord(g[d].hardwarePoints),r=Math.round(o.maxX-o.minX),n=Math.round(o.maxY-o.minY),(r>E.max_width||r<E.min_width)&&(s=1),(n>E.max_height||n<E.min_height)&&(s=1),s&&(l=r+" x "+n+" "+i("translate")("design.NO_MATCH_RANGE")+" ("+E.min_width+" - "+E.max_width+") x ("+E.min_height+" - "+E.max_height+")",h.design.extraHardware.push(l)))}}}function ne(e,t){if(c.global.isInfoBox!==e){for(var i=t.length,o={};--i>-1;)t[i].lamination_type_id?t[i].lamination_type_id===e&&(o=t[i]):t[i].id===e&&(o=t[i]);$.isEmptyObject(o)||(c.global.infoTitle=o.name,c.global.infoImg=o.img,c.global.infoLink=o.link,c.global.infoDescrip=o.description,c.global.isInfoBox=e)}}function le(){p.product=p.setDefaultProduct(),A(),L(),c.global.isChangedTemplate=0,c.global.isShowCommentBlock=0,c.global.isCreatedNewProject=1,c.global.isCreatedNewProduct=1,D(),K(p.product.construction_type).then(function(){c.global.isLoader=0,T(),ee(),J(),"main"!==c.global.currOpenPage&&(c.global.showRoomSelectorDialog=0,e.path("/main"),o(function(){c.global.showRoomSelectorDialog=1},1e3))})}function se(){p.product=p.setDefaultProduct(),c.global.isCreatedNewProduct=1,c.global.isChangedTemplate=0,D(),K(p.product.construction_type).then(function(){T(),ee(),J(),"main"!==c.global.currOpenPage&&(c.global.showRoomSelectorDialog=0,e.path("/main"),o(function(){c.global.showRoomSelectorDialog=1},1e3))})}function de(){for(var e=p.product.chosenAddElements.length,t=0;--e>-1;)p.product.chosenAddElements[e].length&&t++;return t}function ce(){var e=1;if(p.product.is_addelem_only&&(e=de()),e){if(c.global.tempAddElements.length=0,c.global.configMenuTips=0,c.global.isShowCommentBlock=0,v(),c.global.productEditNumber)for(var t=u.order.products.length;--t>-1;)u.order.products[t].product_id===c.global.productEditNumber&&(u.order.products[t]=angular.copy(p.product));else p.product.product_id=u.order.products.length>0?u.order.products.length+1:1,delete p.product.template,u.order.products.push(p.product);c.global.isCreatedNewProduct=0,a.stopStartProg()}return e}function ue(){o(function(){a.setPreviosPage(),e.path("/cart")},100)}function pe(e){r.deleteRowLocalDB(r.tablesLocalDB.orders.tableName,{id:e}),r.deleteRowLocalDB(r.tablesLocalDB.order_products.tableName,{order_id:e}),r.deleteRowLocalDB(r.tablesLocalDB.order_addelements.tableName,{order_id:e})}function ge(e,i,o){function n(){var e,n=t.defer(),s=u.order.products.length;for(u.order.products_qty=0,e=0;e<s;e+=1){var d=angular.copy(u.order.products[e]);d.order_id=u.order.id,d.is_addelem_only||(d.template_source.beads=angular.copy(d.beadsData)),4===d.construction_type?d.profile_id=0:(d.profile_id=u.order.products[e].profile.id,d.door_group_id?d.door_group_id=0:d.door_group_id=0),d.glass_id=u.order.products[e].glass.map(function(e){return e.id}).join(", "),4===d.construction_type?d.hardware_id=d.doorLock.id:d.hardware.id?d.hardware_id=d.hardware.id:d.hardware_id=0,d.lamination_id=u.order.products[e].lamination.id,d.template_source=JSON.stringify(d.template_source),d.lamination_in_id=u.order.products[e].lamination.img_in_id,d.lamination_out_id=u.order.products[e].lamination.img_out_id,d.modified=new Date,d.template&&delete d.template,delete d.templateIcon,delete d.profile,delete d.glass,delete d.hardware,delete d.lamination,delete d.chosenAddElements,delete d.profileDepths,delete d.addelemPriceDis,delete d.productPriceDis,delete d.report,delete d.beadsData,delete d.doorName,delete d.doorSashName,delete d.doorHandle,delete d.doorLock,u.order.products_qty+=u.order.products[e].product_qty,i&&(r.insertRowLocalDB(d,r.tablesLocalDB.order_products.tableName),r.insertServer(g.userInfo.phone,g.userInfo.device_code,r.tablesLocalDB.order_products.tableName,d));for(var p=angular.copy(u.order.products[e].report),m=p.length;--m>-1;)p[m].order_id=u.order.id,p[m].price=angular.copy(p[m].priceReal),delete p[m].priceReal;var _,h=u.order.products[e].chosenAddElements.length;for(_=0;_<h;_+=1){var y,E=u.order.products[e].chosenAddElements[_].length;if(E>0)for(y=0;y<E;y+=1){20!==u.order.products[e].chosenAddElements[_][y].list_group_id||d.is_addelem_only||"number"!=typeof u.order.products[e].chosenAddElements[_][y].block_id&&(u.order.products[e].chosenAddElements[_][y].block_id=u.order.products[e].chosenAddElements[_][y].block_id.split("_")[1]);var b={order_id:u.order.id,product_id:u.order.products[e].product_id,element_type:u.order.products[e].chosenAddElements[_][y].element_type,element_id:u.order.products[e].chosenAddElements[_][y].id,name:u.order.products[e].chosenAddElements[_][y].name,element_width:u.order.products[e].chosenAddElements[_][y].element_width,element_height:u.order.products[e].chosenAddElements[_][y].element_height,element_price:u.order.products[e].chosenAddElements[_][y].element_price,element_qty:u.order.products[e].chosenAddElements[_][y].element_qty,block_id:1*u.order.products[e].chosenAddElements[_][y].block_id,modified:new Date};i&&(r.insertRowLocalDB(b,r.tablesLocalDB.order_addelements.tableName),r.insertServer(g.userInfo.phone,g.userInfo.device_code,r.tablesLocalDB.order_addelements.tableName,b))}}}var v=angular.copy(u.order);if(v.order_date=new Date(u.order.order_date),v.order_type=i,v.order_price_dis=u.order.order_price_dis,v.order_price=u.order.order_price,v.order_price_primary=u.order.order_price_primary,v.order_style=o,v.factory_id=g.userInfo.factory_id,v.user_id=g.userInfo.id,v.comment=u.order.comment,v.delivery_date=new Date(u.order.delivery_date),v.new_delivery_date=new Date(u.order.new_delivery_date),v.customer_sex=+u.order.customer_sex||0,v.customer_age=u.order.customer_age?u.order.customer_age.id:0,v.customer_education=u.order.customer_education?u.order.customer_education.id:0,v.customer_occupation=u.order.customer_occupation?u.order.customer_occupation.id:0,v.customer_infoSource=u.order.customer_infoSource?u.order.customer_infoSource.id:0,v.products_qty=a.roundingValue(u.order.products_qty),v.discount_construct_max=g.userInfo.discountConstrMax,v.discount_addelem_max=g.userInfo.discountAddElemMax,v.default_term_plant=c.global.deliveryCoeff.percents[c.global.deliveryCoeff.standart_time],v.disc_term_plant=f.cart.discountDeliveyPlant,v.margin_plant=f.cart.marginDeliveyPlant,i&&0===v.order_edit&&(v.additional_payment="",v.created=new Date,v.sended=new Date(0),v.state_to=new Date(0),v.state_buch=new Date(0),v.batch="---",v.base_price=0,v.factory_margin=0,v.purchase_price=0,v.sale_price=0,v.modified=new Date),delete v.products,delete v.floorName,delete v.mountingName,delete v.selectedInstalmentPeriod,delete v.selectedInstalmentPercent,delete v.productsPriceDis,delete v.orderPricePrimaryDis,delete v.paymentFirstDis,delete v.paymentMonthlyDis,delete v.paymentFirstPrimaryDis,delete v.paymentMonthlyPrimaryDis,i&&0===v.order_edit)delete v.order_edit,r.insertServer(g.userInfo.phone,g.userInfo.device_code,r.tablesLocalDB.orders.tableName,v).then(function(e){_e&&navigator.onLine?e.status&&(v.order_number=e.order_number):v.order_number=0,r.insertRowLocalDB(v,r.tablesLocalDB.orders.tableName),n.resolve(1)});else if(i&&1===v.order_edit){var T=angular.copy(v.id);delete v.order_edit,r.updateOrderServer(g.userInfo.phone,g.userInfo.device_code,r.tablesLocalDB.orders.tableName,v,T).then(function(e){r.updateLocalDB(r.tablesLocalDB.orders.tableName,v,{id:T}),n.resolve(1)})}return u.order=u.setDefaultOrder(),l.setUserGeoLocation(g.userInfo.city_id,g.userInfo.cityName,g.userInfo.climaticZone,g.userInfo.heatTransfer,g.userInfo.fullLocation),c.global.isCreatedNewProject=0,n.promise}var s=t.defer();return angular.extend(u.order,e),1===u.order.order_edit?(r.deleteRowLocalDB(r.tablesLocalDB.order_products.tableName,{order_id:u.order.id}),r.deleteRowLocalDB(r.tablesLocalDB.order_addelements.tableName,{order_id:u.order.id}),r.deleteProductServer(g.userInfo.phone,g.userInfo.device_code,u.order.id,r.tablesLocalDB.order_products.tableName).then(function(e){console.info("delete old products",e),r.deleteProductServer(g.userInfo.phone,g.userInfo.device_code,u.order.id,r.tablesLocalDB.order_addelements.tableName).then(function(e){console.info("delete old addElem",e),n().then(function(e){console.info("result edit order",e),s.resolve(1)})})})):n().then(function(e){console.info("result save order",e),s.resolve(1)}),s.promise}function me(){var e=angular.copy(p.product),t=c.global.glassesAll.filter(function(t){return e.profile.profileId&&4==e.construction_type?t.profileId===e.profile.profileId:t.profileId===e.profile.id});c.global.glasses=angular.copy(t[0].glasses)}function fe(e,t,i){i.glass.length=0;var o=c.global.glassesAll.filter(function(t){return t.profileId===e});c.global.glasses=angular.copy(o[0].glasses),i.glass.push(angular.copy(c.global.glasses[0][0])),c.global.glassTypes=angular.copy(o[0].glassTypes),c.global.selectGlassId=i.glass[0].id,c.global.selectGlassName=i.glass[0].sku;for(var r=0;r<t.details.length;r+=1)t.details[r].glassId=i.glass[0].id,t.details[r].glassTxt=i.glass[0].sku,t.details[r].glass_type=i.glass[0].glass_type}var _e,he=this;return $.get("http://api.steko.com.ua",function(e){return _e=!0,!0}).fail(function(){return _e=!1,!1}),he.publicObj={setGlassfilter:me,setGlassDefault:fe,saveUserEntry:I,createOrderData:A,createOrderID:S,doorProfile:P,setCurrDiscounts:L,setCurrTemplate:D,prepareTemplates:K,downloadAllTemplates:N,setCurrentProfile:O,setCurrentDoorProfile:C,setCurrentGlass:k,setGlassToTemplateBlocks:M,setCurrentHardware:U,fineItemById:x,parseTemplate:Q,saveTemplateInProduct:V,downloadProfileDepth:R,saveTemplateInProductForOrder:H,checkSashInTemplate:B,preparePrice:j,setProductPriceTOTAL:z,showInfoBox:ne,closeRoomSelectorDialog:E,laminatFiltering:J,laminationDoor:Z,setCurrLamination:te,setProfileByLaminat:ie,checkGlassSizes:re,checkHardwareSizes:ae,createNewProject:le,createNewProduct:se,setDefaultDoorConfig:b,prepareMainPage:T,setDefaultAuxParam:v,inputProductInOrder:ce,goToCart:ue,saveOrderInDB:ge,deleteOrderInDB:pe,setCurrentGlassForTemplate:G},he.publicObj}])}(),function(){angular.module("MainModule").factory("NavMenuServ",["$location","$http","$filter","$cordovaGeolocation","GeneralServ","MainServ","CartMenuServ","GlobalStor","OrderStor","ProductStor",function(e,t,i,o,r,a,n,l,s,d){function c(){function e(e){var i=e.coords.latitude,o=e.coords.longitude;t.get("http://maps.googleapis.com/maps/api/geocode/json?latlng="+i+","+o+"&sensor=true&language=ru").then(function(e){var t=e.results[0].formatted_address.split(", ");s.order.customer_city_id=156,s.order.customer_city=t[t.length-3],s.order.climatic_zone=7,s.order.heat_coef_min=.99,s.order.customer_location=t[t.length-3]+", "+t[t.length-2]+", "+t[t.length-1]},function(e,t){console.log("Something went wrong with User recive!",e,t)})}function i(e){console.log(e.message)}o.getCurrentPosition().then(e,i)}function u(){var e="ru_RU";return e}function p(){l.global.isVoiceHelper=!l.global.isVoiceHelper,l.global.isVoiceHelper&&(l.global.voiceHelperLanguage=u(),playTTS(i("translate")("construction.VOICE_SWITCH_ON"),l.global.voiceHelperLanguage))}function g(){l.global.isNavMenu=!1,l.global.isConfigMenu=!0,r.setPreviosPage(),e.path("/history")}function m(){r.stopStartProg(),d.product.is_addelem_only?a.createNewProduct():(d.product=d.setDefaultProduct(),a.closeRoomSelectorDialog(),a.setDefaultAuxParam(),d.product.is_addelem_only=1,l.global.isNavMenu=0,l.global.isConfigMenu=1,l.global.activePanel=6)}function f(){l.global.startProgramm?(r.stopStartProg(),a.prepareMainPage()):(l.global.isLoader=1,l.global.isCreatedNewProject&&l.global.isCreatedNewProduct?a.inputProductInOrder()&&(n.calculateOrderPrice(),a.saveOrderInDB({},0,"")):l.global.isCreatedNewProject&&!l.global.isCreatedNewProduct&&a.saveOrderInDB({},0,""),r.setPreviosPage(),a.createNewProject())}var _=this;return _.publicObj={getCurrentGeolocation:c,setLanguageVoiceHelper:u,switchVoiceHelper:p,gotoHistoryPage:g,createAddElementsProduct:m,clickNewProject:f},_.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("optionsServ",["$filter",function(e){return{getTemplateImgIcons:function(t){t(new OkResult({templateImgs:[{id:1,name:e("translate")("panels.1_TYPE"),src:"img/templates/1.png",type:1},{id:3,name:e("translate")("panels.2_TYPE"),src:"img/templates/2.png",type:1},{id:4,name:e("translate")("panels.3_TYPE"),src:"img/templates/3.png",type:1},{id:5,name:e("translate")("panels.4_TYPE"),src:"img/templates/4.png",type:1},{id:6,name:e("translate")("panels.5_TYPE"),src:"img/templates/5.png",type:1},{id:7,name:e("translate")("panels.6_TYPE"),src:"img/templates/6.png",type:1},{id:8,name:e("translate")("panels.7_TYPE"),src:"img/templates/7.png",type:1},{id:9,name:e("translate")("panels.8_TYPE"),src:"img/templates/8.png",type:1},{id:10,name:e("translate")("panels.9_TYPE"),src:"img/templates/9.png",type:1},{id:11,name:e("translate")("panels.10_TYPE"),src:"img/templates/10.png",type:1},{id:12,name:e("translate")("panels.11_TYPE"),src:"img/templates/11.png",type:1},{id:1,name:e("translate")("panels.21_TYPE"),src:"img/templates/21.png",type:2},{id:2,name:e("translate")("panels.22_TYPE"),src:"img/templates/22.png",type:2},{id:3,name:e("translate")("panels.23_TYPE"),src:"img/templates/23.png",type:2},{id:1,name:e("translate")("panels.31_TYPE"),src:"img/templates/31.png",type:4},{id:2,name:e("translate")("panels.32_TYPE"),src:"img/templates/32.png",type:4}]}))},getTemplatesWindow:function(e){e(new OkResult({windows:[{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:[],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1300,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1300,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"sash",parent:"block_0",children:[],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:700,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:700,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",gridId:0,gridTxt:"",openDir:[4],handlePos:4,sashType:2}],hardwareLines:[[490,1190,490,1190]]},{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"sash",parent:"block_0",children:[],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:700,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:700,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",gridId:0,gridTxt:"",openDir:[1,4],handlePos:4,sashType:6}],hardwareLines:[[490,1190,490,1190]]},{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1300,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1300,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"impost",id:"ip1",x:650,y:0,dir:"line",dimType:0},{type:"impost",id:"ip1",x:650,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"}]},{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1300,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1300,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"impost",id:"ip1",x:650,y:0,dir:"line",dimType:0},{type:"impost",id:"ip1",x:650,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"},{type:"skylight",id:"block_3",level:2,blockType:"sash",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",gridId:0,gridTxt:"",openDir:[4],handlePos:4,sashType:2}],hardwareLines:[[482,1190,482,1190]]},{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1300,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1300,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"impost",id:"ip1",x:650,y:0,dir:"line",dimType:0},{type:"impost",id:"ip1",x:650,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"},{type:"skylight",id:"block_3",level:2,blockType:"sash",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",gridId:0,gridTxt:"",openDir:[1,4],handlePos:4,sashType:6}],hardwareLines:[[482,1190,482,1190]]},{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1300,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1300,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"impost",id:"ip1",x:650,y:0,dir:"line",dimType:0},{type:"impost",id:"ip1",x:650,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_2",level:2,blockType:"sash",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",gridId:0,gridTxt:"",openDir:[2],handlePos:2,sashType:2},{type:"skylight",id:"block_3",level:2,blockType:"sash",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",gridId:0,gridTxt:"",openDir:[1,4],handlePos:4,sashType:6}],hardwareLines:[[482,1190,482,1190]]},{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1300,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1300,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"shtulp",id:"sht1",x:650,y:0,dir:"line",dimType:0},{type:"shtulp",
id:"sht1",x:650,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_2",level:2,blockType:"sash",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",openDir:[2],handlePos:0,sashType:4},{type:"skylight",id:"block_3",level:2,blockType:"sash",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",openDir:[1,4],handlePos:4,sashType:17}],hardwareLines:[[497,1190,497,1190]]},{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:2100,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:2100,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"impost",id:"ip1",x:1400,y:0,dir:"line",dimType:0},{type:"impost",id:"ip1",x:1400,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"impost",id:"ip2",x:700,y:0,dir:"line",dimType:0},{type:"impost",id:"ip2",x:700,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"}],hardwareLines:[[497,1190,497,1190]]},{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:2100,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:2100,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"impost",id:"ip1",x:700,y:0,dir:"line",dimType:0},{type:"impost",id:"ip1",x:700,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_6","block_7"],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"impost",id:"ip3",x:1400,y:0,dir:"line",dimType:0},{type:"impost",id:"ip3",x:1400,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_6",level:3,blockType:"sash",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",gridId:0,gridTxt:"",openDir:[4],handlePos:4,sashType:2},{type:"skylight",id:"block_7",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"}],hardwareLines:[[574,1191,574,1191]]},{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:2100,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:2100,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"impost",id:"ip1",x:700,y:0,dir:"line",dimType:0},{type:"impost",id:"ip1",x:700,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_6","block_7"],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"impost",id:"ip3",x:1400,y:0,dir:"line",dimType:0},{type:"impost",id:"ip3",x:1400,y:1400,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_6",level:3,blockType:"sash",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",gridId:0,gridTxt:"",openDir:[1,4],handlePos:4,sashType:6},{type:"skylight",id:"block_7",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"}],hardwareLines:[[574,1191,574,1191]]}]}))},getTemplatesWindowDoor:function(e){e(new OkResult({windowDoor:[{name:"поворотно-откидные",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1","block_2"],maxSizeLimit:5e3},{type:"skylight",id:"block_2",level:1,blockType:"sash",parent:"block_0",children:["block_3","block_4"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:700,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:700,y:2100,dir:"line",sill:1,view:1},{type:"frame",id:"fp4",x:0,y:2100,dir:"line",sill:1,view:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",gridId:0,gridTxt:"",openDir:[1,4],handlePos:4,sashType:6,impost:{impostAxis:[{type:"impost",id:"ip2",x:0,y:1400,dir:"line",dimType:1},{type:"impost",id:"ip2",x:700,y:1400,dir:"line",dimType:1}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"},{type:"skylight",id:"block_4",level:2,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"}],hardwareLines:[[490,1890,490,1890]]},{name:"поворотно",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1","block_2"],maxSizeLimit:5e3},{type:"skylight",id:"block_2",level:1,blockType:"sash",parent:"block_0",children:["block_3","block_4"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:700,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:700,y:2100,dir:"line",sill:1,view:1},{type:"frame",id:"fp4",x:0,y:2100,dir:"line",sill:1,view:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",gridId:0,gridTxt:"",openDir:[4],handlePos:4,sashType:2,impost:{impostAxis:[{type:"impost",id:"ip2",x:0,y:1400,dir:"line",dimType:1},{type:"impost",id:"ip2",x:700,y:1400,dir:"line",dimType:1}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"},{type:"skylight",id:"block_4",level:2,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"}],hardwareLines:[[490,1890,490,1890]]},{name:"Штульповые",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1","block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_2",level:1,blockType:"frame",parent:"block_0",children:["block_3","block_4"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1300,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1300,y:2100,sill:1,dir:"line",view:1},{type:"frame",id:"fp4",x:0,y:2100,dir:"line",view:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1,impost:{impostAxis:[{type:"shtulp",id:"sht2",x:650,y:0,sill:1,dir:"line",dimType:0},{type:"shtulp",id:"sht2",x:650,y:2100,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_3",level:2,blockType:"sash",parent:"block_2",children:["block_5","block_6"],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1,openDir:[2],handlePos:0,sashType:4,impost:{impostAxis:[{type:"impost",id:"ip3",x:0,y:1400,dir:"line",dimType:1},{type:"impost",id:"ip3",x:650,y:1400,dir:"line",dimType:1}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_4",level:2,blockType:"sash",parent:"block_2",children:["block_7","block_8"],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1,openDir:[1,4],handlePos:4,sashType:17,impost:{impostAxis:[{type:"impost",id:"ip4",x:650,y:1400,dir:"line",dimType:1},{type:"impost",id:"ip4",x:1300,y:1400,dir:"line",dimType:1}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1},{type:"skylight",id:"block_6",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1},{type:"skylight",id:"block_7",level:3,blockType:"frame",parent:"block_4",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1},{type:"skylight",id:"block_8",level:3,blockType:"frame",parent:"block_4",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1}],hardwareLines:[[497,1890,497,1890]]}]}))},getTemplatesBalcony:function(e){e(new OkResult({balconies:[{name:"Трехстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:700,y:0,dir:"line"},{type:"impost",id:"ip1",x:700,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:2100,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:2100,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],pointsOut:[],pointsIn:[],pointsLight:[],impost:{impostAxis:[{type:"impost",id:"ip3",x:1400,y:0,dir:"line"},{type:"impost",id:"ip3",x:1400,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Штульповые",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1","block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_2",level:1,blockType:"frame",parent:"block_0",children:["block_3","block_4"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1300,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1300,y:2100,dir:"line",view:1},{type:"frame",id:"fp4",x:0,y:2100,dir:"line",view:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",impost:{impostAxis:[{type:"shtulp",id:"sht2",x:650,y:0,dir:"line",dimType:0},{type:"shtulp",id:"sht2",x:650,y:2100,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_3",level:2,blockType:"sash",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",openDir:[1,2],handlePos:2,sashType:6,gridId:0,gridTxt:""},{type:"skylight",id:"block_4",level:2,blockType:"sash",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",openDir:[4],handlePos:0,sashType:4}],hardwareLines:[[497,1890,497,1890]]}]}))},getTemplatesDoor:function(e){e(new OkResult({doors:[{name:"поворотно",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"sash",parent:"block_0",children:["block_2","block_3"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:900,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:900,y:2e3,dir:"line",view:1},{type:"frame",id:"fp4",x:0,y:2e3,dir:"line",view:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",openDir:[4],handlePos:4,sashType:2,impost:{impostAxis:[{type:"impost",id:"ip1",x:0,y:1300,dir:"line",dimType:1},{type:"impost",id:"ip1",x:900,y:1300,dir:"line",dimType:1}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4"}],hardwareLines:[[795,1895,795,1895]]},{name:"Одностворчатая",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1800,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1800,y:2e3,dir:"line",view:1},{type:"frame",id:"fp4",x:0,y:2e3,dir:"line",view:1}],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1,impost:{impostAxis:[{type:"shtulp",id:"sht1",x:900,y:0,dir:"line",dimType:0},{type:"shtulp",id:"sht1",x:900,y:2e3,dir:"line",dimType:0}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_2",level:2,blockType:"sash",parent:"block_1",children:["block_4","block_5"],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1,openDir:[2],handlePos:0,sashType:4,impost:{impostAxis:[{type:"impost",id:"ip2",x:0,y:1300,dir:"line",dimType:1},{type:"impost",id:"ip2",x:900,y:1300,dir:"line",dimType:1}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_3",level:2,blockType:"sash",parent:"block_1",children:["block_6","block_7"],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1,openDir:[4],handlePos:4,sashType:2,impost:{impostAxis:[{type:"impost",id:"ip3",x:900,y:1300,dir:"line",dimType:1},{type:"impost",id:"ip3",x:1800,y:1300,dir:"line",dimType:1}],impostOut:[],impostIn:[],impostLight:[]}},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1},{type:"skylight",id:"block_6",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1},{type:"skylight",id:"block_7",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:311891,glassTxt:"4-16-4",glass_type:1}],hardwareLines:[[823.5,1895,823.5,1895]]}]}))},getInstalment:function(e){e(new OkResult({instalment:[{id:1,name:1,value:15},{id:2,name:2,value:20},{id:3,name:3,value:25},{id:4,name:4,value:30},{id:5,name:5,value:35}]}))}}}])}(),function(){angular.module("BauVoiceApp").factory("PointsServ",["DesignStor","ProductStor",function(e,t){function i(e){if(e&&!$.isEmptyObject(e)){for(var i=e.details.length,o="",r="",a="",n="",l="",s="";--i>0;)if(1===e.details[i].level)for(var d=e.details[i].pointsOut.length;--d>-1;)0!==e.details[i].pointsOut[d].view&&(r+=e.details[i].pointsOut[d].x,r+=d?" "+e.details[i].pointsOut[d].y+",":" "+e.details[i].pointsOut[d].y),"fp1"!==e.details[i].pointsOut[d].id&&"fp3"!==e.details[i].pointsOut[d].id||(a+=e.details[i].pointsOut[d].x,a+=d?" "+e.details[i].pointsOut[d].y+",":" "+e.details[i].pointsOut[d].y),"fp2"!==e.details[i].pointsOut[d].id&&"fp4"!==e.details[i].pointsOut[d].id||(n+=e.details[i].pointsOut[d].x,n+=d?" "+e.details[i].pointsOut[d].y+",":" "+e.details[i].pointsOut[d].y),e.details[i].pointsOut[d]&&(o+=e.details[i].pointsOut[d].x,o+=d?" "+e.details[i].pointsOut[d].y+",":" "+e.details[i].pointsOut[d].y),"fp3"===e.details[i].pointsOut[d].id&&(l+=d?" "+e.details[i].pointsOut[d].y+",":" "+e.details[i].pointsOut[d].y),"fp3"===e.details[i].pointsOut[d].id&&(s+=e.details[i].pointsOut[d].x);var c=s,u=l;c<1?(c=t.product.template_width,u=t.product.template_height):(c=s,u=l)}return{path:o,noVvPath:r,fpDgLR:a,fpDgRL:n,heightWmd:l,widthWmd:s,widthT:c,heightT:u}}var o=this;return o.publicObj={templatePoints:i},o.publicObj}])}(),function(){angular.module("HistoryModule").factory("ProfileServ",["$location","$filter","$q","GlobalStor","ProductStor","OrderStor","MainServ","DesignStor","AnalyticsServ","UserStor","localDB",function(e,t,i,o,r,a,n,l,s,d,c){function u(e){o.global.continued=0,p(e);var t;r.product.profile.id!==e&&(t=angular.copy(r.product),n.setCurrentProfile(r.product,e).then(function(){n.saveTemplateInProduct(r.product.template_id).then(function(){n.checkGlassSizes(r.product.template),o.global.isSashesInTemplate&&n.checkHardwareSizes(r.product.template),r.product=angular.copy(t),l.design.extraGlass.length?l.design.isGlassExtra=1:l.design.extraHardware.length?l.design.isHardwareExtra=1:(n.setCurrLamination(r.product),n.setCurrentProfile(r.product,e).then(function(){n.parseTemplate().then(function(){n.laminatFiltering(),s.sendAnalyticsData(d.userInfo.id,a.order.id,r.product.template_id,e,1)})}))})}))}function p(e){var t=0;t=e,o.global.dataProfiles=[];var r=i.defer();return c.selectLocalDB(c.tablesLocalDB.elements_profile_systems.tableName,{profile_system_id:e}).then(function(e){o.global.dataProfiles=angular.copy(e),r.resolve(e)}),r.promise}function g(){var e=i.defer();o.global.nameAddElem=[];for(var t=0;t<r.product.chosenAddElements.length;t+=1)for(var a=0;a<r.product.chosenAddElements[t].length;a+=1){for(var n={name:"",product:0,tr:""},l=0;l<o.global.dataProfiles.length;l+=1)r.product.chosenAddElements[t][a].id===o.global.dataProfiles[l].list_id?n.tr=r.product.chosenAddElements[t][a].name:n.name=r.product.chosenAddElements[t][a].name;o.global.nameAddElem.push(n)}for(var s=0;s<o.global.nameAddElem.length;s+=1)o.global.nameAddElem[s].name===o.global.nameAddElem[s].tr&&delete o.global.nameAddElem[s].name;for(var s=0;s<o.global.nameAddElem.length;s+=1)void 0!==o.global.nameAddElem[s].name&&0===o.global.continued&&(o.global.dangerAlert=1);return e.promise}function m(e){i.defer();p(e).then(function(){g().then(function(){}),(o.global.dangerAlert<1||1===o.global.continued)&&u(e)})}var f=this;return n.showInfoBox,f.publicObj={alert:g,checkForAddElem:m,profileForAlert:p,selectProfile:u},f.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("RecOrderServ",["$q","$filter","GlobalStor","HistoryStor","ProductStor","GeneralServ","localDB",function(e,t,i,o,r,a,n){function l(){function e(e,t){async.waterfall([function(t){if(JSON.parse(e.template_source),0===e.is_addelem_only){if(""!==e.glass_id&&(e.nameGlass=[],e.glass_id.length)){var r=/\s*,\s*/,n=e.glass_id.split(r);e.glass_id=[],e.glass_id=angular.copy(n);n.length}for(var l=i.global.hardwares,s=0;s<l.length;s+=1)for(var d=0;d<l[s].length;d+=1){var c={name:"",id:0};c.id=i.global.hardwares[s][d].id,c.name=i.global.hardwares[s][d].name,o.history.listNameHardware.push(c)}for(var u=i.global.profiles,p=0;p<u.length;p+=1)for(var g=0;g<u[p].length;g+=1)c={},c=i.global.profiles[p][g],o.history.listNameProfiles.push(c)}for(var m=e.addElementDATA,f=a.addElementDATA,_=0;_<m.length;_+=1)if(m[_].length>0)for(var h=0;h<m[_].length;h+=1)for(var y=0;y<f.length;y+=1)m[_][h].list_group_id===f[y].id&&(m[_][h].list_group_name=f[y].name,m[_][h].list=[]);if(0===e.is_addelem_only){for(var E=i.global.laminatCouples,b={id:0,laminat_in_name:0,laminat_out_name:0,lamination_in_id:0,lamination_out_id:0,img_in_id:"",img_out_id:""},v=0;v<E.length;v+=1)E[v].id===e.lamination_id&&(b.id=E[v].id,b.laminat_in_name=E[v].laminat_in_name,b.laminat_out_name=E[v].laminat_out_name,b.lamination_in_id=E[v].lamination_in_id,b.lamination_out_id=E[v].lamination_out_id,b.img_in_id=E[v].img_in_id,b.img_out_id=E[v].img_out_id,e.lamination=angular.copy(b));for(var T=0;T<l.length;T+=1)for(var I=0;I<l[T].length;I+=1)l[T][I].id===e.hardware_id&&(e.hardwares=l[T][I]);for(var S=e.glass_id,A=0;A<S.length;A+=1)for(var L=i.global.glassesAll,D=0;D<L.length;D+=1)for(var N=0;N<L[D].glasses.length;N+=1)for(var x=0;x<L[D].glasses[N].length;x+=1){var c={name:"",id:0};e.profile_id===L[D].profileId&&e.glass_id[A]===""+L[D].glasses[N][x].id&&(c.id=L[D].glasses[N][x].id,c.name=L[D].glasses[N][x].name,e.nameGlass.push(c))}for(var R=0;R<u.length;R+=1)for(var O=0;O<u[R].length;O+=1)u[R][O].id===e.profile_id&&(e.nameProfiles=u[R][O].name)}for(var m=e.addElementDATA,C=i.global.addElementsAll,N=0;N<C.length;N+=1)for(var P=0;P<C[N].elementsList.length;P+=1)for(var w=0;w<C[N].elementsList[P].length;w+=1)for(var M=0;M<m.length;M+=1)for(var k=0;k<m[M].length;k+=1)m[M][k].list_group_id===C[N].elementsList[P][w].list_group_id&&m[M][k].list.push(C[N].elementsList[P][w]);t()}],function(e,i){return e?t(e):void t(null)})}var t=o.history.isBoxArray.products;async.eachSeries(t,e,function(e,t){console.log("end",o.history.isBoxArray)})}function s(e){for(var t=o.history.isBoxArray.products,r=i.global.glassesAll,a=[],n=0;n<t.length;n+=1)for(var l=0;l<r.length;l+=1)if(t[n].dataProfiles&&t[n].product_id===e&&t[n].dataProfiles.id===r[l].profileId)for(var s=0;s<r[l].glasses.length;s+=1)for(var d=0;d<r[l].glasses[s].length;d+=1){var c={name:"",id:0,sku:0};c.id=r[l].glasses[s][d],c.name=r[l].glasses[s][d].name,c.sku=r[l].glasses[s][d].sku,a.push(c),t[n].listNameGlass=angular.copy(a)}}function d(e){for(var r=o.history.isBoxArray.products,a=i.global.laminatCouples,n=[],l=0;l<r.length;l+=1)for(var s=0;s<a.length;s+=1)if(r[l].dataProfiles&&r[l].product_id===e){var d={name:"",nameIn:"",nameOut:"",id:0,img_in_id:0,img_out_id:0,profile_id:0,lamination:""};r[l].dataProfiles.id===a[s].profile_id?(d.profile_id=a[s].profile_id,d.id=a[s].id,d.nameIn=a[s].lamination_in_id>1?i.global.laminatCouples[s].laminat_in_name:t("translate")(i.global.laminatCouples[s].laminat_in_name),d.nameOut=a[s].lamination_out_id>1?i.global.laminatCouples[s].laminat_out_name:t("translate")(i.global.laminatCouples[s].laminat_out_name),d.img_in_id=a[s].img_in_id,d.img_out_id=a[s].img_out_id,d.lamination=a[s],d.name=d.nameIn+"/"+d.nameOut,n.push(d),r[l].listNameLaminat=n):0===a[s].id&&(d.profile_id=a[s].profile_id,d.id=a[s].id,d.nameIn=a[s].lamination_in_id>1?i.global.laminatCouples[s].laminat_in_name:t("translate")(i.global.laminatCouples[s].laminat_in_name),d.nameOut=a[s].lamination_out_id>1?i.global.laminatCouples[s].laminat_out_name:t("translate")(i.global.laminatCouples[s].laminat_out_name),d.img_in_id=a[s].img_in_id,d.img_out_id=a[s].img_out_id,d.lamination=a[s],d.name=d.nameIn+"/"+d.nameOut,n.push(d),r[l].listNameLaminat=n)}}function c(){function e(e,t){async.waterfall([function(t){if(e.dataProfiles?e.profile=e.dataProfiles:e.profile="",e.dataProfiles&&e.nameGlass){e.template_source=JSON.parse(e.template_source);for(var o=angular.copy(e.glass_id),r=0;r<e.nameGlass.length;r+=1){e.glass_id[r]=e.nameGlass[r].dataGlass.id,e.template_source.beads[r].glassId=e.nameGlass[r].dataGlass.id.id;for(var a=0;a<e.template_source.details.length;a+=1)e.template_source.details[a].glassId===1*o[r]&&(e.template_source.details[a].glassId=e.nameGlass[r].dataGlass.id.id,e.template_source.details[a].glassTxt=e.nameGlass[r].dataGlass.id.sku,e.template_source.details[a].glass_type=e.nameGlass[r].dataGlass.id.glass_color)}delete e.nameGlass}e.dataHardware?(e.hardware_id=e.dataHardware.id,delete e.dataHardware):e.hardware_id="",e.dataLamination?(e.lamination=angular.copy(e.dataLamination.lamination),delete e.dataLamination):e.lamination="";for(var n=0;n<e.addElementDATA.length;n+=1)if(e.addElementDATA[n].length>0){for(var l=0;l<e.addElementDATA[n].length;l+=1)e.addElementDATA[n][l].selectedAddElem.element_width=1*e.addElementDATA[n][l].width,e.addElementDATA[n][l].selectedAddElem.element_qty=1*e.addElementDATA[n][l].qty,e.addElementDATA[n][l].selectedAddElem.element_height=1*e.addElementDATA[n][l].height,e.addElementDATA[n][l].selectedAddElem.element_type=e.addElementDATA[n][l].element_type,e.addElementDATA[n][l].selectedAddElem.block_id=e.addElementDATA[n][l].block_id,i.push(e.addElementDATA[n][l].selectedAddElem);e.addElementDATA[n]=[],console.log(i,"obj"),e.addElementDATA[n]=angular.copy(i),i=[]}t()}],function(e,i){return e?t(e):void t(null)})}var t={},i=[];t.customer_age=o.history.isBoxArray.customer_age,t.customer_city=o.history.isBoxArray.customer_city,t.customer_city_id=o.history.isBoxArray.customer_city_id,t.customer_education=o.history.isBoxArray.customer_education,t.customer_flat=o.history.isBoxArray.customer_flat,t.customer_floor=o.history.isBoxArray.customer_floor,t.customer_house=o.history.isBoxArray.customer_house,t.customer_infoSource=o.history.isBoxArray.customer_infoSource,t.customer_location=o.history.isBoxArray.customer_location,t.customer_name=o.history.isBoxArray.customer_name,t.customer_occupation=o.history.isBoxArray.customer_occupation,t.customer_phone=o.history.isBoxArray.customer_phone,t.customer_sex=o.history.isBoxArray.customer_sex,t.discount_addelem=o.history.isBoxArray.discount_addelem,t.discount_addelem_max=o.history.isBoxArray.discount_addelem_max,t.discount_construct=o.history.isBoxArray.discount_construct,t.discount_construct_max=o.history.isBoxArray.discount_construct_max,o.history.isBoxArray.info=angular.copy(t);var r=o.history.isBoxArray.products;async.eachSeries(r,e,function(e,t){console.log("end",o.history.isBoxArray)})}var u=this;return u.publicObj={box:l,extend:c,nameListLaminat:d,nameListGlasses:s},u.publicObj}])}(),function(){angular.module("SettingsModule").factory("SettingServ",["$rootScope","$location","localDB","GlobalStor","UserStor",function(e,t,i,o,r){function a(e,t){r.userInfo.avatar=e,i.sendIMGServer(t),i.updateLocalDB(i.tablesLocalDB.users.tableName,{avatar:e},{id:r.userInfo.id})}function n(){t.path("/"+o.global.currOpenPage)}function l(){t.path("/location")}function s(){t.path("/change-pass")}function d(){t.path("/change-lang")}function c(){t.path("/settings")}function u(){console.log("prevOpenPage +++",o.global.prevOpenPage),t.path(o.global.prevOpenPage)}var p=this;return p.publicObj={changeAvatar:a,closeLocationPage:n,gotoLocationPage:l,gotoPasswordPage:s,gotoLanguagePage:d,gotoSettingsPage:c,closeSettingsPage:u},p.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("SoundPlayServ",function(){function e(){var e=document.getElementById("sounds");e.play()}var t=this;return t.soundsIntervals={menu:{start:7.93,end:11.7},swip:{start:8,end:9},price:{from:21.5,to:23.2},fly:{start:.57,end:1.59},switching:{start:1.81,end:2.88}},t.publicObj={playSound:e},t.publicObj})}(),function(){angular.module("MainModule").factory("SVGServ",["$q","globalConstants","GeneralServ","GlobalStor","ProductStor","DesignStor","PointsServ",function(e,t,i,o,r,a,n){function l(e,t){var o=e.coefA*t.coefB-t.coefA*e.coefB,r=e.coefB*t.coefC-t.coefB*e.coefC,a=t.coefA*e.coefC-e.coefA*t.coefC,n={x:i.roundingValue(i.roundingValue(r/o,3)),y:i.roundingValue(i.roundingValue(a/o,3))};return n.x===-0?n.x=0:n.y===-0&&(n.y=0),n}function s(e,t,o){var r={x:i.roundingValue((e.x-t.x)/(o.x-t.x)),y:i.roundingValue((e.y-t.y)/(o.y-t.y))};return r.x===-(1/0)?r.x=1/0:r.y===-(1/0)&&(r.y=1/0),r.x===-0?r.x=0:r.y===-0&&(r.y=0),r}function d(e){var t=0;return e.x===1/0||e.y===1/0?t=0:e.x>=0&&e.x<=1&&e.y>=0&&e.y<=1?t=1:isNaN(e.x)&&e.y>=0&&e.y<=1?t=1:e.x>=0&&e.x<=1&&isNaN(e.y)&&(t=1),t}function c(e,t){var i={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return i}function u(e,t){for(var i,o,r,a=t.length;--a>-1;){for(i=t.length,o=0,r=0;r<i;r+=1)switch(e){case 1:t[r].x===t[a].x&&(o+=1);break;case 2:t[r].y===t[a].y&&(o+=1);break;case 3:t[r].x===t[a].x&&t[r].y===t[a].y&&(o+=1)}o>1&&t.splice(a,1)}}function p(e){for(var t,i=[],o=e.length;--o>0;)if(t=e[o].pointsOut.length)for(;--t>-1;)i.push(angular.copy(e[o].pointsOut[t]));return u(3,i),i}function g(e,t){for(var i,o=t.length;--o>-1;)for(i=t.length;--i>-1;)if(o!==i&&t[o]&&t[i])switch(e){case 1:t[o].x===t[i].x&&("impost"!==t[i].type&&"shtulp"!==t[i].type||"frame"!==t[o].type&&"corner"!==t[o].type?delete t[o]:delete t[i]);break;case 2:t[o].y===t[i].y&&("impost"!==t[i].type&&"shtulp"!==t[i].type||"frame"!==t[o].type&&"corner"!==t[o].type?delete t[o]:delete t[i])}return t.filter(function(e){return e?1:0})}function m(e,t){return e.x-t.x}function f(e,t){return e.y-t.y}function _(e,t,i){return(i.x-t.x)*(i.y-e.y)-(i.y-t.y)*(i.x-e.x)}function h(e,t){var i=1,o=t.length;if(o)for(;--o>-1;)t[o].x===e.x&&t[o].y===e.y&&(i=0);return i}function y(e,t){var i=0,o=t.length;if(o)for(;--o>-1;)t[o].id.slice(0,3)===e.slice(0,3)&&t[o].id.slice(0,3).indexOf("q")+1&&(i=1);return i}function E(e,t,o){var r={x:i.roundingValue((1-e)*t.x+e*o.x),y:i.roundingValue((1-e)*t.y+e*o.y)};return r}function b(e,t,o){var r=c(t.from,t.to),a={};if(t.coefA&&t.coefB)switch(e){case 1:a.y=r.y-Math.sqrt(Math.pow(o,2)/(1+Math.pow(t.coefB/t.coefA,2))),a.x=r.x-Math.sqrt(Math.abs(Math.pow(o,2)-Math.pow(r.y-a.y,2)));break;case 2:a.y=r.y-Math.sqrt(Math.pow(o,2)/(1+Math.pow(t.coefB/t.coefA,2))),a.x=Math.sqrt(Math.abs(Math.pow(o,2)-Math.pow(a.y-r.y,2)))+r.x;break;case 3:a.y=Math.sqrt(Math.pow(o,2)/(1+Math.pow(t.coefB/t.coefA,2)))+r.y,a.x=Math.sqrt(Math.abs(Math.pow(o,2)-Math.pow(a.y-r.y,2)))+r.x;break;case 4:a.y=Math.sqrt(Math.pow(o,2)/(1+Math.pow(t.coefB/t.coefA,2)))+r.y,a.x=r.x-Math.sqrt(Math.abs(Math.pow(o,2)-Math.pow(r.y-a.y,2)))}else a.x=Math.sqrt(Math.pow(o,2)/(1+Math.pow(t.coefB/t.coefA,2)))+r.x,a.y=Math.sqrt(Math.abs(Math.pow(o,2)-Math.pow(a.x-r.x,2)))+r.y;return a.y=i.roundingValue(a.y,1),a.x=i.roundingValue(a.x,1),a}function v(e,t,o,r){return i.roundingValue(r*r*(e-2*t+o)-2*r*(e-t)+e)}function T(e){var t=e.length,i={x:e.reduce(function(e,t){return"curv"===t.dir?e+t.xQ:e+t.x},0)/t,y:e.reduce(function(e,t){return"curv"===t.dir?e+t.yQ:e+t.y},0)/t};return i}function I(e,t){var i;return i="curv"===t.dir?Math.atan2(e.y-t.yQ,t.xQ-e.x)*(180/Math.PI):Math.atan2(e.y-t.y,t.x-e.x)*(180/Math.PI),i<0&&(i+=360),i}function S(e,t){var i,o=e.length;for(i=0;i<o;i+=1)e[i].fi=I(t,e[i]);return e.sort(function(e,t){return t.fi-e.fi}),e}function A(e){e.coefA=e.from.y-e.to.y,e.coefB=e.to.x-e.from.x,e.coefC=e.from.x*e.to.y-e.to.x*e.from.y}function L(e,t){var i="";return i=e.indexOf("ip")+1&&t.indexOf("ip")+1?"impost":e.indexOf("sht")+1&&t.indexOf("sht")+1&&e===t?"shtulp":"frame"}function D(e){var t,o,r,a,n=[],l=e.length;for(r=0;r<l;r+=1)("frame"!==e[r].type||e[r].view)&&(t={},t.from=angular.copy(e[r]),
t.dir=e[r].dir,r===l-1?(o=0,"frame"!==e[o].type||e[o].view||(o=1)):(o=r+1,"frame"!==e[o].type||e[o].view||(o=o===l-1?0:r+2)),t.to=angular.copy(e[o]),t.type=L(e[r].id,e[o].id),"line"===t.dir&&(t.dir="curv"===e[o].dir?"curv":"line"),t.size=i.roundingValue(Math.hypot(t.to.x-t.from.x,t.to.y-t.from.y)),A(t),n.push(t));return a=n.pop(),n.unshift(a),n}function N(e,t,i){var o=0,r=20;switch(i){case"frame":"frame"===t.type?o=e.frameDepth.c:"impost"===t.type?o=e.impostDepth.c/2:"shtulp"===t.type&&(o=e.shtulpDepth.b/2);break;case"frame-bead":case"sash-bead":o=r;break;case"frame-glass":"frame"===t.type?o=e.frameDepth.d-e.frameDepth.c:"impost"===t.type&&(o=e.impostDepth.b-e.impostDepth.c/2);break;case"sash-out":"frame"===t.type?o=e.frameDepth.b-e.frameDepth.c:"impost"===t.type?o=e.impostDepth.d-e.impostDepth.c/2:"shtulp"===t.type&&(o=e.shtulpDepth.a/2-e.shtulpDepth.b/2);break;case"sash-in":o=e.sashDepth.c;break;case"light":"frame"===t.type?o=e.frameDepth.a:"impost"===t.type?o=e.impostDepth.a/2:"shtulp"===t.type&&(o=e.shtulpDepth.b/2);break;case"sash-light":o=e.sashDepth.b+e.sashDepth.a;break;case"hardware":o=e.sashDepth.b;break;case"sash-glass":o=e.sashDepth.d-e.sashDepth.c}var a=t.coefC-o*Math.hypot(t.coefA,t.coefB);return a}function x(e){var t=e.from.x,i=e.from.y,o=e.to.x,r=e.to.y;return Math.round((r-i)/(o-t))}function R(e,t){var i=x(e),o=x(t);return i===o?1:0}function O(e,t){var i={},o={},r=R(e,t);if(r){var a=e.to.x,n=e.to.y,s={coefA:e.coefB,coefB:-e.coefA,coefC:e.coefA*n-e.coefB*a};o=l(e,s)}else o=l(e,t);return i.x=o.x,i.y=o.y,"impost"===e.type||"impost"===t.type?i.type="impost":"shtulp"===e.type||"shtulp"===t.type?i.type="shtulp":i.type="frame","curv"===e.to.dir?(i.dir="curv",i.xQ=e.to.xQ,i.yQ=e.to.yQ):i.dir="line",i.id=e.to.id,i.view=1,i}function C(e,t,i){var o,r,a,n,l,s=[],d=e.length;for(o=0;o<d;o+=1)r=angular.copy(e[o]),a={},n={},r.coefC=N(t,r,i),l=o===d-1?0:o+1,a=angular.copy(e[l]),a.coefC=N(t,a,i),n=O(r,a),s.push(n);return s}function P(e,t){return Math.round(t/2+e*e/(8*t))}function w(e,o,r,a){e.startX=v(o.x,r.x,a.x,.5),e.startY=v(o.y,r.y,a.y,.5),e.lengthChord=i.roundingValue(Math.hypot(a.x-o.x,a.y-o.y)),e.radius=P(e.lengthChord,e.heightQ),e.radiusMax=P(e.lengthChord,e.lengthChord/4),e.radiusMin=P(e.lengthChord,t.minRadiusHeight)}function M(e){var t,i=e.pointsQ.length;if(i)for(t=0;t<i;t+=1){var o,r=e.pointsOut.length,a=0,n=0;for(o=0;o<r;o+=1)e.pointsQ[t].fromPId===e.pointsOut[o].id&&(a=e.pointsOut[o]),e.pointsQ[t].toPId===e.pointsOut[o].id&&(n=e.pointsOut[o]);if(a&&n){var l,s={from:a,to:n},d=c(a,n),u={type:e.pointsQ[t].type,id:e.pointsQ[t].id,dir:"curv",xQ:d.x,yQ:d.y};A(s),l=b(e.pointsQ[t].positionQ,s,2*e.pointsQ[t].heightQ),u.x=l.x,u.y=l.y,s.coefA||1!==e.pointsQ[t].positionQ?s.coefB||4!==e.pointsQ[t].positionQ||(u.x-=4*e.pointsQ[t].heightQ):u.y-=4*e.pointsQ[t].heightQ,e.pointsOut.push(angular.copy(u)),e.pointsQ[t].midleX=u.xQ,e.pointsQ[t].midleY=u.yQ,w(e.pointsQ[t],a,u,n)}}}function k(e){var t=0;return e.x===1/0&&e.y>=0&&e.y<=1?t=1:e.x>=0&&e.x<=1&&e.y===1/0?t=1:isNaN(e.x)&&e.y>=0&&e.y<=1?t=1:e.x>=0&&e.x<=1&&isNaN(e.y)?t=1:e.x>=0&&e.x<=1&&e.y>=0&&e.y<=1?t=1:e.x>=0&&e.x<=1&&$.isNumeric(e.y)?(e.y<-2||e.y>2)&&(t=1):$.isNumeric(e.x)&&e.y>=0&&e.y<=1&&(e.x<-2||e.x>2)&&(t=1),t}function G(e,t){var i=c(t.from,t.to);if(e)return i;var o={coefA:t.coefB,coefB:-t.coefA,coefC:t.coefA*i.y-t.coefB*i.x};return l(t,o)}function B(e,t,i,o,r){var a,n,l,s,d;i[e].from.id.indexOf("q")+1?(l=e-1,i[l]||(l=t-1),s=i[l].from,d=i[e].to,a=angular.copy(i[e].from)):i[e].to.id.indexOf("q")+1&&(l=e+1,i[l]||(l=0),s=i[e].from,d=i[l].to,a=angular.copy(i[e].to)),n=angular.copy(a);var u=E(o.t,s,a),p=E(o.t,n,d),g=c(s,o),m=c(o,d);a.x=u.x,a.y=u.y,a.xQ=g.x,a.yQ=g.y,n.x=p.x,n.y=p.y,n.xQ=m.x,n.yQ=m.y;for(var f=r.length;--f>-1;)r[f].id===a.id&&r.splice(f,1);var _=h(a,r);_&&r.push(a);var y=h(n,r);y&&r.push(n)}function V(e,t,i){var o,r=[];if(t?(o={type:"impost",id:i.impostAxis[2].id,dir:"curv"},r.push(i.impostOut[0],i.impostOut[1])):(o=angular.copy(i.impostOut[2]),r=i.impostIn.filter(function(t){return t.group===e&&"line"===t.dir?1:0})),2===r.length){var a,n={from:angular.copy(r[0]),to:angular.copy(r[1])},l=c(n.from,n.to);if(A(n),a=b(i.impostAxis[2].positionQ,n,2*i.impostAxis[2].heightQ),o.x=a.x,o.y=a.y,o.xQ=l.x,o.yQ=l.y,o.group=e,n.coefA||1!==i.impostAxis[2].positionQ?n.coefB||4!==i.impostAxis[2].positionQ||(o.x-=4*i.impostAxis[2].heightQ):o.y-=4*i.impostAxis[2].heightQ,t)return i.impostOut.push(o),o;i.impostIn.push(o)}}function H(e,t,i,o){var r,a,n,l=t.length;for(r=0;r<l;r+=1)n=_(e[0],e[1],t[r]),n>0?(a=0,o.length&&(a=y(t[r].id,o)),a||o.push(angular.copy(t[r]))):n<0&&(a=0,i.length&&(a=y(t[r].id,i)),a||i.push(angular.copy(t[r])))}function U(e,t,i){var o,r=e.length;for(o=0;o<r;o+=1)e[o].group?i.push(angular.copy(e[o])):t.push(angular.copy(e[o]))}function F(e,t,o,r,a){var n,l,s,d,c,u=[],p={x:r.y-a.y,y:a.x-r.x},g={x:e.x-2*t.x+o.x,y:e.y-2*t.y+o.y},m={x:2*(t.x-e.x),y:2*(t.y-e.y)},f={x:e.x,y:e.y},_=r.x*a.y-a.x*r.y,h=[];if(n=Math.abs(p.x)===Math.abs(p.y)?Math.abs(p.x*g.x)+Math.abs(p.y*g.y):Math.abs(p.x)?Math.abs(p.y)?p.x*g.x+p.y*g.y:p.x*g.x+g.y:g.x+p.y*g.y,l=(p.x*m.x+p.y*m.y)/n,s=(p.x*f.x+p.y*f.y+_)/n,d=l*l-4*s,d>0){var y=Math.sqrt(d);h.push(i.roundingValue((-l+y)/2),i.roundingValue((-l-y)/2))}else 0===d&&h.push(i.roundingValue(-l/2));for(c=0;c<h.length;c+=1){var E=h[c];if(E>0&&E<1){var b={t:E,x:v(e.x,t.x,o.x,E),y:v(e.y,t.y,o.y,E)},T=Math.min(r.x,a.x,e.x,t.x,o.x),I=Math.min(r.y,a.y,e.y,t.y,o.y),S=Math.max(r.x,a.x,e.x,t.x,o.x),A=Math.max(r.y,a.y,e.y,t.y,o.y);r.x===a.x&&b.y>=I&&b.y<=A?u.push(b):r.y===a.y&&b.x>=T&&b.x<=S?u.push(b):b.x>=T&&b.y>=I&&b.x<=S&&b.y<=A&&u.push(b)}}return u}function z(e,t,i,o,r){var a,n,l,s,d,c;return i[e].from.id.indexOf("q")+1?(c=e-1,i[c]||(c=t-1),a=i[c].from,n=i[e].from,l=i[e].to):i[e].to.id.indexOf("q")+1&&(c=e+1,i[c]||(c=0),a=i[e].from,n=i[e].to,l=i[c].to),s=o,d=r,F(a,n,l,s,d)}function Y(e,t,i,o,r,a,n,d,c){var u=l(r[i],a),p=s(u,r[i].to,r[i].from),g=k(p);if(g){var m=angular.copy(n);if(m.group=e,m.x=u.x,m.y=u.y,"curv"===r[i].dir){var f=G(t,a),_=z(i,o,r,f,u);_.length&&(m.x=_[0].x,m.y=_[0].y,m.t=_[0].t)}var y=h(m,d);y&&("curv"===r[i].dir&&t&&B(i,o,r,m,c),d.push(angular.copy(m)))}}function W(e,t,i){if(e.children.length){var o,r,a,n,l,s,d,c,u,p,g,m,f,_,h=t.length,y=e.impost.impostAxis.length,E=angular.copy(e.impost.impostAxis[0]),b=angular.copy(e.impost.impostAxis[1]),v=angular.copy(e.pointsOut);for("sash"===e.blockType?(o=angular.copy(e.sashPointsIn),r=e.sashLinesIn,a=angular.copy(e.sashPointsLight),n=angular.copy(e.sashLinesLight)):(o=angular.copy(e.pointsIn),r=e.linesIn,a=angular.copy(e.pointsLight),n=angular.copy(e.linesLight)),_=r.length,f=1;f<h;f+=1)t[f].id===e.children[0]?l=f:t[f].id===e.children[1]&&(s=f);for(d={type:"impost"===E.type?"impost":"shtulp",from:E,to:b},c={type:"impost"===E.type?"impost":"shtulp",from:b,to:E},A(d),A(c),u=angular.copy(d),p=angular.copy(c),u.coefC=N(i,u,"frame"),p.coefC=N(i,p,"frame"),g=angular.copy(d),m=angular.copy(c),g.coefC=N(i,g,"light"),m.coefC=N(i,m,"light"),f=0;f<_;f+=1)Y(0,0,f,_,r,u,E,e.impost.impostIn),Y(1,0,f,_,r,p,b,e.impost.impostIn),Y(0,1,f,_,r,d,E,e.impost.impostOut,o),Y(0,0,f,_,n,g,E,e.impost.impostLight),Y(1,0,f,_,n,m,b,e.impost.impostLight);if(3===y){var T,S=e.impost.impostOut.length;for(f=0;f<S;f+=1)e.impost.impostOut[f].fi=I(e.center,e.impost.impostOut[f]),e.impost.impostAxis[f].fi=I(e.center,e.impost.impostAxis[f]);e.impost.impostOut[0].fi!==e.impost.impostAxis[0].fi&&e.impost.impostOut.reverse(),T=V(0,1,e.impost),V(0,0,e.impost),V(1,0,e.impost),t[l].pointsOut.push(angular.copy(T)),t[s].pointsOut.push(angular.copy(T)),e.impost.impostAxis[2].midleX=T.xQ,e.impost.impostAxis[2].midleY=T.yQ,w(e.impost.impostAxis[2],e.impost.impostOut[0],T,e.impost.impostOut[1])}var L=angular.copy(e.impost.impostAxis);H(L,v,t[l].pointsOut,t[s].pointsOut),H(L,o,t[l].pointsIn,t[s].pointsIn),U(e.impost.impostIn,t[l].pointsIn,t[s].pointsIn),H(L,a,t[l].pointsLight,t[s].pointsLight),U(e.impost.impostLight,t[l].pointsLight,t[s].pointsLight);var D,x=e.linesOut.length;for(e.impost.impostAxis[2]&&(D=angular.copy(e.impost.impostAxis[2])),e.impost.impostAxis.length=0,f=0;f<x;f+=1)Y(0,0,f,x,e.linesOut,d,E,e.impost.impostAxis);for(D&&e.impost.impostAxis.push(D),f=0;f<2;f+=1)t[l].pointsOut.push(angular.copy(e.impost.impostAxis[f])),t[s].pointsOut.push(angular.copy(e.impost.impostAxis[f]))}}function q(e,t,i,o,r){e.points.push(t,i,o,r),"corner"!==t.type&&"corner"!==i.type||(e.type="corner"),t.sill&&i.sill&&(e.sill=1)}function j(e){var t="M "+e[0].x+","+e[0].y,i=1,o=e.length;if(4===o)for(;i<o;i+=1)t+=" L "+e[i].x+","+e[i].y,i===o-1&&(t+=" Z");else if(6===o)for(;i<o;i+=1)3===i?t+=" L "+e[i].x+","+e[i].y:(t+=" Q "+e[i].x+","+e[i].y+" "+e[i+1].x+","+e[i+1].y,i+=1),i===o-1&&(t+=" Z");return t}function Q(e){var t=e.length,o=0;if(2===t||4===t)o=i.roundingValue(Math.hypot(e[1].x-e[0].x,e[1].y-e[0].y),1);else if(3===t||6===t)for(var r=.01,a=0;a<=1;){var n=2*((1-a)*(e[1].x-e[0].x)+a*(e[2].x-e[1].x)),l=2*((1-a)*(e[1].y-e[0].y)+a*(e[2].y-e[1].y));o+=Math.hypot(n,l)*r,a+=r}return o}function K(e,t,a,n,l,s){var d=0,c=e?e:0;"design"!==o.global.currOpenPage&&"main"!==o.global.currOpenPage||(d=r.product.door_type_index);var u,p,g,m=a.filter(function(e){return!("frame"===e.type&&!e.view)}),f=[],_=m.length,h={glassId:s,sizes:[]};for(g=0;g<_;g+=1)if(0!==g||"curv"!==m[g].dir){var y={type:m[g].type,dir:"line",points:[]};if(g===_-1){if("curv"===m[g].dir)break;"curv"===m[0].dir?(y.type="arc",y.points.push(m[g],m[0],m[1],n[1],n[0],n[g]),"corner"!==m[g].type&&"corner"!==m[1].type||(y.type="arc-corner"),y.dir="curv"):4!==r.product.construction_type||1!==d&&2!==d?4===r.product.construction_type&&3===d&&c&&"frame"===m[0].type&&"fp3"===m[0].id?(u=angular.copy(m[0]),u.y=n[0].y+c.a,p=angular.copy(n[0]),p.y=n[0].y+c.a,q(y,m[g],u,p,n[g])):q(y,m[g],m[0],n[0],n[g]):"frame"===m[0].type&&"fp3"===m[0].id?(u=angular.copy(n[0]),u.y=1*m[0].y,q(y,m[g],m[0],u,n[g])):q(y,m[g],m[0],n[0],n[g])}else if("curv"===m[g].dir||"curv"===m[g+1].dir)y.type="arc",y.points.push(m[g],m[g+1]),m[g+2]?(y.points.push(m[g+2],n[g+2]),"corner"!==m[g].type&&"corner"!==m[g+2].type||(y.type="arc-corner")):(y.points.push(m[0],n[0]),"corner"!==m[g].type&&"corner"!==m[0].type||(y.type="arc-corner")),y.points.push(n[g+1],n[g]),y.dir="curv",g+=1;else if(4!==r.product.construction_type||1!==d&&2!==d)if(4===r.product.construction_type&&3===d&&c){if("frame"===m[g].type&&"fp3"===m[g].id&&(c.a?(u=angular.copy(n[g]),u.y=m[g].y-c.a,p=angular.copy(n[g+1]),p.y=m[g+1].y-c.a,u.x=1*m[g].x,p.x=1*m[g+1].x):(u=angular.copy(n[g]),u.x=1*m[g].x,p=angular.copy(n[g+1]),p.x=1*m[g+1].x),q(y,m[g],m[g+1],p,u),y.doorstep=1),"frame"===m[g].type&&"fp4"===m[g].id)u=angular.copy(m[g]),u.y=n[g].y+c.a,p=angular.copy(n[g]),p.y=n[g].y+c.a,q(y,u,m[g+1],n[g+1],p);else if("frame"===m[g].type&&"fp3"!==m[g].id||"frame"!==m[g].type)if("sash"===m[g].type&&"fp3"===m[g].id){var E=m[g];E.y=m[g].y+c.a;var b=m[g+1];b.y=m[g+1].y+c.a;var v=n[g+1];v.y=n[g+1].y+c.a;var T=n[g];T.y=n[g].y+c.a,q(y,E,b,v,T)}else if("bead"===m[g].type&&"fp3"===m[g].id){var E=m[g],b=m[g+1],v=n[g+1],T=n[g];q(y,E,b,v,T)}else if("sash"===m[g+1].type&&"fp4"===m[g+1].id&&"fp4"===n[g+1].id){var E=m[g];E.y=m[g].y+c.a;var b=m[g+1];b.y=m[g+1].y+c.a;var v=n[g+1];v.y=n[g+1].y+c.a;var T=n[g];T.y=n[g].y+c.a,q(y,E,b,v,T)}else if("sash"===m[g].type&&"sash"===m[g+1].type&&0===g){var E=m[g];E.y=m[g].y+c.a;var b=m[g+1];b.y=m[g+1].y+c.a;var v=n[g+1];v.y=n[g+1].y+c.a;var T=n[g];T.y=n[g].y+c.a,q(y,E,b,v,T)}else q(y,m[g],m[g+1],n[g+1],n[g])}else q(y,m[g],m[g+1],n[g+1],n[g]);else{if(1===d&&"frame"===m[g].type&&"fp3"===m[g].id)continue;2===d&&"frame"===m[g].type&&"fp3"===m[g].id&&(u=angular.copy(m[g]),u.x=1*n[g].x,p=angular.copy(m[g+1]),p.x=1*n[g+1].x,q(y,u,p,n[g+1],n[g]),y.doorstep=1),"frame"===m[g].type&&"fp4"===m[g].id?(u=angular.copy(n[g]),u.y=1*m[g].y,q(y,m[g],m[g+1],n[g+1],u)):("frame"===m[g].type&&"fp3"!==m[g].id||"frame"!==m[g].type)&&q(y,m[g],m[g+1],n[g+1],n[g])}y.path=j(y.points),y.size=Q(y.points);var I=i.roundingValue(angular.copy(y.size)/1e3,3);"bead"===m[g].type?(y.type="bead",h.sizes.push(I)):"sash"===m[g].type?(y.type="sash",l.sashsSize.push(I)):"frame"===y.type&&(y.sill||1===y.doorstep?l.frameSillSize.push(I):l.framesSize.push(I)),f.push(y)}return h.sizes.length&&l.beadsSize.push(h),f}function X(e){var t,i=0,o=e.length;for(t=0;t<o;t+=1)i+=e[t+1]?e[t].x*e[t+1].y-e[t].y*e[t+1].x:e[t].x*e[0].y-e[t].y*e[0].x;return i/=2e6}function Z(e){var t,o=e.length,r=[];for(t=0;t<o;t+=1){var a,n=0;if(0!==t||"curve"!==e[t].dir){if(a=e[t+1]?t+1:0,"curve"===e[a].dir){var l,s=.01,d=0;for(l=e[t+2]?t+2:1;d<=1;){var c=2*((1-d)*(e[a].x-e[t].x)+d*(e[l].x-e[a].x)),u=2*((1-d)*(e[a].y-e[t].y)+d*(e[l].y-e[a].y));n+=Math.hypot(c,u)*s,d+=s}t+=1}else n=i.roundingValue(Math.hypot(e[a].x-e[t].x,e[a].y-e[t].y),1);r.push(n)}}return r}function J(e,t,o,r,a){var n,l={type:"glass",points:o,path:"M ",square:0,glass_type:t},s={elemId:a},d=o.length;for(n=0;n<d;n+=1)0===n&&("curv"===o[n].dir?l.path+=o[d-1].x+","+o[d-1].y:l.path+=o[n].x+","+o[n].y),"curv"===o[n].dir?(l.path+=" Q "+o[n].x+","+o[n].y+",",o[n+1]?l.path+=o[n+1].x+","+o[n+1].y:l.path+=o[0].x+","+o[0].y+" Z",n+=1):(l.path+=" L "+o[n].x+","+o[n].y,n===d-1&&(l.path+=" Z"));return l.square=X(o),l.sizes=Z(o),s.square=angular.copy(l.square),s.sizes=angular.copy(l.sizes).map(function(e){return i.roundingValue(e/1e3,3)}),r.glassSquares.push(s),l}function ee(e,t,i){return 0===i?"arc"!==e[t].type&&"frame"===e[i].type&&"arc"!==e[i+1].type?1:0:i===t?"arc"!==e[i-1].type&&"frame"===e[i].type&&"arc"!==e[0].type?1:0:"arc"!==e[i-1].type&&"frame"===e[i].type&&"arc"!==e[i+1].type?1:0}function te(e){var t,i=e.length;for(t=1;t<i;t+=1)if(1===e[t].level){var o,r=e[t].pointsOut.length;if("single"===e[t].position)for(o=0;o<r;o+=1)e[t].pointsOut[o].corner=ee(e[t].pointsOut,r-1,o);else if("first"===e[t].position)for(o=0;o<r;o+=1)e[t].pointsOut[o].fi>90&&e[t].pointsOut[o].fi<270&&(e[t].pointsOut[o].corner=ee(e[t].pointsOut,r-1,o));else if("last"===e[t].position)for(o=0;o<r;o+=1)(e[t].pointsOut[o].fi<90||e[t].pointsOut[o].fi>270)&&(e[t].pointsOut[o].corner=ee(e[t].pointsOut,r-1,o))}}function ie(e,t){for(var i=angular.copy(e),o=i.length;--o>-1;)i[o].type=t;return i}function oe(e){var t,i=[],o=e.length;for(t=0;t<o;t+=1)if("curv"===e[t].dir){var r,a,n=.5,l={},s=t;0===t?(r=o-1,a=t+1):t===o-1?(r=t-1,a=0):(r=t-1,a=t+1),l.x=v(e[r].to.x,e[s].to.x,e[a].to.x,n),l.y=v(e[r].to.y,e[s].to.y,e[a].to.y,n),i.push(l)}else i.push(e[t].to);return i}function re(e,t){var i=Math.tan(t*Math.PI/180),o={center:e,coefA:i,coefB:-1,coefC:e.y-i*e.x};return o}function ae(e,t,i){var o,r,a,n,d,c=i.length,u=[];for(o=0;o<c;o+=1)if(r=l(t,i[o]),r.x>=0&&r.y>=0&&(a=s(r,i[o].to,i[o].from),n=k(a))){if("curv"===i[o].dir&&(d=z(o,c,i,t.center,r),d.length&&(r.x=d[0].x,r.y=d[0].y)),r.fi=I(t.center,r),e)switch(e){case 1:r.id=r.fi>180?"head":"tail";break;case 2:r.id=r.fi>90&&r.fi<270?"head":"tail";break;case 3:r.id=r.fi<180?"head":"tail";break;case 4:r.id=r.fi>270||r.fi<90?"head":"tail"}u.push(r)}return u}function ne(e,t,i,o){var r=re(t,i),a=ae(e,r,o);return a}function le(e,t){var i,o,r,a,n,l,s,d,c,u,p,g,m=[],f=oe(t),_=T(f),h=e.length;for(i=0;i<h;i+=1){switch(o={type:"sash-dir",points:[]},e[i]){case 1:l=ne(3,_,90,t);break;case 2:l=ne(4,_,180,t);break;case 3:l=ne(1,_,270,t);break;case 4:l=ne(2,_,180,t)}for(s=l.length;--s>-1;)if("head"===l[s].id)u=l[s];else if("tail"===l[s].id)for(r=angular.copy(f),r.push(l[s]),r=S(r,_),a=r.length,n=0;n<a;n+=1)"tail"===r[n].id&&(d=n-1,c=n+1,d<0&&(d=a-1),c>=a&&(c=0),p=r[c],g=r[d]);o.points.push(p,u,g),m.push(o)}return m}function se(e,t,i,o){for(var a={sizes:[],openDir:t,type:e},n=i.length;--n>-1;)a.sizes.push(i[n].size);r.product.template_source.hardwareLines=[],r.product.template_source.hardwareLines.push(a.sizes),o.sashesBlock.push(a)}function de(e){var t,i,o,r,a,n=[],l=[],s=[],d=e.length;for(o=0;o<d;o+=1)e[o].id.indexOf("qi")+1&&(e[o].group?i=e[o]:t=e[o]);for(o=0;o<d;o+=1)if(!(e[o].id.indexOf("qi")+1)){var c=_(t,i,e[o]);c>0?l.push(e[o]):s.push(e[o])}for(r=0;r<l.length;r+=1)l[r].group?n.unshift(l[r]):n.push(l[r]);for(n.unshift(i),n.push(t),a=0;a<s.length;a+=1)s[a].group?n.unshift(s[a]):n.push(s[a]);return n}function ce(e,t){var i,o=[];if(4===e)for(;--e>-1;)t[e].group&&o.push(t[e]);else if(6===e){for(i=0;i<e;i+=1)t[i].group&&(t[i].id.indexOf("ip")+1||t[i].id.indexOf("sht")+1)&&o.push(t[i]);for(i=0;i<e;i+=1)t[i].group&&t[i].id.indexOf("qi")+1&&o.splice(1,0,t[i])}return o}function ue(e,t){var o=e[0].type,r=e.length,a={type:o,dir:"line"};if(4===r){var n=T(e);a.points=S(e,n)}else 6===r&&(a.dir="curv",a.points=de(e));a.path=j(a.points);var l=ce(r,a.points);a.size=Q(l);var s=i.roundingValue(angular.copy(a.size)/1e3,3);return"impost"===o?t.impostsSize.push(s):"shtulp"===o&&t.shtulpsSize.push(s),a}function pe(e,o,r,a,n,l){for(var s=r.length;--s>-1;){var d,c,u={blockId:o,level:e,dimId:r[s].id,minLimit:t.minRadiusHeight};for(d=1;d<l;d+=1)if(1===n[d].level&&n[d].pointsQ){var p=n[d].pointsQ.length;if(p)for(c=0;c<p;c+=1)if(n[d].pointsQ[c].id===u.dimId){switch(n[d].pointsQ[c].positionQ){case 1:u.axis="y",u.from=angular.copy(n[d].pointsQ[c].startY),u.to=angular.copy(n[d].pointsQ[c].midleY);break;case 2:u.axis="x",u.from=angular.copy(n[d].pointsQ[c].midleX),u.to=angular.copy(n[d].pointsQ[c].startX);break;case 3:u.axis="y",u.from=angular.copy(n[d].pointsQ[c].midleY),u.to=angular.copy(n[d].pointsQ[c].startY);break;case 4:u.axis="x",u.from=angular.copy(n[d].pointsQ[c].startX),u.to=angular.copy(n[d].pointsQ[c].midleX)}u.text=i.roundingValue(angular.copy(n[d].pointsQ[c].heightQ),1),u.maxLimit=n[d].pointsQ[c].lengthChord/4}}"x"===u.axis?a.dimX.push(u):a.dimY.push(u)}}function ge(e,t){for(var i=t.dimX.length,o=t.dimY.length;--i>-1;)t.dimX[i].level&&(e.w+=t.dimX[i].text);for(;--o>-1;)t.dimY[o].level&&(e.h+=t.dimY[o].text)}function me(e,t){for(var i=t.length;--i>-1;)t[i].t||"curv"===t[i].dir||t[i].id.indexOf("fp")+1&&!t[i].view||e.push(t[i])}function fe(e){var t=e.filter(function(e){return 1===e.level}),i=t.length,o=e.filter(function(e){var o,r=0;for(o=0;o<i;o+=1)e.level||e.from!==t[o].from||e.to!==t[o].to||(r+=1);if(!r)return 1});return o}function _e(e,o,r){var a,n={},l=o.length;for(a=0;a<l;a+=1)"x"===e.axis?o[a].x===e.to&&(n.minL=o[a-1]?i.roundingValue(o[a-1].x+t.minSizeLimit,1):t.minSizeLimit,n.maxL=o[a+1]?i.roundingValue(o[a+1].x-e.from-t.minSizeLimit,1):r):o[a].y===e.to&&(n.minL=o[a-1]?i.roundingValue(o[a-1].y+t.minSizeLimit,1):t.minSizeLimit,n.maxL=o[a+1]?i.roundingValue(o[a+1].y-e.from-t.minSizeLimit,1):r);return n}function he(e,t,i){var o,r=[],a=i.length;if("x"===e){for(o=0;o<a;o+=1)(t.y===i[o].y||i[o].id.indexOf("fp")+1)&&r.push(i[o]);u(1,r),r.sort(m)}else{for(o=0;o<a;o+=1)(t.x===i[o].x||i[o].id.indexOf("fp")+1)&&r.push(i[o]);u(2,r),r.sort(f)}return r}function ye(e,o,r,a,n){var l,s={},d=he(e,o,a),c=d.length;for(l=0;l<c;l+=1){var u,p=0;for(u=0;u<c;u+=1)if(d[u].id===o.id){var g=o.x-d[u].x,m=o.y-d[u].y;"x"===e&&g>0?p=1:"y"===e&&m>0&&(p=1)}"x"===e?d[l].x===o.x&&(d[l-1]&&p?o.id===d[l-1].id?s.minL=t.minSizeLimit:s.minL=i.roundingValue(o.x-d[l-1].x-t.minSizeLimit,1):s.minL=t.minSizeLimit,d[l+1]?s.maxL=i.roundingValue(d[l+1].x-r-t.minSizeLimit,1):d[l-2]&&(s.maxL=i.roundingValue(o.x-d[l-2].x-t.minSizeLimit,1))):d[l].y===o.y&&(d[l-1]&&p?o.id===d[l-1].id?s.minL=t.minSizeLimit:s.minL=i.roundingValue(o.y-d[l-1].y-t.minSizeLimit,1):s.minL=t.minSizeLimit,d[l+1]?s.maxL=i.roundingValue(d[l+1].y-r-t.minSizeLimit,1):d[l-2]&&(s.maxL=i.roundingValue(o.y-d[l-2].y-t.minSizeLimit,1)))}return s}function Ee(e,t,o,r,a,n,l,s){var d,c={blockId:l,level:e,axis:t,dimId:a[r].id,from:"x"===t?angular.copy(a[o].x):angular.copy(a[o].y),to:"x"===t?angular.copy(a[r].x):angular.copy(a[r].y)};return c.text=i.roundingValue(Math.abs(c.to-c.from),1),d=e?_e(c,n,s):ye(t,a[r],c.from,n,s),c.minLimit=d.minL,c.maxLimit=d.maxL,c}function be(e,t,i,o,r,a,n){var l,s=i.length-1;for(l=0;l<s;l+=1)o.push(Ee(e,t,l,l+1,i,r,a,n))}function ve(e){var t,i,r,a,n={dimX:[],dimY:[],dimQ:[]},l=e.length,s=o.global.maxSizeLimit;for(r=p(e),r=r.filter(function(e){return"curv"===e.dir||e.t?0:1}),t=angular.copy(r),i=angular.copy(r),u(1,t),u(2,i),t.sort(m),i.sort(f),a=1;a<l;a+=1){var d=e[a].pointsOut.length;if(1===e[a].level){var c,_,h=[],y=[],E={w:0,h:0};for(_=0;_<d;_+=1)e[a].pointsOut[_].id.indexOf("fp")+1?h.push(e[a].pointsOut[_]):e[a].pointsOut[_].id.indexOf("qa")+1&&y.push(e[a].pointsOut[_]);if(c=angular.copy(h),u(1,h),u(2,c),h.sort(m),c.sort(f),be(1,"x",h,n.dimX,t,e[a].id,s),be(1,"y",c,n.dimY,i,e[a].id,s),pe(1,e[a].id,y,n,e,l),e[a].pointsQ){var b=e[a].pointsQ.length;if(b)for(;--b>-1;)n.dimQ.push(e[a].pointsQ[b])}ge(E,n),E.square=X(e[a].pointsOut),e[0].overallDim.push(E)}if(!e[a].children.length){var v,T,I=[],S=[],A=1;for(me(I,e[a].pointsOut),T=1;T<l;T+=1)e[T].id===e[a].parent&&e[T].impost&&e[T].impost.impostAxis[2]&&n.dimQ.push(e[T].impost.impostAxis[2]);S=angular.copy(r),v=angular.copy(I),I.length>1&&(I=g(1,I),v=g(2,v),I.sort(m),v.sort(f),I[0].id.indexOf("fp")+1&&I[1].id.indexOf("fp")+1?A=0:I.length&&be(0,"x",I,n.dimX,S,e[a].id,s),v[0].id.indexOf("fp")+1&&v[1].id.indexOf("fp")+1?A=0:v.length&&be(0,"y",v,n.dimY,S,e[a].id,s))}}return n.dimX=angular.copy(fe(n.dimX)),n.dimY=angular.copy(fe(n.dimY)),n}function Te(t,i){var o,a,n={},l=e.defer();for(n.details=angular.copy(t.details),n.priceElements={framesSize:[],frameSillSize:[],sashsSize:[],impostsSize:[],shtulpsSize:[],glassSquares:[],beadsSize:[],sashesBlock:[]},a=n.details.length,o=0;o<a;o+=1)if(n.details[o].level){if(1===n.details[o].level&&n.details[o].pointsQ&&M(n.details[o]),n.details[o].center=T(n.details[o].pointsOut),n.details[o].pointsOut=S(n.details[o].pointsOut,n.details[o].center),n.details[o].linesOut=D(n.details[o].pointsOut),1===n.details[o].level?(n.details[o].pointsIn=C(n.details[o].linesOut,i,"frame"),n.details[o].pointsLight=C(n.details[o].linesOut,i,"light")):(n.details[o].center=T(n.details[o].pointsIn),n.details[o].pointsIn=S(n.details[o].pointsIn,n.details[o].center),n.details[o].pointsLight=S(n.details[o].pointsLight,T(n.details[o].pointsLight))),n.details[o].linesIn=D(n.details[o].pointsIn),n.details[o].linesLight=D(n.details[o].pointsLight),1===n.details[o].level&&(te(n.details),$.merge(n.details[o].parts,K(i.frameStillDepth,t,n.details[o].pointsOut,n.details[o].pointsIn,n.priceElements))),n.details[o].children.length?"sash"===n.details[o].blockType&&(n.details[o].sashPointsOut=ie(C(n.details[o].linesIn,i,"sash-out"),"sash"),n.details[o].sashLinesOut=D(n.details[o].sashPointsOut),n.details[o].sashPointsIn=C(n.details[o].sashLinesOut,i,"sash-in"),n.details[o].sashLinesIn=D(n.details[o].sashPointsIn),n.details[o].sashPointsLight=C(n.details[o].sashLinesOut,i,"sash-light"),n.details[o].sashLinesLight=D(n.details[o].sashPointsLight),n.details[o].hardwarePoints=C(n.details[o].sashLinesOut,i,"hardware"),n.details[o].hardwareLines=D(n.details[o].hardwarePoints),$.merge(n.details[o].parts,K(i.frameStillDepth,t,n.details[o].sashPointsOut,n.details[o].sashPointsIn,n.priceElements)),n.details[o].sashOpenDir=le(n.details[o].openDir,n.details[o].sashLinesIn),se(n.details[o].sashType,n.details[o].openDir,n.details[o].hardwareLines,n.priceElements)):"frame"===n.details[o].blockType?(n.details[o].beadPointsOut=ie(n.details[o].pointsIn,"bead"),n.details[o].beadLinesOut=D(n.details[o].beadPointsOut),n.details[o].beadPointsIn=C(n.details[o].beadLinesOut,i,"frame-bead"),n.details[o].glassPoints=C(n.details[o].beadLinesOut,i,"frame-glass"),n.details[o].parts.push(J(i.frameStillDepth,n.details[o].glass_type,n.details[o].glassPoints,n.priceElements,n.details[o].glassId)),$.merge(n.details[o].parts,K(i.frameStillDepth,t,n.details[o].beadPointsOut,n.details[o].beadPointsIn,n.priceElements,n.details[o].glassId))):"sash"===n.details[o].blockType&&(n.details[o].sashPointsOut=ie(C(n.details[o].linesIn,i,"sash-out"),"sash"),n.details[o].sashLinesOut=D(n.details[o].sashPointsOut),n.details[o].sashPointsIn=C(n.details[o].sashLinesOut,i,"sash-in"),n.details[o].sashLinesIn=D(n.details[o].sashPointsIn),$.merge(n.details[o].parts,K(i.frameStillDepth,t,n.details[o].sashPointsOut,n.details[o].sashPointsIn,n.priceElements)),n.details[o].hardwarePoints=C(n.details[o].sashLinesOut,i,"hardware"),n.details[o].hardwareLines=D(n.details[o].hardwarePoints),n.details[o].beadPointsOut=ie(n.details[o].sashPointsIn,"bead"),n.details[o].beadLinesOut=D(n.details[o].beadPointsOut),n.details[o].beadPointsIn=C(n.details[o].beadLinesOut,i,"sash-bead"),n.details[o].beadLinesIn=D(n.details[o].beadPointsIn),n.details[o].glassPoints=C(n.details[o].beadLinesOut,i,"sash-glass"),n.details[o].parts.push(J(i.frameStillDepth,n.details[o].glass_type,n.details[o].glassPoints,n.priceElements,n.details[o].glassId)),$.merge(n.details[o].parts,K(i.frameStillDepth,t,n.details[o].beadPointsOut,n.details[o].beadPointsIn,n.priceElements,n.details[o].glassId)),n.details[o].sashOpenDir=le(n.details[o].openDir,n.details[o].beadLinesIn),se(n.details[o].sashType,n.details[o].openDir,n.details[o].hardwareLines,n.priceElements)),W(n.details[o],n.details,i),n.details[o].children.length){var s=angular.copy(n.details[o].impost.impostIn[0].y),d=angular.copy(n.details[o].impost.impostIn[3].x),c=angular.copy(n.details[o].impost.impostIn[3].y),u=angular.copy(n.details[o].impost.impostIn[0].x);Math.abs(s-c)>Math.abs(d-u)&&n.details[o].pointsIn[0].y!==n.details[o].impost.impostIn[0].y&&3===r.product.door_type_index&&(n.details[o].impost.impostIn[0].y=angular.copy(n.details[o].impost.impostIn[0].y+i.frameStillDepth.a),n.details[o].impost.impostIn[1].y=angular.copy(n.details[o].impost.impostIn[1].y+i.frameStillDepth.a)),n.details[o].parts.push(ue(n.details[o].impost.impostIn,n.priceElements))}}else{var p,g=n.details[o].children.length;if(1===g)for(p=0;p<a;p+=1)n.details[o].children[0]===n.details[p].id&&(n.details[p].position="single");else if(g>1)for(p=0;p<a;p+=1)n.details[o].children[0]===n.details[p].id?n.details[p].position="first":n.details[o].children[g-1]===n.details[p].id&&(n.details[p].position="last");n.details[o].overallDim=[]}return n.dimension=ve(n.details),l.resolve(n),l.promise}function Ie(t,i){var o=e.defer(),r=angular.copy(i),a=2;for(var n in r)for(var l in r[n])r[n][l]*=a;return Te(t,r).then(function(e){o.resolve(e)}),o.promise}function Se(e,t,i,o){var r,a=e.maxX-e.minX,n=e.maxY-e.minY,l=d3.scale.linear().domain([0,1]).range([0,o]);return a>n?r=l(t>a?a/(t+200):t<a?t/(a+200):.9):a<=n&&(r=l(i>n?n/i:i<n?i/n:.9)),r}function Ae(e){var t,i=d3.scale.linear().domain([0,1]).range([0,e]);return t=i(.38)}function Le(e,t,i,o){var r={x:(t-(e.minX+e.maxX)*o)/2,y:(i-(e.minY+e.maxY)*o)/2};return r}function De(e,t,i){var o=n.templatePoints(r.product.template),a=t-(e.minY+e.maxY)*i,l={};return 1!==r.product.construction_type&&3!==r.product.construction_type||(l.x=250,o.heightT<1648&&(l.y=a-310),1648<o.heightT&&(l.y=a-240),1848<o.heightT&&(l.y=a-190),2148<o.heightT&&(l.y=a-130)),2===r.product.construction_type&&(l.x=276,l.y=a-110),4===r.product.construction_type&&6===r.product.doorLock.stvorka_type&&(l.x=242,l.y=a-72),4===r.product.construction_type&&6!==r.product.doorLock.stvorka_type&&(l.x=276,l.y=a-110),l}var Ne=this;return Ne.publicObj={createSVGTemplate:Te,createSVGTemplateIcon:Ie,collectAllPointsOut:p,setTemplateScale:Se,setTemplateScaleMAIN:Ae,setTemplatePositionMAIN:De,setTemplatePosition:Le,centerBlock:T,sortingPoints:S,getAngelPoint:I,setLines:D,setLineCoef:A,getNewCoefC:N,setPointLocationToLine:_,intersectionQ:F,cteateLineByAngel:re,getIntersectionInCurve:z,getCoordCrossPoint:l,checkLineOwnPoint:s,isInsidePointInLine:k,getCoordSideQPCurve:E,checkEqualPoints:h,setQPointCoord:b,getCenterLine:c,calcSquare:X,checkInsidePointInLineEasy:d,sortByX:m},Ne.publicObj}])}(),function(){angular.module("MainModule").factory("TemplatesServ",["$filter","GeneralServ","MainServ","DesignServ","AnalyticsServ","GlobalStor","OrderStor","ProductStor","DesignStor","UserStor","SVGServ",function(e,t,i,o,r,a,n,l,s,d,c){function u(e){l.product.template_id=e,i.saveTemplateInProduct(e).then(function(){if(l.product.glass.length=0,i.setCurrentHardware(l.product),"design"===a.global.currOpenPage)4!==l.product.construction_type?o.setDefaultConstruction():o.setDoorConfigDefault(l.product);else{var e=l.product.hardware.id||0;i.preparePrice(l.product.template,l.product.profile.id,l.product.glass,e,l.product.lamination.lamination_in_id),r.sendAnalyticsData(d.userInfo.id,n.order.id,l.product.template_id,l.product.profile.id,1)}})}function p(e,t){t?(i.closeRoomSelectorDialog(),l.product.room_id=t-1,4===a.global.rooms[t-1].group_id&&a.global.noDoorExist&&(s.design.isNoDoors=1),l.product.construction_type!==a.global.rooms[t-1].group_id||4===l.product.construction_type?(l.product.construction_type=a.global.rooms[t-1].group_id,4!==l.product.construction_type&&i.setCurrentProfile(l.product,0),i.downloadAllTemplates(l.product.construction_type).then(function(t){t&&(a.global.templatesSourceSTORE=angular.copy(t),a.global.templatesSource=angular.copy(t),4===l.product.construction_type?(l.product.template_source=angular.copy(a.global.templatesSource[e]),s.design.templateSourceTEMP=angular.copy(a.global.templatesSource[e]),c.createSVGTemplate(l.product.template_source,l.product.profileDepths).then(function(e){l.product.template=angular.copy(e),i.setCurrentGlass(l.product),o.setDoorConfigDefault(l.product).then(function(){})})):u(e))})):u(e)):u(e)}function g(){var e=angular.copy(a.global.templatesSourceSTORE[l.product.template_id]);a.global.templatesSource[l.product.template_id]=e}function m(r,n){function d(){if(i.setDefaultDoorConfig(),4!==l.product.construction_type)l.product.template_id=r,i.prepareTemplates(l.product.construction_type).then(function(){"design"===a.global.currOpenPage&&o.setDefaultConstruction()});else if(4!=l.product.construction_type||n)4==l.product.construction_type&&n&&p(r,n);else{l.product.template_source=angular.copy(a.global.templatesSource[r]);var e=angular.copy(l.product),t=angular.copy(o.idsForNewTemplate(l.product.door_shape_id,l.product));e.profile=angular.copy(t),l.product.template_id=r,i.setCurrentDoorProfile(e).then(function(e){l.product=angular.copy(e),c.createSVGTemplate(l.product.template_source,l.product.profileDepths).then(function(e){l.product.template=angular.copy(e),i.setCurrentGlass(l.product),o.setDoorConfigDefault(l.product).then(function(){})})})}g(),a.global.isChangedTemplate=0,s.design.designSteps.length=0}if(a.global.isChangedTemplate=s.design.designSteps.length?1:0,l.product.construction_type=n?a.global.rooms[n-1].group_id:a.global.templatesType,a.global.isChangedTemplate)t.confirmAlert(e("translate")("common_words.NEW_TEMPLATE_TITLE"),e("translate")("common_words.TEMPLATE_CHANGES_LOST"),d);else if(i.setDefaultDoorConfig(),4!==l.product.construction_type)l.product.template_id=r,i.prepareTemplates(l.product.construction_type).then(function(){"design"===a.global.currOpenPage&&o.setDefaultConstruction()});else if(4!=l.product.construction_type||n)4==l.product.construction_type&&n&&p(r,n);else{l.product.template_source=angular.copy(a.global.templatesSource[r]);var u=angular.copy(l.product),m=angular.copy(o.idsForNewTemplate(l.product.door_shape_id,l.product));u.profile=angular.copy(m),l.product.template_id=r,i.setCurrentDoorProfile(u).then(function(e){l.product=angular.copy(e),c.createSVGTemplate(l.product.template_source,l.product.profileDepths).then(function(e){l.product.template=angular.copy(e),i.setCurrentGlass(l.product),o.setDoorConfigDefault(l.product).then(function(){})})})}}function f(e){l.product.construction_type=e,l.product.template_id=0,i.prepareTemplates(e).then(function(){"design"===a.global.currOpenPage&&o.setDefaultConstruction()})}var _=this;return _.publicObj={selectNewTemplate:m,initNewTemplateType:f},_.publicObj}])}(),function(){angular.module("MainModule").factory("AuxStor",function(){function e(){return angular.copy(t.publicObj.auxiliarySource)}var t=this;return t.publicObj={auxiliarySource:{addElementsType:[],addElementsList:[],showAddElementsMenu:0,addElementsMenuStyle:0,isFocusedAddElement:0,isAddElement:0,currentAddElementId:0,auxParameter:0,tempSize:[],currAddElementPrice:0,
isTabFrame:0,truefalse:0,trfal:-1,isAddElementListView:0,isWindowSchemeDialog:0,isGridSelectorDialog:0,selectedGrid:0,calculatorStyle:"",addElementGroups:[],searchingWord:""},setDefaultAuxiliary:e},t.publicObj.aux=e(),t.publicObj})}(),function(){angular.module("CartModule").factory("CartStor",["OrderStor",function(e){function t(){return angular.copy(o.publicObj.cartSource)}function i(){o.publicObj.cart.customer.customer_name=angular.copy(e.order.customer_name),o.publicObj.cart.customer.customer_location=angular.copy(e.order.customer_location),o.publicObj.cart.customer.customer_address=angular.copy(e.order.customer_address),o.publicObj.cart.customer.customer_house=angular.copy(e.order.customer_house),o.publicObj.cart.customer.customer_flat=angular.copy(e.order.customer_flat),o.publicObj.cart.customer.customer_floor=angular.copy(e.order.customer_floor),o.publicObj.cart.customer.customer_city=angular.copy(e.order.customer_city),o.publicObj.cart.customer.customer_city_id=angular.copy(e.order.customer_city_id),o.publicObj.cart.customer.customer_email=angular.copy(e.order.customer_email),o.publicObj.cart.customer.customer_phone=angular.copy(e.order.customer_phone),o.publicObj.cart.customer.customer_phone_city=angular.copy(e.order.customer_phone_city),o.publicObj.cart.customer.customer_itn=angular.copy(e.order.customer_itn),o.publicObj.cart.customer.customer_starttime=angular.copy(e.order.customer_starttime),o.publicObj.cart.customer.customer_endtime=angular.copy(e.order.customer_endtime),o.publicObj.cart.customer.customer_target=angular.copy(e.order.customer_target),o.publicObj.cart.customer.customer_sex=angular.copy(e.order.customer_sex),o.publicObj.cart.customer.customer_age=angular.copy(e.order.customer_age),o.publicObj.cart.customer.customer_education=angular.copy(e.order.customer_education),o.publicObj.cart.customer.customer_occupation=angular.copy(e.order.customer_occupation),o.publicObj.cart.customer.customer_infoSource=angular.copy(e.order.customer_infoSource)}var o=this;return o.publicObj={cartSource:{allAddElements:[],isShowDiscount:0,tempConstructDisc:0,tempAddelemDisc:0,discountPriceDiff:0,discountDeliveyPlant:0,marginDeliveyPlant:0,squareTotal:0,perimeterTotal:0,qtyTotal:0,isBox:-1,isExistAddElems:0,isAllAddElems:0,allAddElemsOrder:[],addElemsOrderPriceTOTAL:0,isSelectedProduct:0,selectedProducts:[],isMasterDialog:0,isOrderDialog:0,isCreditDialog:0,submitted:0,isCityBox:0,customer:{customer_sex:0}},optionAge:[{id:1,name:"20-30"},{id:2,name:"31-40"},{id:3,name:"41-50"},{id:4,name:"51-60"},{id:5,name:"cart.CLIENT_AGE_OLDER"}],optionEductaion:[{id:1,name:"cart.CLIENT_EDUC_MIDLE"},{id:2,name:"cart.CLIENT_EDUC_SPEC"},{id:3,name:"cart.CLIENT_EDUC_HIGH"},{id:4,name:"cart.CLIENT_EDUC_4"}],optionOccupation:[{id:1,name:"cart.CLIENT_OCCUP_WORKER"},{id:2,name:"cart.CLIENT_OCCUP_HOUSE"},{id:3,name:"cart.CLIENT_OCCUP_BOSS"},{id:4,name:"cart.CLIENT_OCCUP_STUD"},{id:5,name:"cart.CLIENT_OCCUP_PENSION"},{id:6,name:"cart.UNKNOWN"}],optionInfo:[{id:1,name:"TV"},{id:2,name:"InterNET"},{id:3,name:"cart.CLIENT_INFO_PRESS"},{id:4,name:"cart.CLIENT_INFO_FRIEND"},{id:5,name:"cart.CLIENT_INFO_ADV"}],setDefaultCart:t,fillOrderForm:i},o.publicObj.cart=t(),o.publicObj}])}(),function(){angular.module("DesignModule").factory("DesignStor",function(){function e(){return angular.copy(i.publicObj.designSource)}function t(){return angular.copy(i.publicObj.designSource.doorConfig)}var i=this;return i.publicObj={designSource:{templateSourceTEMP:{},templateTEMP:{},designSteps:[],activeMenuItem:0,activeSubMenuItem:0,isDropSubMenu:0,isImpostDelete:0,selectedGlass:[],selectedCorner:[],selectedImpost:[],selectedArc:[],doorsGroups:[],openVoiceHelper:0,loudVoice:0,quietVoice:0,voiceTxt:"",selectedGlassId:0,isDimAnimate:0,oldSize:0,prevSize:0,tempSize:[],steps:{isDoorConfig:0,selectedStep1:0,selectedStep2:0,selectedStep3:0,selectedStep4:0},isMinSizeRestriction:0,isMaxSizeRestriction:0,minSizeLimit:0,maxSizeLimit:0,isDimExtra:0,isSquareExtra:0,extraGlass:[],isGlassExtra:0,extraHardware:[],isHardwareExtra:0,isNoDoors:0,doorShapeData:[{id:0,name:"panels.DOOR_TYPE1",icon:"img/door-config/doorstep.png",iconSelect:"img/door-config-selected/doorstep.png"},{id:1,name:"panels.DOOR_TYPE2",icon:"img/door-config/no-doorstep.png",iconSelect:"img/door-config-selected/no-doorstep.png"},{id:2,name:"panels.DOOR_TYPE3",icon:"img/door-config/doorstep-al1.png",iconSelect:"img/door-config-selected/doorstep-al1.png"},{id:3,name:"panels.DOOR_TYPE4",icon:"img/door-config/doorstep-al2.png",iconSelect:"img/door-config-selected/doorstep-al2.png"}],doorShapeList:[],sashShapeList:[],handleShapeList:[],lockShapeList:[],doorConfig:{doorTypeIndex:"",doorShapeIndex:"",doorShapeName:"",sashShapeIndex:"",sashShapeName:"",handleShapeIndex:"",handleShape:{},lockShapeIndex:"",lockShape:{}}},setDefaultDesign:e,setDefaultDoor:t},i.publicObj.design=e(),i.publicObj})}(),function(){angular.module("BauVoiceApp").factory("GlobalStor",function(){function e(){return angular.copy(t.publicObj.globalSource)}var t=this;return t.publicObj={globalSource:{getPCPower:0,isDevice:0,continued:0,checkAlert:0,loader:0,setTimeout:0,isLoader:0,isLoader2:0,isLoader3:0,inform:[],checkSashInTemplate:0,dangerAlert:0,gotoSettingsPage:0,startProgramm:1,isNavMenu:1,isConfigMenu:0,activePanel:0,configMenuTips:0,isCreatedNewProject:1,copyGlabalStorGlassesAll:[],isCreatedNewProduct:1,productEditNumber:0,orderEditNumber:0,prevOpenPage:"",currOpenPage:"main",isChangedTemplate:0,isVoiceHelper:0,voiceHelperLanguage:"",showGlassSelectorDialog:0,isShowCommentBlock:0,isTemplateTypeMenu:0,createHandle:[],heightTEMP:[],widthTEMP:[],showRoomSelectorDialog:0,rooms:[],isRoomElements:0,imgLink:"",selectRoom:0,background:0,heightCheck:0,widthCheck:0,templateLabel:"",templatesSource:[],templatesSourceSTORE:[],isSashesInTemplate:0,templateIndex:-1,templatesType:1,profiles:[],profilesType:[],glassesAll:[],glassTypes:[],glasses:[],selectGlassId:0,selectGlassName:"",prevGlassId:0,prevGlassName:"",hardwares:[],hardwareTypes:[],hardwareLimits:[],laminats:[],laminatCouples:[],lamGroupFiltered:[],typeMenu:5555,typeMenuID:5555,addElementsAll:[],tempAddElements:[],noDoorExist:0,checkDoors:0,doorKitsT1:[],doorKitsT2:[],type_door:0,doorHandlers:[],doorLocks:[],doorsGroups:[],doorsLaminations:[],supplyData:[],assemblingData:[],instalmentsData:[],isInfoBox:0,infoTitle:"",infoImg:"",infoLink:"",infoDescrip:"",isReport:0,currencies:[],locations:{countries:[],regions:[],cities:[],areas:[]},margins:{},deliveryCoeff:{},isAlert:0,isAlertInfo:0,alertTitle:"",alertDescr:"",isBox:0,isAlertHistory:0,isEditBox:0,confirmAction:0,confirmInActivity:0,isQtyCalculator:0,isSizeCalculator:0,isWidthCalculator:0,maxSizeLimit:3200,maxSquareLimit:6,changeLocation:1},setDefaultGlobal:e},t.publicObj.global=e(),t.publicObj})}(),function(){angular.module("HistoryModule").factory("HistoryStor",function(){function e(){return angular.copy(t.publicObj.historySource)}var t=this;return t.publicObj={historySource:{orders:[],ordersSource:[],isEmptyResult:0,"errorСhecking":0,isOrderSearch:0,searchingWord:"",isOrderDate:0,startDate:"",finishDate:"",isStartDate:0,isFinishDate:0,isAllPeriod:1,isBox:0,isArr:0,addElem:[],isOrderSort:0,isSortType:"last",isFilterType:void 0,isDraftView:0,orderEditNumber:0,drafts:[],draftsSource:[],isEmptyResultDraft:0,isOrderDateDraft:0,startDateDraft:"",finishDateDraft:"",isStartDateDraft:0,isFinishDateDraft:0,isAllPeriodDraft:1,isOrderSortDraft:0,isSortTypeDraft:"last",reverseDraft:1,dataProfiles:[],resTimeBox:{name:"history.DURING_THE_WEEK",namb:1},listName:[],listNameGlass:[],listNameHardware:[],listNameProfiles:[],firstClick:[]},setDefaultHistory:e},t.publicObj.history=e(),t.publicObj})}(),function(){angular.module("BauVoiceApp").factory("OrderStor",function(){function e(){return angular.copy(t.publicObj.orderSource)}var t=this;return t.publicObj={orderSource:{id:0,order_number:0,order_hz:"---",order_type:1,order_date:0,order_style:"",climatic_zone:0,heat_coef_min:0,discount_construct:0,discount_addelem:0,discount_construct_max:0,discount_addelem_max:0,delivery_user_id:0,mounting_user_id:0,default_term_plant:0,disc_term_plant:0,margin_plant:0,products_qty:0,products:[],templates_price:0,addelems_price:0,products_price:0,productsPriceDis:0,delivery_date:0,new_delivery_date:0,delivery_price:0,is_date_price_less:0,is_date_price_more:0,floor_id:0,floorName:"",floor_price:0,mounting_id:0,mountingName:"",mounting_price:0,is_instalment:0,instalment_id:0,selectedInstalmentPeriod:0,selectedInstalmentPercent:0,is_old_price:0,payment_first:0,payment_monthly:0,payment_first_primary:0,payment_monthly_primary:0,paymentFirstDis:0,paymentMonthlyDis:0,paymentFirstPrimaryDis:0,paymentMonthlyPrimaryDis:0,order_price:0,order_price_dis:0,order_price_primary:0,orderPricePrimaryDis:0,comment:"",customer_name:"",customer_email:"",customer_phone:"",customer_phone_city:"",customer_address:"",customer_location:"",customer_city:"",customer_city_id:0,customer_itn:0,customer_starttime:"",customer_endtime:"",customer_target:"",customer_sex:0,customer_age:0,customer_education:0,customer_occupation:0,customer_infoSource:0,order_edit:0},setDefaultOrder:e},t.publicObj.order=e(),t.publicObj})}(),function(){angular.module("BauVoiceApp").factory("ProductStor",function(){function e(){return angular.copy(t.publicObj.productSource)}var t=this;return t.publicObj={productSource:{product_id:0,is_addelem_only:0,room_id:0,construction_type:1,heat_coef_total:0,template_id:0,template_source:{},template:{},templateIcon:{},template_width:0,template_height:0,template_square:0,profile:{},glass:[],hardware:{},beadsData:[],profileDepths:{frameDepth:{},frameStillDepth:{},sashDepth:{},impostDepth:{},shtulpDepth:{}},lamination:{id:0,lamination_in_id:1,lamination_out_id:1,laminat_in_name:"mainpage.WHITE_LAMINATION",laminat_out_name:"mainpage.WHITE_LAMINATION",img_in_id:1,img_out_id:1},chosenAddElements:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],door_type_index:0,door_shape_id:0,door_sash_shape_id:0,door_handle_shape_id:0,door_lock_shape_id:0,doorName:"",doorSashName:"",doorHandle:{},doorLock:{},template_price:0,addelem_price:0,addelemPriceDis:0,product_price:0,productPriceDis:0,report:[],comment:"",product_qty:1},setDefaultProduct:e},t.publicObj.product=e(),t.publicObj})}(),function(){angular.module("BauVoiceApp").factory("UserStor",function(){function e(){return angular.copy(t.publicObj.userInfoSource)}var t=this;return t.publicObj={userInfoSource:{cityName:"",regionName:"",countryName:"",fullLocation:"",climaticZone:0,heatTransfer:0,langLabel:"en",langName:"English",currencyId:0,currency:"",discountConstr:0,discountAddElem:0,discountConstrMax:0,discountAddElemMax:0,discConstrByWeek:[],discAddElemByWeek:[],factoryLink:""},setDefaultUser:e},t.publicObj.userInfo=e(),t.publicObj})}();var speechKit=new NuanceSpeechKitPlugin;