"use strict";function parseStringToDimension(e){e=e.toLowerCase();var t=e.split(" ");return t=updateDigits(t),t=updateFirstTwoToM(t),t=updateCM(t),t=updateMs(t),t=updateM(t),t=updateMM(t),e=summAll(t)}function updateDigits(e){for(var t=0;t<e.length;t++)"ноль"===e[t]&&(e[t]="0"),"раз"===e[t]&&(e[t]="1"),"один"===e[t]&&(e[t]="1"),"два"===e[t]&&(e[t]="2"),"три"===e[t]&&(e[t]="3"),"четыре"===e[t]&&(e[t]="4"),"пять"===e[t]&&(e[t]="5"),"шесть"===e[t]&&(e[t]="6"),"семь"===e[t]&&(e[t]="7"),"восемь"===e[t]&&(e[t]="8"),"девять"===e[t]&&(e[t]="9");return e}function updateCM(e){for(var t=0;t<e.length;t++)"и"===e[t]&&(e[t]="см"),t>0&&"см"===e[t]&&isNumber(e[t-1])&&(e[t-1]=10*parseInt(e[t-1],10),e.splice(t,1));return e}function updateMM(e){for(var t=0;t<e.length;t++)t>0&&"мм"===e[t]&&isNumber(e[t-1])&&e.splice(t,1);return e}function updateMs(e){for(var t=0;t<e.length;t++)"метр"!==e[t]&&"1м"!==e[0]&&"тыща"!==e[t]&&"тысяча"!==e[t]||(e[t]="м");return e}function updateM(e){for(var t=1;t<e.length;t++)"м"===e[t]&&isNumber(e[t-1])&&(e[t-1]=""+1e3*parseInt(e[t-1],10),e=upadtePostM(e,t),e.splice(t,1));return"м"===e[0]&&(e[0]="1000",e=upadtePostM(e,0)),e}function updateFirstTwoToM(e){return 2==e.length&&isNumber(e[0])&&isNumber(e[1])&&(e[2]=e[1],e[1]="м",parseInt(e[2],10)<100?e[3]="см":e[3]="мм"),e}function upadtePostM(e,t){return t===e.length-2?isNumber(e[t+1])&&parseInt(e[t+1],10)<100&&(e[t+1]=""+10*parseInt(e[t+1],10)):t<e.length-1&&isNumber(e[t+1])&&parseInt(e[t+1],10)<100&&isNumber(e[t+2])&&(e[t+1]=""+10*parseInt(e[t+1],10)),e}function summAll(e){for(var t=0,i=0;i<e.length;i++)t+=parseInt(e[i],10);return""+t}function isNumber(e){return""+parseInt(e,10)===e}function OkResult(e){this.status=!0,this.data=e}function ErrorResult(e,t){this.status=!1,this.code=e,this.message=t,console.error(this.code,this.message)}function doInit(){var e="cvq.nmdp.nuancemobility.net";speechKit.initialize("Credentials",e,443,!1,function(e){printResult(e)},function(e){printResult(e)})}function doCleanup(){speechKit.cleanup(function(e){printResult(e)},function(e){printResult(e)})}function startRecognition(e,t,i){function r(){console.log("FORCE STOP"+s),s===!0&&(console.log("FORCE STOP"),o())}function o(){speechKit.stopRecognition(function(e){a(e)},function(e){console.log(e)})}function a(e){"RecoVolumeUpdate"==e.event?(console.log("RecoVolumeUpdate"),t&&t(e.volumeLevel)):n(e)}function n(t){return console.log("parseAndCallback"+t.event),void 0!=t.results&&t.results.length>0?(e(t.results[0].value),void(s=!1)):"RecoStarted"!=t.event?(e("0"),void(s=!1)):void 0}var s=!0,l=i;console.log("Before startRecognition"),speechKit.startRecognition("dictation",l,function(e){a(e)},function(e){a(e)}),console.log("After startRecognition");setTimeout(r,5e3)}function stopRecognition(){speechKit.stopRecognition(function(e){printRecoResult(e)},function(e){console.log(e)})}function getResult(){speechKit.getResults(function(e){printResult(e)},function(e){console.log("getResult"+e)})}function printResult(e){console.log("printResult "+e.event)}function playTTS(e,t){function i(e){console.log("printTTSResult "+JSON.stringify(e))}if(e.length>0){console.log("Playing TTS");var r=(document.getElementById("tts-language"),t);speechKit.playTTS(e,r,null,function(e){i(e)},function(e){i(e)})}}var isDevice=/(Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone)/i.test(window.navigator.userAgent)?1:0;!function(){function e(e,t,i){e.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl as loginPage",title:"Login"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl as mainPage",title:"Main"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl as settingsPage",title:"Settings"}).when("/change-pass",{templateUrl:"views/change-pass.html",controller:"ChangePassCtrl as passwordPage",title:"Change Pass"}).when("/change-lang",{templateUrl:"views/change-lang.html",controller:"ChangeLangCtrl as languagePage",title:"Change Language"}).when("/location",{templateUrl:"views/location.html",controller:"LocationCtrl as locationPage",title:"Location"}).when("/history",{templateUrl:"views/history.html",controller:"HistoryCtrl as historyPage",title:"History"}).when("/cart",{templateUrl:"views/cart.html",controller:"CartCtrl as cartPage",title:"Cart"}).when("/design",{templateUrl:"views/design.html",controller:"DesignCtrl as designPage",title:"Design"}).otherwise({redirectTo:"/"}),i.preferredLanguage("en"),i.useLoader("AsyncLoader")}e.$inject=["$routeProvider","$locationProvider","$translateProvider"],/(chrome|Chromium|safari|firefox|Opera|Yandex|internet explorer|Seamonkey)/i.test(window.navigator.userAgent)&&(isDevice=0),isDevice&&(window.PhonegapApp={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){doInit(),angular.element(document).ready(function(){angular.bootstrap(document,["BauVoiceApp","LoginModule"])})}},PhonegapApp.initialize()),angular.module("BauVoiceApp",["ngRoute","pascalprecht.translate","ngTouch","ngCordova","swipe","LoginModule","MainModule","DesignModule","CartModule","HistoryModule","SettingsModule"]).config(e),angular.module("LoginModule",[]),angular.module("MainModule",[]),angular.module("DesignModule",[]),angular.module("CartModule",[]),angular.module("HistoryModule",[]),angular.module("SettingsModule",[])}(),function(){angular.module("CartModule").controller("CartCtrl",["$filter","globalConstants","GlobalStor","OrderStor","ProductStor","UserStor","CartStor","CartServ","CartMenuServ",function(e,t,i,r,o,a,n,s,l){function d(e){n.cart.allAddElements[e].length>0&&(h.config.detailProductIndex=e,h.config.isAddElementDetail=!0)}function c(){h.config.isAddElementDetail=!1}function u(){h.config.isCartLightView=!h.config.isCartLightView}function p(e){var t=e+1;h.config.isProductComment=h.config.isProductComment===t?0:t}function g(e){e=e||window.event,13===e.keyCode&&l.approveNewDisc(0)}function m(e){e=e||window.event,13===e.keyCode&&l.approveNewDisc(1)}function f(e){e?(h.config.isShowDiscInput=0,h.config.isShowDiscInputAdd=1):(h.config.isShowDiscInput=1,h.config.isShowDiscInputAdd=0)}function _(e){13===e.which&&l.closeDiscountBlock()}var h=this;h.constants=t,h.G=i,h.O=r,h.U=a,h.C=n,h.config={currDisConstr:0,isAddElementDetail:0,isCartLightView:0,detailProductIndex:0,isShowDiscInput:0,isShowDiscInputAdd:0,isProductComment:0,element:e("translate")("add_elements.ELEMENT"),elementa:e("translate")("add_elements.ELEMENTA"),elements:e("translate")("add_elements.ELEMENTS"),DELAY_START:t.STEP,typing:"on"},h.ALL_ADD_ELEMENTS=e("translate")("cart.ALL_ADD_ELEMENTS"),h.ADD_ORDER=e("translate")("cart.ADD_ORDER"),h.LETTER_M=e("translate")("common_words.LETTER_M"),h.HEATCOEF_VAL=e("translate")("mainpage.HEATCOEF_VAL"),h.MM=e("translate")("mainpage.MM"),h.CONFIGMENU_SIZING=e("translate")("mainpage.CONFIGMENU_SIZING"),h.CONFIGMENU_PROFILE=e("translate")("mainpage.CONFIGMENU_PROFILE"),h.CONFIGMENU_GLASS=e("translate")("mainpage.CONFIGMENU_GLASS"),h.CONFIGMENU_HARDWARE=e("translate")("mainpage.CONFIGMENU_HARDWARE"),h.CONFIGMENU_LAMINATION_TYPE=e("translate")("mainpage.CONFIGMENU_LAMINATION_TYPE"),h.CONFIGMENU_LAMINATION=e("translate")("mainpage.CONFIGMENU_LAMINATION"),h.CONFIGMENU_ADDITIONAL=e("translate")("mainpage.CONFIGMENU_ADDITIONAL"),h.PRODUCT_QTY=e("translate")("cart.PRODUCT_QTY"),h.ORDER_COMMENT=e("translate")("cart.ORDER_COMMENT"),h.LIGHT_VIEW=e("translate")("cart.LIGHT_VIEW"),h.DISCOUNT_SELECT=e("translate")("cart.DISCOUNT_SELECT"),h.MAX=e("translate")("common_words.MAX"),h.DISCOUNT_WINDOW=e("translate")("cart.DISCOUNT_WINDOW"),h.DISCOUNT_ADDELEM=e("translate")("cart.DISCOUNT_ADDELEM"),h.DISCOUNT=e("translate")("cart.DISCOUNT"),h.DISCOUNT_WITHOUT=e("translate")("cart.DISCOUNT_WITHOUT"),h.DISCOUNT_WITH=e("translate")("cart.DISCOUNT_WITH"),h.FULL_VIEW=e("translate")("cart.FULL_VIEW"),h.ADDELEMENTS_EDIT_LIST=e("translate")("cart.ADDELEMENTS_EDIT_LIST"),h.WIDTH_LABEL=e("translate")("add_elements.WIDTH_LABEL"),h.HEIGHT_LABEL=e("translate")("add_elements.HEIGHT_LABEL"),h.QTY_LABEL=e("translate")("add_elements.QTY_LABEL"),h.ADDELEMENTS_PRODUCT_COST=e("translate")("cart.ADDELEMENTS_PRODUCT_COST"),h.GRID=e("translate")("add_elements.GRID"),h.VISOR=e("translate")("add_elements.VISOR"),h.SPILLWAY=e("translate")("add_elements.SPILLWAY"),h.OUTSIDE=e("translate")("add_elements.OUTSIDE"),h.LOUVERS=e("translate")("add_elements.LOUVERS"),h.INSIDE=e("translate")("add_elements.INSIDE"),h.CONNECTORS=e("translate")("add_elements.CONNECTORS"),h.FAN=e("translate")("add_elements.FAN"),h.WINDOWSILL=e("translate")("add_elements.WINDOWSILL"),h.HANDLEL=e("translate")("add_elements.HANDLEL"),h.OTHERS=e("translate")("add_elements.OTHERS"),h.NAME_LABEL=e("translate")("add_elements.NAME_LABEL"),h.TOTAL_PRICE_TXT=e("translate")("add_elements.TOTAL_PRICE_TXT"),h.LINK_BETWEEN_COUPLE=e("translate")("cart.LINK_BETWEEN_COUPLE"),h.LINK_BETWEEN_ALL=e("translate")("cart.LINK_BETWEEN_ALL"),i.global.currOpenPage="cart",i.global.productEditNumber=0,l.joinAllAddElements(),l.calculateOrderPrice(),"main"===i.global.prevOpenPage&&(o.product=o.setDefaultProduct()),i.global.orderEditNumber||(n.cart.customer.customer_location=r.order.customer_location),h.decreaseProductQty=s.decreaseProductQty,h.increaseProductQty=s.increaseProductQty,h.addNewProductInOrder=s.addNewProductInOrder,h.clickDeleteProduct=s.clickDeleteProduct,h.createProductCopy=s.createProductCopy,h.addCloneProductInOrder=s.addCloneProductInOrder,h.openBox=s.openBox,h.showAddElementDetail=d,h.closeAddElementDetail=c,h.viewSwitching=u,h.switchProductComment=p,h.box=s.box,h.enterKeyPrice=g,h.enterKeyDop=m,h.showAllAddElements=s.showAllAddElements,h.openDiscountBlock=l.openDiscountBlock,h.closeDiscountBlock=l.closeDiscountBlock,h.approveNewDisc=l.approveNewDisc,h.openDiscInput=f,h.pressEnterInDisc=_}])}(),function(){angular.module("SettingsModule").controller("ChangeLangCtrl",["$location","$translate","$timeout","globalConstants","GlobalStor","UserStor","NavMenuServ","loginServ",function(e,t,i,r,o,a,n,s){function l(s){t.use(r.languages[s].label),a.userInfo.langLabel=r.languages[s].label,a.userInfo.langName=r.languages[s].name,o.global.isVoiceHelper&&(o.global.voiceHelperLanguage=n.setLanguageVoiceHelper()),1===o.global.isRoomElements?i(function(){e.path("/main")},200):i(function(){e.path("/")},200)}function d(){e.path("/settings")}var c=this;c.constants=r,c.U=a,c.config={DELAY_START:r.STEP,typing:"on"},c.getDeviceLanguage=s.getDeviceLanguage,c.switchLang=l,c.gotoSettingsPage=d}])}(),function(){angular.module("SettingsModule").controller("ChangePassCtrl",["$filter","globalConstants","SettingServ","UserStor","localDB",function(e,t,i,r,o){function a(){l.config.oldPassword&&r.userInfo.password==o.md5(l.config.oldPassword)&&l.config.newPassword&&l.config.confirmPassword&&l.config.newPassword===l.config.confirmPassword?(l.config.isErrorPassword=0,r.userInfo.password=o.md5(l.config.newPassword),o.updateLocalServerDBs(o.tablesLocalDB.users.tableName,r.userInfo.id,{password:r.userInfo.password}).then(function(){l.config.newPassword=l.config.confirmPassword="",i.gotoSettingsPage()})):l.config.oldPassword&&r.userInfo.password==o.md5(l.config.oldPassword)?l.config.isErrorPassword=1:l.config.isErrorOldPassword=1}function n(){l.config.isErrorPassword=0}function s(){l.config.isErrorOldPassword=0}var l=this;l.U=r,l.consts=t,l.config={DELAY_START:t.STEP,oldPassword:0,newPassword:0,confirmPassword:0,isErrorPassword:0,isErrorOldPassword:0,typing:"on"},l.WRONG_LOGIN=e("translate")("login.WRONG_LOGIN"),l.NO_CONFIRM_PASS=e("translate")("settings.NO_CONFIRM_PASS"),l.CHANGE_PASSWORD=e("translate")("settings.CHANGE_PASSWORD"),l.SAVE=e("translate")("settings.SAVE"),l.CURRENT_PASSWORD=e("translate")("settings.CURRENT_PASSWORD"),l.NEW_PASSWORD=e("translate")("settings.NEW_PASSWORD"),l.CONFIRM_PASSWORD=e("translate")("settings.CONFIRM_PASSWORD"),l.saveNewPassword=a,l.gotoSettingsPage=i.gotoSettingsPage,l.checkError=n,l.checkErrorOld=s}])}(),function(){angular.module("DesignModule").controller("DesignCtrl",["$filter","$timeout","globalConstants","DesignServ","GlobalStor","ProductStor","DesignStor",function(e,t,i,r,o,a,n){function s(){n.design.activeMenuItem=0,n.design.activeSubMenuItem=0,n.design.isDropSubMenu=0}function l(){D.config.isDesignError=1,n.design.activeMenuItem=0,n.design.activeSubMenuItem=0,t(function(){D.config.isDesignError=0},800)}function d(e){if(n.design.activeSubMenuItem=e,!n.design.selectedGlass.length){var t=d3.selectAll("#tamlateSVG .glass");n.design.selectedGlass=t[0],t.classed("glass-active",!0)}}function c(e){var t,i=1,o=n.design.selectedGlass.length;if(1===e)for(s(),t=0;o>t;t+=1)r.deleteSash(n.design.selectedGlass[t]);else if(2!==e&&6!==e&&8!==e||(n.design.isDropSubMenu===e?n.design.isDropSubMenu=0:(n.design.isDropSubMenu=e,i=0)),i)for(s(),t=0;o>t;t+=1)r.createSash(e,n.design.selectedGlass[t])}function u(e){var t=d3.selectAll("#tamlateSVG .corner_mark");t[0].length?(n.design.activeSubMenuItem=e,t.transition().duration(300).ease("linear").attr("r",50),n.design.selectedCorner=t[0],t.on("click",function(){r.hideCornerMarks();var e=d3.select(this).transition().duration(300).ease("linear").attr("r",50);n.design.selectedCorner.push(e[0][0])})):l()}function p(e){s(),D.config.isTest=1,r.hideCornerMarks()}function g(e){var t=d3.selectAll("#tamlateSVG .frame")[0].filter(function(e){return"frame"===e.__data__.type||"arc"===e.__data__.type?!0:void 0});if(t.length){if(n.design.activeSubMenuItem=e,!n.design.selectedArc.length){var i=d3.selectAll(t);n.design.selectedArc=i[0],i.classed("active_svg",!0)}}else l()}function m(e){s(),D.config.isTest=1,r.deselectAllArc()}function f(e){var i,o=1,a=n.design.selectedImpost.length;if(1===e){if(s(),a){for(i=0;a>i;i+=1)r.deleteImpost(n.design.selectedImpost[i]);t(function(){n.design.isImpostDelete=0},300)}}else if(2===e||3===e){if(4!==e&&8!==e&&12!==e||(n.design.isDropSubMenu===e?n.design.isDropSubMenu=0:(n.design.isDropSubMenu=e,o=0)),o)if(s(),a)r.deselectAllImpost();else{var l=n.design.selectedGlass.length;if(l)for(i=0;l>i;i+=1)r.createImpost(e,n.design.selectedGlass[i])}}else s(),D.config.isTest=1,r.deselectAllGlass(),r.deselectAllImpost()}function _(){s(),r.initMirror()}function h(){s(),r.positionAxises()}function y(){s(),r.positionGlasses()}function E(){D.config.isDoorConfig=1,r.closeSizeCaclulator()}function v(e){if(!D.config.selectedStep2)if(n.design.doorConfig.doorShapeIndex===e)n.design.doorConfig.doorShapeIndex="",D.config.selectedStep1=0;else{switch(n.design.sashShapeList.length=0,e){case 0:case 1:o.global.doorKitsT1.length?n.design.sashShapeList=angular.copy(o.global.doorKitsT1):o.global.doorKitsT2.length&&(n.design.sashShapeList=angular.copy(o.global.doorKitsT2));break;case 2:o.global.doorKitsT1.length&&(n.design.sashShapeList=angular.copy(o.global.doorKitsT1));break;case 3:o.global.doorKitsT2.length&&(n.design.sashShapeList=angular.copy(o.global.doorKitsT2))}n.design.doorConfig.doorShapeIndex=e,D.config.selectedStep1=1}}function b(e){var t;D.config.selectedStep3||(n.design.doorConfig.sashShapeIndex===e?(n.design.doorConfig.sashShapeIndex="",D.config.selectedStep2=0):(n.design.doorConfig.sashShapeIndex=e,D.config.selectedStep2=1),t=o.global.doorHandlers.filter(function(t){return t.profIds.indexOf(n.design.sashShapeList[e].profileId)+1}),n.design.handleShapeList=t)}function I(e){D.config.selectedStep4||(n.design.doorConfig.handleShapeIndex===e?(n.design.doorConfig.handleShapeIndex="",D.config.selectedStep3=0):(n.design.doorConfig.handleShapeIndex=e,D.config.selectedStep3=1),n.design.lockShapeList=o.global.doorLocks[e])}function A(e){n.design.doorConfig.lockShapeIndex===e?(n.design.doorConfig.lockShapeIndex="",D.config.selectedStep4=0):(n.design.doorConfig.lockShapeIndex=e,D.config.selectedStep4=1)}function S(){D.config.selectedStep3?(D.config.selectedStep3=0,D.config.selectedStep4=0,n.design.doorConfig.lockShapeIndex="",n.design.doorConfig.handleShapeIndex=""):D.config.selectedStep2?(D.config.selectedStep2=0,n.design.doorConfig.sashShapeIndex=""):D.config.selectedStep1?(D.config.selectedStep1=0,n.design.doorConfig.doorShapeIndex=""):(D.config.isDoorConfig=0,n.design.doorConfig=n.setDefaultDoor())}function T(){r.setNewDoorParamValue(a.product,n.design),r.rebuildSVGTemplate(),D.config.isDoorConfig=0}function x(e){if(n.design.tempSize.length)r.closeSizeCaclulator();else if(n.design.activeMenuItem=n.design.activeMenuItem===e?0:e,n.design.isDropSubMenu=0,r.hideCornerMarks(),r.deselectAllImpost(),4!==e&&r.deselectAllArc(),r.hideSizeTools(),n.design.activeMenuItem)switch(n.design.activeMenuItem){case 1:d(e),t(function(){n.design.isDropSubMenu=2},C),t(function(){n.design.isDropSubMenu=6},O),t(function(){n.design.isDropSubMenu=8},R),t(function(){n.design.isDropSubMenu=0},P);break;case 2:r.deselectAllGlass(),u(e);break;case 3:d(e),t(function(){n.design.isDropSubMenu=4},C),t(function(){n.design.isDropSubMenu=8},O),t(function(){n.design.isDropSubMenu=12},R),t(function(){n.design.isDropSubMenu=0},P);break;case 4:r.deselectAllGlass(),g(e);break;case 5:n.design.activeSubMenuItem=e}else n.design.activeSubMenuItem=0,r.deselectAllGlass(),r.deselectAllArc(),t(function(){n.design.isImpostDelete=0},300)}function N(){o.global.activePanel?(o.global.activePanel=0,r.initAllImposts(),r.initAllGlass(),r.initAllArcs(),r.initAllDimension()):o.global.activePanel=1}function L(){D.config.isTest=0,n.design.isDimExtra=0,n.design.isSquareExtra=0}var D=this,C=300,O=600,R=900,P=1200;D.constants=i,D.G=o,D.P=a,D.D=n,o.global.currOpenPage="design",D.config={isDesignError:0,isTest:0,isDoorConfig:0,selectedStep1:0,selectedStep2:0,selectedStep3:0,selectedStep4:0,DELAY_SHOW_FIGURE_ITEM:1e3,typing:"on"},D.IMPOST_SHAPE=e("translate")("design.IMPOST_SHAPE"),D.SASH_SHAPE=e("translate")("design.SASH_SHAPE"),D.ANGEL_SHAPE=e("translate")("design.ANGEL_SHAPE"),D.ARCH_SHAPE=e("translate")("design.ARCH_SHAPE"),D.POSITION_SHAPE=e("translate")("design.POSITION_SHAPE"),D.UNITS_DESCRIP=e("translate")("design.UNITS_DESCRIP"),D.PROJECT_DEFAULT=e("translate")("design.PROJECT_DEFAULT"),D.BACK=e("translate")("common_words.BACK"),D.SAVE=e("translate")("settings.SAVE"),D.CANCEL=e("translate")("add_elements.CANCEL"),D.DOOR_CONFIG_LABEL=e("translate")("design.DOOR_CONFIG_LABEL"),D.DOOR_CONFIG_DESCTIPT=e("translate")("design.DOOR_CONFIG_DESCTIPT"),D.SASH_CONFIG_DESCTIPT=e("translate")("design.SASH_CONFIG_DESCTIPT"),D.HANDLE_CONFIG_DESCTIPT=e("translate")("design.HANDLE_CONFIG_DESCTIPT"),D.LOCK_CONFIG_DESCTIPT=e("translate")("design.LOCK_CONFIG_DESCTIPT"),D.STEP=e("translate")("design.STEP"),D.LABEL_DOOR_TYPE=e("translate")("design.LABEL_DOOR_TYPE"),D.LABEL_SASH_TYPE=e("translate")("design.LABEL_SASH_TYPE"),D.LABEL_HANDLE_TYPE=e("translate")("design.LABEL_HANDLE_TYPE"),D.LABEL_LOCK_TYPE=e("translate")("design.LABEL_LOCK_TYPE"),D.NOT_AVAILABLE=e("translate")("design.NOT_AVAILABLE"),D.DIM_EXTRA=e("translate")("design.DIM_EXTRA"),D.SQUARE_EXTRA=e("translate")("design.SQUARE_EXTRA"),D.ROOM_SELECTION=e("translate")("mainpage.ROOM_SELECTION"),D.TEST_STAGE=e("translate")("design.TEST_STAGE"),D.VOICE_SPEACH=e("translate")("design.VOICE_SPEACH"),r.setDoorConfigDefault(a.product),n.design=n.setDefaultDesign(),r.setDefaultTemplate(),t(function(){r.initAllImposts(),r.initAllGlass(),r.initAllArcs(),r.initAllDimension()},50),D.designSaved=r.designSaved,D.designCancel=r.designCancel,D.selectMenuItem=x,D.setDefaultConstruction=r.setDefaultConstruction,D.showTemplates=N,D.toggleDoorConfig=E,D.selectDoor=v,D.selectSash=b,D.selectHandle=I,D.selectLock=A,D.closeDoorConfig=S,D.saveDoorConfig=T,D.insertSash=c,D.insertCorner=p,D.insertImpost=f,D.insertArc=m,D.initMirror=_,D.positionAxis=h,D.positionGlass=y,D.stepBack=r.stepBack,D.closeAttantion=L}])}(),function(){angular.module("HistoryModule").controller("HistoryCtrl",["$filter","GlobalStor","UserStor","HistoryStor","HistoryServ","CartServ",function(e,t,i,r,o,a){var n=this;n.G=t,n.H=r,n.U=i,n.FROM=e("translate")("history.FROM"),n.UNTIL=e("translate")("history.UNTIL"),n.DATE_RANGE=e("translate")("history.DATE_RANGE"),n.ALL_TIME=e("translate")("history.ALL_TIME"),n.SORTING=e("translate")("history.SORTING"),n.NEWEST_FIRST=e("translate")("history.NEWEST_FIRST"),n.NEWEST_LAST=e("translate")("history.NEWEST_LAST"),n.SORT_BY_TYPE=e("translate")("history.SORT_BY_TYPE"),n.SORT_SHOW=e("translate")("history.SORT_SHOW"),n.ALL=e("translate")("common_words.ALL"),n.SORT_SHOW_ACTIVE=e("translate")("history.SORT_SHOW_ACTIVE"),n.SORT_SHOW_WAIT=e("translate")("history.SORT_SHOW_WAIT"),n.SORT_SHOW_DONE=e("translate")("history.SORT_SHOW_DONE"),n.INCLUDED=e("translate")("history.INCLUDED"),n.DELIVERY=e("translate")("cart.DELIVERY"),n.AND=e("translate")("common_words.AND"),n.ASSEMBLING=e("translate")("cart.ASSEMBLING"),n.CLIENT=e("translate")("history.CLIENT"),n.PHONE=e("translate")("history.PHONE"),n.ADDRESS=e("translate")("history.ADDRESS"),n.PAYMENTS=e("translate")("history.PAYMENTS"),n.WAIT_MASTER=e("translate")("history.WAIT_MASTER"),n.ALLPRODUCTS=e("translate")("history.ALLPRODUCTS"),n.ON=e("translate")("history.ON"),n.CHANGE=e("translate")("common_words.CHANGE"),n.BY_YOUR_REQUEST=e("translate")("history.BY_YOUR_REQUEST"),n.NOT_FIND=e("translate")("history.NOT_FIND"),n.DRAFT_VIEW=e("translate")("history.DRAFT_VIEW"),n.DRAFT=e("translate")("history.DRAFT"),n.HISTORY_VIEW=e("translate")("history.HISTORY_VIEW"),t.global.currOpenPage="history",n.createdDate="created",o.downloadOrders(),n.toCurrentCalculation=o.toCurrentCalculation,n.sendOrderToFactory=o.sendOrderToFactory,n.makeOrderCopy=o.makeOrderCopy,n.clickDeleteOrder=o.clickDeleteOrder,n.editOrder=o.editOrder,n.orderPrint=o.orderPrint,n.viewSwitching=o.viewSwitching,n.orderSearching=o.orderSearching,n.orderDateSelecting=o.orderDateSelecting,n.openCalendarScroll=o.openCalendarScroll,n.orderSorting=o.orderSorting,n.sortingInit=o.sortingInit}])}(),function(){angular.module("SettingsModule").controller("LocationCtrl",["localDB","GeneralServ","loginServ","SettingServ","GlobalStor","OrderStor","UserStor",function(e,t,i,r,o,a,n){function s(a){l.userNewLocation=a.fullLocation,n.userInfo.therm_coeff_id?n.userInfo.heatTransfer=t.roundingValue(1/a.heatTransfer):n.userInfo.heatTransfer=a.heatTransfer,"settings"===o.global.currOpenPage?(n.userInfo.city_id=a.cityId,n.userInfo.cityName=a.cityName,n.userInfo.countryId=a.countryId,n.userInfo.fullLocation=a.fullLocation,n.userInfo.climaticZone=a.climaticZone,e.updateLocalServerDBs(e.tablesLocalDB.users.tableName,n.userInfo.id,{city_id:a.cityId})):"main"===o.global.currOpenPage&&i.setUserGeoLocation(a.cityId,a.cityName,a.climaticZone,n.userInfo.heatTransfer,a.fullLocation),o.global.startProgramm=!1,r.closeLocationPage()}var l=this;l.userNewLocation=angular.copy(a.order.customer_location),l.locations=o.global.locations.cities.filter(function(e){return e.countryId===n.userInfo.countryId}),l.closeLocationPage=r.closeLocationPage,l.selectCity=s}])}(),function(){angular.module("LoginModule").controller("LoginCtrl",["$location","$timeout","$cordovaNetwork","$filter","globalConstants","localDB","loginServ","MainServ","GlobalStor","ProductStor","UserStor",function(e,t,i,r,o,a,n,s,l,d,c){function u(e){u.list||(u.list=[]);var t,i,r=u.list;for(t=0;t<e.length;t+=1)i=new Image,i.onload=function(){var e=r.indexOf(this);-1!==e&&r.splice(e,1)},r.push(i),i.src=e[t]}function p(){s.saveUserEntry(),s.createOrderData(),s.setCurrDiscounts(),s.setCurrTemplate(),s.prepareTemplates(d.product.construction_type).then(function(){s.prepareMainPage(),s.laminatFiltering(),1===l.global.locations.cities.length&&(n.downloadAllCities(1),l.global.isLoader=0,e.path("/main"))})}function g(){D.isStartImport=1,a.importAllDB(c.userInfo.phone,c.userInfo.device_code).then(function(e){e?(n.downloadAllData().then(function(){p()}),D.isStartImport=0):console.log("Error!")})}function m(e){for(var t,i=e.length;--i>-1;)for(t=l.global.locations.cities.length;--t>-1;)e[i].city_id===l.global.locations.cities[t].cityId&&(e[i].location=l.global.locations.cities[t].fullLocation);return e}function f(){n.setUserLocation(),+c.userInfo.factory_id>0?n.isLocalDBExist().then(function(e){D.isLocalDB=e,D.isLocalDB?n.downloadAllData().then(function(){p()}):g(c.userInfo.factory_id)}):n.collectCityIdsAsCountry().then(function(e){a.importFactories(c.userInfo.phone,c.userInfo.device_code,e).then(function(e){l.global.isLoader=0,e.status?(D.factories=m(e.factories),D.isFactoryId=1):console.log("can not get factories!")})})}function _(e){e.locked?a.cleanLocalDB(a.tablesLocalDB).then(function(t){t&&a.createTablesLocalDB(a.tablesLocalDB).then(function(t){t&&(a.insertRowLocalDB(e,a.tablesLocalDB.users.tableName),angular.extend(c.userInfo,e),a.importLocation(c.userInfo.phone,c.userInfo.device_code).then(function(e){e&&n.prepareLocationToUse().then(function(){f()})}))})}):(l.global.isLoader=0,D.isUserNotActive=1)}function h(){a.importUser(D.user.phone).then(function(e){if(e.status){var t=angular.copy(e.user);console.log("USER!!!!!!!!!!!!",D.user.phone,e);var i=a.md5(D.user.password);i===t.password?_(t):(l.global.isLoader=0,D.isUserPasswordError=1)}else l.global.isLoader=0,D.isUserNotExist=1})}function y(){var t=e.search(),i=["7d537b6746f925b1703aefa9b8a9a4bc","3f5f0c7d46d318e026f9ba60dceffc65","799e078b084c6d57cea0b0d53a7e3008","9aefeef9c7e53f9de9bb36f32649dc3f","a2da6d85764368b24392740020efbc92","ceb60bfed037baaa484bd7b88d274c98","632b3213660804acb71fe045c6e321ed","d11758b674ac02f0fcf128dcc906dbef","8155bc545f84d9652f1012ef2bdfb6eb","59e711d152de7bec7304a8c2ecaf9f0f","877466ffd21fe26dd1b3366330b7b560","f31c147335274c56d801f833d3c26a70","f68ec4f0c6df90137749af75a929a3eb","0f190e6e164eafe66f011073b4486975","a9588aa82388c0579d8f74b4d02b895f","66a516f865fca1c921dba625ede4a693","7cebd0178b69b2e88774529e1e59a7b0","ad1df793247a0e650d0d7166341b8d97","04fc711301f3c784d66955d98d399afb","768c1c687efe184ae6dd2420710b8799","f7a5c99c58103f6b65c451efd0f81826","27701bd8dd141b953b94a5c9a44697c0","7f7d5f9f3a660f2b09e3aae62a15e29b","23ff17389acbfd020043268fb49e7048","cd714cc33cfd23e74f414cbb8b9787fe","2959f1aea8db0f7fbba61f0f8474d0ef","a28a19e19b283845c851b4876b97cef4","661e67f8ce5eaf9d63c1b5be6fce1afb","0653e359db756493450c3fb1fc6790b2","ec5fefce8d1d81849b47923d6d1b52c0","d4ccb0f347163d9ee1cd5a106e1ec48b","c500ea6c5baf3deb447be25b90cf5f1c","59a6670111970ede6a77e9b43a5c4787","266021e24dd0bfaaa96f2b5e21d7c800","b8c4b7f74db12fadbe2d979ed93f392b","2482b711a07d1da3efa733aa7014f947","573b8926f015aa477cb6604901b92aea","b54d11c86eb7c8955a50d20f6b3be2f2","3a55b7218a5ca395ac71b3ec9904b6ed","3615d9213b1b3d5fe760901f43a8405f","e50137601a90943ce98b03e90d73272e","d4651afb4e1c749f0bacc7ff5d101982","988a8fa4855bf7ea54057717655d3fc9"],r=["0950604425","0500505500","78124541170","22274313","9201922876","903528981","9301600441","89324310961","1000000","1000001","1000002","1000003","1000004","1000005","1000006","1000007","1000008","1000009","000001","000002","000003","000007","000008","000009","000010","000011","000012","000013","000014","000015","000016","000017","000018","000019","000020","000021","000022","000023","000024","000025","000026","000027","000028"],o=["0950604425","0500505500","78124541170","22274313","9201922876","903528981","9301600441","89324310961","1000000","1000001","1000002","1000003","1000004","1000005","1000006","1000007","1000008","1000009","000001","000002","000003","000007","000008","000009","000010","000011","000012","000013","000014","000015","000016","000017","000018","000019","000020","000021","000022","000023","000024","000025","000026","000027","000028"],n=i.length,s=0;if(t.access){for(;n>-1;)n-=1,i[n]===t.access&&(D.user.phone=r[n],D.user.password=o[n],s=1);s?D.user.phone&&D.user.password&&(l.global.isLoader=1,h()):a.importUser(t.access,1).then(function(e){var t=angular.copy(e.user);l.global.isLoader=1,_(t)})}}function E(){D.isOffline=!1}function v(){t(function(){l.global.isLoader2=25},100),t(function(){l.global.isLoader2=40},1500),t(function(){l.global.isLoader2=65},3e3),t(function(){l.global.isLoader2=90},4e3),t(function(){l.global.isLoader2=94},7e3),t(function(){l.global.isLoader2=95},9e3),t(function(){l.global.isLoader2=96},11e3),t(function(){l.global.isLoader2=97},15e3),t(function(){l.global.isLoader2=98},21e3),t(function(){l.global.isLoader2=99},3e4)}function b(e){v();var t;D.submitted=1,e.$valid&&(l.global.isLoader=1,D.isOnline?n.isLocalDBExist().then(function(e){D.isLocalDB=e,D.isLocalDB?(console.log("SYNC"),a.selectLocalDB(a.tablesLocalDB.users.tableName,{phone:D.user.phone}).then(function(e){e.length?(t=a.md5(D.user.password),t===e[0].password?e[0].locked?(angular.extend(c.userInfo,e[0]),n.prepareLocationToUse().then(function(){f()})):(l.global.isLoader=0,D.isUserNotActive=1):(l.global.isLoader=0,D.isUserPasswordError=1)):(console.log("Sync IMPORT"),h())})):(console.log("IMPORT"),h())}):D.isLocalDB?(console.log("OFFLINE"),a.selectLocalDB(a.tablesLocalDB.users.tableName,{phone:D.user.phone}).then(function(e){if(e.length){var t=a.md5(D.user.password);t===e[0].password?e[0].locked?e[0].factory_id>0?(angular.extend(c.userInfo,e[0]),n.prepareLocationToUse().then(function(){n.setUserLocation(),n.downloadAllData().then(function(){p()})})):(l.global.isLoader=0,D.isOffline=1):(l.global.isLoader=0,D.isUserNotActive=1):(l.global.isLoader=0,D.isUserPasswordError=1)}else l.global.isLoader=0,D.isUserNotExist=1})):(l.global.isLoader=0,D.isOffline=1))}function I(){D.user.factoryId>0?D.isOnline?(l.global.isLoader=1,c.userInfo.factory_id=angular.copy(D.user.factoryId),a.updateLocalServerDBs(a.tablesLocalDB.users.tableName,c.userInfo.id,{factory_id:c.userInfo.factory_id}).then(function(){D.isFactoryId=0,g()})):D.isOffline=1:D.isFactoryNotSelect=1}function A(){D.isFactoryNotSelect=0,D.isFactoryId=0,delete D.user.factoryId}function S(){D.isOnline?n.isLocalDBExist().then(function(e){D.isLocalDB=e,D.isLocalDB?(l.global.isLoader=1,n.prepareLocationToUse(1).then(function(){l.global.isLoader=0,D.isRegistration=1})):(l.global.isLoader=1,a.cleanLocalDB(a.tablesLocalDB).then(function(e){e&&a.createTablesLocalDB(a.tablesLocationLocalDB).then(function(e){e&&a.importLocation().then(function(e){e&&n.prepareLocationToUse(1).then(function(){l.global.isLoader=0,D.isRegistration=1})})})})),D.user={}}):D.isOffline=1}function T(){D.user={},D.isRegistration=0}function x(e){D.submitted=!0,e.$valid&&(D.isOnline?(l.global.isLoader=1,a.importUser(D.user.phone).then(function(e){if(e.status)l.global.isLoader=0,D.isUserExist=1;else{var t={name:D.user.name,phone:D.user.phone,email:D.user.mail,cityId:D.user.city.cityId,password:a.md5(D.user.phone)};console.log("CREATE USER!!!!!!!!!!!!",t),a.createUserServer(t),l.global.isLoader=0,D.isSendEmail=1,T()}})):D.isOffline=1)}function N(){D.user.country?D.user.region||delete D.user.city:(delete D.user.region,delete D.user.city)}function L(){0===l.global.gotoSettingsPage&&(t(function(){e.path("/change-lang")},1),t(function(){e.path("/")},1),l.global.gotoSettingsPage=1)}var D=this;D.G=l,D.consts=o,D.isOnline=1,D.isOffline=0,D.isLocalDB=0,D.isRegistration=0,D.submitted=0,D.isUserExist=0,D.isUserNotExist=0,D.isUserPasswordError=0,D.isSendEmail=0,D.isUserNotActive=0,D.isFactoryId=0,D.isFactoryNotSelect=0,D.isStartImport=0,D.user={},D.factories=0,D.OFFLINE=r("translate")("login.OFFLINE"),D.OK=r("translate")("common_words.OK"),D.USER_CHECK_EMAIL=r("translate")("login.USER_CHECK_EMAIL"),D.USER_NOT_EXIST=r("translate")("login.USER_NOT_EXIST"),D.USER_NOT_ACTIVE=r("translate")("login.USER_NOT_ACTIVE"),D.USER_PASSWORD_ERROR=r("translate")("login.USER_PASSWORD_ERROR"),D.IMPORT_DB=r("translate")("login.IMPORT_DB"),D.LOGIN=r("translate")("login.LOGIN"),D.PASSWORD=r("translate")("login.PASSWORD"),D.EMPTY_FIELD=r("translate")("login.EMPTY_FIELD"),D.WRONG_LOGIN=r("translate")("login.WRONG_LOGIN"),D.ENTER=r("translate")("login.ENTER"),D.REGISTRATION=r("translate")("login.REGISTRATION"),D.SELECT_FACTORY=r("translate")("login.SELECT_FACTORY"),D.SELECT_PRODUCER=r("translate")("login.SELECT_PRODUCER"),D.SELECT=r("translate")("common_words.SELECT"),D.USER_EXIST=r("translate")("login.USER_EXIST"),
D.CLIENT_NAME=r("translate")("cart.CLIENT_NAME"),D.WRONG_NAME=r("translate")("login.WRONG_NAME"),D.SHORT_NAME=r("translate")("login.SHORT_NAME"),D.SELECT_COUNTRY=r("translate")("login.SELECT_COUNTRY"),D.SELECT_REGION=r("translate")("login.SELECT_REGION"),D.SELECT_CITY=r("translate")("login.SELECT_CITY"),D.CLIENT_EMAIL=r("translate")("cart.CLIENT_EMAIL"),D.WRONG_EMAIL=r("translate")("cart.WRONG_EMAIL"),u(["img/room/1.png","img/room/4.png","img/room/6.png","img/room/7.png","img/room/8.png","img/room/9.png","img/room/10.png","img/room/11.png","img/room/12.png","img/room/26.png","img/room/121.png","img/room/122.png","img/room/123.png","img/room/fon.gif","img/room/33.gif","img/room/333.gif"]),setTimeout(function(){$("#jssj").trigger("click")},1e3),D.gotoSettingsPage=L,D.switchRegistration=S,D.closeRegistration=T,D.enterForm=b,D.loader=v,D.registrForm=x,D.selectLocation=N,D.selectFactory=I,D.closeFactoryDialog=A,D.closeOfflineAlert=E,n.getDeviceLanguage(),D.isOnline&&(n.initExport(),y())}])}(),function(){angular.module("MainModule").controller("MainCtrl",["$location","$timeout","globalConstants","GeneralServ","loginServ","MainServ","SVGServ","DesignServ","AddElementMenuServ","GlobalStor","ProductStor","DesignStor","UserStor","AuxStor",function(e,t,i,r,o,a,n,s,l,d,c,u,p,g){function m(){c.product.is_addelem_only||((d.global.isQtyCalculator||d.global.isSizeCalculator)&&l.finishCalculators(),d.global.showRoomSelectorDialog=0,d.global.configMenuTips=0,d.global.isShowCommentBlock=0,d.global.isTemplateTypeMenu=0,r.stopStartProg(),a.setDefaultAuxParam(),d.global.showGlassSelectorDialog&&s.closeGlassSelectorDialog(1),d.global.activePanel=0,u.design.isGlassExtra=0,e.path("/design"))}function f(){for(var e=1e6,t=0,i=0,r=0;10>r;r++){for(var o=+new Date,a=0;e>a;a++){var n=Math.sqrt(a)*Math.sin(a)*Math.cos(a/2)/2;t+=n}var s=+new Date,l=s-o;i+=l}return d.global.getPCPower=Math.round(1e6/i),d.global.loader=2,Math.round(1e6/i)}var _=this;_.G=d,_.P=c,_.U=p,_.A=g,_.constants=i,_.D=u,d.global.currOpenPage="main",d.global.isReport=0,_.config={isDesignError:0,DELAY_SHOW_FIGURE_ITEM:1e3,typing:"on"},d.global.startProgramm&&s.setDefaultTemplate(),d.global.productEditNumber&&(console.log("EDIT!!!!"),console.log("product = ",c.product),n.createSVGTemplate(c.product.template_source,c.product.profileDepths).then(function(e){c.product.template=e})),console.log(f()),_.getPCPower=f,_.goToEditTemplate=m,_.setDefaultConstruction=s.setDefaultConstruction}])}(),function(){angular.module("MainModule").controller("addElementMenuCtrl",["$timeout","$filter","globalConstants","GlobalStor","ProductStor","UserStor","AuxStor","MainServ","AddElementMenuServ","AddElementsServ","DesignServ",function(e,t,i,r,o,a,n,s,l,d,c){function u(){n.aux.isTabFrame=!n.aux.isTabFrame}function p(e){1===n.aux.truefalse?($("#"+n.aux.trfal+"prod").css({color:"#363636"}),$("#"+e).css({width:"100%",height:"7%"}),$("#"+e+"open").css({visibility:"visible"}),$("#"+e+"close").css({visibility:"hidden"}),n.aux.truefalse=0):($("#"+n.aux.trfal+"prod").css({color:"#363636"}),$("#"+e).css({width:"100%",height:"auto"}),$("#"+e+"open").css({visibility:"hidden"}),$("#"+e+"close").css({visibility:"visible"}),n.aux.truefalse=1)}function g(t,i,r){var o;n.aux.isAddElement===t+"-"+i?n.aux.isAddElement=!1:n.aux.isAddElement===!1?(o=$(r.target).offset(),f.coordinats={top:o.top-17},e(function(){l.getAddElementPrice(t,i)},500)):(n.aux.isAddElement=!1,e(function(){o=$(r.target).offset(),f.coordinats={top:o.top-17}},500),e(function(){l.getAddElementPrice(t,i)},1e3))}function m(e,t,i){t===n.aux.trfal||-1===n.aux.trfal?$("#"+t+"prod").css({color:"#0079ff"}):t!==n.aux.trfal&&($("#"+n.aux.trfal+"prod").css({color:"#363636"}),$("#"+t+"prod").css({color:"#0079ff"})),n.aux.trfal=t,(r.global.isQtyCalculator||r.global.isSizeCalculator)&&l.finishCalculators(),"main"===r.global.currOpenPage&&1===n.aux.isFocusedAddElement?o.product.is_addelem_only?l.chooseAddElement(e,t):(n.aux.selectedGrid=[e,t],n.aux.isGridSelectorDialog=1,n.aux.isAddElement=e+"-"+t,c.initAllGlassXGrid()):n.aux.isAddElementListView?g(e,t,i):l.chooseAddElement(e,t)}var f=this;f.constants=i,f.G=r,f.P=o,f.U=a,f.A=n,f.config={DELAY_START:i.STEP,DELAY_SHOW_ELEMENTS_MENU:10*i.STEP,typing:"on"},f.TIP=t("translate")("add_elements_menu.TIP"),f.EMPTY_ELEMENT=t("translate")("add_elements_menu.EMPTY_ELEMENT"),f.NAME_LABEL=t("translate")("add_elements.NAME_LABEL"),f.QTY_LABEL=t("translate")("add_elements.QTY_LABEL"),f.WIDTH_LABEL=t("translate")("add_elements.WIDTH_LABEL"),f.HEIGHT_LABEL=t("translate")("add_elements.HEIGHT_LABEL"),f.ADD=t("translate")("add_elements.ADD"),f.TAB_NAME_SIMPLE_FRAME=t("translate")("add_elements_menu.TAB_NAME_SIMPLE_FRAME"),f.TAB_NAME_HARD_FRAME=t("translate")("add_elements_menu.TAB_NAME_HARD_FRAME"),f.TAB_EMPTY_EXPLAIN=t("translate")("add_elements_menu.TAB_EMPTY_EXPLAIN"),f.closeAddElementsMenu=l.closeAddElementsMenu,f.selectAddElement=m,f.hideMenu=p,f.chooseAddElement=l.chooseAddElement,f.chooseAddElementList=l.chooseAddElementList,f.deleteAddElement=l.deleteAddElement,f.showFrameTabs=u,f.initAddElementTools=d.initAddElementTools,f.showInfoBox=s.showInfoBox,f.closeQtyCaclulator=l.closeQtyCaclulator,f.setValueQty=l.setValueQty,f.pressCulculator=l.pressCulculator}])}(),function(){angular.module("CartModule").controller("CartMenuCtrl",["$filter","globalConstants","GlobalStor","OrderStor","UserStor","CartStor","CartMenuServ",function(e,t,i,r,o,a,n){function s(e){u.config.activeMenuItem=u.config.activeMenuItem===e?0:e}function l(){r.order.is_instalment=0,r.order.instalment_id=0,r.order.selectedInstalmentPeriod=0,r.order.selectedInstalmentPercent=0,u.config.activeMenuItem=0}function d(){r.order.products.length&&(a.cart.isMasterDialog=1)}function c(){r.order.products.length&&(r.order.is_instalment?a.cart.isCreditDialog=1:a.cart.isOrderDialog=1)}var u=this;u.G=i,u.U=o,u.O=r,u.C=a,u.config={activeMenuItem:!1,month:e("translate")("common_words.MONTH_LABEL"),montha:e("translate")("common_words.MONTHA_LABEL"),months:e("translate")("common_words.MONTHS_LABEL"),DELAY_START:t.STEP,typing:"on"},u.DELIVERY=e("translate")("cart.DELIVERY"),u.SELF_EXPORT=e("translate")("cart.SELF_EXPORT"),u.FLOOR=e("translate")("cart.FLOOR"),u.ASSEMBLING=e("translate")("cart.ASSEMBLING"),u.WITHOUT_ASSEMBLING=e("translate")("cart.WITHOUT_ASSEMBLING"),u.FREE=e("translate")("cart.FREE"),u.PAYMENT_BY_INSTALMENTS=e("translate")("cart.PAYMENT_BY_INSTALMENTS"),u.WITHOUT_INSTALMENTS=e("translate")("cart.WITHOUT_INSTALMENTS"),u.DELIVERY_DATE=e("translate")("cart.DELIVERY_DATE"),u.FIRST_PAYMENT_LABEL=e("translate")("cart.FIRST_PAYMENT_LABEL"),u.DATE_DELIVERY_LABEL=e("translate")("cart.DATE_DELIVERY_LABEL"),u.MONTHLY_PAYMENT_LABEL=e("translate")("cart.MONTHLY_PAYMENT_LABEL"),u.TOTAL_PRICE_LABEL=e("translate")("cart.TOTAL_PRICE_LABEL"),u.ORDER=e("translate")("cart.ORDER"),u.MEASURE=e("translate")("cart.MEASURE"),u.selectMenuItem=s,u.closeInstalment=l,u.selectFloorPrice=n.selectFloorPrice,u.selectAssembling=n.selectAssembling,u.selectInstalment=n.selectInstalment,u.openMasterDialog=d,u.openOrderDialog=c,u.swipeDiscountBlock=n.swipeDiscountBlock}])}(),function(){angular.module("MainModule").controller("ConfigMenuCtrl",["$location","$filter","globalConstants","GeneralServ","MainServ","AddElementMenuServ","DesignServ","GlobalStor","OrderStor","ProductStor","DesignStor","UserStor",function(e,t,i,r,o,a,n,s,l,d,c,u){function p(t){(s.global.isQtyCalculator||s.global.isSizeCalculator)&&a.finishCalculators(),s.global.showRoomSelectorDialog=0,s.global.configMenuTips=0,s.global.isShowCommentBlock=0,s.global.isTemplateTypeMenu=0,r.stopStartProg(),o.setDefaultAuxParam(),s.global.showGlassSelectorDialog&&n.closeGlassSelectorDialog(1),1===t?(s.global.activePanel=0,c.design.isGlassExtra=0,e.path("/design")):4===d.product.construction_type?3!==t&&6!==t||(s.global.activePanel=s.global.activePanel===t?0:t):s.global.activePanel=s.global.activePanel===t?0:t}function g(){o.inputProductInOrder()&&o.goToCart()}function m(){var e=f.config.TOOLTIP.length;s.global.configMenuTips+=1,s.global.configMenuTips===e&&(s.global.configMenuTips=0)}var f=this;f.constants=i,f.G=s,f.O=l,f.P=d,f.U=u,f.config={TOOLTIP:["",t("translate")("mainpage.TEMPLATE_TIP"),t("translate")("mainpage.PROFILE_TIP"),t("translate")("mainpage.GLASS_TIP")],DELAY_START:i.STEP,DELAY_SHOW_CONFIG_LIST:5*i.STEP,DELAY_SHOW_FOOTER:5*i.STEP,DELAY_TYPE_ITEM_TITLE:10*i.STEP,DELAY_SHOW_U_COEFF:20*i.STEP,DELAY_GO_TO_CART:2*i.STEP,typing:"on"},f.CONFIGMENU_CONFIGURATION=t("translate")("mainpage.CONFIGMENU_CONFIGURATION"),f.CONFIGMENU_SIZING=t("translate")("mainpage.CONFIGMENU_SIZING"),f.MM=t("translate")("mainpage.MM"),f.CONFIGMENU_PROFILE=t("translate")("mainpage.CONFIGMENU_PROFILE"),f.CONFIGMENU_GLASS=t("translate")("mainpage.CONFIGMENU_GLASS"),f.CONFIGMENU_HARDWARE=t("translate")("mainpage.CONFIGMENU_HARDWARE"),f.CONFIGMENU_LAMINATION=t("translate")("mainpage.CONFIGMENU_LAMINATION"),f.CONFIGMENU_LAMINATION_TYPE=t("translate")("mainpage.CONFIGMENU_LAMINATION_TYPE"),f.CONFIGMENU_ADDITIONAL=t("translate")("mainpage.CONFIGMENU_ADDITIONAL"),f.CONFIGMENU_NO_ADDELEMENTS=t("translate")("mainpage.CONFIGMENU_NO_ADDELEMENTS"),f.CONFIGMENU_IN_CART=t("translate")("mainpage.CONFIGMENU_IN_CART"),f.SAVE=t("translate")("settings.SAVE"),f.LETTER_M=t("translate")("common_words.LETTER_M"),f.HEATCOEF_VAL=t("translate")("mainpage.HEATCOEF_VAL"),f.selectConfigPanel=p,f.inputProductInOrder=g,f.showNextTip=m}])}(),function(){angular.module("MainModule").controller("NavMenuCtrl",["$location","$window","$filter","globalConstants","GeneralServ","NavMenuServ","GlobalStor","OrderStor","ProductStor","UserStor",function(e,t,i,r,o,a,n,s,l,d){function c(t){switch(p.activeMenuItem=p.activeMenuItem===t?0:t,t){case 1:o.stopStartProg(),e.path("/location");break;case 2:a.getCurrentGeolocation(),p.activeMenuItem=0;break;case 3:o.setPreviosPage(),e.path("/main");break;case 4:e.path("/cart");break;case 5:a.createAddElementsProduct();break;case 6:o.stopStartProg(),a.gotoHistoryPage();break;case 7:o.setPreviosPage(),e.path("/settings");break;case 8:p.activeMenuItem=0,d.userInfo.factoryLink&&d.userInfo.factoryLink.length&&o.goToLink(d.userInfo.factoryLink);break;case 9:a.switchVoiceHelper()}}function u(){p.activeMenuItem=0,a.clickNewProject()}var p=this;p.G=n,p.O=s,p.P=l,p.activeMenuItem=0,p.NAVMENU_GEOLOCATION=i("translate")("mainpage.NAVMENU_GEOLOCATION"),p.NAVMENU_CURRENT_GEOLOCATION=i("translate")("mainpage.NAVMENU_CURRENT_GEOLOCATION"),p.NAVMENU_CALCULATIONS=i("translate")("mainpage.NAVMENU_CALCULATIONS"),p.NAVMENU_CURRENT_CALCULATION=i("translate")("mainpage.NAVMENU_CURRENT_CALCULATION"),p.NAVMENU_CART=i("translate")("mainpage.NAVMENU_CART"),p.NAVMENU_ADD_ELEMENTS=i("translate")("mainpage.NAVMENU_ADD_ELEMENTS"),p.NAVMENU_ALL_CALCULATIONS=i("translate")("mainpage.NAVMENU_ALL_CALCULATIONS"),p.NAVMENU_APPENDIX=i("translate")("mainpage.NAVMENU_APPENDIX"),p.NAVMENU_SETTINGS=i("translate")("mainpage.NAVMENU_SETTINGS"),p.NAVMENU_MORE_INFO=i("translate")("mainpage.NAVMENU_MORE_INFO"),p.NAVMENU_VOICE_HELPER=i("translate")("mainpage.NAVMENU_VOICE_HELPER"),p.NAVMENU_NEW_CALC=i("translate")("mainpage.NAVMENU_NEW_CALC"),p.selectMenuItem=c,p.clickNewProject=u}])}(),function(){angular.module("CartModule").controller("AddElemCartCtrl",["globalConstants","GeneralServ","CartServ","CartMenuServ","OrderStor","CartStor","AuxStor",function(e,t,i,r,o,a,n){function s(){a.cart.isAllAddElems=0,a.cart.allAddElemsOrder.length=0,a.cart.addElemsOrderPriceTOTAL=0,a.cart.isSelectedProduct=0,n.aux.showAddElementsMenu=0,n.aux.addElementGroups.length=0,n.aux.searchingWord=""}function l(e){for(var t,i,r,a=o.order.products,n=a.length;--n>-1;)for(r=a[n].chosenAddElements,t=r.length;--t>-1;)if(i=r[t].length)if(e)for(;--i>-1;)r[t][i].id===e.id&&r[t][i].element_width===e.element_width&&r[t][i].element_height===e.element_height&&r[t].splice(i,1);else r[t].length=0}function d(e){l(e),r.joinAllAddElements(),a.cart.isExistAddElems?i.showAllAddElements():s(),i.calculateAddElemsProductsPrice(1),r.calculateOrderPrice()}function c(){l(),i.calculateAddElemsProductsPrice(),r.calculateOrderPrice(),r.joinAllAddElements(),s()}function u(){var e,t,i,r,n,s,l,d=a.cart.allAddElements.length;for(I.config.addElemUnitProducts.length=0,i=0;d>i;i+=1)for(l=a.cart.allAddElements[i],e=l.length,r=0;e>r;r+=1)if(l[r].id===I.config.selectedAddElemUnit.id&&l[r].element_width===I.config.selectedAddElemUnit.element_width&&l[r].element_height===I.config.selectedAddElemUnit.element_height)if(o.order.products[i].is_addelem_only)t={productIndex:i,is_addelem_only:o.order.products[i].is_addelem_only,name:l[r].name,element_width:l[r].element_width,element_height:l[r].element_height,element_qty:l[r].element_qty,elementPriceDis:l[r].elementPriceDis},I.config.addElemUnitProducts.push(t);else if(t={productIndex:i,is_addelem_only:o.order.products[i].is_addelem_only,element_qty:l[r].element_qty/o.order.products[i].product_qty},o.order.products[i].product_qty>1){for(n=[],s=+o.order.products[i].product_qty;--s>-1;)n.push(t);I.config.addElemUnitProducts.push(n)}else I.config.addElemUnitProducts.push(t)}function p(e){I.config.selectedAddElemUnit=e,u(),I.config.isAddElemUnitDetail=1}function g(){I.config.isAddElemUnitDetail=0,I.config.selectedAddElemUnit={id:0},I.config.isLinkExplodeMenu=0}function m(e){for(var t,i=o.order.products[e].chosenAddElements,r=i.length,a=I.config.selectedAddElemUnit;--r>-1;)if(t=i[r].length)for(;--t>-1;)i[r][t].id===a.id&&i[r][t].element_width===a.element_width&&i[r][t].element_height===a.element_height&&i[r].splice(t,1)}function f(){for(var e=a.cart.allAddElemsOrder,t=I.config.selectedAddElemUnit,i=e.length,r=1;--i>-1;)e[i].id===t.id&&(t.element_qty=angular.copy(e[i].element_qty),r-=1);r&&g()}function _(e,t){t?i.decreaseProductQty(e[0].productIndex):(m(e),r.joinAllAddElements()),a.cart.isExistAddElems?(i.showAllAddElements(),u(),f()):(g(),s()),i.calculateAddElemsProductsPrice(1),r.calculateOrderPrice()}function h(e,t){I.config.isLinkExplodeMenu=!I.config.isLinkExplodeMenu,I.config.explodeMenuTop=t.center.y-50,I.config.explodeMenuLeft=t.center.x-30}function y(e,t){var a=d3.max(o.order.products.map(function(e){return e.product_id})),n=angular.copy(o.order.products[e[0].productIndex]),s=n.product_qty-1;if(n.product_qty=1,t)for(o.order.products[e[0].productIndex].product_qty=1;--s>-1;)i.addCloneProductInOrder(n,a);else o.order.products[e[0].productIndex].product_qty-=1,i.addCloneProductInOrder(n,a);I.config.isLinkExplodeMenu=0,r.joinAllAddElements(),i.showAllAddElements(),u(),f(),i.calculateAddElemsProductsPrice(1),r.calculateOrderPrice()}function E(){I.config.isSwipeProdSelector=!I.config.isSwipeProdSelector}function v(){for(var e=0,t=a.cart.selectedProducts.length;--t>-1;)a.cart.selectedProducts[t].length&&(e+=1);a.cart.isSelectedProduct=e?1:0}function b(e){var t=a.cart.selectedProducts[e].length;t?(a.cart.selectedProducts[e].length=0,v()):(a.cart.selectedProducts[e].push(1),a.cart.isSelectedProduct=1)}var I=this;I.constants=e,I.config={addElementDATA:t.addElementDATA,selectedAddElemUnit:{id:0},isAddElemUnitDetail:0,addElemUnitProducts:[],isLinkExplodeMenu:0,explodeMenuTop:0,explodeMenuLeft:0,isSwipeProdSelector:0},I.closeAllAddElemsPanel=s,I.deleteAllAddElems=c,I.deleteAddElemsItem=d,I.showAddElemUnitDetail=p,I.closeAddElemUnitDetail=g,I.deleteAddElemUnit=_,I.toggleExplodeLinkMenu=h,I.explodeUnitToProduct=y,I.swipeProductSelector=E,I.selectProductToAddElem=b}])}(),function(){angular.module("MainModule").controller("AddElementsListCtrl",["$filter","globalConstants","GeneralServ","AddElementsServ","AddElementMenuServ","GlobalStor","ProductStor","UserStor","AuxStor",function(e,t,i,r,o,a,n,s,l){var d=this;d.G=a,d.P=n,d.U=s,d.A=l,d.config={addElementDATA:i.addElementDATA,DELAY_START:t.STEP,DELAY_SHOW_ELEMENTS_MENU:6*t.STEP,filteredGroups:[],typing:"on"},d.NAME_LABEL=e("translate")("add_elements.NAME_LABEL"),d.QTY_LABEL=e("translate")("add_elements.QTY_LABEL"),d.WIDTH_LABEL=e("translate")("add_elements.WIDTH_LABEL"),d.HEIGHT_LABEL=e("translate")("add_elements.HEIGHT_LABEL"),d.TOTAL_PRICE_TXT=e("translate")("add_elements.TOTAL_PRICE_TXT"),d.SCHEME_VIEW=e("translate")("add_elements.SCHEME_VIEW"),d.selectAddElement=r.selectAddElement,d.initAddElementTools=r.initAddElementTools,d.deleteAddElement=o.deleteAddElement,d.deleteAllAddElements=o.deleteAllAddElements,d.closeAddElementListView=r.closeAddElementListView,d.pressCulculator=o.pressCulculator}])}(),function(){angular.module("MainModule").controller("AddElementsCtrl",["$filter","$timeout","globalConstants","GeneralServ","AddElementsServ","AddElementMenuServ","DesignServ","GlobalStor","AuxStor","ProductStor",function(e,t,i,r,o,a,n,s,l,d){function c(){l.aux.isWindowSchemeDialog=!0,n.showAllDimension(i.SVG_ID_ICON)}function u(){l.aux.isWindowSchemeDialog=!1}function p(e){s.global.typeMenu=0,s.global.typeMenuID=e,t(function(e){s.global.typeMenu=s.global.typeMenuID,g.config.colorFilter=s.global.typeMenuID,55===s.global.typeMenu?$(".aux-handle").css({left:"14.375rem",top:"82.625rem"}):$(".aux-handle").css({left:"34.375rem",top:"65.625rem"})},100)}var g=this;g.constants=i,g.G=s,g.P=d,g.A=l,g.config={DELAY_START:i.STEP,addElementDATA:r.addElementDATA,DELAY_SHOW_INSIDESLOPETOP:20*i.STEP,DELAY_SHOW_INSIDESLOPERIGHT:22*i.STEP,DELAY_SHOW_INSIDESLOPELEFT:21*i.STEP,DELAY_SHOW_FORCECONNECT:30*i.STEP,DELAY_SHOW_BALCONCONNECT:35*i.STEP,DELAY_SHOW_BUTTON:40*i.STEP,DELAY_SHOW_ELEMENTS_MENU:12*i.STEP,colorFilter:55,typing:"on"},g.INSIDES=e("translate")("add_elements.INSIDES"),g.OUTSIDES=e("translate")("add_elements.OUTSIDES"),g.COMPONENTS=e("translate")("add_elements.COMPONENTS"),g.OTHERS=e("translate")("add_elements.OTHERS"),g.OTHER=e("translate")("add_elements.OTHER"),g.ALL=e("translate")("add_elements.ALL"),g.CHOOSE=e("translate")("add_elements.CHOOSE"),g.QTY_LABEL=e("translate")("add_elements.QTY_LABEL"),g.WIDTH_LABEL=e("translate")("add_elements.WIDTH_LABEL"),g.HEIGHT_LABEL=e("translate")("add_elements.HEIGHT_LABEL"),g.OTHER_ELEMENTS1=e("translate")("add_elements.OTHER_ELEMENTS1"),g.OTHER_ELEMENTS2=e("translate")("add_elements.OTHER_ELEMENTS2"),g.LIST_VIEW=e("translate")("add_elements.LIST_VIEW"),g.click=p,g.selectAddElement=o.selectAddElement,g.initAddElementTools=o.initAddElementTools,g.pressCulculator=a.pressCulculator,g.openAddElementListView=o.openAddElementListView,g.showWindowScheme=c,g.closeWindowScheme=u}])}(),function(){angular.module("MainModule").controller("GlassesCtrl",["$filter","globalConstants","MainServ","AnalyticsServ","DesignServ","SVGServ","GlobalStor","OrderStor","ProductStor","DesignStor","UserStor",function(e,t,i,r,o,a,n,s,l,d,c){function u(e,t){n.global.prevGlassId=angular.copy(n.global.selectGlassId),n.global.prevGlassName=angular.copy(n.global.selectGlassName),n.global.selectGlassId=e,n.global.selectGlassName=t,n.global.showGlassSelectorDialog=1,o.initAllGlassXGlass()}function p(){var e;d.design.selectedGlass.length=0,a.createSVGTemplate(l.product.template_source,l.product.profileDepths).then(function(t){l.product.template=angular.copy(t),e=l.product.hardware.id||0,i.preparePrice(l.product.template,l.product.profile.id,l.product.glass,e,l.product.lamination.lamination_in_id)})}function g(){i.setGlassToTemplateBlocks(l.product.template_source,n.global.selectGlassId,n.global.selectGlassName),p(),o.closeGlassSelectorDialog()}function m(){var e,t=d.design.selectedGlass.length,r=angular.copy(l.product.glass);if(t||i.setGlassToTemplateBlocks(l.product.template,n.global.selectGlassId,n.global.selectGlassName),i.setCurrentGlass(l.product,n.global.selectGlassId),i.checkGlassSizes(l.product.template),d.design.extraGlass.length)d.design.isGlassExtra=1,l.product.glass=angular.copy(r),i.setGlassToTemplateBlocks(l.product.template,n.global.prevGlassId,n.global.prevGlassName);else if(t){for(;--t>-1;)e=d.design.selectedGlass[t].attributes.block_id.nodeValue,i.setGlassToTemplateBlocks(l.product.template_source,n.global.selectGlassId,n.global.selectGlassName,e);p(),o.closeGlassSelectorDialog()}else g()}var f=this;f.constants=t,f.G=n,f.P=l,f.config={prevGlassId:0,prevGlassName:"",camera:e("translate")("panels.CAMERa"),camer:e("translate")("panels.CAMER"),camers:e("translate")("panels.CAMERs"),DELAY_START:5*t.STEP,DELAY_BLOCK:2*t.STEP,DELAY_TYPING:2.5*t.STEP,typing:"on"},f.ENERGY_SAVE=e("translate")("panels.ENERGY_SAVE"),f.HEAT_INSULATION=e("translate")("panels.HEAT_INSULATION"),f.NOICE_INSULATION=e("translate")("panels.NOICE_INSULATION"),f.selectGlass=u,f.confirmGlass=m,f.setGlassToAll=g,f.closeGlassSelectorDialog=o.closeGlassSelectorDialog,f.showInfoBox=i.showInfoBox}])}(),function(){angular.module("MainModule").controller("HardwaresCtrl",["$filter","globalConstants","GlobalStor","OrderStor","ProductStor","DesignStor","UserStor","MainServ","AnalyticsServ",function(e,t,i,r,o,a,n,s,l){function d(e){o.product.hardware.id!==e&&(s.checkHardwareSizes(o.product.template,e),a.design.extraHardware.length?a.design.isHardwareExtra=1:(s.setCurrentHardware(o.product,e),s.preparePrice(o.product.template,o.product.profile.id,o.product.glass,o.product.hardware.id,o.product.lamination.lamination_in_id),l.sendAnalyticsData(n.userInfo.id,r.order.id,o.product.template_id,e,3)))}var c=this;c.G=i,c.P=o,c.config={DELAY_START:5*t.STEP,DELAY_BLOCK:2*t.STEP,DELAY_TYPING:2.5*t.STEP,typing:"on"},c.BRAND=e("translate")("panels.BRAND"),c.COUNTRY=e("translate")("panels.COUNTRY"),c.CORROSION_COEFF=e("translate")("panels.CORROSION_COEFF"),c.BURGLAR_COEFF=e("translate")("panels.BURGLAR_COEFF"),c.selectHardware=d,c.showInfoBox=s.showInfoBox}])}(),function(){angular.module("MainModule").controller("LaminationsCtrl",["$filter","globalConstants","MainServ","GlobalStor","OrderStor","ProductStor","UserStor",function(e,t,i,r,o,a,n){function s(e){for(var t=r.global.laminats.length;--t>-1;)r.global.laminats[t].type_id===e&&(r.global.laminats[t].isActive=!r.global.laminats[t].isActive,i.laminatFiltering())}function l(e){i.setCurrLamination(a.product,e),i.setProfileByLaminat(e).then(function(){})}var d=this;d.G=r,d.P=a,d.config={DELAY_START:5*t.STEP,DELAY_BLOCK:2*t.STEP,DELAY_TYPING:2.5*t.STEP,typing:"on"},d.LAMINAT_INSIDE=e("translate")("panels.LAMINAT_INSIDE"),d.LAMINAT_OUTSIDE=e("translate")("panels.LAMINAT_OUTSIDE"),d.selectLaminat=l,d.initLaminatFilter=s,d.showInfoBox=i.showInfoBox}])}(),function(){angular.module("MainModule").controller("ProfilesCtrl",["$filter","globalConstants","MainServ","AnalyticsServ","GlobalStor","OrderStor","ProductStor","DesignStor","UserStor",function(e,t,i,r,o,a,n,s,l){function d(e){var t;n.product.profile.id!==e&&(t=angular.copy(n.product),i.setCurrentProfile(n.product,e).then(function(){i.saveTemplateInProduct(n.product.template_id).then(function(){i.checkGlassSizes(n.product.template),o.global.isSashesInTemplate&&i.checkHardwareSizes(n.product.template),n.product=angular.copy(t),s.design.extraGlass.length?s.design.isGlassExtra=1:s.design.extraHardware.length?s.design.isHardwareExtra=1:(i.setCurrLamination(n.product),i.setCurrentProfile(n.product,e).then(function(){i.parseTemplate().then(function(){i.laminatFiltering(),r.sendAnalyticsData(l.userInfo.id,a.order.id,n.product.template_id,e,1)})}))})}))}var c=this;c.G=o,c.P=n,c.config={camera:e("translate")("panels.CAMERa"),camer:e("translate")("panels.CAMER"),camers:e("translate")("panels.CAMERs"),DELAY_START:5*t.STEP,DELAY_BLOCK:2*t.STEP,DELAY_TYPING:2.5*t.STEP,typing:"on"},c.COUNTRY=e("translate")("panels.COUNTRY"),c.HEAT_INSULATION=e("translate")("panels.HEAT_INSULATION"),c.NOICE_INSULATION=e("translate")("panels.NOICE_INSULATION"),c.selectProfile=d,c.showInfoBox=i.showInfoBox}])}(),function(){angular.module("MainModule").controller("TemplatesCtrl",["$location","$filter","globalConstants","MainServ","GeneralServ","TemplatesServ","optionsServ","GlobalStor","DesignStor","OrderStor","ProductStor",function(e,t,i,r,o,a,n,s,l,d,c){function u(){s.global.isTemplateTypeMenu=!s.global.isTemplateTypeMenu}function p(e){function i(){4===e&&r.setDefaultDoorConfig(),s.global.isChangedTemplate=0,a.initNewTemplateType(e)}s.global.isTemplateTypeMenu=0,4===e&&s.global.noDoorExist?l.design.isNoDoors=1:("design"===s.global.currOpenPage&&(s.global.isChangedTemplate=l.design.designSteps.length?1:0),s.global.isChangedTemplate?o.confirmAlert(t("translate")("common_words.NEW_TEMPLATE_TITLE"),t("translate")("common_words.TEMPLATE_CHANGES_LOST"),i):a.initNewTemplateType(e))}var g=this;g.constants=i,g.G=s,g.O=d,g.P=c,g.config={DELAY_TEMPLATE_ELEMENT:5*i.STEP,typing:"on"},g.TEMPLATE_WINDOW=t("translate")("panels.TEMPLATE_WINDOW"),g.TEMPLATE_DOOR=t("translate")("panels.TEMPLATE_DOOR"),g.TEMPLATE_BALCONY_ENTER=t("translate")("panels.TEMPLATE_BALCONY_ENTER"),g.TEMPLATE_BALCONY=t("translate")("panels.TEMPLATE_BALCONY"),n.getTemplateImgIcons(function(e){e.status?g.templatesImgs=e.data.templateImgs:console.log(e)}),g.selectNewTemplate=a.selectNewTemplate,g.toggleTemplateType=u,g.selectNewTemplateType=p}])}(),function(){angular.module("MainModule").controller("AddElemGroupMenuCtrl",["AddElementsServ","AddElementMenuServ","DesignServ","GlobalStor","ProductStor","AuxStor",function(e,t,i,r,o,a){function n(t){a.aux.isAddElement=0,e.selectAddElement(t)}var s=this;s.A=a,s.takeAddElemMenu=n,s.takeAddElemFilt=t.takeAddElemFilt}])}(),function(){angular.module("MainModule").controller("AlertCtrl",["$filter","GlobalStor",function(e,t){function i(){t.global.isAlert=0,t.global.confirmAction()}function r(){t.global.isAlert=0,t.global.confirmInActivity()}function o(){t.global.isAlert=0,t.global.isBox=0}var a=this;a.G=t,a.BUTTON_N=e("translate")("common_words.BUTTON_N"),a.BUTTON_Y=e("translate")("common_words.BUTTON_Y"),a.BUTTON_C=e("translate")("common_words.BUTTON_C"),a.BUTTON_E=e("translate")("common_words.BUTTON_E"),a.isAlert=o,a.clickYes=i,a.clickCopy=r}])}(),function(){angular.module("MainModule").controller("AttantCtrl",["$filter","DesignStor","HistoryStor",function(e,t,i){function r(){t.design.isGlassExtra=0,t.design.isHardwareExtra=0,i.history.isNoPrint=0,t.design.isNoDoors=0}var o=this;o.D=t,o.H=i,o.NO_PRINT=e("translate")("history.NO_PRINT"),o.EXTRA_SASH=e("translate")("design.EXTRA_SASH"),o.CHANGE_SIZE=e("translate")("design.CHANGE_SIZE"),o.DOOR_ERROR=e("translate")("design.DOOR_ERROR"),o.closeAttantion=r}])}(),function(){angular.module("HistoryModule").controller("EditOrderCtrl",["$q","$filter","OrderStor","HistoryStor","CartStor","GlobalStor","ProductStor","RecOrderServ","MainServ","localDB","UserStor","HistoryServ",function(e,t,i,r,o,a,n,s,l,d,c,u){function p(){function e(e,r){i.order=i.setDefaultOrder(),n.product=n.setDefaultProduct(),async.waterfall([function(t){n.product.addelem_price=angular.copy(e.addelem_price),n.product.order_id=angular.copy(e.order_id),n.product.template_source=angular.copy(e.template_source),n.product.hardware_id=angular.copy(e.hardware_id),n.product.hardware=angular.copy(e.hardware),n.product.lamination=angular.copy(e.lamination),n.product.product_id=angular.copy(e.product_id),n.product.profile_id=angular.copy(e.profile_id),n.product.glass=angular.copy(e.glasses),t(null)},function(e){l.setCurrentProfile(n.product,n.product.profile_id).then(function(t){l.saveTemplateInProductForOrder().then(function(t){var i=n.product.profile_id,r=n.product.hardware_id,o=n.product.lamination.lamination_in_id,a=n.product.glass;l.preparePrice(n.product.template,i,a,r,o).then(function(t){e()})})})},function(e){l.setProductPriceTOTAL(n.product),e()},function(e){i.order.products.push(n.product),e()},function(e){for(var r=i.order.products.length,o=0;r>o;o+=1)t+=i.order.products[o].productPriceDis;l.saveOrderInDBnew(n.product.order_id,t),e()},function(e){i.order=i.setDefaultOrder(),u.downloadOrders(),e()}],function(e,t){return e?r(e):void r(null)})}a.global.isEditBox=0,a.global.isBox=0;var t=0;n.product=n.setDefaultProduct(),i.order=i.setDefaultOrder(),s.extendProfile(),s.extendGlass(),s.extendHardware(),s.extendLaminat(),s.templateSource();var o,p=r.history.isBoxArray.length;for(o=0;p>o;o+=1){var g=angular.copy(r.history.isBoxArray[o].order_id);d.deleteRowLocalDB(d.tablesLocalDB.order_products.tableName,{order_id:g}),d.deleteOrderServer(c.userInfo.phone,c.userInfo.device_code,g)}var m=r.history.isBoxArray;async.eachSeries(m,e,function(e,t){console.log("end")}),r.history.listName=[],r.history.isBoxArray=[],r.history.isBoxArrayCopy=[],r.history.listNameHardware=[],r.history.listNameProfiles=[]}function g(){a.global.isEditBox=0,a.global.isAlertHistory=0,a.global.isBox=0,r.history.isBoxArray=[],r.history.isBoxArrayCopy=[],r.history.listName=[],r.history.listNameHardware=[],r.history.listNameProfiles=[]}function m(e){s.nameListLaminat(e),s.nameListGlasses(e)}function f(){s.errorChecking(),r.history.errorСhecking<1?(p(),a.global.isAlertHistory=0):(a.global.isAlertHistory=1,console.log("errrrrrrror",r.history.errorСhecking))}var _=this;_.O=i,_.C=o,_.H=r,_.G=a,_.P=n,_.CONFIGMENU_PROFILE=t("translate")("mainpage.CONFIGMENU_PROFILE"),_.CONFIGMENU_ALERT=t("translate")("mainpage.CONFIGMENU_ALERT"),_.CONFIGMENU_GLASS=t("translate")("mainpage.CONFIGMENU_GLASS"),_.CONFIGMENU_HARDWARE=t("translate")("mainpage.CONFIGMENU_HARDWARE"),_.CONFIGMENU_LAMINATION=t("translate")("mainpage.CONFIGMENU_LAMINATION"),_.errorChecking=s.errorChecking,_.check=f,_.box=s.box,_.downloadOrders=u.downloadOrders,_.templateSource=s.templateSource,_.nameListLaminat=s.nameListLaminat,_.nameListGlasses=s.nameListGlasses,_.extendLaminat=s.extendLaminat,_.extendHardware=s.extendHardware,_.extendProfile=s.extendProfile,_.extendGlass=s.extendGlass,_.okey=p,_.close=g,_.listName=m}])}(),function(){angular.module("MainModule").controller("GridSelectorCtrl",["$filter","AddElementMenuServ","globalConstants","ProductStor","AuxStor",function(e,t,i,r,o){var a=this;a.constants=i,a.P=r,a.A=o,a.SELECT_ALL=e("translate")("mainpage.SELECT_ALL"),a.SELECT_GLASS_WARN=e("translate")("mainpage.SELECT_GLASS_WARN"),a.confirmGrid=t.confirmGrid,a.setGridToAll=t.setGridToAll,a.closeGridSelectorDialog=t.closeGridSelectorDialog}])}(),function(){angular.module("MainModule").controller("infoBoxCtrl",["GlobalStor",function(e){function t(){e.global.isInfoBox=0,e.global.infoTitle="",e.global.infoImg="",e.global.infoLink="",e.global.infoDescrip=""}var i=this;i.G=e,i.closeInfoBox=t}])}(),function(){angular.module("MainModule").controller("LoaderCtrl",["GlobalStor",function(e){var t=this;t.G=e}])}(),function(){angular.module("CartModule").controller("OrderFormCtrl",["$filter","GlobalStor","OrderStor","UserStor","CartStor","CartMenuServ",function(e,t,i,r,o,a){function n(e){o.cart.submitted=!0,e.$valid&&a.sendOrder()}var s=this;s.O=i,s.C=o,s.U=r,s.config={month:e("translate")("common_words.MONTH_LABEL"),montha:e("translate")("common_words.MONTHA_LABEL"),months:e("translate")("common_words.MONTHS_LABEL")},s.CALL_ORDER=e("translate")("cart.CALL_ORDER"),s.CALL_ORDER_DESCRIP=e("translate")("cart.CALL_ORDER_DESCRIP"),s.CALL_ORDER_CLIENT_INFO=e("translate")("cart.CALL_ORDER_CLIENT_INFO"),s.CLIENT_NAME=e("translate")("cart.CLIENT_NAME"),s.EMPTY_FIELD=e("translate")("login.EMPTY_FIELD"),s.MOBILE=e("translate")("login.MOBILE"),s.WRONG_NUMBER=e("translate")("login.WRONG_NUMBER"),s.CALL_ORDER_DELIVERY=e("translate")("cart.CALL_ORDER_DELIVERY"),s.CLIENT_LOCATION=e("translate")("cart.CLIENT_LOCATION"),s.CLIENT_ADDRESS=e("translate")("cart.CLIENT_ADDRESS"),s.CLIENT_HOUSE=e("translate")("cart.CLIENT_HOUSE"),s.CLIENT_FLAT=e("translate")("cart.CLIENT_FLAT"),s.CLIENT_FLOOR=e("translate")("cart.CLIENT_FLOOR"),s.CALL_ORDER_TOTAL_PRICE=e("translate")("cart.CALL_ORDER_TOTAL_PRICE"),s.CALL_ORDER_ADD_INFO=e("translate")("cart.CALL_ORDER_ADD_INFO"),s.CLIENT_EMAIL_ORDER=e("translate")("cart.CLIENT_EMAIL_ORDER"),s.WRONG_EMAIL=e("translate")("cart.WRONG_EMAIL"),s.ADD_PHONE=e("translate")("cart.ADD_PHONE"),s.CLIENT_SEX=e("translate")("cart.CLIENT_SEX"),s.CLIENT_SEX_M=e("translate")("cart.CLIENT_SEX_M"),s.CLIENT_SEX_F=e("translate")("cart.CLIENT_SEX_F"),s.CLIENT_AGE=e("translate")("cart.CLIENT_AGE"),s.SELECT_PLACEHOLD=e("translate")("cart.SELECT_PLACEHOLD"),s.CLIENT_EDUCATION=e("translate")("cart.CLIENT_EDUCATION"),
s.CLIENT_OCCUPATION=e("translate")("cart.CLIENT_OCCUPATION"),s.CLIENT_INFO_SOURCE=e("translate")("cart.CLIENT_INFO_SOURCE"),s.READY=e("translate")("cart.READY"),s.CALL_MASTER=e("translate")("cart.CALL_MASTER"),s.CALL_MASTER_DESCRIP=e("translate")("cart.CALL_MASTER_DESCRIP"),s.CALL_CREDIT=e("translate")("cart.CALL_CREDIT"),s.CALL_CREDIT_DESCRIP=e("translate")("cart.CALL_CREDIT_DESCRIP"),s.CALL_CREDIT_CLIENT_INFO=e("translate")("cart.CALL_CREDIT_CLIENT_INFO"),s.CREDIT_TARGET=e("translate")("cart.CREDIT_TARGET"),s.CLIENT_ITN=e("translate")("cart.CLIENT_ITN"),s.CALL_START_TIME=e("translate")("cart.CALL_START_TIME"),s.CALL_END_TIME=e("translate")("cart.CALL_END_TIME"),s.CALL_CREDIT_PARTIAL_PRICE=e("translate")("cart.CALL_CREDIT_PARTIAL_PRICE"),s.locations=t.global.locations.cities.filter(function(e){return e.countryId===r.userInfo.countryId}),s.submitForm=n,s.changeLocation=a.changeLocation,s.selectCity=a.selectCity,s.closeOrderDialog=a.closeOrderDialog}])}(),function(){angular.module("MainModule").controller("qtyCalculatorCtrl",["$filter","AddElementMenuServ",function(e,t){var i=this;i.QTY_LABEL=e("translate")("add_elements.QTY_LABEL"),i.setValueQty=t.setValueQty,i.closeQtyCaclulator=t.closeQtyCaclulator,i.pressCulculator=t.pressCulculator}])}(),function(){angular.module("MainModule").controller("ReportCtrl",["$rootScope","$filter","localDB","GeneralServ","GlobalStor","ProductStor","UserStor",function(e,t,i,r,o,a,n){function s(e){var t;t=e?a.product.report.filter(function(t){return t.element_group_id===e}):angular.copy(a.product.report),t.length?(c.config.reportPriceTotal=r.roundingValue(t.reduce(function(e,t){return{priceReal:e.priceReal+t.priceReal}}).priceReal,2),c.config.reportPriceBase=r.roundingValue(t.reduce(function(e,t){return{price:e.price+t.price}}).price,2)):(c.config.reportPriceTotal=0,c.config.reportPriceBase=0)}function l(e){s(e),e?c.config.reportFilterId=e:c.config.reportFilterId=void 0}function d(){o.global.isReport=!o.global.isReport,s(),o.global.isReport&&i.selectLocalDB(i.tablesLocalDB.elements_groups.tableName).then(function(e){c.config.reportMenu=e.filter(function(e){return e.position>0}),c.config.reportMenu.push({id:0,name:t("translate")("common_words.ALL")})}),e.$apply()}var c=this;c.G=o,c.P=a,c.U=n,c.config={reportMenu:[],reportFilterId:void 0,reportPriceTotal:0,reportPriceBase:0},c.NAME_LABEL=t("translate")("add_elements.NAME_LABEL"),c.ARTICUL_LABEL=t("translate")("add_elements.ARTICUL_LABEL"),c.QTY_LABEL=t("translate")("add_elements.QTY_LABEL"),c.SIZE_LABEL=t("translate")("add_elements.SIZE_LABEL"),c.LETTER_M=t("translate")("common_words.LETTER_M"),c.CALL_ORDER_TOTAL_PRICE=t("translate")("cart.CALL_ORDER_TOTAL_PRICE"),$(".main-content").off("keypress").keypress(function(e){5!==n.userInfo.user_type&&7!==n.userInfo.user_type||82!==e.keyCode&&114!==e.keyCode||d()}),c.sortReport=l}])}(),function(){angular.module("MainModule").controller("RoomInfoCtrl",["$filter","globalConstants","TemplatesServ","GlobalStor","OrderStor","ProductStor","UserStor",function(e,t,i,r,o,a,n){function s(){r.global.isShowCommentBlock||(r.global.showRoomSelectorDialog=1)}function l(){r.global.isShowCommentBlock=!r.global.isShowCommentBlock}var d=this;d.G=r,d.O=o,d.P=a,d.U=n,d.config={DELAY_SHOW_COEFF:20*t.STEP,DELAY_SHOW_ALLROOMS_BTN:15*t.STEP,typing:"on"},d.CLIMATE_ZONE=e("translate")("mainpage.CLIMATE_ZONE"),d.THERMAL_RESISTANCE=e("translate")("mainpage.THERMAL_RESISTANCE"),d.ROOM_SELECTION=e("translate")("mainpage.ROOM_SELECTION"),d.COMMENT=e("translate")("mainpage.COMMENT"),d.showRoomSelectorDialog=s,d.switchComment=l}])}(),function(){angular.module("MainModule").controller("RoomSelectorCtrl",["globalConstants","MainServ","TemplatesServ","GlobalStor","ProductStor","UserStor",function(e,t,i,r,o,a){function n(e){i.selectNewTemplate(r.global.rooms[e].template_id-1,e+1)}var s=this;s.G=r,s.P=o,s.U=a,s.config={DELAY_SHOW_ROOM:2*e.STEP},s.selectRoom=n,s.closeRoomSelectorDialog=t.closeRoomSelectorDialog}])}(),function(){angular.module("MainModule").controller("searchCtrl",["$filter","GlobalStor","AuxStor","HistoryStor","AddElementsServ","AddElementMenuServ",function(e,t,i,r,o,a){function n(){p.searchingWord="",i.aux.addElementGroups.length=0,i.aux.searchingWord=p.searchingWord,a.closeAddElementsMenu()}function s(){""!==p.searchingWord?(i.aux.searchingWord=p.searchingWord,i.aux.searchingWord.length>3&&o.createAddElementGroups()):n()}function l(){p.searchingWord=p.searchingWord.slice(0,-1),""===p.searchingWord?n():i.aux.searchingWord=p.searchingWord}function d(){""!==p.searchingWord&&(r.history.searchingWord=p.searchingWord)}function c(){p.searchingWord="",r.history.searchingWord="",r.history.isOrderSearch=0}function u(){p.searchingWord=p.searchingWord.slice(0,-1),r.history.searchingWord=p.searchingWord}var p=this;p.G=t,p.CANCEL=e("translate")("add_elements.CANCEL"),"main"===t.global.currOpenPage||"cart"===t.global.currOpenPage?(p.placeholder=e("translate")("add_elements.INPUT_ADD_ELEMENT"),p.checkChanges=s,p.cancelSearching=n,p.deleteSearchChart=l):"history"===t.global.currOpenPage&&(p.placeholder=e("translate")("history.SEARCH_PLACEHOLDER"),p.checkChanges=d,p.cancelSearching=c,p.deleteSearchChart=u)}])}(),function(){angular.module("MainModule").controller("sizeCalculatorCtrl",["$filter","GlobalStor","DesignStor","AddElementMenuServ","DesignServ",function(e,t,i,r,o){var a=this;a.isDesignPage=!1,a.D=i,a.MIN=e("translate")("common_words.MIN"),a.MAX=e("translate")("common_words.MAX"),"main"===t.global.currOpenPage?(a.isDesignPage=!1,a.setValueSize=r.setValueSize,a.deleteLastNumber=r.deleteLastNumber,a.closeSizeCaclulator=r.closeSizeCaclulator):(a.isDesignPage=!0,a.setValueSize=o.setValueSize,a.deleteLastNumber=o.deleteLastNumber,a.closeSizeCaclulator=o.closeSizeCaclulator),a.pressCulculator=r.pressCulculator}])}(),function(){angular.module("MainModule").controller("UserInfoCtrl",["globalConstants","GlobalStor","UserStor",function(e,t,i){function r(){t.global.isNavMenu=!t.global.isNavMenu,t.global.isConfigMenu=!t.global.isConfigMenu}function o(){t.global.isNavMenu&&(t.global.isNavMenu=0,t.global.isConfigMenu=1)}function a(){t.global.isNavMenu||(t.global.isNavMenu=1,t.global.isConfigMenu=0)}var n=this;n.G=t,n.U=i,n.config={DELAY_SHOW_USER_INFO:40*e.STEP,typing:"on",checked:!1},n.swipeMainPage=r,n.swipeLeft=o,n.swipeRight=a}])}(),function(){angular.module("SettingsModule").controller("SettingsCtrl",["$location","$timeout","$filter","globalConstants","localDB","SettingServ","GlobalStor","OrderStor","ProductStor","AuxStor","UserStor",function(e,t,i,r,o,a,n,s,l,d,c){function u(e,t){var i={};switch(e){case"user-name":i.name=t;break;case"user-address":i.address=t;break;case"user-email":var r=x.config.mailReg.test(t);r?(x.config.isEmailError=0,i.email=t):x.config.isEmailError=1}$.isEmptyObject(i)||o.updateLocalServerDBs(o.tablesLocalDB.users.tableName,c.userInfo.id,i)}function p(e){t(function(){$("#"+e).find("input").focus()},100)}function g(){t(function(){$(".set-input-phone").focus()},100)}function m(e,t){x.config.selectedSetting=e,p(t.target.id)}function f(e,t){13===event.which&&u(e,t)}function _(e,t){u(e,t)}function h(){x.config.isEmailError=0}function y(e){var t=e.join(",");c.userInfo.city_phone=t,o.updateLocalServerDBs(o.tablesLocalDB.users.tableName,c.userInfo.id,{city_phone:t}),x.config.tempAddPhone=""}function E(){var e=x.config.regex.test(x.config.tempAddPhone);e?(x.config.isInsertPhone=0,x.config.isErrorPhone=0,x.config.addPhones.push(x.config.tempAddPhone),y(x.config.addPhones)):x.config.isErrorPhone=1}function v(){x.config.isInsertPhone=!x.config.isInsertPhone,x.config.tempAddPhone="",x.config.isErrorPhone=0,g()}function b(){x.config.tempAddPhone&&""!==x.config.tempAddPhone?E():v()}function I(){x.config.isInsertPhone=0,x.config.isErrorPhone=0}function A(){13===event.which&&E()}function S(e){x.config.addPhones.splice(e,1),y(x.config.addPhones)}function T(){c.userInfo=c.setDefaultUser(),n.global=n.setDefaultGlobal(),s.order=s.setDefaultOrder(),l.product=l.setDefaultProduct(),d.aux=d.setDefaultAuxiliary(),e.path("/login")}var x=this;x.U=c,x.config={DELAY_START:r.STEP,DELAY_SHOW_ICONS:10*r.STEP,isInsertPhone:!1,isEmailError:!1,addPhones:[],tempAddPhone:"",regex:r.REG_PHONE,mailReg:r.REG_MAIL,typing:"on"},x.NAVMENU_SETTINGS=i("translate")("mainpage.NAVMENU_SETTINGS"),x.CHANGE=i("translate")("common_words.CHANGE"),x.AUTHORIZATION=i("translate")("settings.AUTHORIZATION"),x.CHANGE_PASSWORD=i("translate")("settings.CHANGE_PASSWORD"),x.CHANGE_LANGUAGE=i("translate")("settings.CHANGE_LANGUAGE"),x.PRIVATE_INFO=i("translate")("settings.PRIVATE_INFO"),x.USER_NAME=i("translate")("settings.USER_NAME"),x.CITY=i("translate")("settings.CITY"),x.CLIENT_ADDRESS=i("translate")("cart.CLIENT_ADDRESS"),x.CLIENT_EMAIL=i("translate")("cart.CLIENT_EMAIL"),x.WRONG_EMAIL=i("translate")("cart.WRONG_EMAIL"),x.ADD_PHONES=i("translate")("settings.ADD_PHONES"),x.INSERT_PHONE=i("translate")("settings.INSERT_PHONE"),x.WRONG_NUMBER=i("translate")("login.WRONG_NUMBER"),x.CLIENT_SUPPORT=i("translate")("settings.CLIENT_SUPPORT"),x.LOGOUT=i("translate")("settings.LOGOUT"),n.global.currOpenPage="settings",c.userInfo.city_phone&&(x.config.addPhones=c.userInfo.city_phone.split(",")),x.changeSettingData=m,x.appendInputPhone=v,x.cancelAddPhone=I,x.saveChanges=f,x.saveChangesBlur=_,x.changeEmail=h,x.addNewPhone=b,x.saveChangesPhone=A,x.deletePhone=S,x.gotoPasswordPage=a.gotoPasswordPage,x.gotoLanguagePage=a.gotoLanguagePage,x.gotoLocationPage=a.gotoLocationPage,x.closeSettingsPage=a.closeSettingsPage,x.logOut=T}])}(),function(){angular.module("HistoryModule").directive("calendarScroll",["$filter","HistoryStor",function($filter,HistoryStor){return{restrict:"E",transclude:!0,replace:!0,scope:{calendarType:"=",orderType:"="},template:function(e,t){var i=+t.calendarType,r="",o="",a="",n="",s="",l="",d="",c="",u="",p=$filter("translate")("common_words.MONTHS"),g=p.split(", "),m=g.length,f=1,_=0,h=2010,y=(new Date).getFullYear()+1;for(i?(o="date_range_from",a="date_from",n="from_date",s="from_date_"+t.orderType,l="from_month",d="from_month_"+t.orderType,c="from_fullYear",u="from_fullYear_"+t.orderType):(o="date_range_to",a="date_to",n="to_date",s="to_date_"+t.orderType,l="to_month",d="to_month_"+t.orderType,c="to_fullYear",u="to_fullYear_"+t.orderType),r='<div class="date_range outside"><div class="date_range_container"><div class="'+o+'"><form name="'+a+'"><div class="lines"><div></div></div><select class="date" id="'+n+'" name="'+s+'">';32>f;)r+='<option value="'+f+'">'+f+"</option>",f+=1;for(r+='</select><select class="date" id="'+l+'" name="'+d+'">';m>_;)r+='<option value="'+_+'">'+g[_]+"</option>",_+=1;for(r+='</select><select class="date" id="'+c+'" name="'+u+'">';y>=h;)r+='<option value="'+h+'">'+h+"</option>",h+=1;return r+="</select></form></div></div></div>"},link:function(scope){function getIndexForValue(e,t){for(var i=e.options.length;--i>-1;)if(e.options[i].value===t)return i}function update(e,t,i){$("."+e).find("#"+t+"_date").drum("setIndex",i.getDate()-1),$("."+e).find("#"+t+"_month").drum("setIndex",i.getMonth()),$("."+e).find("#"+t+"_fullYear").drum("setIndex",getIndexForValue($("#"+t+"_fullYear")[0],i.getFullYear()))}$(function(){$("select.date").drum({onChange:function(elem){var elemNameArr=elem.name.split("_"),section=elemNameArr[0],isOrder=+elemNameArr[2],arr={date:"setDate",month:"setMonth",fullYear:"setFullYear"},date=new Date,s,i;for(s in arr)i=$("form[name='date_"+section+"'] select[id='"+section+"_"+s+"']")[0].value,eval("date."+arr[s]+"("+i+")");isOrder?(update("history-view",section,date),"from"===section?HistoryStor.history.startDate=date:HistoryStor.history.finishDate=date):(update("draft-view",section,date),"from"===section?HistoryStor.history.startDateDraft=date:HistoryStor.history.finishDateDraft=date),scope.$apply()}});var now=new Date;update("history-view","from",new Date(now.getFullYear(),now.getMonth(),now.getDate())),update("history-view","to",new Date(now.getFullYear(),now.getMonth(),now.getDate())),update("draft-view","from",new Date(now.getFullYear(),now.getMonth(),now.getDate())),update("draft-view","to",new Date(now.getFullYear(),now.getMonth(),now.getDate()))})}}}])}(),function(){angular.module("CartModule").directive("calendar",["$filter","CartMenuServ","GlobalStor","OrderStor",function(e,t,i,r){return{restrict:"E",transclude:!0,link:function(o,a){var n=new Date(r.order.order_date).getDate(),s=(new Date).setDate(n+i.global.deliveryCoeff.min_time-1),l=e("date")(r.order.new_delivery_date,"dd.MM.yyyy"),d=e("date")(r.order.delivery_date,"dd.MM.yyyy");$(function(){var i={flat:!0,format:"d.m.Y",locale:{days:[],daysShort:[],daysMin:[],monthsShort:[],months:[]},date:l,min:s,change:function(e){t.checkDifferentDate(d,e),o.$apply()}};i.locale.monthsShort=e("translate")("common_words.MONTHS_SHOT").split(", "),i.locale.months=e("translate")("common_words.MONTHS").split(", "),a.pickmeup(i)})}}}])}(),function(){angular.module("BauVoiceApp").directive("fsClick",["GlobalStor",function(e){return function(t,i,r){var o=e.global.isDevice?"touchstart":"mousedown";i.on(o,function(){t.$apply(r.fsClick)})}}])}(),function(){angular.module("BauVoiceApp").directive("fileread",["SettingServ","UserStor",function(e,t){return{scope:{fileread:"="},link:function(i,r){r.bind("change",function(r){var o=new FormData,a=new FileReader;o.append("user",t.userInfo.id),o.append("file",r.target.files[0]),a.onload=function(t){i.$apply(function(){i.fileread=t.target.result,e.changeAvatar(i.fileread,o)})},a.readAsDataURL(r.target.files[0])})}}}])}(),function(){angular.module("BauVoiceApp").filter("locationFilter",["$filter",function(e){return function(t,i){var r,o=t.length,a=[];if(i&&i.length>2)for(r=i.toLowerCase();--o>-1;)0===t[o].fullLocation.toLowerCase().indexOf(r)&&a.push(t[o]);return a=e("orderBy")(a,"cityName",!1)}}])}(),function(){angular.module("HistoryModule").directive("orderDate",["$filter",function(e){return{restrict:"A",scope:{orderDate:"@",typeDate:"="},link:function(t,i,r){function o(t,r){var o,a,n,s,l;n=e("translate")("common_words.MONTHA").split(", "),""!==t?"order"===r?(o=t.split(" "),a=o[0].split("-"),l=parseInt(a[1],10)-1,s=a[2]+" "+n[l]+", "+a[0]):(a=t.split("/"),l=parseInt(a[0],10)-1,s=a[1]+" "+n[l]+", "+a[2]):(o=new Date,s=o.getDate()+" "+n[o.getMonth()]+", "+o.getFullYear()),r||""!==t?i.text(s):i.text("")}o(t.orderDate,t.typeDate),r.$observe("orderDate",function(){o(t.orderDate,t.typeDate)})}}}])}(),function(){angular.module("HistoryModule").filter("orderSorting",function(){return function(e,t){function i(e,t){angular.forEach(e,function(e){angular.equals(e.order_style,t)&&r.push(e)})}var r=[];return"type"===t?(i(e,"order"),i(e,"master"),i(e,"done")):"first"===t?(angular.forEach(e,function(e){r.push(e)}),r.reverse()):angular.forEach(e,function(e){r.push(e)}),r}})}(),function(){angular.module("BauVoiceApp").directive("priceFixed",function(){return{restrict:"A",scope:{priceFixed:"@",qtyElement:"@",currencyElement:"@"},link:function(e,t,i){function r(e,i,r){var o=parseFloat((Math.round(100*parseFloat(e))/100*i).toFixed(2))+" "+r;t.text(o)}r(e.priceFixed,e.qtyElement,e.currencyElement),i.$observe("qtyElement",function(){r(e.priceFixed,e.qtyElement,e.currencyElement)}),i.$observe("priceFixed",function(){r(e.priceFixed,e.qtyElement,e.currencyElement)})}}})}(),function(){angular.module("BauVoiceApp").directive("price",["globalConstants","SoundPlayServ",function(e,t){function i(r,o){var a,n,s,l,d,c=2*e.STEP,u=64,p=o.find("#price").children(),g=p.length,m=$(p[0]).children().length,f=0;for(void 0!==r&&(t.playSound(),a="string"==typeof r?r.split(""):r.toFixed(2).split("")),i.revertDigitState=function(){n.animate({top:0},"fast")},i.initDigit=function(){s=a.shift()},i.animateDigit=function(){l="."===s?(m-1)*u:(parseInt(s,10)+1)*u,n.delay(f*c).animate({top:-l/16+"rem"},"fast")},d=g;d>0;d-=1)n=$(p[f]),d>a.length?i.revertDigitState():(i.initDigit(),i.animateDigit()),f+=1}return{restrict:"E",replace:!0,transclude:!0,scope:{priceValue:"=",priceCurrency:"="},template:'<div class="price clearfix" data-output="priceValue"><div id="price" class="price-value"><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div><div class="digit-cell"><div class="digit">&nbsp;</div><div class="digit">0</div><div class="digit">1</div><div class="digit">2</div><div class="digit">3</div><div class="digit">4</div><div class="digit">5</div><div class="digit">6</div><div class="digit">7</div><div class="digit">8</div><div class="digit">9</div><div class="digit">.</div></div></div><div id="currency" class="price-currency">{{ priceCurrency }}</div></div>',link:function(e,t,r){e.$watch(r.output,function(e){i(e,t)})}}}])}(),function(){angular.module("BauVoiceApp").directive("showDelay",function(){return{scope:{showDelay:"@"},link:function(e,t,i){function r(){var i="unvisible";setTimeout(function(){t.removeClass(i)},+e.showDelay)}i.$observe("showDelay",function(){r()})}}})}(),function(){angular.module("BauVoiceApp").directive("svgTemplate",["globalConstants","GeneralServ","ProductStor","SVGServ","DesignServ","PointsServ",function(e,t,i,r,o,a){return{restrict:"E",replace:!0,transclude:!0,scope:{typeConstruction:"=",template:"=",templateWidth:"=",templateHeight:"="},link:function(n,s){function l(){d3.select("#main_group").attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function d(e,t,i,r,o,a,n,s,l,d){e.append("marker").classed(d,!0).attr({id:t,viewBox:i,refX:r,refY:o,markerWidth:n,markerHeight:s,orient:a}).append("path").attr("d",l)}function c(e,t,i){var r,o=i.sashOpenDir.length;return i.handlePos?(1===o?2===i.handlePos?r=e?"url(#handleR)":"url(#hingeL)":1===i.handlePos?r=e?"url(#handleU)":"url(#hingeD)":4===i.handlePos?r=e?"url(#handleL)":"url(#hingeR)":3===i.handlePos&&(r=e?"url(#handleD)":"url(#hingeU)"):2===o&&(t.points[1].fi<45||t.points[1].fi>315?r=e?"url(#handleR)":"url(#hingeL)":t.points[1].fi>135&&t.points[1].fi<225&&(r=e?"url(#handleL)":"url(#hingeR)")),r):void 0}function u(t,i,r,o){if(n.typeConstruction!==e.SVG_ID_MAIN){var a,s,l=-150,d=50,c=-20,u=160,p=70,g=20,m=[],f=[],_=[],h={x:t?c:i.from,y:t?i.from:c},y={x:t?l:i.from,y:t?i.from:l},E={x:t?c:i.to,y:t?i.to:c},v={x:t?l:i.to,y:t?i.to:l},b={x:t?l+d:i.from,y:t?i.from:l+d},I={x:t?l+d:i.to,y:t?i.to:l+d};m.push(h,y),f.push(E,v),_.push(b,I),a=r.append("g").attr({"class":function(){var r;return r=n.typeConstruction===e.SVG_ID_ICON?t?i.level?"dim_blockY dim_shiftY":"dim_block":i.level?"dim_blockX dim_shiftX":"dim_block":t?i.level?"dim_blockY":"dim_block dim_hidden":i.level?"dim_blockX":"dim_block dim_hidden"},block_id:i.blockId,axis:i.axis}),a.append("path").classed("size-line",!0).attr("d",o(f)),a.append("path").classed("size-line",!0).attr("d",o(m)),a.append("path").classed("size-line",!0).attr({d:o(_),"marker-start":function(){return t?"url(#dimVertR)":"url(#dimHorL)"},"marker-end":function(){return t?"url(#dimVertL)":"url(#dimHorR)"}}),s=a.append("g").classed("size-box",!0),"tamlateSVG"===n.typeConstruction&&s.append("rect").classed("size-rect",!0).attr({x:function(){return t?l-.8*u:(i.from+i.to-u)/2},y:function(){return t?(i.from+i.to-p)/2:l-.8*p},rx:g,ry:g}),s.append("text").text(i.text).attr({"class":function(){return n.typeConstruction===e.SVG_ID_EDIT?"size-txt-edit":"size-txt"},x:function(){return t?l-.8*u:(i.from+i.to-u)/2},y:function(){return t?(i.from+i.to-p)/2:l-.8*p},dx:80,dy:40,type:"line",block_id:i.blockId,size_val:i.text,min_val:i.minLimit,max_val:i.maxLimit,dim_id:i.dimId,from_point:i.from,to_point:i.to,axis:i.axis,level:i.level})}}function p(t,i,r){var o,a,s=[],l=20,d={x:t.startX,y:t.startY},c={x:t.midleX,y:t.midleY};s.push(c,d),o=i.append("g").attr({"class":"dim_block_radius",block_id:t.blockId}),o.append("path").classed("size-line",!0).attr({d:r(s),style:"stroke: #000;","marker-end":"url(#dimArrow)"}),a=o.append("g").classed("size-box",!0),n.typeConstruction===e.SVG_ID_EDIT&&a.append("rect").classed("size-rect",!0).attr({x:t.midleX,y:t.midleY,rx:l,ry:l}),a.append("text").text(t.radius).attr({"class":"size-txt-edit",x:t.midleX,y:t.midleY,dx:80,dy:40,type:"curve",block_id:t.blockId,size_val:t.radius,min_val:t.radiusMax,max_val:t.radiusMin,dim_id:t.id,chord:t.lengthChord})}function g(g,m,f){if(g&&!$.isEmptyObject(g)){var _,h,y,E,v,b,I,A,S,T,x=document.createElement("div"),N=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),L=.7,D={x:0,y:0},C=a.templatePoints(g);n.typeConstruction===e.SVG_CLASS_ICON?L=1:n.typeConstruction===e.SVG_ID_EDIT?L=.6:n.typeConstruction===e.SVG_ID_MAIN&&(L=.6),_=d3.select(x).append("svg").attr({width:m,height:f}),n.typeConstruction===e.SVG_CLASS_ICON?_.attr("class",n.typeConstruction):_.attr("id",n.typeConstruction),v=r.collectAllPointsOut(g.details),b=t.getMaxMinCoord(v),I=n.typeConstruction===e.SVG_ID_MAIN?r.setTemplateScaleMAIN(L):r.setTemplateScale(b,m,f,L),n.typeConstruction!==e.SVG_CLASS_ICON&&(D=n.typeConstruction===e.SVG_ID_MAIN?r.setTemplatePositionMAIN(b,f,I):r.setTemplatePosition(b,m,f,I)),h=_.append("g").attr({id:"main_group",transform:"translate("+D.x+", "+D.y+") scale("+I+","+I+")"}),n.typeConstruction===e.SVG_ID_EDIT&&_.call(d3.behavior.zoom().translate([D.x,D.y]).scale(I).scaleExtent([0,8]).on("zoom",l));var O=C.noVvPath,R=C.widthT,P=C.heightT;if(n.typeConstruction!==e.SVG_CLASS_ICON){var w=h.append("defs"),M="M4.5,0C2.015,0,0,2.015,0,4.5v6c0,1.56,0.795,2.933,2,3.74V7.5C2,6.119,3.119,5,4.5,5S7,6.119,7,7.5v6.74c1.205-0.807,2-2.18,2-3.74v-6C9,2.015,6.985,0,4.5,0zM7,26.5C7,27.881,5.881,29,4.5,29l0,0C3.119,29,2,27.881,2,26.5v-19C2,6.119,3.119,5,4.5,5l0,0C5.881,5,7,6.119,7,7.5V26.5z",k="M0,0L5,0L5,15L0,15z";if(d(w,"dimHorL","-5, -5, 1, 8",-5,-2,0,50,50,"M 0,0 L -4,-2 L0,-4 z","size-line"),d(w,"dimHorR","-5, -5, 1, 8",-5,-2,180,50,50,"M 0,0 L -4,-2 L0,-4 z","size-line"),d(w,"dimVertL","4.2, -1, 8, 9",5,2,90,100,60,"M 0,0 L 4,2 L0,4 z","size-line"),d(w,"dimVertR","4.2, -1, 8, 9",5,2,270,100,60,"M 0,0 L 4,2 L0,4 z","size-line"),d(w,"dimArrow","4.2, -1, 8, 9",5,2,"auto",100,60,"M 0,0 L 4,2 L0,4 z","size-line"),d(w,"handleR","0 -1 9 32",-5,5,0,29,80,M,"handle-mark"),d(w,"handleL","0 -1 9 32",14,5,0,29,80,M,"handle-mark"),d(w,"handleU","0 -1 9 32",-5.3,5,270,29,80,M,"handle-mark"),d(w,"handleD","0 -1 9 32",14.3,5,270,29,80,M,"handle-mark"),d(w,"hingeR","-1 0 9 4",-17.5,5,0,20,80,k,"hinge-mark"),d(w,"hingeL","-1 0 9 4",22.5,5,0,20,80,k,"hinge-mark"),d(w,"hingeU","-1 0 9 4",-17.3,5,270,20,80,k,"hinge-mark"),d(w,"hingeD","-1 0 9 4",22.2,5,270,20,80,k,"hinge-mark"),i.product.lamination.img_in_id>1&&(w.append("pattern").attr("id","laminat").attr("patternUnits","userSpaceOnUse").attr("width",600).attr("height",400).append("image").attr("xlink:href","img/lamination/"+i.product.lamination.img_in_id+".jpg").attr("width",600).attr("height",400),w.append("pattern").attr("id","laminat1").attr("patternUnits","userSpaceOnUse").attr("width",150).attr("height",100).append("image").attr("xlink:href","img/lamination/"+i.product.lamination.img_in_id+".jpg").attr("width",150).attr("height",100)),n.typeConstruction===e.SVG_ID_MAIN){var G="",B="",V=P;1!==i.product.construction_type&&3!==i.product.construction_type||(B="fon.gif",2049>=V&&(G=1.2),V>=2050&&(G=1.26),V>=2101&&(G=1.28),V>=2171&&(G=1.32),V>=2191&&(G=1.35),V>=2211&&(G=1.38),V>=2231&&(G=1.4),V>=2251&&(G=1.42),V>=2271&&(G=1.44),V>=2291&&(G=1.46),V>=2311&&(G=1.48),V>=2331&&(G=1.5),V>=2351&&(G=1.52),V>=2371&&(G=1.54),V>=2391&&(G=1.56)),4!==i.product.construction_type&&2!==i.product.construction_type||(B="333.gif",V>100&&(G=1.03),V>=1800&&(G=1.05),V>=1850&&(G=1.07),V>=1900&&(G=1.11),V>=1950&&(G=1.14),V>=2e3&&(G=1.17),V>=2050&&(G=1.2),V>=2101&&(G=1.23),V>=2171&&(G=1.24),V>=2191&&(G=1.25),V>=2211&&(G=1.27),V>=2231&&(G=1.29),V>=2251&&(G=1.31),V>=2271&&(G=1.33),V>=2291&&(G=1.35),V>=2311&&(G=1.37),V>=2331&&(G=1.38),V>=2351&&(G=1.4),V>=2371&&(G=1.41),V>=2391&&(G=1.43)),w.append("pattern").attr("id","background").attr("patternUnits","userSpaceOnUse").attr("width",2520*G).attr("height",1680*G).append("image").attr("xlink:href","img/room/"+B).attr("width",2520*G).attr("height",1680*G)}}if(n.typeConstruction===e.SVG_ID_MAIN){if(1===i.product.construction_type){var U=.18*P-252+520,H=.18*R-234+520,F=755,z="",Y="",W="",q="";1648>P&&(z="456",Y="90",W=100,q="720"),P>1648&&(z="526",Y="90",W=60,q="720"),P>1848&&(z="576",Y="90",W=0,q="720"),P>2148&&(z="637",Y="90",W=-30,q="720"),R>900&&1648>P?$(".coeff-room-block5").css("left",109+.48*(R/2-224)/2+"px"):$(".coeff-room-block5").css("left",1e4+"px"),$(".coeff-room-block15").css({width:.48*(R/2)+30+"px",height:Y+"px",top:q+"px"}),$(".coeff-room-block11").css("left",1e4+"px"),$(".coeff-room-block16").css("left","9px"),$(".coeff-room-block8").css("left",1e4+"px"),$(".coeff-room-block7").css("opacity",0),$(".coeff-room-block9").css("opacity",1),$(".coeff-room-block23").css("left",1e4+"px"),$(".coeff-room-block10").css("opacity",0),$(".coeff-room-block17").css({width:.4*(R/2*2+350)+"px",height:"41px",left:"215px",top:z+"px"}),$(".coeff-room-block18").css({width:H+"px",height:U+"px",left:"3px",top:F-U-W+"px"}),$(".coeff-room-block19").css({width:H+"px",height:U+"px",left:"3px",top:F-U-W+"px"}),$(".coeff-room-block20").css({width:H+"px",height:U+"px",left:"3px",top:F-U-W+"px"}),$(".coeff-room-block21").css({width:H+"px",height:U+"px",left:"3px",top:F-U-W+"px"})}if(4===i.product.construction_type||2===i.product.construction_type){var U=.18*P-252+520,H=.18*R-234+420,F=755;$(".coeff-room-block23").css({width:500+.7*(R-700)+"px",top:"665px",left:100-2.5*(.1*R-70)+"px"}),$(".coeff-room-block15").css({top:1e4+"px"}),$(".coeff-room-block17").css({width:"0px",height:"0px",left:"0px"}),$(".coeff-room-block18").css({width:H+"px",height:U+"px",left:"130px",top:F-U+30+"px"}),$(".coeff-room-block19").css({width:H+"px",height:U+"px",left:"130px",top:F-U+30+"px"}),$(".coeff-room-block20").css({width:H+"px",height:U+"px",left:"130px",top:F-U+30+"px"}),$(".coeff-room-block21").css({width:H+"px",height:U+"px",left:"130px",top:F-U+50+"px"}),$(".coeff-room-block11").css("left",.23*(.991*R)+280+"px"),$(".coeff-room-block8").css("left",.23*R+275+"px"),$(".coeff-room-block5").css("left","5000px"),$(".coeff-room-block10").css("opacity",1),$(".coeff-room-block7").css("opacity",1),$(".coeff-room-block16").css("left","5000px"),$(".coeff-room-block9").css("opacity",0)}}if(n.typeConstruction===e.SVG_ID_MAIN){var Q=4.4*I;if(1===i.product.construction_type||3===i.product.construction_type){var j=D.x-160,K=18,X=D.x-340,Z=-100;h.append("g").append("polygon").attr({id:"clipPolygonWindow1",fill:"#FFFAFA",points:O,transform:"translate("+j+", "+K+") scale("+Q+","+Q+")"}),h.append("g").append("polygon").attr({id:"clipPolygonWindow2",fill:"#FFFAFA",points:O,transform:"translate("+X+", "+K+") scale("+Q+","+Q+")"}),h.append("g").append("polygon").attr({id:"clipPolygonWindow3",fill:"#FFFAFA",points:O,transform:"translate("+j+", "+Z+") scale("+Q+","+Q+")"}),h.append("g").append("polygon").attr({id:"clipPolygonWindow4",fill:"#FFFAFA",points:O,transform:"translate("+X+", "+Z+") scale("+Q+","+Q+")"})}4!=i.product.construction_type&&2!==i.product.construction_type||(h.append("g").append("polygon").attr({id:"clipPolygonDoor3",fill:"#FFFAFA",points:O,transform:"translate("+(D.x-215)+", -80) scale("+Q+","+Q+")"}),h.append("g").append("polygon").attr({id:"clipPolygonDoor4",fill:"#FFFAFA",points:O,transform:"translate("+(D.x-336)+", -80) scale("+Q+","+Q+")"}))}for(y=h.append("g").attr({id:"elem_group"}),E=h.append("g").attr({id:"dim_group"}),A=g.details.length,S=1;A>S;S+=1)y.selectAll("path."+g.details[S].id).data(g.details[S].parts).enter().append("path").attr({block_id:g.details[S].id,parent_id:g.details[S].parent,"class":function(t){var i;return i=n.typeConstruction===e.SVG_CLASS_ICON?"glass"===t.type?"glass-icon":"frame-icon":t.doorstep?"doorstep":"glass"===t.type?"glass":"frame"},item_type:function(e){return e.type},item_dir:function(e){return e.dir},item_id:function(e){return e.points[0].id},d:function(e){return e.path},fill:function(t){var r;return r="glass"===t.type?n.typeConstruction===e.SVG_ID_MAIN?"url(#background)":"rgba(155, 204, 255, 0.20)":i.product.lamination.img_in_id>1?"frame"===t.type||"impost"===t.type?"glass"!==t.type?"url(#laminat)":"":"glass"!==t.type?"url(#laminat1)":"":n.typeConstruction===e.SVG_ID_MAIN?"#DCDCDC":"#f9f9f9"}}),n.typeConstruction!==e.SVG_CLASS_ICON&&(g.details[S].sashOpenDir&&y.selectAll("path.sash_mark."+g.details[S].id).data(g.details[S].sashOpenDir).enter().append("path").classed("sash_mark",!0).attr({d:function(e){return N(e.points)},"marker-mid":function(e){return c(1,e,g.details[S])},"marker-start":function(e){
return c(0,e,g.details[S])},"marker-end":function(e){return c(0,e,g.details[S])}}),n.typeConstruction===e.SVG_ID_EDIT&&1===g.details[S].level&&(T=g.details[S].pointsOut.filter(function(e){return e.corner>0}),y.selectAll("circle.corner_mark."+g.details[S].id).data(T).enter().append("circle").attr({block_id:g.details[S].id,"class":"corner_mark",parent_id:function(e){return e.id},cx:function(e){return e.x},cy:function(e){return e.y},r:0})),"tamlateGlassSVG"===n.typeConstruction&&(g.details[S].children.length||y.append("text").text(g.details[S].glassTxt).attr({block_id:g.details[S].id,"class":"glass-txt",x:g.details[S].center.x,y:g.details[S].center.y})),"tamlateGridSVG"===n.typeConstruction&&!g.details[S].children.length&&g.details[S].gridId&&y.append("text").text(g.details[S].gridTxt).attr({"class":"glass-txt",x:g.details[S].center.x,y:g.details[S].center.y}));if(n.typeConstruction!==e.SVG_CLASS_ICON){var J,ee,te,ie=g.dimension.dimX.length,re=g.dimension.dimY.length,oe=g.dimension.dimQ.length;for(J=0;ie>J;J+=1)u(0,g.dimension.dimX[J],E,N);for(ee=0;re>ee;ee+=1)u(1,g.dimension.dimY[ee],E,N);for(te=0;oe>te;te+=1)p(g.dimension.dimQ[te],E,N)}s.html(x),o.removeAllEventsInSVG(),n.typeConstruction===e.SVG_ID_EDIT&&(o.initAllImposts(),o.initAllGlass(),o.initAllArcs(),o.initAllDimension())}}n.$watch("template",function(){g(n.template,n.templateWidth,n.templateHeight)})}}}])}(),function(){angular.module("BauVoiceApp").directive("typing",function(){return{scope:{output:"@",typingDelay:"@"},link:function(e,t,i){function r(){t.text(e.output)}i.$observe("typing",function(e){"on"===e.toString()&&r()}),i.$observe("output",function(){r()})}}})}();var NuanceSpeechKitPlugin=function(){};NuanceSpeechKitPlugin.prototype.initialize=function(e,t,i,r,o,a){return Cordova.exec(o,a,"PhoneGapSpeechPlugin","initSpeechKit",[e,t,i,r])},NuanceSpeechKitPlugin.prototype.cleanup=function(e,t){return Cordova.exec(e,t,"PhoneGapSpeechPlugin","cleanupSpeechKit",[])},NuanceSpeechKitPlugin.prototype.startRecognition=function(e,t,i,r){return Cordova.exec(i,r,"PhoneGapSpeechPlugin","startRecognition",[e,t])},NuanceSpeechKitPlugin.prototype.stopRecognition=function(e,t){return Cordova.exec(e,t,"PhoneGapSpeechPlugin","stopRecognition",[])},NuanceSpeechKitPlugin.prototype.getResults=function(e,t){return Cordova.exec(e,t,"PhoneGapSpeechPlugin","getRecoResult",[])},NuanceSpeechKitPlugin.prototype.playTTS=function(e,t,i,r,o){return Cordova.exec(r,o,"PhoneGapSpeechPlugin","startTTS",[e,t,i])},NuanceSpeechKitPlugin.prototype.stopTTS=function(e,t){return Cordova.exec(e,t,"PhoneGapSpeechPlugin","stopTTS",[])},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},function(){angular.module("MainModule").factory("AddElementMenuServ",["$q","$timeout","GlobalStor","OrderStor","ProductStor","CartStor","AuxStor","DesignStor","UserStor","localDB","GeneralServ","loginServ","MainServ","SVGServ","DesignServ","AnalyticsServ","CartServ","CartMenuServ",function(e,t,i,r,o,a,n,s,l,d,c,u,p,g,m,f,_,h){function y(){n.aux.auxParameter=0,i.global.isQtyCalculator=0,i.global.isSizeCalculator=0,i.global.isWidthCalculator=0}function E(e){var i,o=e.chosenAddElements.length;for(e.addelem_price=0,e.addelemPriceDis=0;--o>-1;)if(i=e.chosenAddElements[o].length,i>0)for(;--i>-1;)e.addelem_price+=e.chosenAddElements[o][i].element_qty*e.chosenAddElements[o][i].element_price;e.addelem_price=c.roundingValue(e.addelem_price),e.addelemPriceDis=c.setPriceDis(e.addelem_price,r.order.discount_addelem),t(function(){p.setProductPriceTOTAL(e)},50)}function v(e){var t=n.aux.currentAddElementId,i=n.aux.auxParameter.split("-")[0]-1;return o.product.chosenAddElements[i][t].element_qty<2&&0>e?!1:o.product.chosenAddElements[i][t].element_qty<6&&-5==e?!1:void(n.aux.tempSize.length?(o.product.chosenAddElements[i][t].element_qty=parseInt(n.aux.tempSize.join(""),10)+e,n.aux.tempSize.length=0):o.product.chosenAddElements[i][t].element_qty+=e)}function b(){y(),n.aux.tempSize.length=0,E(o.product)}function I(e,t,o){var a,s=o[e][t];return 20===s.list_group_id?(a={currencyId:l.userInfo.currencyId,element:s},d.calculationGridPrice(a).then(function(e){return e&&(s.element_price=angular.copy(c.roundingValue(c.addMarginToPrice(e.priceTotal,i.global.margins.margin))),s.elementPriceDis=angular.copy(c.roundingValue(c.setPriceDis(s.element_price,r.order.discount_addelem))),n.aux.currAddElementPrice=angular.copy(s.elementPriceDis)),e})):(a={currencyId:l.userInfo.currencyId,elementId:s.id,elementWidth:s.element_width/1e3,elementHeight:s.element_height/1e3},d.getAdditionalPrice(a).then(function(e){return e&&(s.element_price=c.roundingValue(c.addMarginToPrice(e.priceTotal,i.global.margins.margin)),s.elementPriceDis=c.roundingValue(c.setPriceDis(s.element_price,r.order.discount_addelem)),n.aux.currAddElementPrice=angular.copy(s.elementPriceDis)),e}))}function A(){var e=n.aux.currentAddElementId,t=n.aux.auxParameter.split("-")[0]-1;n.aux.tempSize.length=0,y(),I(t,e,o.product.chosenAddElements).then(function(){E(o.product)})}function S(){var e="",t=n.aux.currentAddElementId,r=n.aux.auxParameter.split("-")[0]-1;e=parseInt(n.aux.tempSize.join(""),10),i.global.isQtyCalculator?o.product.chosenAddElements[r][t].element_qty=e:i.global.isSizeCalculator&&(i.global.isWidthCalculator?o.product.chosenAddElements[r][t].element_width=e:o.product.chosenAddElements[r][t].element_height=e)}function T(e){var t=n.aux.tempSize.length;(4===t||1===t&&!n.aux.tempSize[0])&&(n.aux.tempSize.length=0),"0"===e?t&&n.aux.tempSize[0]&&(n.aux.tempSize.push(e),S()):"00"===e?t&&n.aux.tempSize[0]&&(3>t?n.aux.tempSize.push(0,0):3===t&&n.aux.tempSize.push(0),S()):(n.aux.tempSize.push(e),S())}function x(){n.aux.tempSize.pop(),n.aux.tempSize.length<1&&n.aux.tempSize.push(0),S()}function N(e){var t;if(13===e.which)i.global.isQtyCalculator?b():i.global.isSizeCalculator&&A();else if(8===e.which)x();else{switch(e.which){case 48:case 96:t=0;break;case 49:case 97:t=1;break;case 50:case 98:t=2;break;case 51:case 99:t=3;break;case 52:case 100:t=4;break;case 53:case 101:t=5;break;case 54:case 102:t=6;break;case 55:case 103:t=7;break;case 56:case 104:t=8;break;case 57:case 105:t=9}void 0!==t&&T(t)}}function L(){i.global.isSizeCalculator?A():i.global.isQtyCalculator&&b(),n.aux.currentAddElementId=0}function D(){(i.global.isQtyCalculator||i.global.isSizeCalculator)&&L(),n.aux.isFocusedAddElement=0,n.aux.isTabFrame=0,n.aux.isGridSelectorDialog=0,n.aux.selectedGrid=0,n.aux.showAddElementsMenu=0,n.aux.isAddElement=0}function C(e){var t;if(o.product.template_source.details[e].gridId)for(t=o.product.chosenAddElements[0].length;--t>-1;)o.product.chosenAddElements[0][t].block_id===o.product.template_source.details[e].id&&(1===o.product.chosenAddElements[0][t].element_qty?o.product.chosenAddElements[0].splice(t,1):o.product.chosenAddElements[0][t].element_qty>1&&(o.product.chosenAddElements[0][t].element_qty-=1))}function O(e,t,i){var r,a=o.product.template.details[t].pointsLight.map(function(e){return e.x}),s=o.product.template.details[t].pointsLight.map(function(e){return e.y});return o.product.template_source.details[t].gridId=n.aux.addElementsList[i[0]][i[1]].id,o.product.template_source.details[t].gridTxt=n.aux.addElementsList[i[0]][i[1]].name,r=angular.copy(n.aux.addElementsList[i[0]][i[1]]),r.element_width=Math.round(d3.max(a)-d3.min(a)),r.element_height=Math.round(d3.max(s)-d3.min(s)),r.block_id=e,r}function R(e,t){for(var i=o.product.template_source.details.length,r=[];--i>0;)if(e){if(o.product.template_source.details[i].id===e){C(i),r.push(O(e,i,t));break}}else"sash"===o.product.template_source.details[i].blockType&&(C(i),r.push(O(o.product.template_source.details[i].id,i,t)));return r}function P(){g.createSVGTemplate(o.product.template_source,o.product.profileDepths).then(function(e){o.product.template=angular.copy(e)})}function w(){m.removeGlassEventsInSVG(),s.design.selectedGlass.length=0,n.aux.selectedGrid=0,n.aux.isGridSelectorDialog=!n.aux.isGridSelectorDialog}function M(e,t){for(var i=e.length,r=0;--i>-1;)if(e[i].id===t.id&&(t.element_width&&t.element_height&&e[i].element_width===t.element_width&&e[i].element_height===t.element_height&&(r+=1),t.element_width&&!t.element_height&&e[i].element_width===t.element_width&&(r+=1),t.element_width||t.element_height||(r+=1),r)){e[i].element_qty+=1;break}return r}function k(e,t){var i,r=n.aux.isFocusedAddElement-1;if(i=M(e.chosenAddElements[r],t),!i){var o={element_type:r,element_width:0,element_height:0,block_id:0},a=angular.extend(o,t);e.chosenAddElements[r].push(a),2===e.chosenAddElements[r].length&&(n.aux.isTabFrame=1)}}function G(e){u.getGridPrice(e).then(function(e){var t=e.length;if(n.aux.currAddElementPrice=0,t){for(;--t>-1;)k(o.product,e[t]),n.aux.currAddElementPrice+=e[t].elementPriceDis;n.aux.currAddElementPrice=c.roundingValue(n.aux.currAddElementPrice),n.aux.isAddElement=n.aux.selectedGrid[0]+"-"+n.aux.selectedGrid[1],E(o.product),P(),w()}})}function B(){if(s.design.selectedGlass.length){var e=s.design.selectedGlass.map(function(e){var t=e.attributes.block_id.nodeValue;return R(t,n.aux.selectedGrid)[0]});G(e)}}function V(){var e=R(0,n.aux.selectedGrid);G(e)}function U(e){for(var t=o.product.template_source.details.length;--t>0;)if(e){if(o.product.template_source.details[t].id===e&&o.product.template_source.details[t].gridId){delete o.product.template_source.details[t].gridId,delete o.product.template_source.details[t].gridTxt;break}}else o.product.template_source.details[t].gridId&&(delete o.product.template_source.details[t].gridId,delete o.product.template_source.details[t].gridTxt);P()}function H(t,i){var r=e.defer();return n.aux.isAddElement=t+"-"+i,I(t,i,n.aux.addElementsList).then(function(){r.resolve(angular.copy(n.aux.addElementsList[t][i]))}),r.promise}function F(e,t){if((i.global.isQtyCalculator||i.global.isSizeCalculator)&&L(),n.aux.currAddElementPrice=0,void 0===e&&void 0===t){1===n.aux.isFocusedAddElement&&U();var r=n.aux.isFocusedAddElement-1;n.aux.isAddElement=0,o.product.chosenAddElements[r].length=0,E(o.product)}else H(e,t).then(function(e){k(o.product,e),E(o.product)})}function z(e,t){var s,l;if("main"===i.global.currOpenPage)1===n.aux.isFocusedAddElement?o.product.is_addelem_only?(k(o.product,n.aux.addElementsList[e][t]),E(o.product)):(n.aux.selectedGrid=[e,t],n.aux.isGridSelectorDialog=1,m.initAllGlassXGrid()):(k(o.product,n.aux.addElementsList[e][t]),E(o.product));else if("cart"===i.global.currOpenPage)for(s=a.cart.selectedProducts.length,l=0;s>l;l+=1)a.cart.selectedProducts[l].length&&(k(r.order.products[l],n.aux.addElementsList[e][t]),_.calculateAddElemsProductsPrice(1),h.joinAllAddElements(),_.collectAllAddElems(),_.getAddElemsPriceTotal(),h.calculateOrderPrice());n.aux.currAddElementPrice=0,n.aux.isAddElement=0}function Y(e,t,i){I(t,i,n.aux.addElementsList).then(function(){var r,a=e-1,s=angular.copy(n.aux.addElementsList[t][i]);if(r=M(o.product.chosenAddElements[a],s),!r){var l={element_type:a,element_width:0,element_height:0,block_id:0},d=angular.extend(l,s);o.product.chosenAddElements[a].push(d)}E(o.product)})}function W(e,t,r,a){a.stopPropagation(),D(),n.aux.addElementsList=angular.copy(i.global.addElementsAll[e-1].elementsList),1===e?o.product.is_addelem_only?Y(e,t,r):(n.aux.isFocusedAddElement=e,n.aux.selectedGrid=[t,r],n.aux.isGridSelectorDialog=1,m.initAllGlassXGrid()):Y(e,t,r)}function $(e,t){(i.global.isQtyCalculator||i.global.isSizeCalculator)&&L(),1===n.aux.isFocusedAddElement&&U(o.product.chosenAddElements[e][t].block_id),o.product.chosenAddElements[e].splice(t,1),E(o.product)}function q(){var e,t=o.product.chosenAddElements.length;for(e=0;t>e;e+=1)e||o.product.chosenAddElements[e].length&&U(),o.product.chosenAddElements[e].length=0;o.product.addelem_price=0,o.product.addelemPriceDis=0,E(o.product),D()}var Q=this;return Q.publicObj={closeAddElementsMenu:D,chooseAddElement:F,chooseAddElementList:z,getAddElementPrice:H,deleteAddElement:$,deleteAllAddElements:q,finishCalculators:L,takeAddElemFilt:W,confirmGrid:B,setGridToAll:V,closeGridSelectorDialog:w,pressCulculator:N,setValueQty:v,closeQtyCaclulator:b,setValueSize:T,deleteLastNumber:x,changeElementSize:S,closeSizeCaclulator:A},Q.publicObj}])}(),function(){angular.module("MainModule").factory("AddElementsServ",["$filter","$timeout","globalConstants","GeneralServ","AddElementMenuServ","GlobalStor","ProductStor","AuxStor",function(e,t,i,r,o,a,n,s){function l(e){var t,i=e-1;s.aux.addElementsMenuStyle=r.addElementDATA[i].typeClass+"-theme",s.aux.addElementsType=angular.copy(a.global.addElementsAll[i].elementType),1===s.aux.isFocusedAddElement?n.product.is_addelem_only?s.aux.addElementsList=angular.copy(a.global.addElementsAll[i].elementsList):(t=angular.copy(a.global.addElementsAll[i].elementsList)[0].filter(function(e){return e.profile_id===n.product.profile.id}),s.aux.addElementsList=[t]):s.aux.addElementsList=angular.copy(a.global.addElementsAll[i].elementsList)}function d(e){s.aux.isFocusedAddElement=e,s.aux.currAddElementPrice=0,l(e),s.aux.addElementsList.length&&s.aux.addElementsList[0].length&&(s.aux.showAddElementsMenu=i.activeClass)}function c(e){(a.global.isQtyCalculator||a.global.isSizeCalculator)&&o.finishCalculators(),s.aux.showAddElementsMenu?s.aux.isFocusedAddElement===e?o.closeAddElementsMenu():(o.closeAddElementsMenu(),t(function(){d(e)},h)):d(e)}function u(e,t,i){var l;if(s.aux.auxParameter===e+"-"+t+"-"+i)o.finishCalculators();else switch((a.global.isQtyCalculator||a.global.isSizeCalculator)&&o.finishCalculators(),l=n.product.chosenAddElements[e-1][i],s.aux.auxParameter=e+"-"+t+"-"+i,s.aux.currentAddElementId=i,s.aux.calculatorStyle=r.addElementDATA[e-1].typeClass+"-theme",t){case 1:a.global.isQtyCalculator=1;break;case 2:a.global.isSizeCalculator=1,a.global.isWidthCalculator=1;break;case 3:a.global.isSizeCalculator=1,a.global.isWidthCalculator=0}}function p(){s.aux.isFocusedAddElement=0,s.aux.isTabFrame=0,s.aux.showAddElementsMenu=0,s.aux.isAddElement=0,s.aux.isGridSelectorDialog=0,(a.global.isQtyCalculator||a.global.isSizeCalculator)&&o.finishCalculators()}function g(){s.aux.isAddElementListView=1,p()}function m(){s.aux.isAddElementListView=0,p()}function f(){var t,i,o,l,d,c,u,p=r.addElementDATA.length,g=a.global.addElementsAll,m=s.aux.searchingWord.toLowerCase(),f=[];for(s.aux.addElementGroups.length=0,o=0;p>o;o+=1)if(g[o].elementsList){for(t={type:{},elems:[]},t.type.groupId=o+1,t.type.groupName=e("translate")(r.addElementDATA[o].name),t.type.groupClass=r.addElementDATA[o].typeClass+"-theme",u=o?g[o].elementsList:n.product.is_addelem_only?g[o].elementsList:[angular.copy(g[o].elementsList)[0].filter(function(e){return e.profile_id===n.product.profile.id})],l=u.length;--l>-1;)for(d=u[l].length;--d>-1;)c=u[l][d].name.toLowerCase(),c.indexOf(m)+1&&(i={typeInd:l,index:d,name:u[l][d].name},t.elems.push(i));f.push(t)}s.aux.addElementGroups=f.filter(function(e){return e.elems.length>0})}var _=this,h=12*i.STEP;return _.publicObj={selectAddElement:c,initAddElementTools:u,openAddElementListView:g,closeAddElementListView:m,createAddElementGroups:f},_.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("AnalyticsServ",["localDB","UserStor",function(e,t){function i(i,r,o,a,n){var s={user_id:i,order_id:r,calculation_id:o,element_id:a,date:new Date},l="";switch(n){case 1:l="profile_analytics";break;case 2:break;case 3:l="hardware_analytics";break;case 4:}e.insertServer(t.userInfo.phone,t.userInfo.device_code,l,s)}var r=this;return r.analyticsObjSource={user_id:0,order_id:0,element_id:0,element_type:0},r.publicObj={sendAnalyticsData:i},r.publicObj}])}(),function(){angular.module("CartModule").factory("CartMenuServ",["$location","GeneralServ","MainServ","GlobalStor","OrderStor","CartStor","UserStor",function(e,t,i,r,o,a,n){function s(){var e,t,i,r,n,s,l,d,c=o.order.products.length,u=0;for(a.cart.allAddElements.length=0,a.cart.isExistAddElems=0,s=0;c>s;s+=1){for(i=[],e=o.order.products[s].chosenAddElements.length,l=0;e>l;l+=1)if(t=o.order.products[s].chosenAddElements[l].length,t>0)for(d=0;t>d;d+=1)r=angular.copy(o.order.products[s].chosenAddElements[l][d]),n={id:r.id,list_group_id:r.list_group_id,name:r.name,elementPriceDis:r.elementPriceDis,element_price:r.element_price,element_qty:r.element_qty*o.order.products[s].product_qty,element_type:r.element_type,element_width:r.element_width,element_height:r.element_height},i.push(n);i.length&&(u+=1),a.cart.allAddElements.push(i)}u&&(a.cart.isExistAddElems=1)}function l(){var e=new Date(o.order.new_delivery_date).getDay(),i=0;switch(e){case 0:i=n.userInfo.mount_sun||0;break;case 1:i=n.userInfo.mount_mon||0;break;case 2:i=n.userInfo.mount_tue||0;break;case 3:i=n.userInfo.mount_wed||0;break;case 4:i=n.userInfo.mount_thu||0;break;case 5:i=n.userInfo.mount_fri||0;break;case 6:i=n.userInfo.mount_sat||0}o.order.mounting_price=t.roundingValue(o.order.mounting_price*(1+i/100))}function d(e,i,r,a){o.order.is_instalment&&(o.order.payment_first=t.roundingValue(e*o.order.selectedInstalmentPercent/100),o.order.payment_monthly=t.roundingValue((e-o.order.payment_first)/o.order.selectedInstalmentPeriod),o.order.paymentFirstDis=t.roundingValue(r*o.order.selectedInstalmentPercent/100),o.order.paymentMonthlyDis=t.roundingValue((r-o.order.paymentFirstDis)/o.order.selectedInstalmentPeriod),i&&(o.order.payment_first_primary=t.roundingValue(i*o.order.selectedInstalmentPercent/100),o.order.payment_monthly_primary=t.roundingValue((i-o.order.payment_first_primary)/o.order.selectedInstalmentPeriod),o.order.paymentFirstPrimaryDis=t.roundingValue(a*o.order.selectedInstalmentPercent/100),o.order.paymentMonthlyPrimaryDis=t.roundingValue((a-o.order.paymentFirstPrimaryDis)/o.order.selectedInstalmentPeriod)))}function c(){if(o.order.order_price=0,o.order.order_price_dis=0,l(),o.order.order_price=o.order.products_price,o.order.order_price_dis=t.roundingValue(o.order.productsPriceDis+o.order.floor_price+o.order.mounting_price),o.order.order_price_primary=angular.copy(o.order.order_price),o.order.orderPricePrimaryDis=angular.copy(o.order.order_price_dis),o.order.delivery_price)if(o.order.is_date_price_more)a.cart.marginDeliveyPlant&&(o.order.order_price+=o.order.products_price*a.cart.marginDeliveyPlant/100),o.order.order_price_dis+=o.order.delivery_price;else if(o.order.is_date_price_less)a.cart.discountDeliveyPlant&&(o.order.order_price-=o.order.products_price*a.cart.discountDeliveyPlant/100),o.order.order_price_dis-=o.order.delivery_price;else{var e=r.global.deliveryCoeff.percents[r.global.deliveryCoeff.standart_time];e&&(o.order.order_price-=o.order.products_price*e/100)}o.order.order_price=t.roundingValue(o.order.order_price),o.order.order_price_dis=t.roundingValue(o.order.order_price_dis),a.cart.discountPriceDiff=t.roundingValue(o.order.order_price-o.order.productsPriceDis),d(o.order.order_price,o.order.order_price_primary,o.order.order_price_dis,o.order.orderPricePrimaryDis)}function u(e){o.order.floor_id!==e.id&&(o.order.floor_id=e.id,e.id?(o.order.floorName=e.name,o.order.floor_price=e.priceReal,o.order.delivery_user_id=e.user_id):(o.order.floorName="",o.order.floor_price=0,o.order.delivery_user_id=0),c())}function p(e){o.order.mounting_id!==e.id&&(o.order.mounting_id=e.id,e.id?(o.order.mountingName=e.name,o.order.mounting_price=e.priceReal,o.order.mounting_user_id=e.user_id):(o.order.mountingName="",o.order.mounting_price=0,o.order.mounting_user_id=0),c())}function g(e,t,i){o.order.instalment_id!==e&&(o.order.is_instalment=1,o.order.instalment_id=e,o.order.selectedInstalmentPeriod=t,o.order.selectedInstalmentPercent=i,d(o.order.order_price,o.order.order_price_primary,o.order.order_price_dis,o.order.orderPricePrimaryDis))}function m(e){for(var i,r=o.order.products.length;--r>-1;)i=t.setPriceDis(o.order.products[r].template_price,e)+o.order.products[r].addelemPriceDis,o.order.products[r].productPriceDis=angular.copy(t.roundingValue(i))}function f(){var e=o.order.products.length;for(o.order.templates_price=0,o.order.addelems_price=0,o.order.products_price=0,o.order.productsPriceDis=0,a.cart.squareTotal=0,a.cart.perimeterTotal=0,a.cart.qtyTotal=0;--e>-1;)o.order.addelems_price+=o.order.products[e].addelem_price*o.order.products[e].product_qty,o.order.templates_price+=o.order.products[e].template_price*o.order.products[e].product_qty,o.order.products_price+=o.order.products[e].product_price*o.order.products[e].product_qty,o.order.productsPriceDis+=o.order.products[e].productPriceDis*o.order.products[e].product_qty,a.cart.squareTotal+=o.order.products[e].template_square*o.order.products[e].product_qty,a.cart.perimeterTotal+=.002*(o.order.products[e].template_width+o.order.products[e].template_height)*o.order.products[e].product_qty,a.cart.qtyTotal+=o.order.products[e].product_qty;o.order.addelems_price=t.roundingValue(o.order.addelems_price),o.order.templates_price=t.roundingValue(o.order.templates_price),o.order.products_price=t.roundingValue(o.order.products_price),a.cart.squareTotal=t.roundingValue(a.cart.squareTotal),a.cart.perimeterTotal=t.roundingValue(a.cart.perimeterTotal),a.cart.qtyTotal=t.roundingValue(a.cart.qtyTotal),o.order.productsPriceDis?o.order.productsPriceDis=t.roundingValue(o.order.productsPriceDis):o.order.productsPriceDis=angular.copy(o.order.products_price)}function _(e){var i,r,a,n,l,d,c=o.order.products.length;for(n=0;c>n;n++)for(i=o.order.products[n].productPriceDis-o.order.products[n].addelemPriceDis,o.order.products[n].addelemPriceDis=t.setPriceDis(o.order.products[n].addelem_price,e),o.order.products[n].productPriceDis=t.roundingValue(i+o.order.products[n].addelemPriceDis),r=o.order.products[n].chosenAddElements.length,l=0;r>l;l++)if(a=o.order.products[n].chosenAddElements[l].length,a>0)for(d=0;a>d;d++)o.order.products[n].chosenAddElements[l][d].elementPriceDis=t.setPriceDis(o.order.products[n].chosenAddElements[l][d].element_price,e);s()}function h(){o.order.delivery_price=t.roundingValue(o.order.productsPriceDis*a.cart.discountDeliveyPlant/100)}function y(){o.order.delivery_price=t.roundingValue(o.order.productsPriceDis*a.cart.marginDeliveyPlant/100)}function E(){o.order.is_date_price_less=0,o.order.is_date_price_more=0,o.order.is_old_price=0}function v(e,t){var s=e.split("."),l=t.split("."),d=new Date(s[2],s[1]-1,s[0]),u=new Date(l[2],l[1]-1,l[0]),p=Math.floor((u-d)/864e5);if(o.order.delivery_price=0,p&&p>0){var g=p/7,v=0,b=0,I=0;1>=g?(v=r.global.deliveryCoeff.week_1,b=n.userInfo.discConstrByWeek[0],I=n.userInfo.discAddElemByWeek[0]):g>1&&2>=g?(v=r.global.deliveryCoeff.week_2,b=n.userInfo.discConstrByWeek[1],I=n.userInfo.discAddElemByWeek[1]):g>2&&3>=g?(v=r.global.deliveryCoeff.week_3,b=n.userInfo.discConstrByWeek[2],I=n.userInfo.discAddElemByWeek[2]):g>3&&4>=g?(v=r.global.deliveryCoeff.week_4,b=n.userInfo.discConstrByWeek[3],I=n.userInfo.discAddElemByWeek[3]):g>4&&5>=g?(v=r.global.deliveryCoeff.week_5,b=n.userInfo.discConstrByWeek[4],I=n.userInfo.discAddElemByWeek[4]):g>5&&6>=g?(v=r.global.deliveryCoeff.week_6,b=n.userInfo.discConstrByWeek[5],I=n.userInfo.discAddElemByWeek[5]):g>6&&7>=g?(v=r.global.deliveryCoeff.week_7,b=n.userInfo.discConstrByWeek[6],I=n.userInfo.discAddElemByWeek[6]):g>7&&(v=r.global.deliveryCoeff.week_8,b=n.userInfo.discConstrByWeek[7],I=n.userInfo.discAddElemByWeek[7]),b?(o.order.discount_construct=b,m(b),f()):(o.order.discount_construct=angular.copy(n.userInfo.discountConstr),m(o.order.discount_construct),f()),I?(o.order.discount_addelem=I,_(I),f()):(o.order.discount_addelem=angular.copy(n.userInfo.discountAddElem),_(o.order.discount_addelem),f()),v?(a.cart.discountDeliveyPlant=v,h(),o.order.is_date_price_less=1,o.order.is_date_price_more=0,o.order.is_old_price=1):(f(),E())}else if(p&&0>p){i.setCurrDiscounts(),_(o.order.discount_addelem),m(o.order.discount_construct),f();var A=Math.abs(r.global.deliveryCoeff.standart_time+p);a.cart.marginDeliveyPlant=+r.global.deliveryCoeff.percents[A],a.cart.marginDeliveyPlant?(y(),o.order.is_date_price_more=1,o.order.is_date_price_less=0,o.order.is_old_price=1):E()}else i.setCurrDiscounts(),_(o.order.discount_addelem),m(o.order.discount_construct),f(),E();o.order.new_delivery_date=u.getTime(),c()}function b(e){if(e)for(var t=e.length;--t>-1;)if(e[t].type)switch(e[t].type){case 1:e[t].priceReal=Math.round(e[t].price*a.cart.qtyTotal);break;case 2:e[t].priceReal=Math.round(e[t].price*a.cart.squareTotal);break;case 3:e[t].priceReal=Math.round(e[t].price*a.cart.perimeterTotal);break;case 4:e[t].priceReal=Math.round(o.order.productsPriceDis*e[t].price/100);break;default:e[t].priceReal=Math.round(e[t].price)}}function I(){f(),a.cart.discountDeliveyPlant&&h(),a.cart.marginDeliveyPlant&&y(),c(),b(r.global.supplyData),b(r.global.assemblingData)}function A(){a.cart.tempConstructDisc=+o.order.discount_construct,a.cart.tempAddelemDisc=+o.order.discount_addelem,a.cart.isShowDiscount=1}function S(){a.cart.isShowDiscount=0}function T(){a.cart.isShowDiscount||(a.cart.tempConstructDisc=+o.order.discount_construct,a.cart.tempAddelemDisc=+o.order.discount_addelem),a.cart.isShowDiscount=!a.cart.isShowDiscount}function x(e){return null==e?e=0:e%1&&(e=parseFloat(e.toFixed(1))),e}function N(e){e?(a.cart.tempAddelemDisc=x(a.cart.tempAddelemDisc),a.cart.tempAddelemDisc>n.userInfo.discountAddElemMax&&(a.cart.tempAddelemDisc=+n.userInfo.discountAddElemMax),o.order.discount_addelem=+a.cart.tempAddelemDisc,_(o.order.discount_addelem)):(a.cart.tempConstructDisc=x(a.cart.tempConstructDisc),a.cart.tempConstructDisc>n.userInfo.discountConstrMax&&(a.cart.tempConstructDisc=+n.userInfo.discountConstrMax),o.order.discount_construct=+a.cart.tempConstructDisc,m(o.order.discount_construct)),I()}function L(){a.cart.customer.customer_city_id=arguments[0],a.cart.customer.customer_city=arguments[1],a.cart.customer.customer_location=arguments[2]}function D(){a.cart.submitted=0,a.cart.isCityBox=0,r.global.orderEditNumber>0?a.fillOrderForm():(L(o.order.customer_city_id,o.order.customer_city,o.order.customer_location),a.cart.customer.customer_sex=0),a.cart.isMasterDialog=0,a.cart.isOrderDialog=0,a.cart.isCreditDialog=0}function C(){var o;r.global.isLoader=1,o=a.cart.isMasterDialog?"master":"order",i.saveOrderInDB(a.cart.customer,1,o).then(function(){D(),t.setPreviosPage(),r.global.isLoader=0,e.path("/history")})}function O(){a.cart.customer.customer_location?a.cart.isCityBox=1:a.cart.isCityBox=0}function R(e){L(e.cityId,e.cityName,e.fullLocation),a.cart.isCityBox=0}var P=this;return P.publicObj={joinAllAddElements:s,selectFloorPrice:u,selectAssembling:p,selectInstalment:g,checkDifferentDate:v,calculateOrderPrice:I,calculateAllProductsPrice:f,calculateTotalOrderPrice:c,changeProductPriceAsDiscount:m,changeAddElemPriceAsDiscount:_,openDiscountBlock:A,closeDiscountBlock:S,swipeDiscountBlock:T,approveNewDisc:N,closeOrderDialog:D,changeLocation:O,selectCity:R,sendOrder:C},P.publicObj}])}(),function(){angular.module("CartModule").factory("CartServ",["$location","$filter","GeneralServ","MainServ","CartMenuServ","GlobalStor","OrderStor","ProductStor","CartStor","AuxStor",function(e,t,i,r,o,a,n,s,l,d){function c(){i.setPreviosPage(),r.createNewProduct()}function u(e){n.order.products[e].product_qty+=1,o.joinAllAddElements(),o.calculateOrderPrice()}function p(e){function r(){n.order.products.splice(e,1),l.cart.allAddElements.splice(e,1),o.calculateOrderPrice(),n.order.products.length>0}i.confirmAlert(t("translate")("common_words.DELETE_PRODUCT_TITLE"),t("translate")("common_words.DELETE_PRODUCT_TXT"),r)}function g(e){1===n.order.products[e].product_qty?p(e):(n.order.products[e].product_qty-=1,o.calculateOrderPrice()),o.joinAllAddElements()}function m(l,d){function c(){s.product=angular.copy(n.order.products[l]),a.global.productEditNumber=s.product.product_id,a.global.isCreatedNewProduct=1,a.global.isChangedTemplate=1,r.prepareMainPage(),"auxiliary"===d&&(a.global.activePanel=6),i.setPreviosPage(),e.path("/main"),a.global.isBox=!a.global.isBox}function u(e,t){t+=1,e.product_id=t,n.order.products.push(e)}function p(){var e=d3.max(n.order.products.map(function(e){return e.product_id})),t=angular.copy(n.order.products[l]);a.global.isBox=!a.global.isBox,u(t,e),o.joinAllAddElements(),o.calculateOrderPrice()}a.global.isBox=!a.global.isBox,i.confirmAlert(t("translate")("common_words.EDIT_COPY_TXT"),t("translate")("common_words.SPACE"),c),i.confirmPath(p)}function f(){var e,t,r,o=angular.copy(l.cart.allAddElements),a=o.length;for(l.cart.allAddElemsOrder.length=0;--a>-1;)if(e=o[a].length)for(;--e>-1;)if(t=l.cart.allAddElemsOrder.length){for(r=1;--t>-1;)l.cart.allAddElemsOrder[t].id===o[a][e].id&&l.cart.allAddElemsOrder[t].element_width===o[a][e].element_width&&l.cart.allAddElemsOrder[t].element_height===o[a][e].element_height&&(l.cart.allAddElemsOrder[t].element_qty=i.roundingValue(l.cart.allAddElemsOrder[t].element_qty+o[a][e].element_qty),r-=1);r&&l.cart.allAddElemsOrder.push(o[a][e])}else l.cart.allAddElemsOrder.push(o[a][e]);console.warn(l.cart.allAddElemsOrder)}function _(){var e=n.order.products.length;for(l.cart.addElemsOrderPriceTOTAL=0;--e>-1;)l.cart.addElemsOrderPriceTOTAL+=n.order.products[e].addelemPriceDis*n.order.products[e].product_qty;l.cart.addElemsOrderPriceTOTAL=i.roundingValue(l.cart.addElemsOrderPriceTOTAL)}function h(){l.cart.selectedProducts.length=0,l.cart.selectedProducts=n.order.products.map(function(){return[]})}function y(){f(),_(),h(),l.cart.isAllAddElems=1,d.aux.isAddElementListView=1}function E(e){for(var t,o,a=n.order.products.length;--a>-1;){if(n.order.products[a].addelem_price=0,n.order.products[a].addelemPriceDis=0,e)for(t=n.order.products[a].chosenAddElements.length;--t>-1;)if(o=n.order.products[a].chosenAddElements[t].length){for(;--o>-1;)n.order.products[a].addelem_price+=n.order.products[a].chosenAddElements[t][o].element_qty*n.order.products[a].chosenAddElements[t][o].element_price;n.order.products[a].addelem_price=i.roundingValue(n.order.products[a].addelem_price),n.order.products[a].addelemPriceDis=i.setPriceDis(n.order.products[a].addelem_price,n.order.discount_addelem)}r.setProductPriceTOTAL(n.order.products[a])}}function v(e,t){t+=1,e.product_id=t,n.order.products.push(e)}function b(e){var t=d3.max(n.order.products.map(function(e){return e.product_id})),i=angular.copy(n.order.products[e]);v(i,t),o.joinAllAddElements(),o.calculateOrderPrice()}var I=this;return I.publicObj={increaseProductQty:u,decreaseProductQty:g,addNewProductInOrder:c,clickDeleteProduct:p,box:m,showAllAddElements:y,collectAllAddElems:f,getAddElemsPriceTotal:_,calculateAddElemsProductsPrice:E,createProductCopy:b,addCloneProductInOrder:v},I.publicObj}])}(),function(){angular.module("BauVoiceApp").constant("globalConstants",{serverIP:"http://api.windowscalculator.net",printIP:"http://windowscalculator.net:3002/orders/get-order-pdf/",localPath:"/local/",STEP:50,REG_LOGIN:/^[a-zA-Z?0-9?_?.?@?\-?]+$/,REG_PHONE:/^\d+$/,REG_NAME:/^[a-zA-Z]+$/,REG_MAIL:/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,SVG_CLASS_ICON:"tamlateIconSVG",SVG_ID_EDIT:"tamlateSVG",SVG_ID_MAIN:"tamlateMainSVG",SVG_ID_ICON:"tamlateIconBigSVG",SVG_ID_GLASS:"tamlateGlassSVG",SVG_ID_GRID:"tamlateGridSVG",svgTemplateIconWidth:70,svgTemplateIconHeight:70,svgTemplateIconBigWidth:500,svgTemplateIconBigHeight:450,svgTemplateWidth:1022,svgTemplateHeight:767,squareLimit:.15,minSizeLimit:100,minSizeLimitStulp:300,minRadiusHeight:10,activeClass:"active",languages:[{label:"uk",name:"Українська"},{label:"ru",name:"Русский"},{label:"en",name:"English"},{label:"de",name:"Deutsch"},{label:"ro",name:"Român"},{label:"it",name:"Italiano"}]})}(),function(){angular.module("DesignModule").factory("DesignServ",["$rootScope","$location","$timeout","$filter","$q","globalConstants","GeneralServ","localDB","loginServ","MainServ","AnalyticsServ","SVGServ","GlobalStor","DesignStor","OrderStor","ProductStor","UserStor",function(e,t,i,r,o,a,n,s,l,d,c,u,p,g,m,f,_){function h(){d3.selectAll("#"+a.SVG_ID_EDIT+" .dim_blockX").classed("dim_shiftX",!1),d3.selectAll("#"+a.SVG_ID_EDIT+" .dim_blockY").classed("dim_shiftY",!1),d3.selectAll("#"+a.SVG_ID_EDIT+" .dim_block").classed("dim_hidden",!0);
}function y(){g.design.selectedCorner.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" .corner_mark").transition().duration(300).ease("linear").attr("r",0)}function E(){g.design.selectedImpost.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" [item_type=impost]").classed("frame-active",!1)}function v(){g.design.selectedArc.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" .frame").classed("active_svg",!1)}function b(){g.design.selectedGlass.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" .glass").classed("glass-active",!1)}function I(){d3.selectAll("#"+a.SVG_ID_EDIT+" .size-rect").classed("active",!1),d3.selectAll("#"+a.SVG_ID_EDIT+" .size-txt-edit").classed("active",!1)}function A(){I(),p.global.isSizeCalculator=0,g.design.openVoiceHelper=0}function S(){u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){g.design.templateTEMP=angular.copy(e)})}function T(e,t){var i=t||a.SVG_ID_EDIT,r=d3.select("#"+i+" .glass[block_id="+e+"]"),o=1;r.classed("error_glass",!0);var n=setInterval(function(){11===o&&clearInterval(n),o%2?r.classed("error_glass",!1):r.classed("error_glass",!0),o+=1},50)}function x(){d3.selectAll("#"+a.SVG_ID_EDIT+" [item_type=impost]").each(function(){d3.select(this).on(Xe,null)}),d3.selectAll("#"+a.SVG_ID_EDIT+" .glass").each(function(){d3.select(this).on(Xe,null)}),d3.selectAll("#"+a.SVG_ID_EDIT+" .frame").each(function(){d3.select(this).on(Xe,null)}),d3.selectAll("#"+a.SVG_ID_EDIT+" .size-box").each(function(){d3.select(this).on(Xe,null)}),d3.select(window).on("keydown",null)}function N(){d3.selectAll("#"+a.SVG_ID_GLASS+" .glass").each(function(){d3.select(this).on(Xe,null).classed("glass-active",!1)}),d3.selectAll("#"+a.SVG_ID_GRID+" .glass").each(function(){d3.select(this).on(Xe,null).classed("glass-active",!1)}),d3.select(window).on("keydown",null)}function L(){g.design.tempSize.length=0,g.design.isMinSizeRestriction=0,g.design.isMaxSizeRestriction=0,g.design.isDimExtra=0,g.design.isSquareExtra=0}function D(e,t){return n.roundingValue(t-Math.sqrt(Math.pow(t,2)-Math.pow(e,2)/4),1)}function C(e){var t,i,r,o,a,s,l=g.design.templateSourceTEMP.details,d=g.design.oldSize.attributes[5].nodeValue,c=g.design.oldSize.attributes[6].nodeValue,u=g.design.oldSize.attributes[10].nodeValue,p=+g.design.oldSize.attributes[11].nodeValue,m=+g.design.oldSize.attributes[12].nodeValue,f=g.design.oldSize.attributes[13].nodeValue,_=+g.design.oldSize.attributes[14].nodeValue,h=p+e,y=m-e,E=l.length,v=0,b=[];if(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),"curve"===d){i=D(p,e);e:for(r=1;E>r;r+=1)if(l[r].id===c){if(l[r].pointsQ)for(a=l[r].pointsQ.length;--a>-1;)if(l[r].pointsQ[a].id===u){l[r].pointsQ[a].heightQ=i;break e}if(l[r].impost&&l[r].impost.impostAxis[2].id===u){l[r].impost.impostAxis[2].heightQ=i;break e}}}else if(u.indexOf("qa")+1){for(r=1;E>r;r+=1)if(1===l[r].level&&(a=l[r].pointsQ.length))for(;--a>-1;)l[r].pointsQ[a].id===u&&(l[r].pointsQ[a].heightQ=e)}else{if(!_){for(r=1;E>r;r+=1)1===l[r].level&&b.push(n.getMaxMinCoord(l[r].pointsOut));for(t=b.length;--t>-1;)"x"===f?b[t].maxX===m&&(v=1):"y"===f&&b[t].maxY===m&&(v=1)}for(r=1;E>r;r+=1){if(s=l[r].pointsOut.length)for(;--s>-1;)v||("x"===f?l[r].pointsOut[s].x===m&&(l[r].pointsOut[s].x=h):"y"===f&&l[r].pointsOut[s].y===m&&(l[r].pointsOut[s].y=h));if(l[r].impost)for(o=0;2>o;o+=1)v?"x"===f?l[r].impost.impostAxis[o].x===p&&(l[r].impost.impostAxis[o].x=y):"y"===f&&l[r].impost.impostAxis[o].y===p&&(l[r].impost.impostAxis[o].y=y):"x"===f?l[r].impost.impostAxis[o].x===m&&(l[r].impost.impostAxis[o].x=h):"y"===f&&l[r].impost.impostAxis[o].y===m&&(l[r].impost.impostAxis[o].y=h)}}}function O(e){var t,i,r,o,a=g.design.templateTEMP.details,n=a.length,s=+g.design.oldSize.attributes[11].nodeValue,l=+g.design.oldSize.attributes[12].nodeValue,d=g.design.oldSize.attributes[13].nodeValue;for(i=1;n>i;i+=1)if(1===a[i].level&&(r=a[i].pointsOut.length,r&&(o=0,o=a[i].pointsOut.some(function(e){return"x"===d?e.x===l:"y"===d?e.y===l:void 0}))))for(t=angular.copy(a[i].pointsOut);--r>-1;)"x"===d?a[i].pointsOut[r].x===l&&(t[r].x=s+e):"y"===d&&a[i].pointsOut[r].y===l&&(t[r].y=s+e);return t}function R(e){var t=o.defer();if(g.design.tempSize.length){var i=parseInt(g.design.tempSize.join(""),10),a=O(i),n=a?u.calcSquare(a):0;n<p.global.maxSquareLimit?i>=g.design.minSizeLimit&&i<=g.design.maxSizeLimit?(C(i),A(),u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){g.design.templateTEMP=angular.copy(e),L(),t.resolve(1)})):(i<g.design.minSizeLimit?p.global.isVoiceHelper?playTTS(r("translate")("construction.VOICE_SMALLEST_SIZE"),p.global.voiceHelperLanguage):(g.design.isMinSizeRestriction=1,g.design.isMaxSizeRestriction=0):i>g.design.maxSizeLimit&&(p.global.isVoiceHelper?playTTS(r("translate")("construction.VOICE_BIGGEST_SIZE"),p.global.voiceHelperLanguage):(g.design.isMinSizeRestriction=0,g.design.isMaxSizeRestriction=1),i>p.global.maxSizeLimit&&(g.design.isDimExtra=1)),d3.select(g.design.oldSize).text(g.design.prevSize),g.design.tempSize.length=0,t.resolve(1)):(g.design.isSquareExtra=1,d3.select(g.design.oldSize).text(g.design.prevSize),g.design.tempSize.length=0,t.resolve(1))}else A(),t.resolve(1);return g.design.openVoiceHelper=0,g.design.loudVoice=0,g.design.quietVoice=0,e?t.promise:void 0}function P(){var e=g.design.tempSize.join("");d3.select(g.design.oldSize).text(e),p.global.isVoiceHelper&&R()}function w(e){var t=g.design.tempSize.length;if(p.global.isVoiceHelper){var i=parseInt(e,10);g.design.voiceTxt="",g.design.openVoiceHelper=!1,i>0&&1e4>i&&(g.design.tempSize=(""+i).split(""),P()),I()}else(4===t||1===t&&!g.design.tempSize[0])&&(g.design.tempSize.length=0),"0"===e?t&&g.design.tempSize[0]&&(g.design.tempSize.push(e),P()):"00"===e?t&&g.design.tempSize[0]&&(3>t?g.design.tempSize.push(0,0):3===t&&g.design.tempSize.push(0),P()):(g.design.tempSize.push(e),P())}function M(){g.design.tempSize.pop(),g.design.tempSize.length<1&&g.design.tempSize.push(0),P()}function k(t){var i;if(13===t.which)R(),e.$apply();else if(8===t.which)M();else{switch(t.which){case 48:case 96:i=0;break;case 49:case 97:i=1;break;case 50:case 98:i=2;break;case 51:case 99:i=3;break;case 52:case 100:i=4;break;case 53:case 101:i=5;break;case 54:case 102:i=6;break;case 55:case 103:i=7;break;case 56:case 104:i=8;break;case 57:case 105:i=9}void 0!==i&&w(i)}}function G(t){g.design.voiceTxt=t,e.$apply(),i(function(){var i=parseStringToDimension(t);"NaN"===i&&(i=r("translate")("construction.VOICE_NOT_UNDERSTAND")),playTTS(i),w(i),e.$apply()},1e3)}function B(t){t>100?(g.design.loudVoice=!0,g.design.quietVoice=!1):(g.design.loudVoice=!1,g.design.quietVoice=!0),e.$apply()}function V(){d3.selectAll("#"+a.SVG_ID_EDIT+" .size-box").each(function(){var t=d3.select(this);t.on(Xe,function(){var i=t.select(".size-rect"),r=i[0][0].attributes[0].nodeValue.indexOf("active")+1;if(g.design.tempSize.length)R(),L();else{if(r)A();else{I(),i.classed("active",!0);var o=t.select(".size-txt-edit");o.classed("active",!0),g.design.oldSize=o[0][0],g.design.prevSize=o[0][0].textContent,g.design.minSizeLimit=+o[0][0].attributes[8].nodeValue,g.design.maxSizeLimit=+o[0][0].attributes[9].nodeValue,p.global.isVoiceHelper?(g.design.openVoiceHelper=1,startRecognition(G,B,p.global.voiceHelperLanguage)):(p.global.isSizeCalculator=1,g.design.isMinSizeRestriction=0,g.design.isMaxSizeRestriction=0,g.design.isDimExtra=0,g.design.isSquareExtra=0)}e.$apply()}})}),d3.select(window).on("keydown",function(){p.global.isSizeCalculator&&k(d3.event)})}function U(){var e,t,i,r,o,a=angular.copy(f.product.chosenAddElements[0]),n=a.length,s=f.product.template.details,l=s.length,d=0,c=[];if(n){for(;--l>0;)if(s[l].gridId)for(o=0;n>o;o+=1)s[l].id===a[o].block_id&&(r=a[o],i={},e=s[l].pointsLight.map(function(e){return e.x}),t=s[l].pointsLight.map(function(e){return e.y}),i.width=Math.round(d3.max(e)-d3.min(e)),i.height=Math.round(d3.max(t)-d3.min(t)),r.element_width===i.width&&r.element_height===i.height||(r.element_width=i.width,r.element_height=i.height,d=1),c.push(r));f.product.chosenAddElements[0]=angular.copy(c)}return d}function H(){g.designSource.templateSourceTEMP=angular.copy(f.product.template_source),g.designSource.templateTEMP=angular.copy(f.product.template),g.design.templateSourceTEMP=angular.copy(f.product.template_source),g.design.templateTEMP=angular.copy(f.product.template)}function F(){g.design=g.setDefaultDesign(),p.global.activePanel=0,p.global.isNavMenu=0,p.global.isConfigMenu=1,t.path("/main")}function z(e,t){e.doorName=t.doorShapeList[e.door_shape_id].name,e.doorSashName=t.sashShapeList[e.door_sash_shape_id].frame.name+"/"+t.sashShapeList[e.door_sash_shape_id].sash.name,e.doorHandle=t.handleShapeList[e.door_handle_shape_id],e.doorLock=t.lockShapeList[e.door_lock_shape_id]}function Y(e,t){e.door_shape_id=t.doorConfig.doorShapeIndex,e.door_sash_shape_id=t.doorConfig.sashShapeIndex,e.door_handle_shape_id=t.doorConfig.handleShapeIndex,e.door_lock_shape_id=t.doorConfig.lockShapeIndex,z(e,t)}function W(e){var t,i,r=g.designSource.doorShapeData.length;for(g.designSource.doorShapeList.length=0,t=0;r>t;t+=1)i=0,2===t&&p.global.doorKitsT1.length?i=1:3===t&&p.global.doorKitsT2.length?i=1:t&&1!==t||(i=1),i&&g.designSource.doorShapeList.push(g.designSource.doorShapeData[t]);if(!p.global.noDoorExist){switch(e.door_shape_id){case 0:case 1:p.global.doorKitsT1.length?g.designSource.sashShapeList=p.global.doorKitsT1:p.global.doorKitsT2.length&&(g.designSource.sashShapeList=p.global.doorKitsT2);break;case 2:p.global.doorKitsT1.length&&(g.designSource.sashShapeList=p.global.doorKitsT1);break;case 3:p.global.doorKitsT2.length&&(g.designSource.sashShapeList=p.global.doorKitsT2)}g.designSource.handleShapeList=p.global.doorHandlers,g.designSource.lockShapeList=p.global.doorLocks[e.door_handle_shape_id],z(e,g.designSource)}}function q(){A(),g.design=g.setDefaultDesign(),H()}function Q(e,t){for(var i=1,r=e.attributes.block_id.nodeValue,o=t.length;--o>-1;)if(t[o].attributes.block_id.nodeValue===r){t.splice(o,1),i=0;break}return i&&t.push(e),i}function j(){g.design.selectedImpost.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" [item_type=impost]").each(function(){var t=d3.select(this);t.on(Xe,function(){if(g.design.tempSize.length)R(),L();else{var i=Q(t[0][0],g.design.selectedImpost);i?(t.classed("frame-active",!0),g.design.activeMenuItem=3,g.design.isImpostDelete=1,g.design.activeSubMenuItem=3,y(),v(),A(),e.$apply()):(t.classed("frame-active",!1),g.design.selectedImpost.length||(g.design.activeMenuItem=0,g.design.activeSubMenuItem=0,e.$apply(),g.design.isImpostDelete=0))}})})}function K(e,t){var i,r=e[0].length,o=0,a=0;if(r){for(;--r>-1;)i=e[0][r].attributes.axis,i&&("x"===i.nodeValue?o=1:"y"===i.nodeValue&&(a=1));o&&d3.selectAll("#"+t+" .dim_blockX").classed("dim_shiftX",1),a&&d3.selectAll("#"+t+" .dim_blockY").classed("dim_shiftY",1),e.classed("dim_hidden",0)}}function X(e){var t=d3.selectAll("#"+a.SVG_ID_EDIT+" .dim_block[block_id="+e+"]");K(t,a.SVG_ID_EDIT)}function Z(e){var t=d3.selectAll("#"+e+" .dim_block");K(t,e)}function J(){g.design.selectedGlass.length=0,d3.selectAll("#"+a.SVG_ID_EDIT+" .glass").each(function(){var t=d3.select(this);t.on(Xe,function(){if(g.design.tempSize.length)R(),L();else{var i=Q(t[0][0],g.design.selectedGlass),r=t[0][0].attributes.block_id.nodeValue;i?(t.classed("glass-active",!0),y(),E(),v(),A(),X(r),e.$apply()):(t.classed("glass-active",!1),d3.selectAll("#"+a.SVG_ID_EDIT+" .dim_block[block_id="+r+"]").classed("dim_hidden",!0),g.design.selectedGlass.length||(g.design.activeMenuItem=0,g.design.activeSubMenuItem=0,h(),e.$apply()))}})})}function ee(){g.design.selectedGlass.length=0,d3.selectAll("#"+a.SVG_ID_GLASS+" .glass").each(function(){var e=d3.select(this);e.on(Xe,function(){var t=Q(e[0][0],g.design.selectedGlass),i=e[0][0].attributes.block_id.nodeValue;t?(e.classed("glass-active",!0),d3.select(".glass-txt[block_id="+i+"]").text(p.global.selectGlassName),d.setGlassToTemplateBlocks(f.product.template,p.global.selectGlassId,p.global.selectGlassName,i)):(e.classed("glass-active",!1),d3.select(".glass-txt[block_id="+i+"]").text(p.global.prevGlassName),d.setGlassToTemplateBlocks(f.product.template,p.global.prevGlassId,p.global.prevGlassName,i))})}),Z(a.SVG_ID_GLASS)}function te(e){e&&(p.global.selectGlassId=p.global.prevGlassId,p.global.selectGlassName=p.global.prevGlassName,u.createSVGTemplate(f.product.template_source,f.product.profileDepths).then(function(e){f.product.template=angular.copy(e)})),N(),p.global.showGlassSelectorDialog=0}function ie(){g.design.selectedGlass.length=0,d3.selectAll("#"+a.SVG_ID_GRID+" .glass").each(function(){var e=d3.select(this);e.on(Xe,function(){for(var t,i=f.product.template.details,r=i.length,o=e[0][0].attributes.block_id.nodeValue;--r>0;)i[r].id===o&&("sash"===i[r].blockType?(t=Q(e[0][0],g.design.selectedGlass),t?e.classed("glass-active",!0):e.classed("glass-active",!1)):T(o,a.SVG_ID_GRID))})}),Z(a.SVG_ID_GRID)}function re(e,t){for(var i=1,r=e.attributes.item_id.nodeValue,o=t.length;--o>-1;)if(t[o].attributes.item_id.nodeValue===r){t.splice(o,1),i=0;break}return i&&t.push(e),i}function oe(){var t=d3.selectAll("#"+a.SVG_ID_EDIT+" .frame")[0].filter(function(e){return"frame"===e.__data__.type||"arc"===e.__data__.type?!0:void 0});t.length&&d3.selectAll(t).each(function(){var t=d3.select(this);t.on(Xe,function(){if(g.design.tempSize.length)R(),L();else{var i=re(t[0][0],g.design.selectedArc);i?(t.classed("active_svg",!0),b(),y(),E(),A(),e.$apply()):(t.classed("active_svg",!1),g.design.selectedArc.length||(g.design.activeMenuItem=0,g.design.activeSubMenuItem=0,e.$apply()))}})})}function ae(e,t){var i=1,r=40,o=t.x-e.x,a=t.y-e.y;return o>0&&r>o&&a>0&&r>a&&(i=0),i}function ne(e,t,i,r,o,a){var n={type:"impost",id:"ip"+t,x:Math.round(e.x),y:Math.round(e.y),dir:"line",dimType:o};a&&(n.type="shtulp",n.id="sht"+t),r[i].impost||(r[i].impost={impostAxis:[],impostOut:[],impostIn:[],impostLight:[]}),r[i].impost.impostAxis.push(n)}function se(e,t,i,r,o){var a={type:"skylight",id:"block_"+e,level:i[t].level+1,blockType:"frame",parent:i[t].id,children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:i[t].glassId,glassTxt:i[t].glassTxt};r&&(a.blockType="sash",angular.extend(a,o)),i[t].children.push(a.id),i.push(a)}function le(e){for(var t=5,i=e.length;--i>-1;)for(var r=e.length;--r>-1;){var o=Math.abs(e[i].x-e[r].x),a=Math.abs(e[i].y-e[r].y);if(o>0&&t>o&&a>0&&t>a){e.splice(i,1);break}}}function de(e){for(var t,i=e.length,r=0;--i>0;)t=Number(e[i].id.replace(/\D+/g,"")),t>r&&(r=t);return r}function ce(e,t){var i,r,o,a,n,s,l,d=[],c=t.length;for(i=0;c>i;i+=1)r=u.getCoordCrossPoint(e,t[i]),r.x>=0&&r.y>=0&&(o=u.checkLineOwnPoint(r,t[i].to,t[i].from),a=u.isInsidePointInLine(o),a&&(n=u.checkEqualPoints(r,d),n&&(s=ae(t[i].from,r),s&&(l=ae(t[i].to,r),l&&d.push(r)))));return d}function ue(e,t,i,r){var o=ce(t,i);if(2===o.length){var a,s,l,d,c={from:o[0],to:o[1]},p=n.roundingValue(Math.hypot(c.from.x-c.to.x,c.from.y-c.to.y)/2,1),g=angular.copy(r),m=g.length,f=[];for(u.setLineCoef(c),l=u.setQPointCoord(e,c,p),c.coefA||1!==e?c.coefB||4!==e||(l.x-=2*p):l.y-=2*p,d=u.setPointLocationToLine(c.from,c.to,l);--m>-1;){var _=u.setPointLocationToLine(c.from,c.to,g[m]);_>0&&d>0?f.push(g[m]):0>_&&0>d&&f.push(g[m])}return f.push(c.from,c.to),a=u.centerBlock(f),s=n.roundingValue(Math.abs((c.coefA*a.x+c.coefB*a.y+c.coefC)/Math.hypot(c.coefA,c.coefB)),1),s>p?p/2:s/2}}function pe(e,t,i,r,o){var a={blockId:o[r].id,dir:"curv",id:"qi"+i,heightQ:e,positionQ:t};o[r].impost.impostAxis.push(a)}function ge(e,t){var i,r,o,a,n,s=g.design.templateTEMP.details,l=s.length,d=g.design.templateSourceTEMP.details,c=90,p=0;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP));--l>0;)s[l].id===e&&(i=+l,r=Number(s[l].id.replace(/\D+/g,"")));o=de(d),a=u.cteateLineByAngel(s[i].center,c),n=ce(a,s[i].linesOut),n.length>2&&le(n);var m=n.length;if(2===m){for(;--m>-1;)ne(n[m],r,i,d,p,1),se(o+=1,i,d,1,t[m]);S()}else T(e)}function me(e,t){var i,r,o=t.__data__,n=t.attributes.block_id.nodeValue,s=g.design.templateSourceTEMP.details,l=s.length,d=d3.min(o.sizes);if(8===e||9===e)d>=a.minSizeLimitStulp?(8===e?i=[{openDir:[4],handlePos:0,sashType:4},{openDir:4===f.product.construction_type?[2]:[1,2],handlePos:2,sashType:4===f.product.construction_type?2:17}]:9===e&&(i=[{openDir:4===f.product.construction_type?[4]:[1,4],handlePos:4,sashType:4===f.product.construction_type?2:17},{openDir:[2],handlePos:0,sashType:4}]),ge(n,i)):T(n);else if(d>=a.minSizeLimit||o.square>=a.squareLimit){for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),r=1;l>r;r+=1)if(s[r].id===n){switch(s[r].blockType="sash",s[r].gridId=0,s[r].gridTxt="",e){case 2:s[r].openDir=[4],s[r].handlePos=4,s[r].sashType=2;break;case 3:s[r].openDir=[2],s[r].handlePos=2,s[r].sashType=2;break;case 4:s[r].openDir=[1],s[r].handlePos=1,s[r].sashType=7;break;case 5:s[r].openDir=[3],s[r].handlePos=3,s[r].sashType=2;break;case 6:s[r].openDir=[1,2],s[r].handlePos=2,s[r].sashType=6;break;case 7:s[r].openDir=[1,4],s[r].handlePos=4,s[r].sashType=6}S()}}else T(n)}function fe(e,t,i){for(var r=0;--i>0;)t[i].id===e&&t[i].impost&&"shtulp"===t[i].impost.impostAxis[0].type&&(r=i);return r}function _e(e){e.blockType="frame",delete e.openDir,delete e.handlePos,delete e.sashType,delete e.gridId,delete e.gridTxt}function he(e,t){for(var i,r=t.length;--r>0;)if(t[r].id===e){i=t[r].children.length,i?(he(t[r].children[0],t),he(t[r].children[1],t),t.splice(r,1)):t.splice(r,1);break}}function ye(e){var t,i=e.attributes.block_id.nodeValue,r=g.design.templateSourceTEMP.details,o=r.length,a=0;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),t=1;o>t;t+=1)if(r[t].id===i){a=fe(r[t].parent,r,o),a?(he(r[a].children[0],r),he(r[a].children[1],r),r[a].children.length=0,delete r[a].impost):_e(r[t]);break}S()}function Ee(e){for(var t,i,r=g.design.templateSourceTEMP.details,o=e.details.length,n=0;--o>0;)if(e.details[o].level&&"sash"===e.details[o].blockType)for(t=e.details[o].parts.length;--t>-1;)"glass"===e.details[o].parts[t].type&&(i=d3.min(e.details[o].parts[t].sizes),i<=a.minSizeLimit&&i<=a.minSizeLimit&&(_e(r[o]),n=1));return n}function ve(e,t,i,r,o){var a=200,n={type:"corner",id:"c"+t+"-"+e,dir:"line"};1===e?(n.x=(i.from.x*(i.size-a)+i.to.x*a)/i.size,n.y=(i.from.y*(i.size-a)+i.to.y*a)/i.size):2===e&&(n.x=(i.from.x*a+i.to.x*(i.size-a))/i.size,n.y=(i.from.y*a+i.to.y*(i.size-a))/i.size),o[r].pointsOut.push(n)}function be(e,t,i,r,o){var a,n=i.length;for(a=0;n>a;a+=1)i[a].from.id===e?ve(1,t,i[a],r,o):i[a].to.id===e&&ve(2,t,i[a],r,o);for(var s=o[r].pointsOut.length;--s>-1;)o[r].pointsOut[s].id===e&&(o[r].pointsOut[s].view=0)}function Ie(e,t,i){for(var r,o,a=i.length;--a>0;)if(i[a].id===t)for(r=i[a].pointsOut.length;--r>-1;)for(o=e.length;--o>-1;)if(i[a].pointsOut[r].id===e[o]){i[a].pointsOut.splice(r,1);break}}function Ae(e,t,i,r,o,a){var n={type:e,blockId:a[o].id,id:t,heightQ:i.size/4,fromPId:i.from.id,toPId:i.to.id,positionQ:r};a[o].pointsQ||(a[o].pointsQ=[]),a[o].pointsQ.push(n)}function Se(e,t,i){for(var r=i[t].pointsOut.length,o={};--r>-1;)"corner"===i[t].pointsOut[r].type&&(i[t].pointsOut[r].id==="c"+e+"-2"&&(o.from=i[t].pointsOut[r]),i[t].pointsOut[r].id==="c"+e+"-1"&&(o.to=i[t].pointsOut[r]));u.setLineCoef(o),o.size=n.roundingValue(Math.hypot(o.to.x-o.from.x,o.to.y-o.from.y),1),Ae("corner","qc"+e,o,e,t,i)}function Te(e,t,i){for(var r,o=i.length;--o>0;)if(i[o].id===t&&i[o].pointsQ)for(r=i[o].pointsQ.length;--r>-1;)if(i[o].pointsQ[r].id===e){i[o].pointsQ.splice(r,1);break}}function xe(e){var t=e.__data__.id,i=Number(t.replace(/\D+/g,"")),r=e.attributes.block_id.nodeValue,o=g.design.templateSourceTEMP.details,a=g.design.templateTEMP.details,n=a.length;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP));--n>0;)a[n].id===r&&(e.__data__.view?be(t,i,a[n].linesOut,n,o):Te("qc"+i,r,o));S()}function Ne(e){var t,i,r=e.__data__.id,o=Number(r.replace(/\D+/g,"")),a=e.attributes.block_id.nodeValue,n=g.design.templateSourceTEMP.details,s=g.design.templateTEMP.details,l=s.length;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP));--l>0;)if(s[l].id===a)if(e.__data__.view)be(r,o,s[l].linesOut,l,n),Se(o,l,n);else for(t=s[l].linesOut.length,i=0;t>i;i+=1)s[l].linesOut[i].from.id==="c"+o+"-2"&&s[l].linesOut[i].to.id==="c"+o+"-1"&&Ae("corner","qc"+o,s[l].linesOut[i],o,l,n);S()}function Le(e){var t,i=e.__data__.id,r=Number(i.replace(/\D+/g,"")),o=e.attributes.block_id.nodeValue,a=g.design.templateSourceTEMP.details,n=a.length;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),Ie(["c"+r+"-1","c"+r+"-2"],o,a),Te("qc"+r,o,a);--n>0;)if(a[n].id===o)for(t=a[n].pointsOut.length;--t>-1;)a[n].pointsOut[t].id===i&&(a[n].pointsOut[t].view=1);S()}function De(e,t,i,r,o){for(;--r>-1;)t?e?i[r].x+=o:i[r].x-=o:e?i[r].y+=o:i[r].y-=o}function Ce(e,t,i,r){for(var o,a=r.length;--a>0;)r[a].level&&(r[a].pointsOut.length&&De(e,t,r[a].pointsOut,r[a].pointsOut.length,i),r[a].pointsIn.length&&De(e,t,r[a].pointsIn,r[a].pointsIn.length,i),r[a].impost&&(o=r[a].impost.impostAxis.length,o&&De(e,t,r[a].impost.impostAxis,o,i)))}function Oe(e,t,i){for(var r,o=u.centerBlock(i[t].pointsOut),a=u.sortingPoints(i[t].pointsOut,o),n=u.setLines(a),s=n.length;--s>-1;)n[s].from.id===e[0].id&&n[s].to.id===e[1].id&&(r=n[s]);return r}function Re(e){var t=o.defer();if(!$.isEmptyObject(e)){var i=e.__data__;if("frame"===i.type){var r,a,n,s,l,d=Number(i.points[0].id.replace(/\D+/g,"")),c=e.attributes.block_id.nodeValue,p=angular.copy(g.design.templateTEMP.details),m=p.length,_=g.design.templateSourceTEMP.details;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),s=1;m>s;s+=1)if(p[s].id===c)for(l=p[s].linesOut.length;--l>-1;)p[s].linesOut[l].from.id===i.points[0].id&&p[s].linesOut[l].to.id===i.points[1].id&&(r=s,a=p[s].linesOut[l]);i.points[0].fi<180&&i.points[1].fi<180?n=1:i.points[0].fi<90&&i.points[1].fi>270?n=2:i.points[0].fi>180&&i.points[1].fi>180?n=3:i.points[0].fi<270&&i.points[1].fi>90&&(n=4);var h=u.setQPointCoord(n,a,a.size/2);1===n?(Ce(1,0,h.y,p),Ce(1,0,h.y,_),h.y=0):4===n&&(Ce(1,1,h.x,p),Ce(1,1,h.x,_),h.x=0),h.y&&h.x||(a=Oe(i.points,r,_)),Ae("arc","qa"+d,a,n,r,_),u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){var i=Ee(e);i?u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){g.design.templateTEMP=angular.copy(e),t.resolve("done")}):(g.design.templateTEMP=angular.copy(e),t.resolve("done"))})}else t.resolve("done")}return t.promise}function Pe(e){var t=o.defer();if(!$.isEmptyObject(e)){var i=e.__data__;if("arc"===i.type){var r=i.points[1].id,a=e.attributes.block_id.nodeValue,n=g.design.templateSourceTEMP.details;g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),Te(r,a,n),i.points[1].x?i.points[1].y||Ce(0,0,i.points[0].y,n):Ce(0,1,i.points[0].x,n),u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){var i=Ee(e);i?u.createSVGTemplate(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){g.design.templateTEMP=angular.copy(e),t.resolve("done")}):(g.design.templateTEMP=angular.copy(e),t.resolve("done"))})}else t.resolve("done")}return t.promise}function we(e){var t=g.design.selectedArc.shift(),r=t.attributes.item_id.nodeValue,o=d3.select("#"+a.SVG_ID_EDIT+" [item_id="+r+"]");o[0].length&&(e?Re(o[0][0]).then(function(){g.design.selectedArc.length&&i(function(){we(e)},1)}):Pe(o[0][0]).then(function(){g.design.selectedArc.length&&i(function(){we(e)},1)}))}function Me(e,t){var i,r,o,n,s,l,d,c,p=t.__data__,m=t.attributes.block_id.nodeValue,f=d3.min(p.sizes),_=g.design.templateTEMP.details,h=_.length,y=g.design.templateSourceTEMP.details,E=0,v=0;if(f>=a.minSizeLimit&&p.square>=a.squareLimit){switch(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),e){case 2:i=90;break;case 3:i=180,E=1;break;case 4:i=170,E=1;break;case 5:i=190,E=1;break;case 6:i=80;break;case 7:i=100;break;case 8:i=90,v=1,r=2;break;case 9:i=90,v=1,r=4;break;case 10:i=180,E=1,v=1,r=1;break;case 11:i=180,E=1,v=1,r=3;break;case 12:i=100,v=1,r=1;break;case 13:i=100,v=1,r=3;break;case 14:i=10,E=1,v=1,r=4;break;case 15:i=10,E=1,v=1,r=2}for(c=1;h>c;c+=1)_[c].id===m&&(o=c,n=Number(_[c].id.replace(/\D+/g,"")));s=de(y),l=u.cteateLineByAngel(_[o].center,i),d=ce(l,_[o].linesOut),d.length>2&&le(d);var b=d.length;if(2===b){for(;--b>-1;)ne(d[b],n,o,y,E),se(++s,o,y);if(v){var I=ue(r,l,_[o].linesIn,_[o].pointsIn);pe(I,r,n,o,y)}S()}else T(m)}else T(m)}function ke(e){var t=e.attributes.block_id.nodeValue,i=g.design.templateSourceTEMP.details,r=i.length;for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP));--r>0;)if(i[r].id===t){he(i[r].children[0],i),he(i[r].children[1],i),i[r].children.length=0,delete i[r].impost;break}S()}function Ge(e,t){for(var i=t.length;--i>-1;)0===t[i].x?t[i].x=e:t[i].x===e?t[i].x=0:t[i].x=e-t[i].x}function Be(e){4===e.positionQ?e.positionQ=2:2===e.positionQ&&(e.positionQ=4)}function Ve(e){4===e.positionQ?e.positionQ=3:2===e.positionQ?e.positionQ=1:1===e.positionQ?e.positionQ=2:3===e.positionQ&&(e.positionQ=4)}function Ue(e,t,i){var r,o,a=i[e].children.length;if(a)for(r=i[e].children.pop(),i[e].children.unshift(r),o=1;t>o;o+=1)i[o].id!==i[e].children[0]&&i[o].id!==i[e].children[1]||Ue(o,t,i)}function He(e,t,i){var r,o;for(o=1;i>o;o+=1){if(t[o].level&&t[o].pointsQ&&(r=t[o].pointsQ.length))for(;--r>-1;)t[o].pointsQ[r].id.indexOf("qa")+1?Be(t[o].pointsQ[r]):t[o].pointsQ[r].id.indexOf("qc")+1&&Ve(t[o].pointsQ[r]);if(t[o].impost&&(Ge(e,t[o].impost.impostAxis),t[o].impost.impostAxis[2])){var a={from:t[o].impost.impostAxis[0],to:t[o].impost.impostAxis[1]};u.setLineCoef(a),a.coefA&&a.coefB?Ve(t[o].impost.impostAxis[2]):Be(t[o].impost.impostAxis[2])}t[o].pointsOut.length&&Ge(e,t[o].pointsOut),t[o].pointsIn.length&&Ge(e,t[o].pointsIn)}}function Fe(){var e,t=g.design.templateSourceTEMP.details,r=t.length,o=u.collectAllPointsOut(g.design.templateTEMP.details),a=d3.max(o,function(e){return e.x});for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),He(a,t,r),e=1;r>e;e+=1)1===t[e].level&&Ue(e,r,t);S(),i(function(){g.design.activeMenuItem=0},500)}function ze(e,t,i){var r,o={x:t,y:i},a=0,n=0,s=e.length;for(r=0;s>r;r+=1)if(n=e[r+1]?u.setPointLocationToLine(e[r],e[r+1],o):u.setPointLocationToLine(e[r],e[0],o),n>0){a=n;break}return a}function Ye(){var e,t,i,r,o,a,n,s,l,d,c,p,m,f=g.design.templateSourceTEMP.details,_=f.length,h=g.design.templateTEMP.details,y=[],E=[];for(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),c=1;_>c;c+=1)1===f[c].level&&y.push(f[c].pointsOut.map(function(e){return e.x}));for(e=y.length,p=0;e>p;p+=1){for(E=[],t=d3.min(y[p]),i=d3.max(y[p]),c=1;_>c;c+=1)f[c].impost&&f[c].impost.impostAxis&&f[c].impost.impostAxis[0].x===f[c].impost.impostAxis[1].x&&f[c].impost.impostAxis[0].x>t&&f[c].impost.impostAxis[0].x<i&&(r={ind:c,x:f[c].impost.impostAxis[0].x},E.push(r));for(o=Math.round(i/(E.length+1)),a=E.sort(u.sortByX),n=a.length,m=0;n>m;m+=1)s=m?a[m-1].x+o:t+o,l=ze(h[a[m].ind].pointsOut,s,f[a[m].ind].impost.impostAxis[0].y),d=ze(h[a[m].ind].pointsOut,s,f[a[m].ind].impost.impostAxis[1].y),l||d||(a[m].x=s,f[a[m].ind].impost.impostAxis[0].x=s,f[a[m].ind].impost.impostAxis[1].x=s)}S()}function We(e,t){var i,r,o,a,n,s,l,d={imps:[]},c=e.pointsOut.filter(function(e){return"impost"===e.type||"shtulp"===e.type}),u=c.length;for(s=0;u>s;s+=1){for(i=0,r=0,l=0;u>l;l+=1)s!==l&&c[l].id===c[s].id&&(r=1,c[l].x===c[s].x&&(i=1));if(!r)break;if(i){for(o=1,a=d.imps.length;--a>-1;)d.imps[a].id===c[s].id&&(o=0);o&&d.imps.push(c[s])}}d.imps.length&&(n=e.glassPoints.map(function(e){return e.x}),d.minX=d3.min(n),d.maxX=d3.max(n),d.width=d.maxX-d.minX,t.push(d))}function $e(){var e,t,i,r,o,a,s,l,d,c,u,p,m,f,_,h,y,E,v,b,I,A=g.design.templateTEMP.details,T=A.length,x=g.design.templateSourceTEMP.details,N=g.design.selectedGlass.length,L=[];if(g.design.designSteps.push(angular.copy(g.design.templateSourceTEMP)),N)for(m=0;N>m;m+=1)for(e=g.design.selectedGlass[m].attributes.block_id.nodeValue,f=1;T>f;f+=1)A[f].id===e&&We(A[f],L);else for(f=1;T>f;f+=1)!A[f].children.length&&A[f].glassPoints&&We(A[f],L);if(t=L.length,i=n.roundingValue(L.reduce(function(e,t){return{width:e.width+t.width}}).width/t),2===t){r=L[0].imps.length,o=L[1].imps.length,a=0;e:for(_=0;r>_;_+=1)for(h=0;o>h;h+=1)if(L[1].imps[h].id===L[0].imps[_].id){a=L[1].imps[h].id;break e}}for(y=0;t>y;y+=1)for(s=L[y].imps.length,d=Math.round(i-L[y].width),E=0;s>E;E+=1)if(!L[y].imps[E].isChanged&&(c=0,2===t?L[y].imps[E].id===a&&(c=1):c=1,c))for(L[y].imps[E].x<L[y].maxX&&(d*=-1),L[y].imps[E].x+=d,v=0;t>v;v+=1)if(E!==v)for(l=L[v].imps.length,b=0;l>b;b+=1)y!==v&&L[v].imps[b].id===L[y].imps[E].id&&(L[v].imps[b].isChanged=1,L[v].width-=d);for(y=0;t>y;y+=1)for(s=L[y].imps.length,E=0;s>E;E+=1)if(!L[y].imps[E].isChanged)for(u=Number(L[y].imps[E].id.replace(/\D+/g,"")),I=1;T>I;I+=1)p=Number(x[I].id.replace(/\D+/g,"")),p===u&&x[I].impost&&(x[I].impost.impostAxis[0].x=+L[y].imps[E].x,x[I].impost.impostAxis[1].x=+L[y].imps[E].x);S()}function qe(){var e=g.design.designSteps.length-1;g.design.templateSourceTEMP=angular.copy(g.design.designSteps[e]),S(),g.design.designSteps.pop(),L(),A()}function Qe(){var e;g.design.doorConfig;R(1).then(function(){if(d.checkGlassSizes(g.design.templateTEMP),g.design.extraGlass.length)g.design.isGlassExtra=1;else if(e=d.checkSashInTemplate(g.design.templateSourceTEMP),e?(p.global.isSashesInTemplate||(p.global.isSashesInTemplate=1,f.product.hardware=p.global.hardwares[0][0]),d.checkHardwareSizes(g.design.templateTEMP)):(f.product.hardware={},f.product.hardware.id=0,p.global.isSashesInTemplate=0,g.design.extraHardware.length=0),g.design.extraHardware.length)g.design.isHardwareExtra=1;else{f.product.template_source=angular.copy(g.design.templateSourceTEMP),f.product.template=angular.copy(g.design.templateTEMP),d.setCurrentGlass(f.product,1),u.createSVGTemplateIcon(g.design.templateSourceTEMP,f.product.profileDepths).then(function(e){f.product.templateIcon=angular.copy(e)}),4===f.product.construction_type&&(f.product.profile=angular.copy(d.fineItemById(g.design.sashShapeList[f.product.door_sash_shape_id].profileId,p.global.profiles))),p.global.templatesSource[f.product.templateIndex]=angular.copy(f.product.template_source);var t=U();t&&l.getGridPrice(f.product.chosenAddElements[0]),d.preparePrice(f.product.template,f.product.profile.id,f.product.glass,f.product.hardware.id,f.product.lamination.lamination_in_id).then(function(){p.global.isChangedTemplate=1,F()})}})}function je(){A(),F()}var Ke=this,Xe=p.global.isDevice?"touchstart":"mousedown";return Ke.publicObj={setDefaultTemplate:H,designSaved:Qe,designCancel:je,setDefaultConstruction:q,initAllImposts:j,initAllGlass:J,initAllGlassXGlass:ee,initAllGlassXGrid:ie,initAllArcs:oe,initAllDimension:V,showAllDimension:Z,hideCornerMarks:y,deselectAllImpost:E,deselectAllArc:v,deselectAllGlass:b,rebuildSVGTemplate:S,createSash:me,deleteSash:ye,setCornerPoints:xe,setCurvCornerPoints:Ne,deleteCornerPoints:Le,createArc:Re,deleteArc:Pe,workingWithAllArcs:we,createImpost:Me,deleteImpost:ke,initMirror:Fe,positionAxises:Ye,positionGlasses:$e,removeAllEventsInSVG:x,removeGlassEventsInSVG:N,closeGlassSelectorDialog:te,setValueSize:w,deleteLastNumber:M,closeSizeCaclulator:R,hideSizeTools:A,stepBack:qe,setNewDoorParamValue:Y,setDoorConfigDefault:W},Ke.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("GeneralServ",["$filter","$window","$document","globalConstants","GlobalStor",function(e,t,i,r,o){function a(){o.global.startProgramm&&"main"===o.global.currOpenPage&&(o.global.startProgramm=0)}function n(){o.global.prevOpenPage=o.global.currOpenPage}function s(e,t){var i,r,o=t||2,a=typeof e,n="1";for(i=0;o>i;i+=1)n+="0";return n*=1,"string"===a?r=parseFloat((Math.round(parseFloat(e)*n)/n).toFixed(o)):"number"===a&&(r=parseFloat((Math.round(e*n)/n).toFixed(o))),r}function l(e,t){return e*t}function d(e,t){return s(e*(1-t/100))}function c(e,t){return e-t}function u(e){
return e.filter(function(e,t,i){return t===i.indexOf(e)})}function p(e){var t={minX:d3.min(e,function(e){return e.x}),maxX:d3.max(e,function(e){return e.x}),minY:d3.min(e,function(e){return e.y}),maxY:d3.max(e,function(e){return e.y})};return t}function g(e,t,i){o.global.isAlert=1,o.global.alertTitle=e||"",o.global.alertDescr=t||"",o.global.confirmAction=i}function m(e){o.global.confirmInActivity=e}function f(e){if(o.global.isDevice){var i=window.open(e);i.close()}else t.open(e)}var _=this,h=[{id:20,name:"add_elements.GRIDS",typeClass:"aux-grid",typeMenu:33,mainTypeMenu:55,delay:5*r.STEP},{id:21,name:"add_elements.VISORS",typeClass:"aux-visor",typeMenu:22,delay:6*r.STEP},{id:9,name:"add_elements.SPILLWAYS",typeClass:"aux-spillway",typeMenu:22,delay:6*r.STEP},{id:19,name:"add_elements.OUTSIDE",typeClass:"aux-outside",typeMenu:22,delay:10*r.STEP},{id:26,name:"add_elements.LOUVERS",typeClass:"aux-louver",typeMenu:11,mainTypeMenu:55,delay:15*r.STEP},{id:19,name:"add_elements.INSIDE",typeClass:"aux-inside",typeMenu:11,mainTypeMenu:55,delay:20*r.STEP},{id:12,name:"add_elements.CONNECTORS",typeClass:"aux-connectors",typeMenu:33,mainTypeMenu:55,delay:30*r.STEP},{id:27,name:"add_elements.FAN",typeClass:"aux-fan",typeMenu:33,mainTypeMenu:55,delay:31*r.STEP},{id:8,name:"add_elements.WINDOWSILLS",typeClass:"aux-windowsill",typeMenu:11,mainTypeMenu:55,delay:13*r.STEP},{id:24,name:"add_elements.HANDLELS",typeClass:"aux-handle",typeMenu:33,mainTypeMenu:55,delay:28*r.STEP},{id:18,name:"add_elements.OTHERS",typeClass:"aux-others",typeMenu:22,delay:31*r.STEP},{id:99,name:"add_elements.BLIND",typeClass:"aux-blind",typeMenu:22,delay:31*r.STEP},{id:9999,name:"add_elements.GRATING",typeClass:"aux-grating",typeMenu:22,delay:31*r.STEP},{id:999,name:"add_elements.SHUTTERS",typeClass:"aux-shutters",typeMenu:22,delay:31*r.STEP},{id:999,name:"add_elements.SHUTTERS",typeClass:"aux-shut",mainTypeMenu:55,delay:31*r.STEP},{id:9999,name:"add_elements.GRATING",typeClass:"aux-grat",mainTypeMenu:55,delay:31*r.STEP},{id:21,name:"add_elements.VISORS",typeClass:"aux-vis",mainTypeMenu:55,delay:31*r.STEP},{id:9,name:"add_elements.SPILLWAYS",typeClass:"aux-spil",mainTypeMenu:55,delay:31*r.STEP}];return t.addEventListener("keydown",function(e){8!==e.keyCode||$(e.target).is("input, textarea")||e.preventDefault()}),_.publicObj={addElementDATA:h,stopStartProg:a,setPreviosPage:n,roundingValue:s,addMarginToPrice:l,setPriceDis:d,sorting:c,removeDuplicates:u,getMaxMinCoord:p,confirmAlert:g,goToLink:f,confirmPath:m},_.publicObj}])}(),function(){angular.module("HistoryModule").factory("HistoryServ",["$location","$filter","$q","globalConstants","localDB","GeneralServ","MainServ","RecOrderServ","SVGServ","DesignServ","GlobalStor","OrderStor","ProductStor","UserStor","HistoryStor","CartStor","DesignStor",function(e,t,i,r,o,a,n,s,l,d,c,u,p,g,m,f,_){function h(){a.setPreviosPage(),c.global.isCreatedNewProduct&&c.global.isCreatedNewProject?e.path("/main"):n.createNewProject()}function y(){o.selectLocalDB(o.tablesLocalDB.orders.tableName,{order_type:1}).then(function(e){var t=angular.copy(e),i=t.length;if(m.history.isEmptyResult=0,i){for(;--i>-1;)t[i].created=new Date(t[i].created),t[i].delivery_date=new Date(t[i].delivery_date),t[i].new_delivery_date=new Date(t[i].new_delivery_date),t[i].order_date=new Date(t[i].order_date);m.history.ordersSource=angular.copy(t),m.history.orders=angular.copy(t)}else m.history.isEmptyResult=1})}function E(e,i){function r(){var e,t=m.history.orders.length;for(e=0;t>e;e+=1)m.history.orders[e].id===i&&(m.history.orders[e].order_style=U,m.history.ordersSource[e].order_style=U,o.updateLocalServerDBs(o.tablesLocalDB.orders.tableName,i,{order_style:U,sended:new Date}))}e!==V&&g.userInfo.code_sync.length&&"null"!==g.userInfo.code_sync&&a.confirmAlert(t("translate")("common_words.SEND_ORDER_TITLE"),t("translate")("common_words.SEND_ORDER_TXT"),r)}function v(e,i,r){function l(e,t,i){o.selectLocalDB(i,{order_id:e}).then(function(e){if(e.length){var r,a=angular.copy(e),n=a.length;if(n>0)for(r=0;n>r;r+=1)delete a[r].id,a[r].modified=new Date,a[r].order_id=t,o.insertRowLocalDB(a[r],i),o.insertServer(g.userInfo.phone,g.userInfo.device_code,i,a[r])}else console.log("Empty result = ",e)})}function d(){var e,t,r=m.history.orders.length;for(t=0;r>t;t+=1)m.history.orders[t].id===i&&(e=angular.copy(m.history.orders[t]));e.id=n.createOrderID(),e.order_number=0,e.order_hz="---",e.created=new Date,e.modified=new Date,o.insertServer(g.userInfo.phone,g.userInfo.device_code,o.tablesLocalDB.orders.tableName,e).then(function(t){t.status&&(e.order_number=t.order_number),m.history.orders.push(e),m.history.ordersSource.push(e),o.insertRowLocalDB(e,o.tablesLocalDB.orders.tableName)}),l(i,e.id,o.tablesLocalDB.order_products.tableName),l(i,e.id,o.tablesLocalDB.order_addelements.tableName),c.global.isBox=!c.global.isBox}function u(){c.global.isEditBox=!c.global.isEditBox,s.box()}c.global.isBox=!c.global.isBox,m.history.orderEditNumber=i,x(),b(),e!==V&&(a.confirmAlert(t("translate")("common_words.EDIT_COPY_TXT"),t("translate")("common_words.SPACE"),u),a.confirmPath(d))}function b(){i.defer();x().then(function(e){m.history.isBoxArray=angular.copy(e),m.history.isBoxArrayCopy=angular.copy(e)})}function I(e,i){function r(){var t,r;e?(t=m.history.orders,r=m.history.ordersSource):(t=m.history.drafts,r=m.history.draftsSource);for(var a=t.length;--a>-1;)if(t[a].id===i){t.splice(a,1),r.splice(a,1);break}t.length||(m.history.isEmptyResult=1),n.deleteOrderInDB(i),e&&o.deleteOrderServer(g.userInfo.phone,g.userInfo.device_code,i)}a.confirmAlert(t("translate")("common_words.DELETE_ORDER_TITLE"),t("translate")("common_words.DELETE_ORDER_TXT"),r)}function A(e,t,i){if(t)for(var r=i.length;--r>-1;)if(i[r].id===t)switch(e){case 1:u.order.floorName=angular.copy(i[r].name);break;case 2:u.order.mountingName=angular.copy(i[r].name);break;case 3:u.order.selectedInstalmentPeriod=angular.copy(i[r].name),u.order.selectedInstalmentPercent=angular.copy(i[r].value)}}function S(e,t){var i=c.global.glassesAll.filter(function(t){return t.profileId===e.profile.id});i.length&&e.glass.unshift(n.fineItemById(t,i[0].glasses))}function T(){var e=i.defer();return o.selectLocalDB(o.tablesLocalDB.order_products.tableName,{order_id:c.global.orderEditNumber}).then(function(t){var r=angular.copy(t);if(r.length){var o=r.map(function(e){var t,r=i.defer(),o=p.setDefaultProduct();return angular.extend(o,e),delete o.id,delete o.modified,o.is_addelem_only?r.resolve(o):(o.template_source=JSON.parse(o.template_source),4===o.construction_type?c.global.noDoorExist?(_.design.isNoDoors=1,r.reject(1)):(d.setDoorConfigDefault(o),_.design=_.setDefaultDesign(),t=_.design.sashShapeList[o.door_sash_shape_id].profileId):t=o.profile_id,n.setCurrentProfile(o,t).then(function(){if(o.glass_id){var e=o.glass_id.split(", "),t=e.length;if(t)for(;--t>-1;)S(o,+e[t])}c.global.isSashesInTemplate=n.checkSashInTemplate(o.template_source),n.setCurrentHardware(o,o.hardware_id),n.setCurrLamination(o,o.lamination_id),delete o.lamination_id,delete o.lamination_in_id,delete o.lamination_out_id,r.resolve(o)})),r.promise});i.all(o).then(function(t){var r=t.map(function(e){var t=i.defer();return e.is_addelem_only?(e.addelemPriceDis=a.setPriceDis(e.addelem_price,u.order.discount_addelem),e.productPriceDis=a.setPriceDis(e.template_price,u.order.discount_construct)+e.addelemPriceDis,u.order.products.push(e),t.resolve(1)):l.createSVGTemplateIcon(e.template_source,e.profileDepths).then(function(i){e.templateIcon=i,delete e.profile_id,delete e.glass_id,delete e.hardware_id,e.addelemPriceDis=a.setPriceDis(e.addelem_price,u.order.discount_addelem),e.productPriceDis=a.setPriceDis(e.template_price,u.order.discount_construct)+e.addelemPriceDis,u.order.products.push(e),t.resolve(1)}),t.promise});e.resolve(i.all(r))})}else e.reject(r)}),e.promise}function x(){var e=i.defer();return o.selectLocalDB(o.tablesLocalDB.order_products.tableName,{order_id:m.history.orderEditNumber},"profile_id, glass_id, addelem_price, hardware_id, product_id, order_id, template_source, lamination_id, lamination_out_id, lamination_in_id").then(function(t){e.resolve(t)}),e.promise}function N(){var e=i.defer();return o.selectLocalDB(o.tablesLocalDB.order_addelements.tableName,{order_id:c.global.orderEditNumber}).then(function(t){var i,r,o=angular.copy(t),n=o.length,s=u.order.products.length;if(n)for(;--n>-1;)for(i=0;s>i;i+=1)o[n].product_id===u.order.products[i].product_id&&(r=o[n].element_type,o[n].id=angular.copy(o[n].element_id),delete o[n].element_id,delete o[n].modified,o[n].elementPriceDis=a.setPriceDis(o[n].element_price,u.order.discount_addelem),o[n].list_group_id=a.addElementDATA[r].id,u.order.products[i].chosenAddElements[r].push(o[n]),n||e.resolve(1));else e.resolve(1)}),e.promise}function L(t,i){c.global.isLoader=1,c.global.orderEditNumber=i,u.order=u.setDefaultOrder();for(var r=t?m.history.orders.length:m.history.drafts.length;--r>-1;)t?m.history.orders[r].id===i&&(angular.extend(u.order,m.history.orders[r]),f.fillOrderForm()):m.history.drafts[r].id===i&&(angular.extend(u.order,m.history.drafts[r]),f.fillOrderForm());u.order.order_date=new Date(u.order.order_date).getTime(),u.order.delivery_date=new Date(u.order.delivery_date).getTime(),u.order.new_delivery_date=new Date(u.order.new_delivery_date).getTime(),A(1,u.order.floor_id,c.global.supplyData),A(2,u.order.mounting_id,c.global.assemblingData),A(3,u.order.instalment_id,c.global.instalmentsData),delete u.order.additional_payment,delete u.order.created,delete u.order.sended,delete u.order.state_to,delete u.order.state_buch,delete u.order.batch,delete u.order.base_price,delete u.order.factory_margin,delete u.order.purchase_price,delete u.order.sale_price,delete u.order.modified,T().then(function(){N().then(function(){c.global.isConfigMenu=1,c.global.isNavMenu=0,a.setPreviosPage(),c.global.isLoader=0,e.path("/cart")})})}function D(){o.selectLocalDB(o.tablesLocalDB.orders.tableName,{order_type:0}).then(function(e){var t=angular.copy(e),i=t.length;if(m.history.isEmptyResultDraft=0,i){for(;--i>-1;)t[i].created=new Date(t[i].created),t[i].delivery_date=new Date(t[i].delivery_date),t[i].new_delivery_date=new Date(t[i].new_delivery_date),t[i].order_date=new Date(t[i].order_date);m.history.draftsSource=angular.copy(t),m.history.drafts=angular.copy(t)}else m.history.isEmptyResultDraft=1})}function C(){m.history.isOrderDate=0,m.history.isOrderDateDraft=0,m.history.isDraftView=!m.history.isDraftView,m.history.drafts.length||D()}function O(e){var t=r.printIP+e+"?userId="+g.userInfo.id;navigator.onLine?a.goToLink(t):m.history.isNoPrint=1}function R(){m.history.isOrderSearch=1,m.history.isOrderDate=0,m.history.isOrderSort=0}function P(e,t,i){var r,o,a,n,s;if(""!==t||""!==i){if(r=angular.copy(e),o=new Date(t).valueOf(),a=new Date(i).valueOf(),""!==t&&""!==i&&o>a)return!1;for(n=r.length-1;n>=0;n-=1)s=new Date(r[n].created).valueOf(),(o>s||s>a)&&r.splice(n,1);return r}return!1}function w(){var e;m.history.isDraftView?(m.history.isOrderDateDraft&&(e=P(m.history.draftsSource,m.history.startDateDraft,m.history.finishDateDraft),e&&(m.history.drafts=e)),m.history.isOrderDateDraft=!m.history.isOrderDateDraft,m.history.isOrderSortDraft=0):(m.history.isOrderDate&&(e=P(m.history.ordersSource,m.history.startDate,m.history.finishDate),e&&(m.history.orders=e)),m.history.isOrderDate=!m.history.isOrderDate,m.history.isOrderSearch=0,m.history.isOrderSort=0)}function M(e){m.history.isDraftView?"start-date"!==e||m.history.isStartDateDraft?"finish-date"!==e||m.history.isFinishDateDraft?"full-date"!==e||m.history.isAllPeriodDraft?(m.history.isStartDateDraft=0,m.history.isFinishDateDraft=0,m.history.isAllPeriodDraft=0):(m.history.isStartDateDraft=0,m.history.isFinishDateDraft=0,m.history.isAllPeriodDraft=1,m.history.startDateDraft="",m.history.finishDateDraft="",m.history.drafts=angular.copy(m.history.draftsSource)):(m.history.isStartDateDraft=0,m.history.isFinishDateDraft=1,m.history.isAllPeriodDraft=0):(m.history.isStartDateDraft=1,m.history.isFinishDateDraft=0,m.history.isAllPeriodDraft=0):"start-date"!==e||m.history.isStartDate?"finish-date"!==e||m.history.isFinishDate?"full-date"!==e||m.history.isAllPeriod?(m.history.isStartDate=0,m.history.isFinishDate=0,m.history.isAllPeriod=0):(m.history.isStartDate=0,m.history.isFinishDate=0,m.history.isAllPeriod=1,m.history.startDate="",m.history.finishDate="",m.history.orders=angular.copy(m.history.ordersSource)):(m.history.isStartDate=0,m.history.isFinishDate=1,m.history.isAllPeriod=0):(m.history.isStartDate=1,m.history.isFinishDate=0,m.history.isAllPeriod=0)}function k(){m.history.isDraftView?(m.history.isOrderSortDraft=!m.history.isOrderSortDraft,m.history.isOrderDateDraft=0):(m.history.isOrderSort=!m.history.isOrderSort,m.history.isOrderSearch=0,m.history.isOrderDate=0)}function G(e,t){m.history.isDraftView?m.history.isSortTypeDraft===t?(m.history.isSortTypeDraft=0,m.history.reverseDraft=1):(m.history.isSortTypeDraft=t,"first"===m.history.isSortTypeDraft&&(m.history.reverseDraft=1),"last"===m.history.isSortTypeDraft&&(m.history.reverseDraft=0)):e?m.history.isFilterType===t?m.history.isFilterType=void 0:m.history.isFilterType=t:m.history.isSortType===t?(m.history.orders=angular.copy(m.history.ordersSource),m.history.isSortType="last"):m.history.isSortType=t}var B=this,V="master",U="done";return B.publicObj={toCurrentCalculation:h,downloadOrders:y,sendOrderToFactory:E,makeOrderCopy:v,clickDeleteOrder:I,editOrder:L,orderPrint:O,orderItem:b,viewSwitching:C,downloadProducts1:x,orderSearching:R,orderDateSelecting:w,openCalendarScroll:M,orderSorting:k,sortingInit:G},B.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("AsyncLoader",["$http","$q","globalConstants",function(e,t,i){return function(r){var o,a=t.defer(),n=i.localPath+r.key+".json";return isDevice?(o=window.location.href.replace("index.html",""),$.getJSON(o+n,function(e){a.resolve(e)})):e.get(n).then(function(e){a.resolve(e.data)},function(){console.log("Something went wrong with language json"),a.reject(r.key)}),a.promise}}])}(),function(){angular.module("BauVoiceApp").factory("localDB",["$http","$q","$filter","globalConstants","GeneralServ","UserStor","GlobalStor",function(e,t,i,r,o,a,n){function s(e){var i=Object.keys(e),r=i.map(function(e){var i=t.defer();return X.transaction(function(t){t.executeSql("DROP TABLE IF EXISTS "+e,[],function(){i.resolve(1)},function(){console.log("not find deleting table"),i.resolve(0)})}),i.promise});return t.all(r)}function l(e){var i=Object.keys(e),r=i.map(function(e){var i=t.defer();return X.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+Z[e].tableName+" (id INTEGER PRIMARY KEY AUTOINCREMENT, "+Z[e].prop+", modified TIMESTAMP DEFAULT CURRENT_TIMESTAMP"+Z[e].foreignKey+")",[],function(){i.resolve(1)},function(){console.log("Something went wrong with creating table "+Z[e].tableName),i.resolve(0)})}),i.promise});return t.all(r)}function d(e){return angular.isString(e)&&e.indexOf("'")+1?e.replace(/'/g,"''"):e}function c(e,t){var i=Object.keys(e),r=i.join(", "),o=i.map(function(t){return e[t]=d(e[t]),"'"+e[t]+"'"}).join(", ");X.transaction(function(e){e.executeSql("INSERT INTO "+t+" ("+r+") VALUES ("+o+")",[],null,function(){console.log("Something went wrong with insert into "+t)})})}function u(e){var i=[],r=Object.keys(e.tables),o=r.length;return X.transaction(function(a){var n;for(n=0;o>n;n+=1){var s,l=e.tables[r[n]].fields.join(", "),c=e.tables[r[n]].rows.length;if(c)for(s=0;c>s;s+=1){var u=t.defer(),p=e.tables[r[n]].rows[s].map(function(e){return e=d(e),"'"+e+"'"}).join(", ");a.executeSql("INSERT INTO "+r[n]+" ("+l+") VALUES ("+p+")",[],function(){u.resolve(1)},function(e){console.log("Error!!! ",e,r[n],l),u.resolve(0)}),i.push(u.promise)}}}),t.all(i)}function p(e,i,r){var o=t.defer(),a=r||"*",n="";if(i){n=" WHERE ";var s=Object.keys(i);n+=s[0]+" = '"+i[s[0]]+"'";var l,d=s.length;if(d>1)for(l=1;d>l;l+=1)n+=" AND "+s[l]+" = '"+i[s[l]]+"'"}return X.transaction(function(t){t.executeSql("SELECT "+a+" FROM "+e+n,[],function(e,t){var i=t.rows.length;if(i){var r,a=[];for(r=0;i>r;r+=1)a.push(t.rows.item(r));o.resolve(a)}else o.resolve(0)},function(e,t){0===Object.keys(e).length&&5===t.code&&o.resolve(0)})}),o.promise}function g(e,t,i){var r,o,a="",n=Object.keys(t),s=n.length,l=Object.keys(i),d=l.length,c="";if(s)for(r=0;s>r;r+=1)c+=r?", "+n[r]+" = '"+t[n[r]]+"'":n[r]+" = '"+t[n[r]]+"'";if(d&&(a=" WHERE ",a+=l[0]+" = '"+i[l[0]]+"'",d>1))for(o=1;d>o;o+=1)a+=" AND "+l[o]+" = '"+i[l[o]]+"'";X.transaction(function(t){t.executeSql("UPDATE "+e+" SET "+c+a,[],function(){},function(){console.log("Something went wrong with updating "+e+" record")})})}function m(e,t){var i="";if(t){var r,o=Object.keys(t),a=o.length;if(i=" WHERE "+o[0]+" = '"+t[o[0]]+"'",a>1)for(r=1;a>r;r+=1)i+=" AND "+o[r]+" = '"+t[o[r]]+"'"}X.transaction(function(t){t.executeSql("DELETE FROM "+e+i,[],null,function(){console.log("Something went wrong with insert into "+e)})})}function f(i,o){var a=t.defer(),n=o?"/api/login?type=1":"/api/login";return e.post(r.serverIP+n,{login:i}).then(function(e){a.resolve(e.data)},function(){console.log("Something went wrong with User recive!"),a.resolve({status:0})}),a.promise}function _(i,o){var a=t.defer();return e.get(r.serverIP+"/api/get/locations?login="+i+"&access_token="+o).then(function(e){e.data.status?u(e.data).then(function(){a.resolve(1)}):(console.log("Error!"),a.resolve(0))},function(){console.log("Something went wrong with Location!"),a.resolve(0)}),a.promise}function h(i,o,a){var n=t.defer();return e.get(r.serverIP+"/api/get/factories-by-country?login="+i+"&access_token="+o+"&cities_ids="+a).then(function(e){n.resolve(e.data)},function(){console.log("Something went wrong with get factories!"),n.resolve({status:0})}),n.promise}function y(i,o){var a=t.defer();return console.log("Import database begin!"),e.get(r.serverIP+"/api/sync?login="+i+"&access_token="+o).then(function(e){console.log("importAllDB+++",e),e.data.status?u(e.data).then(function(){a.resolve(1)}):(console.log("Error!"),a.resolve(0))},function(){console.log("Something went wrong with importing Database!"),a.resolve(0)}),a.promise}function E(i,o,a,n){var s=t.defer(),l={model:a,row:JSON.stringify(n)};return e.post(r.serverIP+"/api/insert?login="+i+"&access_token="+o,l).then(function(e){console.log("send changes to server success:",e),s.resolve(e.data)},function(e){console.log("send changes to server failed"),s.resolve(e.data)}),s.promise}function v(i,o,a){var n=a.map(function(a){var n=t.defer();return e.post(r.serverIP+"/api/update?login="+i+"&access_token="+o,a).then(function(e){console.log("send changes to server success:",e),n.resolve(1)},function(){console.log("send changes to server failed"),n.resolve(0)}),n.promise});return t.all(n)}function b(t){e.post(r.serverIP+"/api/register",t).then(function(e){console.log(e)},function(){console.log("Something went wrong when user creating!")})}function I(t,i){var o=new Date;e.get(r.serverIP+"/api/signed?login="+t+"&access_token="+i+"&date="+o).then(function(){console.log("Sucsess!")},function(){console.log("Something went wrong!")})}function A(t,i,o){var a={orderId:+o};e.post(r.serverIP+"/api/remove-order?login="+t+"&access_token="+i,a).then(function(e){console.log(e.data)},function(){console.log("Something went wrong with order delete!")})}function S(e,i,r){var o=t.defer(),n=[{model:e,rowId:i,field:JSON.stringify(r)}];return g(e,r,{id:i}),v(a.userInfo.phone,a.userInfo.device_code,n).then(function(e){e||c(n,Z["export"].tableName),o.resolve(1)}),o.promise}function T(i){var o=t.defer();e.post(r.serverIP+"/api/load-avatar",i,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(e){console.log("send changes to server success:",e),o.resolve(1)},function(){console.log("send changes to server failed"),o.resolve(0)})}function x(e){function t(e,t){return e<<t|e>>>32-t}function i(e,t){var i,r,o,a,n;return o=2147483648&e,a=2147483648&t,i=1073741824&e,r=1073741824&t,n=(1073741823&e)+(1073741823&t),i&r?2147483648^n^o^a:i|r?1073741824&n?3221225472^n^o^a:1073741824^n^o^a:n^o^a}function r(e,t,i){return e&t|~e&i}function o(e,t,i){return e&i|t&~i}function a(e,t,i){return e^t^i}function n(e,t,i){return t^(e|~i)}function s(e,o,a,n,s,l,d){return e=i(e,i(i(r(o,a,n),s),d)),i(t(e,l),o)}function l(e,r,a,n,s,l,d){return e=i(e,i(i(o(r,a,n),s),d)),i(t(e,l),r)}function d(e,r,o,n,s,l,d){return e=i(e,i(i(a(r,o,n),s),d)),i(t(e,l),r)}function c(e,r,o,a,s,l,d){return e=i(e,i(i(n(r,o,a),s),d)),i(t(e,l),r)}function u(e){for(var t,i=e.length,r=i+8,o=(r-r%64)/64,a=16*(o+1),n=Array(a-1),s=0,l=0;i>l;)t=(l-l%4)/4,s=l%4*8,n[t]=n[t]|e.charCodeAt(l)<<s,l+=1;return t=(l-l%4)/4,s=l%4*8,n[t]=n[t]|128<<s,n[a-2]=i<<3,n[a-1]=i>>>29,n}function p(e){var t,i,r="",o="";for(i=0;3>=i;i+=1)t=e>>>8*i&255,o="0"+t.toString(16),r+=o.substr(o.length-2,2);return r}function g(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i+=1){var r=e.charCodeAt(i);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}var m,f,_,h,y,E,v,b,I,A=Array(),S=7,T=12,x=17,N=22,L=5,D=9,C=14,O=20,R=4,P=11,w=16,M=23,k=6,G=10,B=15,V=21;for(e=g(e),A=u(e),E=1732584193,v=4023233417,b=2562383102,I=271733878,m=0;m<A.length;m+=16)f=E,_=v,h=b,y=I,E=s(E,v,b,I,A[m+0],S,3614090360),I=s(I,E,v,b,A[m+1],T,3905402710),b=s(b,I,E,v,A[m+2],x,606105819),v=s(v,b,I,E,A[m+3],N,3250441966),E=s(E,v,b,I,A[m+4],S,4118548399),I=s(I,E,v,b,A[m+5],T,1200080426),b=s(b,I,E,v,A[m+6],x,2821735955),v=s(v,b,I,E,A[m+7],N,4249261313),E=s(E,v,b,I,A[m+8],S,1770035416),I=s(I,E,v,b,A[m+9],T,2336552879),b=s(b,I,E,v,A[m+10],x,4294925233),v=s(v,b,I,E,A[m+11],N,2304563134),E=s(E,v,b,I,A[m+12],S,1804603682),I=s(I,E,v,b,A[m+13],T,4254626195),b=s(b,I,E,v,A[m+14],x,2792965006),v=s(v,b,I,E,A[m+15],N,1236535329),E=l(E,v,b,I,A[m+1],L,4129170786),I=l(I,E,v,b,A[m+6],D,3225465664),b=l(b,I,E,v,A[m+11],C,643717713),v=l(v,b,I,E,A[m+0],O,3921069994),E=l(E,v,b,I,A[m+5],L,3593408605),I=l(I,E,v,b,A[m+10],D,38016083),b=l(b,I,E,v,A[m+15],C,3634488961),v=l(v,b,I,E,A[m+4],O,3889429448),E=l(E,v,b,I,A[m+9],L,568446438),I=l(I,E,v,b,A[m+14],D,3275163606),b=l(b,I,E,v,A[m+3],C,4107603335),v=l(v,b,I,E,A[m+8],O,1163531501),E=l(E,v,b,I,A[m+13],L,2850285829),I=l(I,E,v,b,A[m+2],D,4243563512),b=l(b,I,E,v,A[m+7],C,1735328473),v=l(v,b,I,E,A[m+12],O,2368359562),E=d(E,v,b,I,A[m+5],R,4294588738),I=d(I,E,v,b,A[m+8],P,2272392833),b=d(b,I,E,v,A[m+11],w,1839030562),v=d(v,b,I,E,A[m+14],M,4259657740),E=d(E,v,b,I,A[m+1],R,2763975236),I=d(I,E,v,b,A[m+4],P,1272893353),b=d(b,I,E,v,A[m+7],w,4139469664),v=d(v,b,I,E,A[m+10],M,3200236656),E=d(E,v,b,I,A[m+13],R,681279174),I=d(I,E,v,b,A[m+0],P,3936430074),b=d(b,I,E,v,A[m+3],w,3572445317),v=d(v,b,I,E,A[m+6],M,76029189),E=d(E,v,b,I,A[m+9],R,3654602809),I=d(I,E,v,b,A[m+12],P,3873151461),b=d(b,I,E,v,A[m+15],w,530742520),v=d(v,b,I,E,A[m+2],M,3299628645),E=c(E,v,b,I,A[m+0],k,4096336452),I=c(I,E,v,b,A[m+7],G,1126891415),b=c(b,I,E,v,A[m+14],B,2878612391),v=c(v,b,I,E,A[m+5],V,4237533241),E=c(E,v,b,I,A[m+12],k,1700485571),I=c(I,E,v,b,A[m+3],G,2399980690),b=c(b,I,E,v,A[m+10],B,4293915773),v=c(v,b,I,E,A[m+1],V,2240044497),E=c(E,v,b,I,A[m+8],k,1873313359),I=c(I,E,v,b,A[m+15],G,4264355552),b=c(b,I,E,v,A[m+6],B,2734768916),v=c(v,b,I,E,A[m+13],V,1309151649),E=c(E,v,b,I,A[m+4],k,4149444226),I=c(I,E,v,b,A[m+11],G,3174756917),b=c(b,I,E,v,A[m+2],B,718787259),v=c(v,b,I,E,A[m+9],V,3951481745),E=i(E,f),v=i(v,_),b=i(b,h),I=i(I,y);var U=p(E)+p(v)+p(b)+p(I);return U.toLowerCase()}function N(e,i,r){var o=t.defer();return p(Z.window_hardwares.tableName,{window_hardware_group_id:e}).then(function(e){var t,a,n,s,l,d,c=e.length,u=[],p=i.length;if(c){for(l=0;p>l;l+=1){for(t=angular.copy(e),a=[],n=[],s=i[l].openDir.length,d=0;s>d;d+=1)4===i[l].openDir[d]?i[l].openDir[d]=2:2===i[l].openDir[d]?i[l].openDir[d]=3:i[l].openDir[d]=1;a=t.filter(function(e){if(e.window_hardware_type_id==i[l].type&&(e.window_hardware_color_id==r||!e.window_hardware_color_id)){if(1==s)return e.direction_id==i[l].openDir[0]||1==e.direction_id;if(2==s)return e.direction_id==i[l].openDir[0]||e.direction_id==i[l].openDir[1]||1==e.direction_id}}),n=a.filter(function(e){if(e.min_width&&e.max_width&&!e.min_height&&!e.max_height){if(i[l].sizes[0]>=e.min_width&&i[l].sizes[0]<=e.max_width)return e}else if(!e.min_width&&!e.max_width&&e.min_height&&e.max_height){if(i[l].sizes[1]>=e.min_height&&i[l].sizes[1]<=e.max_height)return e}else if(e.min_width&&e.max_width&&e.min_height&&e.max_height){if(i[l].sizes[1]>=e.min_height&&i[l].sizes[1]<=e.max_height&&i[l].sizes[0]>=e.min_width&&i[l].sizes[0]<=e.max_width)return e}else if(!(e.min_width||e.max_width||e.min_height||e.max_height))return e}),u.push(n)}u.length?o.resolve(u):o.resolve(0)}else o.resolve(0)}),o.promise}function L(e){var i=t.defer(),r=e.sizes.map(function(i,r,o){var a=t.defer();if(i.length&&e.ids[r])if(r===o.length-1)N(e.ids[r],i,e.laminationId).then(function(e){e.length?a.resolve(e):a.resolve(0)});else if(angular.isArray(e.ids[r])){var n=e.ids[r].map(function(e){var i=t.defer();return p(Z.lists.tableName,{id:e},"id, parent_element_id, name, waste, amendment_pruning").then(function(e){e.length?i.resolve(e):i.resolve(0)}),i.promise});t.all(n).then(function(e){var t,i=angular.copy(e),r=i.length,o=[];for(t=0;r>t;t+=1)i[t]&&(i[t][0].amendment_pruning&&(i[t][0].amendment_pruning/=1e3),o.push(i[t][0]));o.length>1?a.resolve(o):1===o.length?a.resolve(o[0]):a.resolve(0)})}else p(Z.lists.tableName,{id:e.ids[r]},"id, parent_element_id, name, waste, amendment_pruning").then(function(e){var t=angular.copy(e);t&&t.length?(t[0].amendment_pruning&&(t[0].amendment_pruning/=1e3),a.resolve(t[0])):a.resolve(0)});else a.resolve(0);return a.promise});return i.resolve(t.all(r)),i.promise}function D(e){var i=t.defer();return p(Z.lists.tableName,{id:e},"parent_element_id, name, waste, amendment_pruning").then(function(e){var t=angular.copy(e);t&&t.length?(t[0].amendment_pruning&&(t[0].amendment_pruning/=1e3),i.resolve(t[0])):i.resolve(0)}),i.promise}function C(e){var i=t.defer(),r=[],o=[];return angular.isArray(e)?r=e:r.push(e),function a(){if(r.length){var e=r.shift(0),t=0;t="object"==typeof e?e.childId:e,p(Z.list_contents.tableName,{parent_list_id:t}).then(function(t){var i,n=t.length;if(n)for(i=0;n>i;i+=1)if("object"==typeof e&&(t[i].parentId=e.parentId),o.push(t[i]),"list"===t[i].child_type){var s={childId:t[i].child_id,parentId:t[i].id};r.push(s)}a()})}else o.length?i.resolve(o):i.resolve(0)}(),i.promise}function O(e){var i=t.defer(),r=e.map(function(e,i,r){var o=t.defer();if(e)if(angular.isArray(e)){var a=e.map(function(e){var o=t.defer();if(i===r.length-1){if(angular.isArray(e)){var a=e.map(function(e){var i=t.defer();return C(e.child_id).then(function(e){e.length?i.resolve(e):i.resolve(0)}),i.promise});o.resolve(t.all(a))}}else C(e.id).then(function(e){e.length?o.resolve(e):o.resolve(0)});return o.promise});t.all(a).then(function(e){var t,i=e.length,r=[];if(i)for(t=0;i>t;t+=1)angular.isArray(e[t])?r.push(e[t]):e[t][0]?r.push(e[t][0]):r.push(e[t]);r.length?o.resolve(r):o.resolve(0)})}else{var n=0;n=i===r.length-1?e.child_id:e.id,n?C(n).then(function(e){e.length?o.resolve(e):o.resolve(0)}):o.resolve(0)}else o.resolve(0);return o.promise});return i.resolve(t.all(r)),i.promise}function R(e,i){var r=t.defer();return p(Z.elements.tableName,{id:i},"id, sku, currency_id, price, name, element_group_id").then(function(t){t.length?e?r.resolve(t):r.resolve(t[0]):r.resolve(0)}),r.promise}function P(e){var i=t.defer(),r=e.map(function(e,i,r){var o=t.defer();if(e)if(angular.isArray(e)){var a=e.map(function(e){var o=t.defer();if(i===r.length-1){if(angular.isArray(e)){var a=e.map(function(e){var i=t.defer();return"element"===e.child_type?i.resolve(R(1,e.child_id)):D(e.child_id).then(function(t){angular.extend(e,t),i.resolve(R(1,t.parent_element_id))}),i.promise});o.resolve(t.all(a))}}else o.resolve(R(0,e.parent_element_id));return o.promise});t.all(a).then(function(e){var t,r=e.length,a=[];if(r)if(5===i||6===i)a=e;else for(t=0;r>t;t+=1)if(e[t])if(angular.isArray(e[t])){var n,s=[],l=e[t].length;for(n=0;l>n;n+=1)e[t][n]&&s.push(e[t][n][0]);a.push(s)}else a.push(e[t][0]);a.length?o.resolve(a):o.resolve(0)})}else i===r.length-1?"element"===e.child_type?o.resolve(R(0,e.child_id)):D(e.child_id).then(function(t){angular.extend(e,t),o.resolve(R(0,t.parent_element_id))}):o.resolve(R(0,e.parent_element_id));else o.resolve(0);return o.promise});return i.resolve(t.all(r)),i.promise}function w(e){var i=t.defer();if(e.length){var r=e.map(function(e){var i=t.defer();if(e&&e.length){var r=e.map(function(e){var i=t.defer();if(angular.isArray(e)){var r=e.map(function(e){var i=t.defer();if(e)if(angular.isArray(e)){var r=e.map(function(e){var i=t.defer();return e?"element"===e.child_type?i.resolve(R(0,e.child_id)):D(e.child_id).then(function(t){angular.extend(e,t),i.resolve(R(0,t.parent_element_id))}):i.resolve(0),i.promise});i.resolve(t.all(r))}else"element"===e.child_type?i.resolve(R(0,e.child_id)):D(e.child_id).then(function(t){angular.extend(e,t),i.resolve(R(0,t.parent_element_id))});else i.resolve(0);return i.promise});i.resolve(t.all(r))}else e?"element"===e.child_type?i.resolve(R(0,e.child_id)):D(e.child_id).then(function(t){angular.extend(e,t),i.resolve(R(0,t.parent_element_id))}):i.resolve(0);return i.promise});i.resolve(t.all(r))}else i.resolve(0);return i.promise});i.resolve(t.all(r))}else i.resolve(0);return i.promise}function M(e,t){var i,r,o,s=n.global.currencies.length;if(s)for(i=0;s>i;i+=1)n.global.currencies[i].id===a.userInfo.currencyId&&(r=i),n.global.currencies[i].id===t&&(o=i);return n.global.currencies[r]&&n.global.currencies[o]&&(e*=n.global.currencies[o].value),e}function k(e,t,r,n,s,l,d){var c,u=0,p=0,g=0,m=1,f={},_=t.waste?1+t.waste/100:1;if(6===e){for(c=0;s>c;c+=1)if(n[c].elemId===t.id)for(var h=n[c].sizes.length;--h>-1;)f=angular.copy(r),p=n[c].sizes[h]+t.amendment_pruning,u=p*f.price*_,a.userInfo.currencyId!=f.currency_id&&(u=M(u,f.currency_id)),f.qty=angular.copy(m),f.size=o.roundingValue(p,3),f.priceReal=o.roundingValue(u,3),l.priceTotal+=u,d.push(f)}else for(var y=0;s>y;y+=1){if(f=angular.copy(r),5===e){var E=0;n[y].elemId===t.id&&(p=n[y].square,g=o.roundingValue(n[y].square,3)+" "+i("translate")("common_words.LETTER_M")+"2 ("+n[y].sizes[0]+" x "+n[y].sizes[1]+")",u=p*f.price*_,E+=1)}else 7===e?(m=t.count,u=m*f.price*_):(p=n[y]+t.amendment_pruning,u=p*f.price*_);(5===e&&E||5!==e)&&(a.userInfo.currencyId!=f.currency_id&&(u=M(u,f.currency_id)),f.qty=angular.copy(m),f.size=o.roundingValue(p,3),f.sizeLabel=g,f.priceReal=o.roundingValue(u,3),l.priceTotal+=u,d.push(f))}}function G(e,t){var i,r=e.kitsElem.length,o=0,a=[];for(e.priceTotal=0,i=0;r>i;i+=1)if(e.kitsElem[i])if(o=t[i].length,angular.isArray(e.kitsElem[i])){var n,s=e.kitsElem[i].length;for(n=0;s>n;n+=1)if(angular.isArray(e.kitsElem[i][n])){var l,d=e.kitsElem[i][n].length;for(l=0;d>l;l+=1)k(i,e.kits[i][n][l],e.kitsElem[i][n][l],t[i][n],1,e,a)}else k(i,e.kits[i][n],e.kitsElem[i][n],t[i],o,e,a)}else k(i,e.kits[i],e.kitsElem[i],t[i],o,e,a);return a}function B(e,t,i){if(1==e.direction_id)return 1;var r,o=0;for(r=0;i>r;r+=1)t[r]===e.direction_id&&(o+=1);return o}function V(e,t,i){var r=0;switch(i){case 1:case 21:case 22:r=o.roundingValue(e-t,3);break;case 2:case 5:var a=1>e?1:parseInt(e);r=a*t;break;case 3:case 12:case 14:r=o.roundingValue(Math.round(e)*t,3);break;case 6:case 7:case 8:case 9:case 13:case 23:r=o.roundingValue(e*t,3);break;default:r=t}return r}function U(e,t,i){var r=0;switch(i){case 1:r=o.roundingValue(e-t,3);break;case 2:case 5:var a=1>e?1:parseInt(e);r=a*t;break;case 3:r=e;break;default:r=t}return r}function H(e,t,i,r,n,s,l,d){if(r){var c=angular.copy(r),u=0,p=0,g=1;switch(9===c.element_group_id&&(p=t),i.rules_type_id){case 1:case 21:case 22:p=o.roundingValue(t+n-i.value,3);break;case 3:g=(t+n)*i.value;break;case 5:g=i.value;break;case 6:case 23:g=(t+n)*i.value;
break;case 2:case 4:case 15:g=e*i.value;break;default:p=o.roundingValue(t+n,3)}u=p?p*g*r.price*s:g*r.price*s,a.userInfo.currencyId!=r.currency_id&&(u=M(u,r.currency_id)),c.priceReal=u,c.size=o.roundingValue(p,3),c.sizeLabel=d,c.qty=g,l.constrElements.push(c),l.priceTotal+=c.priceReal}}function F(e,t,r,a,n,s,l){if(a.parent_list_id===r.id){var d=1,c=1,u=0,p=r.waste?1+r.waste/100:1;5===e?5===a.rules_type_id?(d=t.square,c=t.square,u=o.roundingValue(t.square,3)+" "+i("translate")("common_words.LETTER_M")+"2 ("+t.sizes[0]+" x "+t.sizes[1]+")"):21===a.rules_type_id?(d=t.sizes[0],c=t.sizes[0]):22===a.rules_type_id?(d=t.sizes[1],c=t.sizes[1]):c=t.square:(d=o.roundingValue(t+r.amendment_pruning,3),c=t),"list"===a.child_type&&(a.newValue=V(d,a.value,a.rules_type_id)),H(1,c,a,n,r.amendment_pruning,p,l,u)}else{var g,m=s.length;for(g=0;m>g;g+=1)if(a.parent_list_id===s[g].child_id&&a.parentId===s[g].id){var p=s[g].waste?1+s[g].waste/100:1,f=1;"list"===a.child_type&&(a.newValue=V(s[g].newValue,a.value,a.rules_type_id)),2===s[g].rules_type_id&&(2!==a.rules_type_id&&4!==a.rules_type_id&&15!==a.rules_type_id||(f=s[g].newValue)),H(f,s[g].newValue,a,n,s[g].amendment_pruning,p,l)}}}function z(e,t,i,r,n,s){if(e===s.consist.length-1){if(angular.isArray(i)){var l,d=i.length,c=r.openDir.length;for(l=0;d>l;l+=1)if(angular.isArray(i[l])){var u,p=i[l].length;e:for(u=0;p>u;u+=1)if(B(t[l][u],r.openDir,c)){var g=angular.copy(i[l][u]),m=0,f=1;if(t[l][u].parent_list_id===n[l].child_id)f=n[l].waste?1+n[l].waste/100:1,g.qty=V(n[l].count,t[l][u].value,t[l][u].rules_type_id),"list"===t[l][u].child_type&&(t[l][u].newValue=angular.copy(g.qty));else for(var _=0;p>_;_+=1)if(t[l][u].parent_list_id===t[l][_].child_id&&t[l][u].parentId===t[l][_].id){if(!B(t[l][_],r.openDir,c))continue e;f=t[l][_].waste?1+t[l][_].waste/100:1,g.qty=V(t[l][_].newValue,t[l][u].value,t[l][u].rules_type_id),"list"===t[l][u].child_type&&(t[l][u].newValue=angular.copy(g.qty))}m=g.qty*i[l][u].price*f,m&&(a.userInfo.currencyId!=i[l][u].currency_id&&(m=M(m,i[l][u].currency_id)),g.priceReal=o.roundingValue(m,3),g.size=0,s.constrElements.push(g),s.priceTotal+=g.priceReal)}}}}else if(angular.isArray(i)){var h,y=i.length;for(h=0;y>h;h+=1)if(6===e)for(var E=r.sizes.length;--E>-1;)F(e,r.sizes[E],n,t[h],i[h],t,s);else F(e,r,n,t[h],i[h],t,s)}else if(6===e)for(var E=r.sizes.length;--E>-1;)F(e,r.sizes[E],n,t,i,s.consist[e],s);else F(e,r,n,t,i,s.consist[e],s)}function Y(e,t){var i,r=e.consist.length;for(i=0;r>i;i+=1)if(e.consist[i]){var o=t.sizes[i].length,a=e.consist[i].length;if(a)if(angular.isArray(e.kits[i]))for(var n=0;a>n;n+=1)if(5===i||6===i)for(var s=t.sizes[i].length,l=0;s>l;l+=1)t.sizes[i][l].elemId===e.kits[i][n].id&&e.consistElem[i][n]&&z(i,e.consist[i][n],e.consistElem[i][n],t.sizes[i][l],e.kits[i][n],e);else e.consistElem[i][n]&&z(i,e.consist[i][n],e.consistElem[i][n],t.sizes[i][n],e.kits[i][n],e);else for(var l=0;o>l;l+=1)for(var n=0;a>n;n+=1)e.consistElem[i][n]&&z(i,e.consist[i][n],e.consistElem[i][n],t.sizes[i][l],e.kits[i],e)}}function W(e){var i=t.defer(),r={},a={};return L(e).then(function(t){r.kits=t,O(r.kits).then(function(t){r.consist=t,P(r.kits).then(function(t){r.kitsElem=t,w(r.consist).then(function(t){r.consistElem=t,r.constrElements=G(r,e.sizes),Y(r,e),r.priceTotal=o.roundingValue(r.priceTotal),a.constrElements=angular.copy(r.constrElements),a.priceTotal=isNaN(r.priceTotal)?0:angular.copy(r.priceTotal),i.resolve(a)})})})}),i.promise}function $(e,t,i){var r=angular.copy(t);a.userInfo.currencyId!=r.currency_id&&(r.price=o.roundingValue(M(r.price,r.currency_id),3)),r.qty=i?i.value:1,r.size=0,r.priceReal=o.roundingValue(r.price*r.qty,3),e.priceTot+=r.priceReal,e.elements.push(r)}function q(e,i){var r=t.defer(),a={priceTot:0,elements:[]};return R(0,e.parent_element_id).then(function(e){$(a,e),R(0,i.parent_element_id).then(function(e){$(a,e),C(i.id).then(function(e){a.consist=e,w([a.consist]).then(function(e){a.consistElem=e[0];for(var t=a.consist.length;--t>-1;)$(a,a.consistElem[t],a.consist[t]);a.priceTot=isNaN(a.priceTot)?0:o.roundingValue(a.priceTot),r.resolve(a)})})})}),r.promise}function Q(e){var i=t.defer(),r={},n={constrElements:[],priceTotal:0};return C(angular.copy(e.elementId)).then(function(t){n.consist=angular.copy(t),D(e.elementId).then(function(t){t?(n.kits=angular.copy(t),R(0,n.kits.parent_element_id).then(function(t){n.kitsElem=angular.copy(t),w([n.consist]).then(function(t){if(n.consistElem=angular.copy(t[0]),e.elementWidth>0){var s=0,l=0;e.elementHeight?(s=o.roundingValue(e.elementWidth*e.elementHeight,3),l=o.roundingValue((e.elementWidth+n.kits.amendment_pruning)*(e.elementHeight+n.kits.amendment_pruning),3)):(s=e.elementWidth,l=e.elementWidth+n.kits.amendment_pruning);var d=n.kits.waste?1+n.kits.waste/100:1,c=angular.copy(n.kitsElem),u=o.roundingValue(l*c.price*d);if(a.userInfo.currencyId!=c.currency_id&&(u=M(u,c.currency_id)),c.qty=1,c.size=l,c.priceReal=u,n.priceTotal+=u,n.constrElements.push(c),n.consistElem){var p=n.consist.length;if(p)for(var g=0;p>g;g++)if(n.consist[g])if(n.consist[g].parent_list_id===e.elementId)"list"===n.consist[g].child_type&&(n.consist[g].newValue=V(l,n.consist[g].value,n.consist[g].rules_type_id)),H(1,s,n.consist[g],n.consistElem[g],n.kits.amendment_pruning,d,n);else for(var m=0;p>m;m++)n.consist[g].parent_list_id===n.consist[m].child_id&&n.consist[g].parentId===n.consist[m].id&&(d=n.consist[m].waste?1+n.consist[m].waste/100:1,"list"===n.consist[g].child_type&&(n.consist[g].newValue=V(n.consist[m].newValue,n.consist[g].value,n.consist[g].rules_type_id)),H(n.consist[g].newValue,n.consist[m].newValue,n.consist[g],n.consistElem[g],n.consist[m].amendment_pruning,d,n))}}n.priceTotal=o.roundingValue(n.priceTotal),r.constrElements=angular.copy(n.constrElements),r.priceTotal=angular.copy(n.priceTotal),i.resolve(r)})})):i.resolve(n)})}),i.promise}function j(e){var i=t.defer(),r=angular.copy(e.element),n={},s={constrElements:[],priceTotal:0};return r.element_width/=1e3,r.element_height/=1e3,t.all([D(r.cloth_id),D(r.top_id)]).then(function(e){var l=angular.copy(e[1]);s.kits=angular.copy(e),s.kits.push(l,l,l),t.all([R(0,e[0].parent_element_id),R(0,e[1].parent_element_id)]).then(function(e){var t,i,n,l,d,c,u=[r.cloth_waste,r.top_waste,r.right_waste,r.bottom_waste,r.left_waste],p=u.length;for(s.kitsElem=angular.copy(e),s.kitsElem.push(angular.copy(e[1]),angular.copy(e[1]),angular.copy(e[1])),t=0;p>t;t+=1)d=s.kits[t].waste?1+s.kits[t].waste/100:1,s.kitsElem[t]&&(i=r.element_width+s.kits[t].amendment_pruning-u[t]/1e3,n=r.element_height+s.kits[t].amendment_pruning-u[t]/1e3,l=1===t||3===t?o.roundingValue(i,3):2===t||4===t?o.roundingValue(n,3):o.roundingValue(i*n,3),c=o.roundingValue(l*s.kitsElem[t].price*d),a.userInfo.currencyId!=s.kitsElem[t].currency_id&&(c=o.roundingValue(M(c,s.kitsElem[t].currency_id))),s.kitsElem[t].qty=1,s.kitsElem[t].size=l,s.kitsElem[t].priceReal=c,s.priceTotal+=c,s.constrElements.push(s.kitsElem[t]))}),t.all([C(r.top_id),C(r.right_id),C(r.bottom_id),C(r.left_id)]).then(function(e){s.consist=angular.copy(e),w(s.consist).then(function(e){var t,r,a,l,d,c;if(s.consistElem=angular.copy(e),s.consistElem&&(t=s.consist.length))for(a=0;t>a;a+=1)if(r=s.consist[a].length)for(d=1,c=s.kitsElem[a+1].size,l=0;r>l;l+=1)s.consist[a][l].newValue=U(c,s.consist[a][l].value,s.consist[a][l].rules_type_id),H(1,s.consist[a][l].newValue,s.consist[a][l],s.consistElem[a][l],0,d,s);s.priceTotal=o.roundingValue(s.priceTotal),n.constrElements=angular.copy(s.constrElements),n.priceTotal=angular.copy(s.priceTotal),i.resolve(n)})})}),i.promise}var K=this,X=openDatabase("bauvoice","1.0","bauvoice",5e6),Z={addition_folders:{tableName:"addition_folders",prop:"name VARCHAR(255), addition_type_id INTEGER, factory_id INTEGER, position INTEGER, img VARCHAR, description VARCHAR, link VARCHAR",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id), FOREIGN KEY(addition_type_id) REFERENCES addition_types(id)"},cities:{tableName:"cities",prop:"name VARCHAR(255), region_id INTEGER, transport VARCHAR(2)",foreignKey:", FOREIGN KEY(region_id) REFERENCES regions(id)"},countries:{tableName:"countries",prop:"name VARCHAR(255), currency_id INTEGER",foreignKey:", FOREIGN KEY(currency_id) REFERENCES currencies(id)"},currencies:{tableName:"currencies",prop:"name VARCHAR(100), value NUMERIC(10, 2), factory_id INTEGER, is_base INTEGER",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id)"},directions:{tableName:"directions",prop:"name VARCHAR(255)",foreignKey:""},elements_groups:{tableName:"elements_groups",prop:"name VARCHAR(255), base_unit INTEGER, position INTEGER",foreignKey:""},beed_profile_systems:{tableName:"beed_profile_systems",prop:"profile_system_id INTEGER, list_id INTEGER, glass_width INTEGER",foreignKey:", FOREIGN KEY(list_id) REFERENCES lists(id)"},glass_folders:{tableName:"glass_folders",prop:"name VARCHAR(255), img VARCHAR, position INTEGER, factory_id INTEGER, description VARCHAR, link VARCHAR, is_base INTEGER",foreignKey:""},glass_prices:{tableName:"glass_prices",prop:"element_id INTEGER, col_1_range NUMERIC(10, 2), col_1_price NUMERIC(10, 2), col_2_range_1 NUMERIC(10, 2), col_2_range_2 NUMERIC(10, 2), col_2_price NUMERIC(10, 2), col_3_range_1 NUMERIC(10, 2), col_3_range_2 NUMERIC(10, 2), col_3_price NUMERIC(10, 2), col_4_range_1 NUMERIC(10, 2), col_4_range_2 NUMERIC(10, 2), col_4_price NUMERIC(10, 2), col_5_range NUMERIC(10, 2), col_5_price NUMERIC(10, 2), table_width INTEGER",foreignKey:""},lamination_factory_colors:{tableName:"lamination_factory_colors",prop:"name VARCHAR(255), lamination_type_id INTEGER, factory_id INTEGER",foreignKey:", FOREIGN KEY(lamination_type_id) REFERENCES lamination_default_colors(id), FOREIGN KEY(factory_id) REFERENCES factories(id)"},lamination_types:{tableName:"lamination_types",prop:"name VARCHAR(255)",foreignKey:""},lists_groups:{tableName:"lists_groups",prop:"name VARCHAR(255)",foreignKey:""},lists_types:{tableName:"lists_types",prop:"name VARCHAR(255), image_add_param VARCHAR(100)",foreignKey:""},options_coefficients:{tableName:"options_coefficients",prop:"rentability_percent INTEGER, rentability_hrn_m INTEGER, rentability_hrn INTEGER, others_percent INTEGER, others_hrn_m INTEGER, others_hrn INTEGER, transport_cost_percent INTEGER, transport_cost_hrn_m INTEGER, transport_cost_hrn INTEGER, salary_manager_percent INTEGER, salary_manager_hrn_m INTEGER, salary_manager_hrn INTEGER, rent_offices_percent INTEGER, rent_offices_hrn_m INTEGER, rent_offices_hrn INTEGER, salary_itr_percent INTEGER, salary_itr_hrn_m INTEGER, salary_itr_hrn INTEGER, rent_production_percent INTEGER, rent_production_hrn_m INTEGER, rent_production_hrn INTEGER, salary_glass_percent INTEGER, salary_glass_hrn_m INTEGER, salary_glass_hrn INTEGER, salary_assembly_percent INTEGER, salary_assembly_hrn_m INTEGER, salary_assembly_hrn INTEGER, estimated_cost INTEGER, factory_id INTEGER, plan_production INTEGER, margin NUMERIC(10, 2), coeff NUMERIC(10, 2)",foreignKey:""},options_discounts:{tableName:"options_discounts",prop:"factory_id INTEGER, min_time INTEGER, standart_time INTEGER, base_time INTEGER, week_1 INTEGER, week_2 INTEGER, week_3 INTEGER, week_4 INTEGER, week_5 INTEGER, week_6 INTEGER, week_7 INTEGER, week_8 INTEGER, percents ARRAY",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id)"},elements:{tableName:"elements",prop:"heat_coeff INTEGER, name VARCHAR(255), element_group_id INTEGER, currency_id INTEGER, supplier_id INTEGER, margin_id INTEGER, waste NUMERIC(10, 2), is_optimized INTEGER, is_virtual INTEGER, is_additional INTEGER, weight_accounting_unit NUMERIC(10, 3), glass_folder_id INTEGER, min_width NUMERIC, min_height NUMERIC, max_width NUMERIC, max_height NUMERIC, max_sq NUMERIC, transcalency NUMERIC(10, 2), glass_width INTEGER, factory_id INTEGER, price NUMERIC(10, 2), amendment_pruning NUMERIC(10, 2), noise_coeff NUMERIC, sku VARCHAR(100), lamination_in_id INTEGER, lamination_out_id INTEGER",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id), FOREIGN KEY(glass_folder_id) REFERENCES glass_folders(id), FOREIGN KEY(margin_id) REFERENCES margin_types(id), FOREIGN KEY(supplier_id) REFERENCES suppliers(id), FOREIGN KEY(currency_id) REFERENCES currencies(id), FOREIGN KEY(element_group_id) REFERENCES elements_groups(id)"},profile_system_folders:{tableName:"profile_system_folders",prop:"name VARCHAR(255), factory_id INTEGER, position INTEGER, link VARCHAR, description VARCHAR, img VARCHAR",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id)"},profile_systems:{tableName:"profile_systems",prop:"name VARCHAR(255), short_name VARCHAR(100), folder_id INTEGER, rama_list_id INTEGER, rama_still_list_id INTEGER, stvorka_list_id INTEGER, impost_list_id INTEGER, shtulp_list_id INTEGER, is_editable INTEGER, is_default INTEGER, position INTEGER, country VARCHAR(100), cameras INTEGER, heat_coeff INTEGER, noise_coeff INTEGER, heat_coeff_value NUMERIC(5,2), link VARCHAR, description VARCHAR, img VARCHAR",foreignKey:""},profile_laminations:{tableName:"profile_laminations",prop:"profile_id INTEGER, lamination_in_id INTEGER, lamination_out_id INTEGER, rama_list_id INTEGER, rama_still_list_id INTEGER, stvorka_list_id INTEGER, impost_list_id INTEGER, shtulp_list_id INTEGER, code_sync VARCHAR",foreignKey:""},rules_types:{tableName:"rules_types",prop:"name VARCHAR(255), parent_unit INTEGER, child_unit INTEGER, suffix VARCHAR(15)",foreignKey:""},regions:{tableName:"regions",prop:"name VARCHAR(255), country_id INTEGER, heat_transfer NUMERIC(10, 2), climatic_zone NUMERIC",foreignKey:", FOREIGN KEY(country_id) REFERENCES countries(id)"},users:{tableName:"users",prop:" email VARCHAR(255), password VARCHAR(255), factory_id INTEGER, name VARCHAR(255), phone VARCHAR(100), locked INTEGER, user_type INTEGER, city_phone VARCHAR(100), city_id INTEGER, fax VARCHAR(100), avatar VARCHAR(255), birthday DATE, sex VARCHAR(100), mount_mon NUMERIC(5,2), mount_tue NUMERIC(5,2), mount_wed NUMERIC(5,2), mount_thu NUMERIC(5,2), mount_fri NUMERIC(5,2), mount_sat NUMERIC(5,2), mount_sun NUMERIC(5,2), device_code VARCHAR(250), last_sync TIMESTAMP, address VARCHAR, therm_coeff_id INTEGER, factoryLink VARCHAR, code_sync VARCHAR",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id), FOREIGN KEY(city_id) REFERENCES cities(id)"},users_discounts:{tableName:"users_discounts",prop:"user_id INTEGER, max_construct NUMERIC(5,1), max_add_elem NUMERIC(5,1), default_construct NUMERIC(5,1), default_add_elem NUMERIC(5,1), week_1_construct NUMERIC(5,1), week_1_add_elem NUMERIC(5,1), week_2_construct NUMERIC(5,1), week_2_add_elem NUMERIC(5,1), week_3_construct NUMERIC(5,1), week_3_add_elem NUMERIC(5,1), week_4_construct NUMERIC(5,1), week_4_add_elem NUMERIC(5,1), week_5_construct NUMERIC(5,1), week_5_add_elem NUMERIC(5,1), week_6_construct NUMERIC(5,1), week_6_add_elem NUMERIC(5,1), week_7_construct NUMERIC(5,1), week_7_add_elem NUMERIC(5,1), week_8_construct NUMERIC(5,1), week_8_add_elem NUMERIC(5,1)",foreignKey:""},users_deliveries:{tableName:"users_deliveries",prop:"user_id INTEGER, active INTEGER, name VARCHAR, type INTEGER, price NUMERIC(6,1)",foreignKey:""},users_mountings:{tableName:"users_mountings",prop:"user_id INTEGER, active INTEGER, name VARCHAR, type INTEGER, price NUMERIC(6,1)",foreignKey:""},lists:{tableName:"lists",prop:"name VARCHAR(255), list_group_id INTEGER, list_type_id INTEGER, a NUMERIC(10, 2), b NUMERIC(10, 2), c NUMERIC(10, 2), d NUMERIC(10, 2), parent_element_id INTEGER, position NUMERIC, add_color_id INTEGER, addition_folder_id INTEGER, amendment_pruning NUMERIC(10, 2), waste NUMERIC(10, 2), cameras INTEGER, link VARCHAR, description VARCHAR, img VARCHAR, beed_lamination_id INTEGER, in_door INTEGER, doorstep_type INTEGER, glass_type INTEGER, glass_image INTEGER",foreignKey:", FOREIGN KEY(parent_element_id) REFERENCES elements(id), FOREIGN KEY(parent_element_id) REFERENCES elements(id), FOREIGN KEY(list_group_id) REFERENCES lists_groups(id), FOREIGN KEY(add_color_id) REFERENCES addition_colors(id)"},list_contents:{tableName:"list_contents",prop:"parent_list_id INTEGER, child_id INTEGER, child_type VARCHAR(255), value NUMERIC(10, 7), rules_type_id INTEGER, direction_id INTEGER, window_hardware_color_id INTEGER, lamination_type_id INTEGER",foreignKey:", FOREIGN KEY(parent_list_id) REFERENCES lists(id), FOREIGN KEY(rules_type_id) REFERENCES rules_types(id), FOREIGN KEY(direction_id) REFERENCES directions(id), FOREIGN KEY(lamination_type_id) REFERENCES lamination_types(id), FOREIGN KEY(window_hardware_color_id) REFERENCES window_hardware_colors(id)"},window_hardware_types:{tableName:"window_hardware_types",prop:"name VARCHAR(255), short_name VARCHAR(100)",foreignKey:""},window_hardware_folders:{tableName:"window_hardware_folders",prop:"name VARCHAR, factory_id INTEGER, link VARCHAR, description VARCHAR, img VARCHAR",foreignKey:""},window_hardware_groups:{tableName:"window_hardware_groups",prop:"name VARCHAR(255), short_name VARCHAR(100), folder_id INTEGER, is_editable INTEGER, is_group INTEGER, is_in_calculation INTEGER, is_default INTEGER, position INTEGER, producer VARCHAR(255), country VARCHAR(255), noise_coeff INTEGER, heat_coeff INTEGER, min_height INTEGER, max_height INTEGER, min_width INTEGER, max_width INTEGER, link VARCHAR, description VARCHAR, img VARCHAR",foreignKey:""},window_hardwares:{tableName:"window_hardwares",prop:"window_hardware_type_id INTEGER, min_width INTEGER, max_width INTEGER, min_height INTEGER, max_height INTEGER, direction_id INTEGER, window_hardware_color_id INTEGER, length INTEGER, count INTEGER, child_id INTEGER, child_type VARCHAR(100), position INTEGER, factory_id INTEGER, window_hardware_group_id INTEGER",foreignKey:", FOREIGN KEY(factory_id) REFERENCES factories(id), FOREIGN KEY(window_hardware_type_id) REFERENCES window_hardware_types(id), FOREIGN KEY(direction_id) REFERENCES directions(id), FOREIGN KEY(window_hardware_group_id) REFERENCES window_hardware_groups(id), FOREIGN KEY(window_hardware_color_id) REFERENCES window_hardware_colors(id)"},window_hardware_colors:{tableName:"window_hardware_colors",prop:"name VARCHAR(255)",foreignKey:""},window_hardware_handles:{tableName:"window_hardware_handles",prop:"element_id INTEGER, location VARCHAR(255), constant_value NUMERIC(10, 2)",foreignKey:""},elements_profile_systems:{tableName:"elements_profile_systems",prop:"profile_system_id INTEGER, element_id INTEGER",foreignKey:""},orders:{tableName:"orders",prop:"order_number VARCHAR, order_hz VARCHAR, order_date TIMESTAMP, order_type INTEGER, order_style VARCHAR, user_id INTEGER, created TIMESTAMP, additional_payment VARCHAR, sended TIMESTAMP, state_to TIMESTAMP, state_buch TIMESTAMP, batch VARCHAR, base_price NUMERIC(13, 2), factory_margin NUMERIC(11, 2), factory_id INTEGER, purchase_price NUMERIC(10, 2), sale_price NUMERIC(10, 2), climatic_zone INTEGER, heat_coef_min NUMERIC, products_qty INTEGER, templates_price NUMERIC, addelems_price NUMERIC, products_price NUMERIC, delivery_date TIMESTAMP, new_delivery_date TIMESTAMP, delivery_price NUMERIC, is_date_price_less INTEGER, is_date_price_more INTEGER, floor_id INTEGER, floor_price NUMERIC, mounting_id INTEGER, mounting_price NUMERIC, is_instalment INTEGER, instalment_id INTEGER, is_old_price INTEGER, payment_first NUMERIC, payment_monthly NUMERIC, payment_first_primary NUMERIC, payment_monthly_primary NUMERIC, order_price NUMERIC, order_price_dis NUMERIC, order_price_primary NUMERIC, discount_construct NUMERIC, discount_addelem NUMERIC, discount_construct_max NUMERIC, discount_addelem_max NUMERIC, delivery_user_id NUMERIC, mounting_user_id NUMERIC, default_term_plant NUMERIC, disc_term_plant NUMERIC, margin_plant NUMERIC, customer_name TEXT, customer_email TEXT, customer_phone VARCHAR(30), customer_phone_city VARCHAR(20), customer_city_id INTEGER, customer_city VARCHAR, customer_address TEXT, customer_house TEXT, customer_flat TEXT, customer_floor TEXT, customer_location VARCHAR, customer_itn INTEGER, customer_starttime VARCHAR, customer_endtime VARCHAR, customer_target VARCHAR, customer_sex INTEGER, customer_age INTEGER, customer_education INTEGER, customer_occupation INTEGER, customer_infoSource INTEGER",foreignKey:""},order_products:{tableName:"order_products",prop:"order_id NUMERIC, product_id INTEGER, is_addelem_only INTEGER, room_id INTEGER, construction_type INTEGER, template_id INTEGER, template_source TEXT, template_width NUMERIC, template_height NUMERIC, template_square NUMERIC, profile_id INTEGER, glass_id VARCHAR, hardware_id INTEGER, lamination_id INTEGER, lamination_out_id INTEGER, lamination_in_id INTEGER, door_shape_id INTEGER, door_sash_shape_id INTEGER, door_handle_shape_id INTEGER, door_lock_shape_id INTEGER, heat_coef_total NUMERIC, template_price NUMERIC, addelem_price NUMERIC, product_price NUMERIC, comment TEXT, product_qty INTEGER",foreignKey:""},order_addelements:{tableName:"order_addelements",prop:"order_id NUMERIC, product_id INTEGER, element_type INTEGER, element_id INTEGER, name VARCHAR, element_width NUMERIC, element_height NUMERIC, element_price NUMERIC, element_qty INTEGER, block_id INTEGER",foreignKey:""},template_groups:{tableName:"template_groups",prop:"name VARCHAR(255)",foreignKey:""},templates:{tableName:"templates",prop:"group_id INTEGER,name VARCHAR(255),icon TEXT,template_object TEXT",foreignKey:""},background_templates:{tableName:"background_templates",prop:"factory_id INTEGER,desc_1 VARCHAR(255),desc_2 VARCHAR(255),template_id INTEGER,group_id INTEGER,position INTEGER,img VARCHAR",foreignKey:""},factories:{tableName:"factories",prop:"name VARCHAR,app_token VARCHAR,link VARCHAR,therm_coeff_id INTEGER,max_construct_square INTEGER,max_construct_size INTEGER",foreignKey:""},mosquitos:{tableName:"mosquitos",prop:"profile_id INTEGER,name VARCHAR,bottom_id INTEGER,bottom_waste INTEGER,left_id INTEGER,left_waste INTEGER,top_id INTEGER,top_waste INTEGER,right_id INTEGER,right_waste INTEGER,cloth_id INTEGER,cloth_waste INTEGER",foreignKey:""},window_hardware_type_ranges:{tableName:"window_hardware_type_ranges",prop:"factory_id INTEGER,type_id INTEGER,max_width INTEGER,min_width INTEGER,max_height INTEGER,min_height INTEGER,group_id INTEGER",foreignKey:""},lock_lists:{tableName:"lock_lists",prop:"list_id INTEGER,accessory_id INTEGER",foreignKey:""},"export":{tableName:"export",prop:"model VARCHAR, rowId INTEGER, field TEXT",foreignKey:""}},J={cities:{tableName:"cities",prop:"name VARCHAR(255), region_id INTEGER, transport VARCHAR(2)",foreignKey:", FOREIGN KEY(region_id) REFERENCES regions(id)"},countries:{tableName:"countries",prop:"name VARCHAR(255), currency_id INTEGER",foreignKey:", FOREIGN KEY(currency_id) REFERENCES currencies(id)"},regions:{tableName:"regions",prop:"name VARCHAR(255), country_id INTEGER, heat_transfer NUMERIC(10, 2), climatic_zone NUMERIC",foreignKey:", FOREIGN KEY(country_id) REFERENCES countries(id)"}};return K.publicObj={tablesLocalDB:Z,tablesLocationLocalDB:J,cleanLocalDB:s,createTablesLocalDB:l,insertRowLocalDB:c,insertTablesLocalDB:u,selectLocalDB:p,updateLocalDB:g,deleteRowLocalDB:m,importUser:f,importLocation:_,importFactories:h,importAllDB:y,insertServer:E,updateServer:v,createUserServer:b,exportUserEntrance:I,deleteOrderServer:A,updateLocalServerDBs:S,sendIMGServer:T,md5:x,calculationPrice:W,getAdditionalPrice:Q,calculationGridPrice:j,calcDoorElemPrice:q,currencyExgange:M},K.publicObj}])}(),function(){angular.module("LoginModule").factory("loginServ",["$q","$cordovaGlobalization","$cordovaFileTransfer","$translate","$filter","localDB","globalConstants","GeneralServ","optionsServ","GlobalStor","OrderStor","ProductStor","UserStor",function(e,t,i,r,o,a,n,s,l,d,c,u,p){function g(e){for(var t=n.languages.length;--t>-1;)if(n.languages[t].label.indexOf(e)+1){p.userInfo.langLabel=n.languages[t].label,p.userInfo.langName=n.languages[t].name;break}}function m(){if(d.global.isDevice=isDevice,d.global.isDevice)t.getPreferredLanguage().then(function(e){console.log("language++",e.value),g(e.value),r.use(p.userInfo.langLabel)},function(e){console.log("No language defined",e)});else{var e=navigator.language||navigator.userLanguage;g(e),r.use(p.userInfo.langLabel)}}function f(){var t=e.defer();return console.log("EXPORT"),a.selectLocalDB(a.tablesLocalDB["export"].tableName).then(function(e){e.length&&a.selectLocalDB(a.tablesLocalDB.users.tableName).then(function(i){i.length&&a.updateServer(i[0].phone,i[0].device_code,e).then(function(e){console.log("FINISH export",e),e&&(a.cleanLocalDB({"export":1}),t.resolve(1))})})}),t.promise}function _(){var t=e.defer();return a.selectLocalDB("sqlite_sequence").then(function(e){e&&e.length>5?t.resolve(1):t.resolve(0)}),t.promise}function h(t){var i,r,o,n=e.defer(),s=t?null:{id:p.userInfo.city_id};return a.selectLocalDB(a.tablesLocalDB.cities.tableName,s,"id as cityId, name as cityName, region_id as regionId").then(function(e){if(o=e.length){for(d.global.locations.cities=angular.copy(e);--o>-1;)for(r=d.global.locations.regions.length;--r>-1;)if(d.global.locations.cities[o].regionId===d.global.locations.regions[r].id)for(d.global.locations.cities[o].fullLocation=""+d.global.locations.cities[o].cityName+", "+d.global.locations.regions[r].name,d.global.locations.cities[o].climaticZone=d.global.locations.regions[r].climaticZone,d.global.locations.cities[o].heatTransfer=d.global.locations.regions[r].heatTransfer,i=d.global.locations.countries.length;--i>-1;)d.global.locations.regions[r].countryId===d.global.locations.countries[i].id&&(d.global.locations.cities[o].countryId=d.global.locations.countries[i].id,d.global.locations.cities[o].currencyId=d.global.locations.countries[i].currency);n.resolve(1)}else n.resolve(0)}),n.promise}function y(t){var i,r,o=e.defer();return a.selectLocalDB(a.tablesLocalDB.countries.tableName,null,"id, name, currency_id as currency").then(function(e){i=e.length,i?d.global.locations.countries=angular.copy(e):console.log("Error!!!",e)}).then(function(){a.selectLocalDB(a.tablesLocalDB.regions.tableName,null,"id, name, country_id as countryId, climatic_zone as climaticZone, heat_transfer as heatTransfer").then(function(e){r=e.length,r?d.global.locations.regions=angular.copy(e):console.log("Error!!!",e)}).then(function(){h(t).then(function(){o.resolve(1)})})}),o.promise}function E(){var t=e.defer(),i=d.global.locations.cities.map(function(e){return e.countryId===p.userInfo.countryId?e.cityId:void 0}).join(",");return t.resolve(i),t.promise}function v(e,t,i,r,o){c.order.customer_city_id=e,c.order.customer_city=t,c.order.climatic_zone=i,c.order.heat_coef_min=r,c.order.customer_location=o}function b(){a.selectLocalDB(a.tablesLocalDB.factories.tableName,null,"therm_coeff_id, link, max_construct_size, max_construct_square").then(function(e){var t,i=p.userInfo.heatTransfer;e&&(t=e.length,t&&(p.userInfo.therm_coeff_id=angular.copy(e[0].therm_coeff_id),p.userInfo.therm_coeff_id&&(p.userInfo.heatTransfer=s.roundingValue(1/i)),e[0].link.length&&"null"!==e[0].link&&(p.userInfo.factoryLink=angular.copy(e[0].link)),+e[0].max_construct_square>0&&(d.global.maxSquareLimit=angular.copy(+e[0].max_construct_square)),+e[0].max_construct_size>0&&(d.global.maxSizeLimit=angular.copy(+e[0].max_construct_size)))),v(p.userInfo.city_id,p.userInfo.cityName,p.userInfo.climaticZone,p.userInfo.heatTransfer,p.userInfo.fullLocation)})}function I(){for(var e=d.global.locations.cities.length;--e>-1;)d.global.locations.cities[e].cityId===p.userInfo.city_id&&(p.userInfo.cityName=d.global.locations.cities[e].cityName,p.userInfo.countryId=d.global.locations.cities[e].countryId,p.userInfo.climaticZone=d.global.locations.cities[e].climaticZone,p.userInfo.heatTransfer=d.global.locations.cities[e].heatTransfer,p.userInfo.fullLocation=d.global.locations.cities[e].fullLocation)}function A(){var t=e.defer();return a.selectLocalDB(a.tablesLocalDB.currencies.tableName,null,"id, is_base, name, value").then(function(e){var i=e.length;if(e&&i){for(d.global.currencies=e;--i>-1;)1===e[i].is_base&&(p.userInfo.currencyId=e[i].id,/uah/i.test(e[i].name)?p.userInfo.currency="₴":/rub/i.test(e[i].name)?p.userInfo.currency="":/(usd|\$)/i.test(e[i].name)?p.userInfo.currency="$":/eur/i.test(e[i].name)?p.userInfo.currency="€":p.userInfo.currency="¤");t.resolve(1)}else console.error("not find currencies!"),t.resolve(0)}),t.promise}function S(){var t=e.defer();return p.userInfo.avatar=n.serverIP+p.userInfo.avatar,a.selectLocalDB(a.tablesLocalDB.users_discounts.tableName).then(function(e){var i=angular.copy(e[0]);if(i){p.userInfo.discountConstr=+i.default_construct,p.userInfo.discountAddElem=+i.default_add_elem,p.userInfo.discountConstrMax=+i.max_construct,p.userInfo.discountAddElemMax=+i.max_add_elem;var r,o=Object.keys(i),a=o.length;for(r=0;a>r;r+=1)o[r].indexOf("week")+1&&(o[r].indexOf("construct")+1?p.userInfo.discConstrByWeek.push(+i[o[r]]):o[r].indexOf("add_elem")+1&&p.userInfo.discAddElemByWeek.push(+i[o[r]]));t.resolve(1)}else console.error("not find users_discounts!"),t.resolve(0)}),t.promise}function T(){return a.selectLocalDB(a.tablesLocalDB.options_coefficients.tableName,null,"margin, coeff").then(function(e){return e})}function x(){return a.selectLocalDB(a.tablesLocalDB.options_discounts.tableName).then(function(e){return e})}function N(e){if(e){if(/^.*\.(jpg|jpeg|png|gif|tiff)$/i.test(e)){var t=n.serverIP+""+e;if(d.global.isDevice){var r=e.split("/").pop(),o=cordova.file.documentsDirectory+""+r,a=!0,s={};return i.download(t,o,s,a).then(function(e){},function(e){},function(e){}),o}return t}return""}}function L(t,i,r,o){var n=e.defer();return a.selectLocalDB(t).then(function(t){var l=angular.copy(t).sort(function(e,t){return s.sorting(e.position,t.position)}),d=l.length;if(d){r.length=0,angular.extend(r,l);var c=l.map(function(t){var r=e.defer();return t.img=N(t.img),a.selectLocalDB(i,{folder_id:t.id}).then(function(e){if(e.length){var t=angular.copy(e).sort(function(e,t){return s.sorting(e.position,t.position)});r.resolve(t)}else r.resolve(0)}),r.promise});e.all(c).then(function(e){var t,i=e.length,a=[];for(t=0;i>t;t+=1){var s=e[t].length;if(e[t]&&s){for(;--s>-1;)e[t][s].img=N(e[t][s].img);o.push(e[t]),a.push(e[t][0].folder_id)}}var l=a.length,d=r.length;if(l)for(;--d>-1;){var c,u=0;for(c=0;l>c;c+=1)r[d].id===a[c]&&(u=1);u||r.splice(d,1)}n.resolve(1)})}else n.resolve(0)}),n.promise}function D(){for(var t=e.defer(),i=d.global.profiles.length,r=[];--i>-1;)for(var o=d.global.profiles[i].length;--o>-1;)r.push(d.global.profiles[i][o].id);var n=r.map(function(t){var i=e.defer(),r={profileId:t,glassTypes:[],glasses:[]};return a.selectLocalDB(a.tablesLocalDB.glass_folders.tableName).then(function(e){e.length?(r.glassTypes=angular.copy(e),d.global.glassesAll.push(r),i.resolve(1)):i.resolve(0)}),i.promise});return e.all(n).then(function(i){if(i){var r=d.global.glassesAll.map(function(t){var i=e.defer();return a.selectLocalDB(a.tablesLocalDB.elements_profile_systems.tableName,{profile_system_id:t.profileId},"element_id").then(function(e){var t=e.length;t?i.resolve(e):i.resolve(0)}),i.promise});e.all(r).then(function(i){var r,o,n=i.length,s=[];for(o=0;n>o;o+=1){var l=e.defer(),c=i[o].map(function(t){var i=e.defer();return a.selectLocalDB(a.tablesLocalDB.lists.tableName,{parent_element_id:t.element_id,list_group_id:6},"id, name, parent_element_id, cameras, list_group_id, list_type_id, position, description, img, link, glass_image").then(function(e){var t=angular.copy(e),r=t.length;r?i.resolve(t[0]):i.resolve(0)}),i.promise});l.resolve(e.all(c)),s.push(l.promise)}e.all(s).then(function(i){var o=i.length,n=[];if(o){for(r=0;o>r;r+=1){var s=e.defer();d.global.glassesAll[r].glassLists=i[r].filter(function(e){return e});var l=d.global.glassesAll[r].glassLists.map(function(t){var i=e.defer();return a.selectLocalDB(a.tablesLocalDB.elements.tableName,{id:t.parent_element_id},"id, name, sku, glass_folder_id, glass_width, heat_coeff, noise_coeff, transcalency, max_width, min_width, max_height, min_height, max_sq").then(function(e){var t=angular.copy(e),r=t.length;r?i.resolve(t[0]):i.resolve(0)}),
i.promise});s.resolve(e.all(l)),n.push(s.promise)}e.all(n).then(function(e){var i=e.length;if(i)for(r=0;i>r;r+=1)d.global.glassesAll[r].glasses=e[r];t.resolve(1)})}})})}}),t.promise}function C(){var e,t=d.global.glassesAll.length;for(e=0;t>e;e+=1){var i,r=d.global.glassesAll[e].glassLists.length,o=d.global.glassesAll[e].glassTypes.length,a=[],n=[];for(i=0;r>i;i+=1)d.global.glassesAll[e].glassLists[i].parent_element_id===d.global.glassesAll[e].glasses[i].id&&(d.global.glassesAll[e].glasses[i].elem_id=angular.copy(d.global.glassesAll[e].glasses[i].id),d.global.glassesAll[e].glasses[i].id=angular.copy(d.global.glassesAll[e].glassLists[i].id),d.global.glassesAll[e].glasses[i].name=angular.copy(d.global.glassesAll[e].glassLists[i].name),d.global.glassesAll[e].glasses[i].cameras=angular.copy(d.global.glassesAll[e].glassLists[i].cameras),d.global.glassesAll[e].glasses[i].position=angular.copy(d.global.glassesAll[e].glassLists[i].position),d.global.glassesAll[e].glasses[i].img=angular.copy(d.global.glassesAll[e].glassLists[i].img),d.global.glassesAll[e].glasses[i].img=N(d.global.glassesAll[e].glasses[i].img),d.global.glassesAll[e].glasses[i].link=angular.copy(d.global.glassesAll[e].glassLists[i].link),d.global.glassesAll[e].glasses[i].description=angular.copy(d.global.glassesAll[e].glassLists[i].description),d.global.glassesAll[e].glasses[i].glass_image=angular.copy(d.global.glassesAll[e].glassLists[i].glass_image));for(d.global.glassesAll[e].glassTypes.sort(function(e,t){return s.sorting(e.position,t.position)});--o>-1;){d.global.glassesAll[e].glassTypes[o].img=N(d.global.glassesAll[e].glassTypes[o].img);var l=d.global.glassesAll[e].glasses.filter(function(t){return t.glass_folder_id===d.global.glassesAll[e].glassTypes[o].id});l.length&&(a.unshift(d.global.glassesAll[e].glassTypes[o]),l.sort(function(e,t){return s.sorting(e.position,t.position)}),n.unshift(l))}d.global.glassesAll[e].glassTypes=angular.copy(a),d.global.glassesAll[e].glasses=angular.copy(n),delete d.global.glassesAll[e].glassLists}}function O(){a.selectLocalDB(a.tablesLocalDB.window_hardware_type_ranges.tableName,null,"type_id, min_width, max_width, min_height, max_height, group_id").then(function(e){e&&e.length&&(d.global.hardwareLimits=angular.copy(e))})}function R(){var t=e.defer();return a.selectLocalDB(a.tablesLocalDB.background_templates.tableName).then(function(e){var i=angular.copy(e),r=i.length;if(r){for(i=i.sort(function(e,t){return s.sorting(e.position,t.position)});--r>-1;)i[r].img=N(i[r].img),$("<img />").attr("src",i[r].img);d.global.rooms=i}t.resolve(1)}),t.promise}function P(){return a.selectLocalDB(a.tablesLocalDB.lamination_factory_colors.tableName,null,"id, name, lamination_type_id as type_id").then(function(e){return e})}function w(){var t=e.defer();return a.selectLocalDB(a.tablesLocalDB.profile_laminations.tableName).then(function(e){if(e){d.global.laminatCouples=angular.copy(e);for(var i,r=d.global.laminatCouples.length,o=d.global.laminats.length;--r>-1;)for(delete d.global.laminatCouples[r].code_sync,delete d.global.laminatCouples[r].modified,i=0;o>i;i+=1)d.global.laminats[i].id===d.global.laminatCouples[r].lamination_in_id&&(d.global.laminatCouples[r].laminat_in_name=d.global.laminats[i].name,d.global.laminatCouples[r].img_in_id=d.global.laminats[i].type_id),d.global.laminats[i].id===d.global.laminatCouples[r].lamination_out_id&&(d.global.laminatCouples[r].laminat_out_name=d.global.laminats[i].name,d.global.laminatCouples[r].img_out_id=d.global.laminats[i].type_id);t.resolve(1)}else t.resolve(1)}),t.promise}function M(){var t=e.defer(),i=s.addElementDATA.map(function(e,t){return t?a.selectLocalDB(a.tablesLocalDB.lists.tableName,{list_group_id:e.id}):a.selectLocalDB(a.tablesLocalDB.mosquitos.tableName)});return e.all(i).then(function(e){var i,r,o=angular.copy(e),a=o.length;for(i=0;a>i;i+=1)r=!i&&o[i].length?{elementType:[{addition_type_id:20,name:""}],elementsList:[o[i]]}:{elementType:[],elementsList:o[i]},d.global.addElementsAll.push(r);t.resolve(1)}),t.promise}function k(){var t=e.defer(),i=d.global.addElementsAll.map(function(t,i){var r=e.defer();if(i&&t.elementsList&&t.elementsList.length){var o=t.elementsList.map(function(t){var i=e.defer();return t.img=N(t.img),a.selectLocalDB(a.tablesLocalDB.elements.tableName,{id:t.parent_element_id}).then(function(e){e&&e.length?(d.global.tempAddElements.push(angular.copy(e[0])),i.resolve(1)):i.resolve(0)}),i.promise});r.resolve(e.all(o))}else r.resolve(0);return r.promise});return t.resolve(e.all(i)),t.promise}function G(t){var i=e.defer(),r=t.map(function(t){var i=e.defer(),r={currencyId:p.userInfo.currencyId,element:t};return a.calculationGridPrice(r).then(function(e){e?(t.element_price=angular.copy(s.roundingValue(s.addMarginToPrice(e.priceTotal,d.global.margins.margin))),t.elementPriceDis=angular.copy(s.roundingValue(s.setPriceDis(t.element_price,c.order.discount_addelem))),i.resolve(t)):i.reject(e)}),i.promise});return i.resolve(e.all(r)),i.promise}function B(){var t=e.defer();return a.selectLocalDB(a.tablesLocalDB.addition_folders.tableName).then(function(e){var i,r,n,l,c,u,p,g,m,f,_,h,y,E=d.global.addElementsAll,v=E.length,b={id:0,name:o("translate")("add_elements.OTHERS")};for(e&&e.length&&(i=e.sort(function(e,t){return s.sorting(e.position,t.position)}));--v>-1;)if(E[v].elementsList)if(v){for(i&&i.length&&(E[v].elementType=angular.copy(i)),E[v].elementType.push(b),r=[],n=[],l=E[v].elementType.length,c=E[v].elementsList.length,u=d.global.tempAddElements.length,p=0;l>p;p+=1){for(g=[],m=0;c>m;m+=1)if(E[v].elementType[p].id===E[v].elementsList[m].addition_folder_id){switch(f=0,_=0,E[v].elementsList[m].list_group_id){case 21:case 9:case 8:case 19:case 12:f=1e3;break;case 26:f=1e3,_=1e3}for(E[v].elementsList[m].element_width=f,E[v].elementsList[m].element_height=_,E[v].elementsList[m].element_qty=1,h=0;u>h;h+=1)d.global.tempAddElements[h].id===E[v].elementsList[m].parent_element_id&&(E[v].elementsList[m].element_price=s.roundingValue(a.currencyExgange(d.global.tempAddElements[h].price,d.global.tempAddElements[h].currency_id),2));g.push(angular.copy(E[v].elementsList[m]))}g.length?(g=o("orderBy")(g,"name"),r.push(g)):n.push(p)}if(r.length?E[v].elementsList=angular.copy(r):E[v].elementsList=0,y=n.length)for(;--y>-1;)E[v].elementType.splice(n[y],1)}else if(c=E[v].elementsList[0].length){for(m=0;c>m;m+=1)E[v].elementsList[0][m].element_width=1e3,E[v].elementsList[0][m].element_height=1e3,E[v].elementsList[0][m].element_qty=1,E[v].elementsList[0][m].list_group_id=20;G(E[v].elementsList[0])}t.resolve(1)}),t.promise}function V(){var t=e.defer();return M().then(function(){k().then(function(){B().then(function(){t.resolve(1)})})}),t.promise}function U(){a.selectLocalDB(a.tablesLocalDB.users_deliveries.tableName).then(function(e){e.length&&(d.global.supplyData=angular.copy(e))}),a.selectLocalDB(a.tablesLocalDB.users_mountings.tableName).then(function(e){e.length&&(d.global.assemblingData=angular.copy(e))}),l.getInstalment(function(e){e.status?d.global.instalmentsData=e.data.instalment:console.log(e)})}function H(e,t){var i,r,o,a,n,s,l,c,u,p,g=d.global.profiles.length;if(e.length)for(o=e.filter(function(e){return 2===e.list_group_id}),a=e.filter(function(e){return 3===e.list_group_id}),n=o.length,s=a.length;--g>-1;)for(i=d.global.profiles[g].length;--i>-1;){for(r={},u=0,p=0,l=0;n>l;l+=1)o[l].id===d.global.profiles[g][i].rama_list_id&&(u=o[l]);for(c=0;s>c;c+=1)a[c].id===d.global.profiles[g][i].stvorka_list_id&&(p=a[c]);u&&p&&(r.profileId=d.global.profiles[g][i].id,r.frame=u,r.sash=p,t.push(r))}}function F(){var t=d.global.doorHandlers.map(function(t){var i=e.defer();return a.selectLocalDB(a.tablesLocalDB.lock_lists.tableName,{accessory_id:t.id},"list_id").then(function(t){if(t.length){var r=t.map(function(t){var i=e.defer();return a.selectLocalDB(a.tablesLocalDB.lists.tableName,{id:t.list_id},"id, name, list_type_id, parent_element_id").then(function(e){i.resolve(e[0])}),i.promise});i.resolve(e.all(r))}else i.resolve(0)}),i.promise});e.all(t).then(function(e){d.global.doorLocks=angular.copy(e)})}function z(e){var t,i,r,o,a=[],n=e.length;for(o=0;n>o;o+=1){for(t=d.global.profiles.length,r=0;--t>-1;)for(i=d.global.profiles[t].length;--i>-1;)d.global.profiles[t][i].id===e[o].profile_system_id&&(r=1);r&&a.push(e[o].profile_system_id)}return a.join(", ")}function Y(){var t="id, name, list_type_id, parent_element_id";a.selectLocalDB(a.tablesLocalDB.lists.tableName,{list_type_id:35},t).then(function(i){d.global.doorHandlers=d.global.doorHandlers.concat(i),a.selectLocalDB(a.tablesLocalDB.lists.tableName,{list_type_id:36},t).then(function(t){d.global.doorHandlers=d.global.doorHandlers.concat(t),F();var i=d.global.doorHandlers.map(function(t){var i=e.defer();return a.selectLocalDB(a.tablesLocalDB.elements_profile_systems.tableName,{element_id:t.parent_element_id},"profile_system_id").then(function(e){i.resolve(e)}),i.promise});e.all(i).then(function(e){var t,i=d.global.doorHandlers.length;for(t=0;i>t;t+=1)d.global.doorHandlers[t].profIds=z(e[t])})})})}function W(){a.selectLocalDB(a.tablesLocalDB.lists.tableName,{in_door:1},"id, name, list_group_id, doorstep_type").then(function(e){var t,i,r=angular.copy(e),o=r.length;o?(t=r.filter(function(e){return 1===e.doorstep_type}),i=r.filter(function(e){return 2===e.doorstep_type}),H(t,d.global.doorKitsT1),H(i,d.global.doorKitsT2),Y()):d.global.noDoorExist=1})}function q(){var t=e.defer();return A().then(function(e){e&&S().then(function(e){e&&T().then(function(e){e&&e.length?(d.global.margins=angular.copy(e[0]),x().then(function(e){e&&e.length?(d.global.deliveryCoeff=angular.copy(e[0]),d.global.deliveryCoeff.percents=e[0].percents.split(",").map(function(e){return+e}),b(),L(a.tablesLocalDB.profile_system_folders.tableName,a.tablesLocalDB.profile_systems.tableName,d.global.profilesType,d.global.profiles).then(function(e){e&&D().then(function(e){e&&(C(),L(a.tablesLocalDB.window_hardware_folders.tableName,a.tablesLocalDB.window_hardware_groups.tableName,d.global.hardwareTypes,d.global.hardwares).then(function(e){e&&(W(),O(),R().then(function(){V().then(function(){P().then(function(e){e&&e.length&&(d.global.laminats=angular.copy(e).map(function(e){return e.isActive=0,e}),d.global.laminats.push({id:1,type_id:1,isActive:0,name:o("translate")("mainpage.WHITE_LAMINATION")}),w().then(function(){d.global.laminatCouples.push(angular.copy(u.product.lamination))})),U(),t.resolve(1)})})}))}))})})):(console.error("not find options_discounts!"),t.resolve(0))})):(console.error("not find options_coefficients!"),t.resolve(0))})})}),t.promise}var Q=this;return Q.publicObj={getDeviceLanguage:m,initExport:f,isLocalDBExist:_,prepareLocationToUse:y,downloadAllCities:h,collectCityIdsAsCountry:E,setUserLocation:I,setUserGeoLocation:v,downloadAllData:q,getGridPrice:G},Q.publicObj}])}(),function(){angular.module("MainModule").factory("MainServ",["$location","$q","$filter","$timeout","localDB","GeneralServ","SVGServ","loginServ","optionsServ","AnalyticsServ","GlobalStor","OrderStor","ProductStor","UserStor","AuxStor","CartStor","DesignStor","HistoryStor",function(e,t,i,r,o,a,n,s,l,d,c,u,p,g,m,f,_,h){function y(){c.global.showRoomSelectorDialog=0,c.global.configMenuTips=c.global.startProgramm?1:0}function E(){p.product.door_shape_id=0,p.product.door_sash_shape_id=0,p.product.door_handle_shape_id=0,p.product.door_lock_shape_id=0}function v(){m.aux.isWindowSchemeDialog=0,m.aux.isAddElementListView=0,m.aux.isFocusedAddElement=0,m.aux.isTabFrame=0,m.aux.isAddElementListView=0,m.aux.showAddElementsMenu=0,m.aux.addElementGroups.length=0,m.aux.searchingWord="",m.aux.isGridSelectorDialog=0}function b(){c.global.isNavMenu=0,c.global.isConfigMenu=1,c.global.activePanel=0,v(),c.global.startProgramm&&(r(function(){c.global.showRoomSelectorDialog=1},2e3),r(y,5e3))}function I(){r(function(){o.exportUserEntrance(g.userInfo.phone,g.userInfo.device_code)},5e3)}function A(){var e=(new Date).getTime().toString();return 1*(g.userInfo.id+""+e.slice(4,e.length))}function S(){var e;u.order.id=A(),u.order.order_date=(new Date).getTime(),e=new Date(u.order.order_date).getDate()+c.global.deliveryCoeff.standart_time,u.order.delivery_date=(new Date).setDate(e),u.order.new_delivery_date=angular.copy(u.order.delivery_date)}function T(){u.order.discount_construct=angular.copy(g.userInfo.discountConstr),u.order.discount_addelem=angular.copy(g.userInfo.discountAddElem)}function x(){p.product.construction_type=c.global.rooms[0].group_id,p.product.template_id=c.global.rooms[0].template_id-1}function N(e){var r=t.defer();switch(e){case 1:l.getTemplatesWindow(function(e){e.status?(c.global.templateLabel=i("translate")("panels.TEMPLATE_WINDOW"),r.resolve(e.data.windows)):console.log(e)});break;case 2:l.getTemplatesWindowDoor(function(e){e.status?(c.global.templateLabel=i("translate")("panels.TEMPLATE_BALCONY_ENTER"),r.resolve(e.data.windowDoor)):console.log(e)});break;case 3:l.getTemplatesBalcony(function(e){e.status?(c.global.templateLabel=i("translate")("panels.TEMPLATE_BALCONY"),r.resolve(e.data.balconies)):console.log(e)});break;case 4:l.getTemplatesDoor(function(e){e.status?(c.global.templateLabel=i("translate")("panels.TEMPLATE_DOOR"),r.resolve(e.data.doors)):console.log(e)})}return r.promise}function L(e,t){for(var i,r=t.length;--r>-1;)for(i=t[r].length;--i>-1;)if(t[r][i].id===e)return t[r][i]}function D(e){var i=t.defer();return o.selectLocalDB(o.tablesLocalDB.lists.tableName,{id:e}).then(function(e){var t={};e.length&&(t.a=e[0].a,t.b=e[0].b,t.c=e[0].c,t.d=e[0].d),i.resolve(t)}),i.promise}function C(e,i){var r=t.defer();return i?e.profile=angular.copy(L(i,c.global.profiles)):e.profile=angular.copy(c.global.profiles[0][0]),t.all([D(e.profile.rama_list_id),D(e.profile.rama_still_list_id),D(e.profile.stvorka_list_id),D(e.profile.impost_list_id),D(e.profile.shtulp_list_id)]).then(function(t){e.profileDepths.frameDepth=t[0],e.profileDepths.frameStillDepth=t[1],e.profileDepths.sashDepth=t[2],e.profileDepths.impostDepth=t[3],e.profileDepths.shtulpDepth=t[4],r.resolve(1)}),r.promise}function O(e){for(var t=e.details.length,i=[];--t>0;)e.details[t].children.length||e.details[t].glassId&&i.push(angular.copy(e.details[t].glassId));return i}function R(e,t,i,r){for(var o=e.details.length;--o>0;)if(r){if(e.details[o].id===r){e.details[o].glassId=t,e.details[o].glassTxt=i;break}}else e.details[o].glassId=t,e.details[o].glassTxt=i}function P(e,t){if(e.glass.length=0,t)for(var i=a.removeDuplicates(O(p.product.template)),r=i.length;--r>-1;)e.glass.push(L(i[r],c.global.glasses));else{var o=c.global.glassesAll.filter(function(t){return t.profileId===e.profile.id});o.length&&(c.global.glassTypes=angular.copy(o[0].glassTypes),c.global.glasses=angular.copy(o[0].glasses),e.glass.push(angular.copy(c.global.glasses[0][0])),c.global.selectGlassId=e.glass[0].id,c.global.selectGlassName=e.glass[0].sku,R(p.product.template_source,e.glass[0].id,e.glass[0].sku))}}function w(e){for(var t=e.details.length,i=0;--t>0;)"sash"===e.details[t].blockType&&(i+=1);return i}function M(e){var i=t.defer();return c.global.isChangedTemplate||(p.product.template_source=angular.copy(c.global.templatesSource[e])),P(p.product),n.createSVGTemplate(p.product.template_source,p.product.profileDepths).then(function(e){p.product.template=angular.copy(e),c.global.isSashesInTemplate=w(p.product.template_source),n.createSVGTemplateIcon(p.product.template_source,p.product.profileDepths).then(function(e){c.global.isRoomElements=1,p.product.templateIcon=angular.copy(e),i.resolve(1)})}),i.promise}function k(e){var i=t.defer();return p.product.template_source,n.createSVGTemplate(p.product.template_source,p.product.profileDepths).then(function(e){p.product.template=angular.copy(e),c.global.isSashesInTemplate=w(p.product.template_source),c.global.isRoomElements=1,i.resolve(1)}),i.promise}function G(e,t){t?e.hardware=L(t,c.global.hardwares):c.global.isSashesInTemplate?e.hardware=c.global.hardwares[0][0]:e.hardware={}}function B(e,i){var r=t.defer(),a=p.product.glass.map(function(r){var a=t.defer();return r.glass_width?o.selectLocalDB(o.tablesLocalDB.beed_profile_systems.tableName,{profile_system_id:e,glass_width:r.glass_width},"list_id").then(function(e){var n=e.length,s={glassId:r.id,beadId:0};if(n)if(n>1){var l=e.map(function(e){var r=t.defer();return o.selectLocalDB(o.tablesLocalDB.lists.tableName,{id:e.list_id},"beed_lamination_id as id").then(function(e){e&&e[0].id===i?r.resolve(1):r.resolve(0)}),r.promise});t.all(l).then(function(t){for(var i=t.length;--i>-1;)t[i]&&(s.beadId=e[i].list_id,a.resolve(s));s.beadId||(console.log("Error in bead!!"),a.resolve(0))})}else s.beadId=e[0].list_id,a.resolve(s);else console.log("Error in bead!!"),a.resolve(0)}):(console.log("item.glass_width === 0"),a.resolve(0)),a.promise});return r.resolve(t.all(a)),r.promise}function V(e){var t=c.global.deliveryCoeff.percents[c.global.deliveryCoeff.standart_time],i=a.setPriceDis(e.template_price,u.order.discount_construct);e.product_price=a.roundingValue(e.template_price+e.addelem_price),e.productPriceDis=i+e.addelemPriceDis,t&&(e.productPriceDis=a.setPriceDis(e.productPriceDis,t)),c.global.isLoader=0}function U(e){var i=t.defer();return o.calculationPrice(e).then(function(e){var t,r=angular.copy(e);r.priceTotal?4===p.product.construction_type?o.calcDoorElemPrice(p.product.doorHandle,p.product.doorLock).then(function(e){r.priceTotal+=e.priceTot,angular.extend(r.constrElements,e.elements),t=a.addMarginToPrice(r.priceTotal,c.global.margins.coeff),p.product.template_price=a.roundingValue(t,2),V(p.product),i.resolve(r)}):(t=a.addMarginToPrice(r.priceTotal,c.global.margins.coeff),p.product.template_price=a.roundingValue(t,2),V(p.product),i.resolve(r)):(p.product.template_price=0,i.resolve(0))}),i.promise}function H(e){var t,i,r,o,n,s=[],l=e.length;if(l){for(t=0;l>t;t+=1)if(i=angular.copy(e[t]),i.element_id=angular.copy(i.id),i.amount=angular.copy(i.qty),delete i.id,delete i.amendment_pruninng,delete i.currency_id,delete i.qty,delete i.waste,t){if(r=s.length,o=0,r){for(;--r>-1;)s[r].element_id===i.element_id&&s[r].size===i.size&&(o++,s[r].amount+=i.amount,s[r].priceReal+=i.priceReal);o||s.push(i)}}else s.push(i);for(r=s.length;--r>-1;)s[r].amount=a.roundingValue(s[r].amount,3),n=a.addMarginToPrice(s[r].priceReal,c.global.margins.coeff),s[r].priceReal=a.roundingValue(n,2)}return s}function F(e){for(var t,i=0,r=e.sizes[5].length,o=p.product.glass.length,n=0,s=0,l=0;--r>-1;){for(t=0;o>t;t+=1)e.sizes[5][r].elemId==p.product.glass[t].id&&(angular.isNumber(p.product.glass[t].transcalency)||(p.product.glass[t].transcalency=1),n+=p.product.glass[t].transcalency*e.sizes[5][r].square);i+=e.sizes[5][r].square}n=a.roundingValue(n),i=a.roundingValue(i,3),angular.isNumber(p.product.profile.heat_coeff_value)||(p.product.profile.heat_coeff_value=1),s=p.product.profile.heat_coeff_value*(p.product.template_square-i),l=s+n,g.userInfo.therm_coeff_id?p.product.heat_coef_total=a.roundingValue(l/p.product.template_square):p.product.heat_coef_total=a.roundingValue(p.product.template_square/l)}function z(e,i,o,n,s){var l=t.defer();return c.global.isLoader=1,B(i,s).then(function(t){if(t.length&&t[0]){var i=a.removeDuplicates(angular.copy(t).map(function(t){for(var i=e.priceElements.beadsSize.length;--i>-1;)e.priceElements.beadsSize[i].glassId===t.glassId&&(e.priceElements.beadsSize[i].elemId=t.beadId);return t.beadId})),m={laminationId:s,ids:[p.product.profile.rama_list_id,p.product.profile.rama_still_list_id,p.product.profile.stvorka_list_id,p.product.profile.impost_list_id,p.product.profile.shtulp_list_id,o.length>1?o.map(function(e){return e.id}):o[0].id,i.length>1?i:i[0],4===p.product.construction_type?0:n],sizes:[]};p.product.beadsData=angular.copy(e.priceElements.beadsSize);for(var f in e.priceElements)m.sizes.push(angular.copy(e.priceElements[f]));p.product.template_width=0,p.product.template_height=0,p.product.template_square=0;for(var _=p.product.template.details[0].overallDim.length;--_>-1;)p.product.template_width+=p.product.template.details[0].overallDim[_].w,p.product.template_height+=p.product.template.details[0].overallDim[_].h,p.product.template_square+=p.product.template.details[0].overallDim[_].square;U(m).then(function(e){l.resolve(1),e&&(5!==g.userInfo.user_type&&7!==g.userInfo.user_type||(p.product.report=H(e.constrElements)))}),F(m),c.global.startProgramm&&r(function(){d.sendAnalyticsData(g.userInfo.id,u.order.id,p.product.template_id,p.product.profile.id,1)},5e3)}else l.resolve(1)}),l.promise}function Y(){var e=t.defer();return M(p.product.template_id).then(function(){G(p.product);var t=p.product.hardware.id||0;z(p.product.template,p.product.profile.id,p.product.glass,t,p.product.lamination.lamination_in_id).then(function(){e.resolve(1)})}),e.promise}function W(e){var i=t.defer();return N(e).then(function(e){e?(c.global.templatesSourceSTORE=angular.copy(e),c.global.templatesSource=angular.copy(e),C(p.product).then(function(){Y().then(function(){i.resolve(1)})})):i.resolve(0)}),i.promise}function q(e){for(var t=c.global.lamGroupFiltered.length,i=1;--t>-1;)c.global.lamGroupFiltered[t].id===e&&(i=0);return i}function Q(){var e,t=c.global.laminats.length,i=c.global.laminatCouples.filter(function(e){return e.profile_id?e.profile_id===p.product.profile.id:!0}),r=0;for(c.global.lamGroupFiltered.length=0;--t>-1;)if(c.global.laminats[t].isActive)for(r=1,e=i.length;--e>-1;)i[e].img_in_id===c.global.laminats[t].type_id?q(i[e].id)&&c.global.lamGroupFiltered.push(i[e]):i[e].img_out_id===c.global.laminats[t].type_id&&q(i[e].id)&&c.global.lamGroupFiltered.push(i[e]);c.global.lamGroupFiltered.length||r||(c.global.lamGroupFiltered=i)}function j(){for(var e=c.global.laminats.length;--e>-1;)c.global.laminats[e].isActive=0}function K(e,t){var i=c.global.laminatCouples.length;for(j();--i>-1;)t?c.global.laminatCouples[i].id===t&&(e.lamination=c.global.laminatCouples[i]):c.global.laminatCouples[i].id||(e.lamination=c.global.laminatCouples[i])}function X(e){var i=t.defer();return e?(p.product.profile.rama_list_id=p.product.lamination.rama_list_id,p.product.profile.rama_still_list_id=p.product.lamination.rama_still_list_id,p.product.profile.stvorka_list_id=p.product.lamination.stvorka_list_id,p.product.profile.impost_list_id=p.product.lamination.impost_list_id,p.product.profile.shtulp_list_id=p.product.lamination.shtulp_list_id):p.product.profile=angular.copy(L(p.product.profile.id,c.global.profiles)),t.all([D(p.product.profile.rama_list_id),D(p.product.profile.rama_still_list_id),D(p.product.profile.stvorka_list_id),D(p.product.profile.impost_list_id),D(p.product.profile.shtulp_list_id)]).then(function(e){p.product.profileDepths.frameDepth=e[0],p.product.profileDepths.frameStillDepth=e[1],p.product.profileDepths.sashDepth=e[2],p.product.profileDepths.impostDepth=e[3],p.product.profileDepths.shtulpDepth=e[4],n.createSVGTemplate(p.product.template_source,p.product.profileDepths).then(function(e){p.product.template=angular.copy(e);var t=p.product.hardware.id||0;z(p.product.template,p.product.profile.id,p.product.glass,t,p.product.lamination.lamination_in_id).then(function(){i.resolve(1)}),n.createSVGTemplateIcon(p.product.template_source,p.product.profileDepths).then(function(e){p.product.templateIcon=angular.copy(e)})})}),i.promise}function Z(e){var t,r,o,n,s,l,d,c,u=e.details,g=u.length;_.design.extraGlass.length=0,p.product.glass.forEach(function(e){if(e.max_sq||e.max_width&&e.max_height&&e.min_width&&e.min_height)for(c=1;g>c;c+=1)l=0,d=0,u[c].glassId===e.id&&u[c].glassPoints&&u[c].glassPoints.length&&(r=a.getMaxMinCoord(u[c].glassPoints),o=Math.round(r.maxX-r.minX),n=Math.round(r.maxY-r.minY),s=a.roundingValue(o*n/1e6,3),s>e.max_sq&&(t=i("translate")("design.GLASS")+" "+e.name+" "+i("translate")("design.GLASS_SQUARE")+" "+s+" "+i("translate")("design.MAX_VALUE_HIGHER")+" "+e.max_sq+" "+i("translate")("common_words.LETTER_M")+"2.",_.design.extraGlass.push(t)),(o>e.max_width||o<e.min_width)&&(l=1),(n>e.max_height||n<e.min_height)&&(d=1),l&&d?(t=i("translate")("design.GLASS")+" "+e.name+" "+i("translate")("design.GLASS_SIZE")+" "+o+" x "+n+" "+i("translate")("design.NO_MATCH_RANGE")+" "+i("translate")("design.BY_WIDTH")+" "+e.min_width+" - "+e.max_width+", "+i("translate")("design.BY_HEIGHT")+" "+e.min_height+" - "+e.max_height+".",_.design.extraGlass.push(t)):l&&!d?(t=i("translate")("design.GLASS")+" "+e.name+" "+i("translate")("design.GLASS_SIZE")+" "+o+" x "+n+" "+i("translate")("design.NO_MATCH_RANGE")+" "+i("translate")("design.BY_WIDTH")+" "+e.min_width+" - "+e.max_width+".",_.design.extraGlass.push(t)):!l&&d&&(t=i("translate")("design.GLASS")+" "+e.name+" "+i("translate")("design.GLASS_SIZE")+" "+o+" x "+n+" "+i("translate")("design.NO_MATCH_RANGE")+" "+i("translate")("design.BY_HEIGHT")+" "+e.min_height+" - "+e.max_height+".",_.design.extraGlass.push(t)))})}function J(e,t){var r,o,n,s,l,d,u,g=e.details,m=g.length,f=t||p.product.hardware.id,h=c.global.hardwareLimits.filter(function(e){return e.group_id===f}),y=h.length,E=0;if(_.design.extraHardware.length=0,y)for(d=1;m>d;d+=1)if(l=0,"sash"===g[d].blockType){for(u=0;y>u;u+=1)if(h[u].type_id===g[d].sashType){h[u].max_width&&h[u].max_height&&h[u].min_width&&h[u].min_height&&(E=h[u]);break}E&&g[d].hardwarePoints.length&&(r=a.getMaxMinCoord(g[d].hardwarePoints),o=Math.round(r.maxX-r.minX),n=Math.round(r.maxY-r.minY),(o>E.max_width||o<E.min_width)&&(l=1),(n>E.max_height||n<E.min_height)&&(l=1),l&&(s=o+" x "+n+" "+i("translate")("design.NO_MATCH_RANGE")+" ("+E.min_width+" - "+E.max_width+") x ("+E.min_height+" - "+E.max_height+")",_.design.extraHardware.push(s)))}}function ee(e,t){if(c.global.isInfoBox!==e){for(var i=t.length,r={};--i>-1;)t[i].lamination_type_id?t[i].lamination_type_id===e&&(r=t[i]):t[i].id===e&&(r=t[i]);$.isEmptyObject(r)||(c.global.infoTitle=r.name,c.global.infoImg=r.img,c.global.infoLink=r.link,c.global.infoDescrip=r.description,c.global.isInfoBox=e)}}function te(){console.log("new project!!!!!!!!!!!!!!",u.order),p.product=p.setDefaultProduct(),S(),T(),c.global.isChangedTemplate=0,c.global.isShowCommentBlock=0,c.global.isCreatedNewProject=1,c.global.isCreatedNewProduct=1,x(),W(p.product.construction_type).then(function(){c.global.isLoader=0,b(),j(),Q(),"main"!==c.global.currOpenPage&&(c.global.showRoomSelectorDialog=0,e.path("/main"),r(function(){c.global.showRoomSelectorDialog=1},1e3))})}function ie(){console.log("new product!!!!!!!!!!!!!!!"),p.product=p.setDefaultProduct(),c.global.isCreatedNewProduct=1,c.global.isChangedTemplate=0,x(),W(p.product.construction_type).then(function(){b(),j(),Q(),"main"!==c.global.currOpenPage&&(c.global.showRoomSelectorDialog=0,e.path("/main"),r(function(){c.global.showRoomSelectorDialog=1},1e3))})}function re(){for(var e=p.product.chosenAddElements.length,t=0;--e>-1;)p.product.chosenAddElements[e].length&&t++;return t}function oe(){var e=1;if(p.product.is_addelem_only&&(e=re()),e){if(c.global.tempAddElements.length=0,c.global.configMenuTips=0,c.global.isShowCommentBlock=0,v(),c.global.productEditNumber)for(var t=u.order.products.length;--t>-1;)u.order.products[t].product_id===c.global.productEditNumber&&(u.order.products[t]=angular.copy(p.product));else p.product.product_id=u.order.products.length>0?u.order.products.length+1:1,delete p.product.template,u.order.products.push(p.product);c.global.isCreatedNewProduct=0,a.stopStartProg()}return e}function ae(){r(function(){a.setPreviosPage(),e.path("/cart")},100)}function ne(e){o.deleteRowLocalDB(o.tablesLocalDB.orders.tableName,{id:e}),o.deleteRowLocalDB(o.tablesLocalDB.order_products.tableName,{order_id:e}),o.deleteRowLocalDB(o.tablesLocalDB.order_addelements.tableName,{order_id:e})}function se(e,i,r){var n=t.defer();c.global.orderEditNumber&&(ne(c.global.orderEditNumber),o.deleteOrderServer(g.userInfo.phone,g.userInfo.device_code,c.global.orderEditNumber),c.global.orderEditNumber=0),angular.extend(u.order,e);var l,d=u.order.products.length;for(u.order.products_qty=0,l=0;d>l;l+=1){var p=angular.copy(u.order.products[l]);p.order_id=u.order.id,p.is_addelem_only||(p.template_source.beads=angular.copy(p.beadsData)),p.template_source=JSON.stringify(p.template_source),p.profile_id=u.order.products[l].profile.id,p.glass_id=u.order.products[l].glass.map(function(e){return e.id}).join(", "),p.hardware_id=u.order.products[l].hardware.id||0,p.lamination_id=u.order.products[l].lamination.id,p.lamination_in_id=u.order.products[l].lamination.lamination_in_id,p.lamination_out_id=u.order.products[l].lamination.lamination_out_id,p.modified=new Date,p.template&&delete p.template,delete p.templateIcon,delete p.profile,delete p.glass,delete p.hardware,delete p.lamination,delete p.chosenAddElements,delete p.profileDepths,delete p.addelemPriceDis,delete p.productPriceDis,delete p.report,delete p.beadsData,delete p.doorName,delete p.doorSashName,delete p.doorHandle,delete p.doorLock,u.order.products_qty+=u.order.products[l].product_qty,console.log("SEND PRODUCT------",p),o.insertRowLocalDB(p,o.tablesLocalDB.order_products.tableName),i&&o.insertServer(g.userInfo.phone,g.userInfo.device_code,o.tablesLocalDB.order_products.tableName,p);for(var m=angular.copy(u.order.products[l].report),_=m.length;--_>-1;)m[_].order_id=u.order.id,m[_].price=angular.copy(m[_].priceReal),delete m[_].priceReal;var h,y=u.order.products[l].chosenAddElements.length;for(h=0;y>h;h+=1){var E,v=u.order.products[l].chosenAddElements[h].length;if(v>0)for(E=0;v>E;E+=1){var b={order_id:u.order.id,product_id:u.order.products[l].product_id,element_type:u.order.products[l].chosenAddElements[h][E].element_type,element_id:u.order.products[l].chosenAddElements[h][E].id,name:u.order.products[l].chosenAddElements[h][E].name,element_width:u.order.products[l].chosenAddElements[h][E].element_width,element_height:u.order.products[l].chosenAddElements[h][E].element_height,element_price:u.order.products[l].chosenAddElements[h][E].element_price,element_qty:u.order.products[l].chosenAddElements[h][E].element_qty,block_id:u.order.products[l].chosenAddElements[h][E].block_id,modified:new Date};console.log("SEND ADD",b),o.insertRowLocalDB(b,o.tablesLocalDB.order_addelements.tableName),i&&o.insertServer(g.userInfo.phone,g.userInfo.device_code,o.tablesLocalDB.order_addelements.tableName,b)}}}var I=angular.copy(u.order);return I.order_date=new Date(u.order.order_date),I.order_type=i,I.order_style=r,I.factory_id=g.userInfo.factory_id,I.user_id=g.userInfo.id,I.delivery_date=new Date(u.order.delivery_date),I.new_delivery_date=new Date(u.order.new_delivery_date),I.customer_sex=+u.order.customer_sex||0,I.customer_age=u.order.customer_age?u.order.customer_age.id:0,I.customer_education=u.order.customer_education?u.order.customer_education.id:0,I.customer_occupation=u.order.customer_occupation?u.order.customer_occupation.id:0,I.customer_infoSource=u.order.customer_infoSource?u.order.customer_infoSource.id:0,I.products_qty=a.roundingValue(u.order.products_qty),I.discount_construct_max=g.userInfo.discountConstrMax,I.discount_addelem_max=g.userInfo.discountAddElemMax,I.default_term_plant=c.global.deliveryCoeff.percents[c.global.deliveryCoeff.standart_time],I.disc_term_plant=f.cart.discountDeliveyPlant,I.margin_plant=f.cart.marginDeliveyPlant,i&&(I.additional_payment="",I.created=new Date,I.sended=new Date(0),I.state_to=new Date(0),I.state_buch=new Date(0),I.batch="---",I.base_price=0,I.factory_margin=0,I.purchase_price=0,I.sale_price=0,I.modified=new Date),delete I.products,delete I.floorName,delete I.mountingName,delete I.selectedInstalmentPeriod,delete I.selectedInstalmentPercent,delete I.productsPriceDis,delete I.orderPricePrimaryDis,delete I.paymentFirstDis,delete I.paymentMonthlyDis,delete I.paymentFirstPrimaryDis,delete I.paymentMonthlyPrimaryDis,console.log("!!!!orderData!!!!",I),i?o.insertServer(g.userInfo.phone,g.userInfo.device_code,o.tablesLocalDB.orders.tableName,I).then(function(e){e.status&&(I.order_number=e.order_number),o.insertRowLocalDB(I,o.tablesLocalDB.orders.tableName),n.resolve(1)}):(o.insertRowLocalDB(I,o.tablesLocalDB.orders.tableName),
n.resolve(1)),u.order=u.setDefaultOrder(),s.setUserGeoLocation(g.userInfo.city_id,g.userInfo.cityName,g.userInfo.climaticZone,g.userInfo.heatTransfer,g.userInfo.fullLocation),c.global.isCreatedNewProject=0,n.promise}function le(e,i){console.log("OrderStor.order",u.order);var r,a=t.defer(),n=u.order.products.length;for(u.order.products_qty=0,r=0;n>r;r+=1){var s=angular.copy(u.order.products[r]);s.order_id=p.product.order_id,s.is_addelem_only||(s.template_source.beads=angular.copy(s.beadsData)),s.template_source=JSON.stringify(s.template_source),s.profile_id=u.order.products[r].profile.id,s.glass_id=u.order.products[r].glass.map(function(e){return e.id}).join(", "),void 0===u.order.products[r].hardware?s.hardware_id=0:s.hardware_id=u.order.products[r].hardware.id,s.lamination_id=u.order.products[r].lamination.id,s.lamination_in_id=u.order.products[r].lamination.lamination_in_id,s.lamination_out_id=u.order.products[r].lamination.lamination_out_id,s.modified=new Date,o.updateLocalServerDBs(o.tablesLocalDB.orders.tableName,e,{order_price_dis:i}),s.template&&delete s.template,delete s.templateIcon,delete s.profile,delete s.glass,delete s.hardware,delete s.lamination,delete s.chosenAddElements,delete s.profileDepths,delete s.addelemPriceDis,delete s.productPriceDis,delete s.report,delete s.beadsData,delete s.doorName,delete s.doorSashName,delete s.doorHandle,delete s.doorLock,u.order.products_qty+=u.order.products[r].product_qty,console.log("SEND PRODUCT------",s),o.insertRowLocalDB(s,o.tablesLocalDB.order_products.tableName),o.insertServer(g.userInfo.phone,g.userInfo.device_code,o.tablesLocalDB.order_products.tableName,s);var l=angular.copy(u.order.products[r].report);l.length}return c.global.isCreatedNewProject=0,a.promise}var de=this;return de.publicObj={saveUserEntry:I,saveOrderInDBnew:le,createOrderData:S,createOrderID:A,setCurrDiscounts:T,setCurrTemplate:x,prepareTemplates:W,downloadAllTemplates:N,setCurrentProfile:C,setCurrentGlass:P,setGlassToTemplateBlocks:R,setCurrentHardware:G,fineItemById:L,parseTemplate:Y,saveTemplateInProduct:M,saveTemplateInProductForOrder:k,checkSashInTemplate:w,preparePrice:z,setProductPriceTOTAL:V,showInfoBox:ee,closeRoomSelectorDialog:y,laminatFiltering:Q,setCurrLamination:K,setProfileByLaminat:X,checkGlassSizes:Z,checkHardwareSizes:J,createNewProject:te,createNewProduct:ie,setDefaultDoorConfig:E,prepareMainPage:b,setDefaultAuxParam:v,inputProductInOrder:oe,goToCart:ae,saveOrderInDB:se,deleteOrderInDB:ne},de.publicObj}])}(),function(){angular.module("MainModule").factory("NavMenuServ",["$location","$http","$filter","$cordovaGeolocation","GeneralServ","MainServ","CartMenuServ","GlobalStor","OrderStor","ProductStor",function(e,t,i,r,o,a,n,s,l,d){function c(){function e(e){var i=e.coords.latitude,r=e.coords.longitude;t.get("http://maps.googleapis.com/maps/api/geocode/json?latlng="+i+","+r+"&sensor=true&language=ru").then(function(e){var t=e.results[0].formatted_address.split(", ");l.order.customer_city_id=156,l.order.customer_city=t[t.length-3],l.order.climatic_zone=7,l.order.heat_coef_min=.99,l.order.customer_location=t[t.length-3]+", "+t[t.length-2]+", "+t[t.length-1]},function(e,t){console.log("Something went wrong with User recive!",e,t)})}function i(e){console.log(e.message)}r.getCurrentPosition().then(e,i)}function u(){var e="ru_RU";return e}function p(){s.global.isVoiceHelper=!s.global.isVoiceHelper,s.global.isVoiceHelper&&(s.global.voiceHelperLanguage=u(),playTTS(i("translate")("construction.VOICE_SWITCH_ON"),s.global.voiceHelperLanguage))}function g(){s.global.isNavMenu=!1,s.global.isConfigMenu=!0,o.setPreviosPage(),e.path("/history")}function m(){o.stopStartProg(),d.product.is_addelem_only?a.createNewProduct():(d.product=d.setDefaultProduct(),a.closeRoomSelectorDialog(),a.setDefaultAuxParam(),d.product.is_addelem_only=1,s.global.isNavMenu=0,s.global.isConfigMenu=1,s.global.activePanel=6)}function f(){s.global.startProgramm?(o.stopStartProg(),a.prepareMainPage()):(s.global.isLoader=1,s.global.isCreatedNewProject&&s.global.isCreatedNewProduct?a.inputProductInOrder()&&(n.calculateOrderPrice(),a.saveOrderInDB({},0,"")):s.global.isCreatedNewProject&&!s.global.isCreatedNewProduct&&a.saveOrderInDB({},0,""),o.setPreviosPage(),a.createNewProject())}var _=this;return _.publicObj={getCurrentGeolocation:c,setLanguageVoiceHelper:u,switchVoiceHelper:p,gotoHistoryPage:g,createAddElementsProduct:m,clickNewProject:f},_.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("optionsServ",["$filter",function(e){return{getTemplateImgIcons:function(t){t(new OkResult({templateImgs:[{id:1,name:e("translate")("panels.ONE_WINDOW_TYPE"),src:"img/templates/1.png"},{id:2,name:e("translate")("panels.TWO_WINDOW_TYPE"),src:"img/templates/3.png"},{id:3,name:e("translate")("panels.THREE_WINDOW_TYPE"),src:"img/templates/4.png"},{id:4,name:e("translate")("panels.TWO_WINDOW_TYPE"),src:"img/templates/5.png"},{id:5,name:e("translate")("panels.TWO_WINDOW_TYPE"),src:"img/templates/6.png"},{id:6,name:e("translate")("panels.TWO_WINDOW_TYPE"),src:"img/templates/7.png"},{id:7,name:e("translate")("panels.ONE_WINDOW_TYPE"),src:"img/templates/8.png"},{id:8,name:e("translate")("panels.TWO_WINDOW_TYPE"),src:"img/templates/9.png"},{id:9,name:e("translate")("panels.THREE_WINDOW_TYPE"),src:"img/templates/10.png"},{id:10,name:e("translate")("panels.THREE_WINDOW_TYPE"),src:"img/templates/11.png"},{id:11,name:e("translate")("panels.THREE_WINDOW_TYPE"),src:"img/templates/12.png"}]}))},getTemplatesWindow:function(e){e(new OkResult({windows:[{name:"Глухое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:[],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1300,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1300,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Двухстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:530,y:0,dir:"line"},{type:"impost",id:"ip1",x:530,y:1320,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1060,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1060,y:1320,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1320,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Трехстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:700,y:0,dir:"line"},{type:"impost",id:"ip1",x:700,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:2100,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:2100,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],pointsOut:[],pointsIn:[],pointsLight:[],impost:{impostAxis:[{type:"impost",id:"ip3",x:1400,y:0,dir:"line"},{type:"impost",id:"ip3",x:1400,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Двухстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:530,y:0,dir:"line"},{type:"impost",id:"ip1",x:530,y:1320,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1060,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1060,y:1320,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1320,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],impost:{impostAxis:[{type:"impost",id:"ip3",x:0,y:300,dir:"line"},{type:"impost",id:"ip3",x:530,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Двухстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:530,y:0,dir:"line"},{type:"impost",id:"ip1",x:530,y:1320,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1060,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1060,y:1320,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1320,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],pointsOut:[],pointsIn:[],pointsLight:[],impost:{impostAxis:[{type:"impost",id:"ip3",x:1060,y:300,dir:"line"},{type:"impost",id:"ip3",x:530,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Двухстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:530,y:0,dir:"line"},{type:"impost",id:"ip1",x:530,y:1320,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1060,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1060,y:1320,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1320,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],impost:{impostAxis:[{type:"impost",id:"ip3",x:0,y:300,dir:"line"},{type:"impost",id:"ip3",x:530,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_6","block_7"],impost:{impostAxis:[{type:"impost",id:"ip3",x:1060,y:300,dir:"line"},{type:"impost",id:"ip3",x:530,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_6",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_7",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Одностворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:1060,y:300,dir:"line"},{type:"impost",id:"ip1",x:0,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1060,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1060,y:1320,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1320,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Трехстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:1060,y:300,dir:"line"},{type:"impost",id:"ip1",x:0,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:1060,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:1060,y:1320,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1320,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],pointsOut:[],pointsIn:[],pointsLight:[],impost:{impostAxis:[{type:"impost",id:"ip3",x:530,y:0,dir:"line"},{type:"impost",id:"ip3",x:530,y:1320,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Трехстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:2100,y:300,dir:"line"},{type:"impost",id:"ip1",x:0,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:2100,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:2100,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],pointsOut:[],pointsIn:[],pointsLight:[],impost:{impostAxis:[{type:"impost",id:"ip3",x:700,y:300,dir:"line"},{type:"impost",id:"ip3",x:700,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_3",children:["block_6","block_7"],impost:{impostAxis:[{type:"impost",id:"ip3",x:1400,y:300,dir:"line"},{type:"impost",id:"ip3",x:1400,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_6",level:4,blockType:"frame",parent:"block_5",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_7",level:4,blockType:"frame",parent:"block_5",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Трехстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:2100,y:300,dir:"line"},{type:"impost",id:"ip1",x:0,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:2100,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:2100,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],impost:{impostAxis:[{type:"impost",id:"ip3",x:1050,y:0,dir:"line"},{type:"impost",id:"ip3",x:1050,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_6","block_7"],pointsOut:[],pointsIn:[],pointsLight:[],impost:{impostAxis:[{type:"impost",id:"ip3",x:700,y:300,dir:"line"},{type:"impost",id:"ip3",x:700,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_6",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_7",level:3,blockType:"frame",parent:"block_3",children:["block_8","block_9"],impost:{impostAxis:[{type:"impost",id:"ip3",x:1400,y:300,dir:"line"},{type:"impost",id:"ip3",x:1400,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_8",level:4,blockType:"frame",parent:"block_7",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_9",level:4,blockType:"frame",parent:"block_7",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]},{name:"Трехстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:2100,y:300,dir:"line"},{type:"impost",id:"ip1",x:0,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:2100,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:2100,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],impost:{impostAxis:[{type:"impost",id:"ip3",x:700,y:0,dir:"line"},{type:"impost",id:"ip3",x:700,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_6","block_7"],pointsOut:[],pointsIn:[],pointsLight:[],impost:{impostAxis:[{type:"impost",id:"ip3",x:700,y:300,dir:"line"},{type:"impost",id:"ip3",x:700,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_2",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_2",children:["block_8","block_9"],impost:{impostAxis:[{type:"impost",id:"ip3",x:1400,y:0,dir:"line"},{type:"impost",id:"ip3",x:1400,y:300,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_6",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_7",level:3,blockType:"frame",parent:"block_3",children:["block_10","block_11"],impost:{impostAxis:[{type:"impost",id:"ip3",x:1400,y:300,dir:"line"},{type:"impost",id:"ip3",x:1400,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_8",level:4,blockType:"frame",parent:"block_5",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_9",level:4,blockType:"frame",parent:"block_5",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_10",level:4,blockType:"frame",parent:"block_7",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_11",level:4,blockType:"frame",parent:"block_7",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]}]}))},getTemplatesWindowDoor:function(e){e(new OkResult({windowDoor:[{name:"Балконная дверь",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1","block_2"],maxSizeLimit:5e3},{type:"skylight",id:"block_2",level:1,blockType:"sash",parent:"block_0",children:[],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:700,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:700,y:2100,dir:"line",view:1},{type:"frame",id:"fp4",x:0,y:2100,dir:"line",view:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:"",openDir:[1,4],handlePos:4,sashType:2}]}]}))},getTemplatesBalcony:function(e){e(new OkResult({balconies:[{name:"Трехстворчатое",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"frame",parent:"block_0",children:["block_2","block_3"],impost:{impostAxis:[{type:"impost",id:"ip1",x:700,y:0,dir:"line"},{type:"impost",id:"ip1",x:700,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:2100,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:2100,y:1400,dir:"line",view:1,sill:1},{type:"frame",id:"fp4",x:0,y:1400,dir:"line",view:1,sill:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_2",level:2,blockType:"frame",parent:"block_1",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_3",level:2,blockType:"frame",parent:"block_1",children:["block_4","block_5"],pointsOut:[],pointsIn:[],pointsLight:[],impost:{impostAxis:[{type:"impost",id:"ip3",x:1400,y:0,dir:"line"},{type:"impost",id:"ip3",x:1400,y:1400,dir:"line"}],impostLight:[],impostOut:[],impostIn:[]},parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_4",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""},{type:"skylight",id:"block_5",level:3,blockType:"frame",parent:"block_3",children:[],pointsOut:[],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:""}]}]}))},getTemplatesDoor:function(e){e(new OkResult({doors:[{name:"Одностворчатая",details:[{type:"skylight",id:"block_0",level:0,blockType:"frame",children:["block_1"],maxSizeLimit:5e3},{type:"skylight",id:"block_1",level:1,blockType:"sash",parent:"block_0",children:[],pointsOut:[{type:"frame",id:"fp1",x:0,y:0,dir:"line",view:1},{type:"frame",id:"fp2",x:900,y:0,dir:"line",view:1},{type:"frame",id:"fp3",x:900,y:2200,dir:"line",view:1},{type:"frame",id:"fp4",x:0,y:2200,dir:"line",view:1}],pointsIn:[],pointsLight:[],parts:[],glassId:0,glassTxt:"",openDir:[4],handlePos:4,sashType:2}]}]}))},getInstalment:function(e){e(new OkResult({instalment:[{id:1,name:1,value:15},{id:2,name:2,value:20},{id:3,name:3,value:25},{id:4,name:4,value:30},{id:5,name:5,value:35}]}))}}}])}(),function(){angular.module("BauVoiceApp").factory("PointsServ",["DesignStor","ProductStor",function(e,t){function i(e){if(e&&!$.isEmptyObject(e)){for(var i=e.details.length,r="",o="",a="",n="",s="",l="";--i>0;)if(1===e.details[i].level)for(var d=e.details[i].pointsOut.length;--d>-1;)0!==e.details[i].pointsOut[d].view&&(o+=e.details[i].pointsOut[d].x,o+=d?" "+e.details[i].pointsOut[d].y+",":" "+e.details[i].pointsOut[d].y),"fp1"!==e.details[i].pointsOut[d].id&&"fp3"!==e.details[i].pointsOut[d].id||(a+=e.details[i].pointsOut[d].x,a+=d?" "+e.details[i].pointsOut[d].y+",":" "+e.details[i].pointsOut[d].y),"fp2"!==e.details[i].pointsOut[d].id&&"fp4"!==e.details[i].pointsOut[d].id||(n+=e.details[i].pointsOut[d].x,n+=d?" "+e.details[i].pointsOut[d].y+",":" "+e.details[i].pointsOut[d].y),e.details[i].pointsOut[d]&&(r+=e.details[i].pointsOut[d].x,r+=d?" "+e.details[i].pointsOut[d].y+",":" "+e.details[i].pointsOut[d].y),"fp3"===e.details[i].pointsOut[d].id&&(s+=d?" "+e.details[i].pointsOut[d].y+",":" "+e.details[i].pointsOut[d].y),"fp3"===e.details[i].pointsOut[d].id&&(l+=e.details[i].pointsOut[d].x);var c=l,u=s;1>c?(c=t.product.template_width,u=t.product.template_height):(c=l,u=s)}return{path:r,noVvPath:o,fpDgLR:a,fpDgRL:n,heightWmd:s,widthWmd:l,widthT:c,heightT:u}}var r=this;return r.publicObj={templatePoints:i},r.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("RecOrderServ",["$q","GlobalStor","HistoryStor","ProductStor","localDB",function(e,t,i,r,o){function a(){var e,r,o,a,s,l=i.history.isBoxArray.length,d=t.global.laminatCouples.length,c=t.global.hardwares.length,u=t.global.profiles.length,p=t.global.glassesAll.length;for(e=0;l>e;e+=1)if(i.history.isBoxArray[e].nameGlass=[],i.history.isBoxArray[e].glass_id.length){var g=/\s*,\s*/,m=i.history.isBoxArray[e].glass_id.split(g);delete i.history.isBoxArray[e].glass_id,i.history.isBoxArray[e].glass_id=m;var f,_=m.length;for(f=0;_>f;f+=1){var h={id:0};h.id=m[f],i.history.isBoxArray[e].glass_id.push(h)}}for(o=0;c>o;o+=1){var y,E=t.global.hardwares[o].length;for(y=0;E>y;y+=1){var h={name:"",id:0,hardware:""};h.id=t.global.hardwares[o][y].id,h.name=t.global.hardwares[o][y].name,h.hardware=t.global.hardwares[o][y],i.history.listNameHardware.push(h)}}for(a=0;u>a;a+=1){var v,b=t.global.profiles[a].length;for(v=0;b>v;v+=1){var h={name:"",id:0};h.id=t.global.profiles[a][v].id,h.name=t.global.profiles[a][v].name,i.history.listNameProfiles.push(h)}}for(r=0;d>r;r+=1)for(e=0;l>e;e+=1)t.global.laminatCouples[r].id===i.history.isBoxArray[e].lamination_id&&(i.history.isBoxArray[e].nameIn=t.global.laminatCouples[r].laminat_in_name,i.history.isBoxArray[e].nameOut=t.global.laminatCouples[r].laminat_out_name);for(o=0;c>o;o+=1){var y,E=t.global.hardwares[o].length;for(y=0;E>y;y+=1)for(e=0;l>e;e+=1)t.global.hardwares[o][y].id===i.history.isBoxArray[e].hardware_id&&(i.history.isBoxArray[e].nameHardware=t.global.hardwares[o][y].name)}for(e=0;l>e;e+=1){var f,_=i.history.isBoxArray[e].glass_id.length;for(f=0;_>f;f+=1)for(s=0;p>s;s+=1){var I,A=t.global.glassesAll[s].glasses.length;for(I=0;A>I;I+=1){var S,T=t.global.glassesAll[s].glasses[I].length;for(S=0;T>S;S+=1){var h={name:"",id:0};if(i.history.isBoxArray[e].profile_id===t.global.glassesAll[s].profileId&&i.history.isBoxArray[e].glass_id[f]){var x=i.history.isBoxArray[e].glass_id[f];x===""+t.global.glassesAll[s].glasses[I][S].id&&(h.id=t.global.glassesAll[s].glasses[I][S].id,h.name=t.global.glassesAll[s].glasses[I][S].name,i.history.isBoxArray[e].nameGlass.push(h))}}}}}for(a=0;u>a;a+=1){var v,b=t.global.profiles[a].length;for(v=0;b>v;v+=1)for(e=0;l>e;e+=1)t.global.profiles[a][v].id===i.history.isBoxArray[e].profile_id&&(i.history.isBoxArray[e].nameProfiles=t.global.profiles[a][v].name)}for(e=0;l>e;e+=1)i.history.isBoxArray[e].template_source=JSON.parse(i.history.isBoxArray[e].template_source);n()}function n(){var e,t=i.history.isBoxArray.length;for(e=0;t>e;e+=1){var r=i.history.isBoxArray[e].glass_id.length;i.history.isBoxArray[e].glass_id.splice(0,[r]/2)}}function s(e){var r,o,a=i.history.isBoxArray.length,n=t.global.glassesAll.length;for(r=0;a>r;r+=1){var s=[];for(o=0;n>o;o+=1)if(i.history.isBoxArray[r].dataProfiles&&i.history.isBoxArray[r].product_id===e&&i.history.isBoxArray[r].dataProfiles.id===t.global.glassesAll[o].profileId){var l,d=t.global.glassesAll[o].glasses.length;for(l=0;d>l;l+=1){var c,u=t.global.glassesAll[o].glasses[l].length;for(c=0;u>c;c+=1){var p={name:"",id:0,sku:0};p.id=t.global.glassesAll[o].glasses[l][c].id,p.name=t.global.glassesAll[o].glasses[l][c].name,p.sku=t.global.glassesAll[o].glasses[l][c].sku,s.push(p),i.history.isBoxArray[r].listNameGlass=s}}}}}function l(e){var r,o,a=i.history.isBoxArray.length,n=[],s=t.global.laminatCouples.length;for(r=0;a>r;r+=1)for(o=0;s>o;o+=1)if(i.history.isBoxArray[r].dataProfiles&&i.history.isBoxArray[r].product_id===e){var l={name:"",nameIn:"",nameOut:"",id:0,img_in_id:0,img_out_id:0,profile_id:0,lamination:""};i.history.isBoxArray[r].dataProfiles.id===t.global.laminatCouples[o].profile_id?(l.profile_id=t.global.laminatCouples[o].profile_id,l.id=t.global.laminatCouples[o].id,l.nameIn=t.global.laminatCouples[o].laminat_in_name,l.nameOut=t.global.laminatCouples[o].laminat_out_name,l.img_in_id=t.global.laminatCouples[o].img_in_id,l.img_out_id=t.global.laminatCouples[o].img_out_id,l.lamination=t.global.laminatCouples[o],l.name=t.global.laminatCouples[o].laminat_in_name+"/"+t.global.laminatCouples[o].laminat_out_name,n.push(l),i.history.isBoxArray[r].listNameLaminat=n):0===t.global.laminatCouples[o].id&&(l.profile_id=t.global.laminatCouples[o].profile_id,l.id=t.global.laminatCouples[o].id,l.nameIn=t.global.laminatCouples[o].laminat_in_name,
l.nameOut=t.global.laminatCouples[o].laminat_out_name,l.img_in_id=t.global.laminatCouples[o].img_in_id,l.img_out_id=t.global.laminatCouples[o].img_out_id,l.lamination=t.global.laminatCouples[o],l.name=t.global.laminatCouples[o].laminat_in_name+"/"+t.global.laminatCouples[o].laminat_out_name,n.push(l),i.history.isBoxArray[r].listNameLaminat=n)}}function d(){var e,t=i.history.isBoxArray.length;for(e=0;t>e;e+=1){delete i.history.isBoxArrayCopy[e].hardware_id,delete i.history.isBoxArrayCopy[e].lamination_id,delete i.history.isBoxArrayCopy[e].lamination_in_id,delete i.history.isBoxArrayCopy[e].lamination_out_id,delete i.history.isBoxArrayCopy[e].order_id,delete i.history.isBoxArrayCopy[e].product_id,delete i.history.isBoxArrayCopy[e].profile_id,delete i.history.isBoxArrayCopy[e].template_source;var r=/\s*,\s*/,o=i.history.isBoxArrayCopy[e].glass_id.split(r),a=i.history.isBoxArray[e].glass_id.split(r);i.history.isBoxArrayCopy[e].glass_id=o,i.history.isBoxArrayCopy[e].n_glass_id=a;var n,s=i.history.isBoxArrayCopy[e].glass_id.length;for(n=0;s>n;n+=1){var l={old:0},d={newId:0};d.newId=i.history.isBoxArrayCopy[e].n_glass_id[n],l.old=i.history.isBoxArrayCopy[e].glass_id[n],i.history.isBoxArrayCopy[e].glass_id.push(l),i.history.isBoxArrayCopy[e].n_glass_id.push(d)}i.history.isBoxArrayCopy[e].glass_id.splice(0,[s]/2+1),i.history.isBoxArrayCopy[e].n_glass_id.splice(0,[s]/2+1)}for(e=0;t>e;e+=1){var u,p,g=i.history.isBoxArray[e].template_source.details.length,m=i.history.isBoxArrayCopy[e].glass_id.length;for(p=0;m>p;p+=1)for(u=1;g>u;u+=1)1*i.history.isBoxArrayCopy[e].glass_id[p].old===i.history.isBoxArray[e].template_source.details[u].glassId&&"number"==typeof i.history.isBoxArray[e].template_source.details[u].glassId&&(i.history.isBoxArray[e].template_source.details[u].glassId=i.history.isBoxArrayCopy[e].n_glass_id[p].newId);for(u=1;g>u;u+=1)i.history.isBoxArray[e].template_source.details[u].glassId=1*i.history.isBoxArray[e].template_source.details[u].glassId}c()}function c(){var e,r=t.global.glassesAll.length;for(e=0;r>e;e+=1)for(var o=t.global.glassesAll[e].glasses.length,a=0;o>a;a+=1)for(var n=t.global.glassesAll[e].glasses[a].length,s=0;n>s;s+=1){var l,d=i.history.isBoxArray.length;for(l=0;d>l;l+=1)for(var c=i.history.isBoxArray[l].template_source.details.length,u=0;c>u;u+=1)t.global.glassesAll[e].glasses[a][s].id===i.history.isBoxArray[l].template_source.details[u].glassId&&(i.history.isBoxArray[l].template_source.details[u].glassTxt=t.global.glassesAll[e].glasses[a][s].sku)}}function u(){var e,t=i.history.isBoxArray.length;for(e=0;t>e;e+=1)void 0!==i.history.isBoxArray[e].dataHardware?(delete i.history.isBoxArray[e].hardware_id,delete i.history.isBoxArray[e].nameHardware,i.history.isBoxArray[e].hardware_id=i.history.isBoxArray[e].dataHardware.id,i.history.isBoxArray[e].nameHardware=i.history.isBoxArray[e].dataHardware.name,i.history.isBoxArray[e].hardware=i.history.isBoxArray[e].dataHardware.hardware):0!==i.history.isBoxArray[e].hardware_id&&void 0===i.history.isBoxArray[e].dataHardware&&(i.history.errorСhecking+=1)}function p(){var e,t=i.history.isBoxArray.length;for(e=0;t>e;e+=1)void 0!==i.history.isBoxArray[e].dataProfiles?(delete i.history.isBoxArray[e].profile_id,delete i.history.isBoxArray[e].nameProfiles,i.history.isBoxArray[e].profile_id=i.history.isBoxArray[e].dataProfiles.id,i.history.isBoxArray[e].nameProfiles=i.history.isBoxArray[e].dataProfiles.name):0!==i.history.isBoxArray[e].profile_id&&void 0===i.history.isBoxArray[e].dataProfiles&&(i.history.errorСhecking+=1)}function g(){var e,t=i.history.isBoxArray.length;for(e=0;t>e;e+=1){var r,o,a,n,s=i.history.isBoxArray[e].nameGlass.length;for(r=0;s>r;r+=1)void 0!==i.history.isBoxArray[e].nameGlass[r].dataGlass?0===r?(o=i.history.isBoxArray[e].nameGlass[r].dataGlass.id,n=i.history.isBoxArray[e].nameGlass[r].dataGlass.name,a=i.history.isBoxArray[e].nameGlass[r].dataGlass.sku):(o+=", "+i.history.isBoxArray[e].nameGlass[r].dataGlass.id,n+=", "+i.history.isBoxArray[e].nameGlass[r].dataGlass.name,a+=", "+i.history.isBoxArray[e].nameGlass[r].dataGlass.sku):void 0===i.history.isBoxArray[e].nameGlass[r].dataGlass&&(i.history.errorСhecking+=1);i.history.isBoxArray[e].glass_id=o+"",i.history.isBoxArrayCopy[e].sku=a}f()}function m(){var e,t=i.history.isBoxArray.length;for(e=0;t>e;e+=1)if(void 0!==i.history.isBoxArray[e].dataLamination){delete i.history.isBoxArray[e].lamination_id,delete i.history.isBoxArray[e].nameIn,delete i.history.isBoxArray[e].nameOut,delete i.history.isBoxArray[e].lamination_in_id,delete i.history.isBoxArray[e].lamination_out_id,i.history.isBoxArray[e].lamination_id=i.history.isBoxArray[e].dataLamination.id,i.history.isBoxArray[e].nameIn=i.history.isBoxArray[e].dataLamination.nameIn,i.history.isBoxArray[e].nameOut=i.history.isBoxArray[e].dataLamination.nameOut,i.history.isBoxArray[e].lamination_in_id=i.history.isBoxArray[e].dataLamination.img_in_id,i.history.isBoxArray[e].lamination_out_id=i.history.isBoxArray[e].dataLamination.img_out_id,i.history.isBoxArray[e].lamination=i.history.isBoxArray[e].dataLamination.lamination;var r,o=i.history.isBoxArray[e].glasses.length;for(r=0;o>r;r+=1)i.history.isBoxArray[e].glasses[r].lamination_in_id=i.history.isBoxArray[e].dataLamination.img_in_id,i.history.isBoxArray[e].glasses[r].lamination_out_id=i.history.isBoxArray[e].dataLamination.img_out_id}}function f(){var e,r=i.history.isBoxArray.length;for(e=0;r>e;e+=1){i.history.isBoxArray[e].glasses=[];var o,a,n=/\s*,\s*/,s=i.history.isBoxArray[e].glass_id.split(n),l=s.length,d=[],c=t.global.glassesAll.length;for(o=0;l>o;o+=1)for(a=0;c>a;a+=1){var u,p=t.global.glassesAll[a].glasses.length;for(u=0;p>u;u+=1){var g,m=t.global.glassesAll[a].glasses[u].length;for(g=0;m>g;g+=1)1*s[o]===t.global.glassesAll[a].glasses[u][g].id&&t.global.glassesAll[a].profileId===i.history.isBoxArray[e].profile_id&&(d=t.global.glassesAll[a].glasses[u][g],i.history.isBoxArray[e].glasses.push(d))}}}}function _(){i.history.errorСhecking=0;var e,t=i.history.isBoxArray.length;for(e=0;t>e;e+=1){if(void 0===i.history.isBoxArray[e].dataProfiles){i.history.errorСhecking+=1;break}if(void 0===i.history.isBoxArray[e].dataHardware&&0!==i.history.isBoxArray[e].hardware_id){i.history.errorСhecking+=1;break}if(void 0===i.history.isBoxArray[e].dataLamination){i.history.errorСhecking+=1;break}for(var r=i.history.isBoxArray[e].nameGlass.length,o=0;r>o;o+=1)if(void 0===i.history.isBoxArray[e].nameGlass[o].dataGlass){i.history.errorСhecking+=1;break}}}var h=this;return h.publicObj={box:a,errorChecking:_,dopTemplateSource:c,glassesForProductStor:f,nameListLaminat:l,templateSource:d,extendLaminat:m,extendHardware:u,extendProfile:p,extendGlass:g,nameListGlasses:s,clear:n},h.publicObj}])}(),function(){angular.module("SettingsModule").factory("SettingServ",["$rootScope","$location","localDB","GlobalStor","UserStor",function(e,t,i,r,o){function a(e,t){o.userInfo.avatar=e,i.sendIMGServer(t),i.updateLocalDB(i.tablesLocalDB.users.tableName,{avatar:e},{id:o.userInfo.id})}function n(){t.path("/"+r.global.currOpenPage)}function s(){t.path("/location")}function l(){t.path("/change-pass")}function d(){t.path("/change-lang")}function c(){t.path("/settings")}function u(){console.log("prevOpenPage +++",r.global.prevOpenPage),t.path(r.global.prevOpenPage)}var p=this;return p.publicObj={changeAvatar:a,closeLocationPage:n,gotoLocationPage:s,gotoPasswordPage:l,gotoLanguagePage:d,gotoSettingsPage:c,closeSettingsPage:u},p.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("SoundPlayServ",function(){function e(){var e=document.getElementById("sounds");e.play()}var t=this;return t.soundsIntervals={menu:{start:7.93,end:11.7},swip:{start:8,end:9},price:{from:21.5,to:23.2},fly:{start:.57,end:1.59},switching:{start:1.81,end:2.88}},t.publicObj={playSound:e},t.publicObj})}(),function(){angular.module("MainModule").factory("SVGServ",["$q","globalConstants","GeneralServ","GlobalStor","ProductStor","DesignStor","PointsServ",function(e,t,i,r,o,a,n){function s(e,t){var r=e.coefA*t.coefB-t.coefA*e.coefB,o=e.coefB*t.coefC-t.coefB*e.coefC,a=t.coefA*e.coefC-e.coefA*t.coefC,n={x:i.roundingValue(i.roundingValue(o/r,3)),y:i.roundingValue(i.roundingValue(a/r,3))};return n.x===-0?n.x=0:n.y===-0&&(n.y=0),n}function l(e,t,r){var o={x:i.roundingValue((e.x-t.x)/(r.x-t.x)),y:i.roundingValue((e.y-t.y)/(r.y-t.y))};return o.x===-(1/0)?o.x=1/0:o.y===-(1/0)&&(o.y=1/0),o.x===-0?o.x=0:o.y===-0&&(o.y=0),o}function d(e){var t=0;return e.x===1/0||e.y===1/0?t=0:e.x>=0&&e.x<=1&&e.y>=0&&e.y<=1?t=1:isNaN(e.x)&&e.y>=0&&e.y<=1?t=1:e.x>=0&&e.x<=1&&isNaN(e.y)&&(t=1),t}function c(e,t){var i={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return i}function u(e,t){for(var i,r,o,a=t.length;--a>-1;){for(i=t.length,r=0,o=0;i>o;o+=1)switch(e){case 1:t[o].x===t[a].x&&(r+=1);break;case 2:t[o].y===t[a].y&&(r+=1);break;case 3:t[o].x===t[a].x&&t[o].y===t[a].y&&(r+=1)}r>1&&t.splice(a,1)}}function p(e){for(var t,i=[],r=e.length;--r>0;)if(t=e[r].pointsOut.length)for(;--t>-1;)i.push(angular.copy(e[r].pointsOut[t]));return u(3,i),i}function g(e,t){for(var i,r=t.length;--r>-1;)for(i=t.length;--i>-1;)if(r!==i&&t[r]&&t[i])switch(e){case 1:t[r].x===t[i].x&&("impost"!==t[i].type&&"shtulp"!==t[i].type||"frame"!==t[r].type&&"corner"!==t[r].type?delete t[r]:delete t[i]);break;case 2:t[r].y===t[i].y&&("impost"!==t[i].type&&"shtulp"!==t[i].type||"frame"!==t[r].type&&"corner"!==t[r].type?delete t[r]:delete t[i])}return t.filter(function(e){return e?1:0})}function m(e,t){return e.x-t.x}function f(e,t){return e.y-t.y}function _(e,t,i){return(i.x-t.x)*(i.y-e.y)-(i.y-t.y)*(i.x-e.x)}function h(e,t){var i=1,r=t.length;if(r)for(;--r>-1;)t[r].x===e.x&&t[r].y===e.y&&(i=0);return i}function y(e,t){var i=0,r=t.length;if(r)for(;--r>-1;)t[r].id.slice(0,3)===e.slice(0,3)&&t[r].id.slice(0,3).indexOf("q")+1&&(i=1);return i}function E(e,t,r){var o={x:i.roundingValue((1-e)*t.x+e*r.x),y:i.roundingValue((1-e)*t.y+e*r.y)};return o}function v(e,t,r){var o=c(t.from,t.to),a={};if(t.coefA&&t.coefB)switch(e){case 1:a.y=o.y-Math.sqrt(Math.pow(r,2)/(1+Math.pow(t.coefB/t.coefA,2))),a.x=o.x-Math.sqrt(Math.abs(Math.pow(r,2)-Math.pow(o.y-a.y,2)));break;case 2:a.y=o.y-Math.sqrt(Math.pow(r,2)/(1+Math.pow(t.coefB/t.coefA,2))),a.x=Math.sqrt(Math.abs(Math.pow(r,2)-Math.pow(a.y-o.y,2)))+o.x;break;case 3:a.y=Math.sqrt(Math.pow(r,2)/(1+Math.pow(t.coefB/t.coefA,2)))+o.y,a.x=Math.sqrt(Math.abs(Math.pow(r,2)-Math.pow(a.y-o.y,2)))+o.x;break;case 4:a.y=Math.sqrt(Math.pow(r,2)/(1+Math.pow(t.coefB/t.coefA,2)))+o.y,a.x=o.x-Math.sqrt(Math.abs(Math.pow(r,2)-Math.pow(o.y-a.y,2)))}else a.x=Math.sqrt(Math.pow(r,2)/(1+Math.pow(t.coefB/t.coefA,2)))+o.x,a.y=Math.sqrt(Math.abs(Math.pow(r,2)-Math.pow(a.x-o.x,2)))+o.y;return a.y=i.roundingValue(a.y,1),a.x=i.roundingValue(a.x,1),a}function b(e,t,r,o){return i.roundingValue(o*o*(e-2*t+r)-2*o*(e-t)+e)}function I(e){var t=e.length,i={x:e.reduce(function(e,t){return"curv"===t.dir?e+t.xQ:e+t.x},0)/t,y:e.reduce(function(e,t){return"curv"===t.dir?e+t.yQ:e+t.y},0)/t};return i}function A(e,t){var i;return i="curv"===t.dir?Math.atan2(e.y-t.yQ,t.xQ-e.x)*(180/Math.PI):Math.atan2(e.y-t.y,t.x-e.x)*(180/Math.PI),0>i&&(i+=360),i}function S(e,t){var i,r=e.length;for(i=0;r>i;i+=1)e[i].fi=A(t,e[i]);return e.sort(function(e,t){return t.fi-e.fi}),e}function T(e){e.coefA=e.from.y-e.to.y,e.coefB=e.to.x-e.from.x,e.coefC=e.from.x*e.to.y-e.to.x*e.from.y}function x(e,t){var i="";return i=e.indexOf("ip")+1&&t.indexOf("ip")+1?"impost":e.indexOf("sht")+1&&t.indexOf("sht")+1&&e===t?"shtulp":"frame"}function N(e){var t,r,o,a,n=[],s=e.length;for(o=0;s>o;o+=1)("frame"!==e[o].type||e[o].view)&&(t={},t.from=angular.copy(e[o]),t.dir=e[o].dir,o===s-1?(r=0,"frame"!==e[r].type||e[r].view||(r=1)):(r=o+1,"frame"!==e[r].type||e[r].view||(r=r===s-1?0:o+2)),t.to=angular.copy(e[r]),t.type=x(e[o].id,e[r].id),"line"===t.dir&&(t.dir="curv"===e[r].dir?"curv":"line"),t.size=i.roundingValue(Math.hypot(t.to.x-t.from.x,t.to.y-t.from.y)),T(t),n.push(t));return a=n.pop(),n.unshift(a),n}function L(e,t,i){var r=0,o=20;switch(i){case"frame":"frame"===t.type?r=e.frameDepth.c:"impost"===t.type?r=e.impostDepth.c/2:"shtulp"===t.type&&(r=e.shtulpDepth.b/2);break;case"frame-bead":case"sash-bead":r=o;break;case"frame-glass":"frame"===t.type?r=e.frameDepth.d-e.frameDepth.c:"impost"===t.type&&(r=e.impostDepth.b-e.impostDepth.c/2);break;case"sash-out":"frame"===t.type?r=e.frameDepth.b-e.frameDepth.c:"impost"===t.type?r=e.impostDepth.d-e.impostDepth.c/2:"shtulp"===t.type&&(r=e.shtulpDepth.a/2-e.shtulpDepth.b/2);break;case"sash-in":r=e.sashDepth.c;break;case"light":"frame"===t.type?r=e.frameDepth.a:"impost"===t.type?r=e.impostDepth.a/2:"shtulp"===t.type&&(r=e.shtulpDepth.b/2);break;case"sash-light":r=e.sashDepth.b+e.sashDepth.a;break;case"hardware":r=e.sashDepth.b;break;case"sash-glass":r=e.sashDepth.d-e.sashDepth.c}var a=t.coefC-r*Math.hypot(t.coefA,t.coefB);return a}function D(e){var t=e.from.x,i=e.from.y,r=e.to.x,o=e.to.y;return Math.round((o-i)/(r-t))}function C(e,t){var i=D(e),r=D(t);return i===r?1:0}function O(e,t){var i={},r={},o=C(e,t);if(o){var a=e.to.x,n=e.to.y,l={coefA:e.coefB,coefB:-e.coefA,coefC:e.coefA*n-e.coefB*a};r=s(e,l)}else r=s(e,t);return i.x=r.x,i.y=r.y,"impost"===e.type||"impost"===t.type?i.type="impost":"shtulp"===e.type||"shtulp"===t.type?i.type="shtulp":i.type="frame","curv"===e.to.dir?(i.dir="curv",i.xQ=e.to.xQ,i.yQ=e.to.yQ):i.dir="line",i.id=e.to.id,i.view=1,i}function R(e,t,i){var r,o,a,n,s,l=[],d=e.length;for(r=0;d>r;r+=1)o=angular.copy(e[r]),a={},n={},o.coefC=L(t,o,i),s=r===d-1?0:r+1,a=angular.copy(e[s]),a.coefC=L(t,a,i),n=O(o,a),l.push(n);return l}function P(e,t){return Math.round(t/2+e*e/(8*t))}function w(e,r,o,a){e.startX=b(r.x,o.x,a.x,.5),e.startY=b(r.y,o.y,a.y,.5),e.lengthChord=i.roundingValue(Math.hypot(a.x-r.x,a.y-r.y)),e.radius=P(e.lengthChord,e.heightQ),e.radiusMax=P(e.lengthChord,e.lengthChord/4),e.radiusMin=P(e.lengthChord,t.minRadiusHeight)}function M(e){var t,i=e.pointsQ.length;if(i)for(t=0;i>t;t+=1){var r,o=e.pointsOut.length,a=0,n=0;for(r=0;o>r;r+=1)e.pointsQ[t].fromPId===e.pointsOut[r].id&&(a=e.pointsOut[r]),e.pointsQ[t].toPId===e.pointsOut[r].id&&(n=e.pointsOut[r]);if(a&&n){var s,l={from:a,to:n},d=c(a,n),u={type:e.pointsQ[t].type,id:e.pointsQ[t].id,dir:"curv",xQ:d.x,yQ:d.y};T(l),s=v(e.pointsQ[t].positionQ,l,2*e.pointsQ[t].heightQ),u.x=s.x,u.y=s.y,l.coefA||1!==e.pointsQ[t].positionQ?l.coefB||4!==e.pointsQ[t].positionQ||(u.x-=4*e.pointsQ[t].heightQ):u.y-=4*e.pointsQ[t].heightQ,e.pointsOut.push(angular.copy(u)),e.pointsQ[t].midleX=u.xQ,e.pointsQ[t].midleY=u.yQ,w(e.pointsQ[t],a,u,n)}}}function k(e){var t=0;return e.x===1/0&&e.y>=0&&e.y<=1?t=1:e.x>=0&&e.x<=1&&e.y===1/0?t=1:isNaN(e.x)&&e.y>=0&&e.y<=1?t=1:e.x>=0&&e.x<=1&&isNaN(e.y)?t=1:e.x>=0&&e.x<=1&&e.y>=0&&e.y<=1?t=1:e.x>=0&&e.x<=1&&$.isNumeric(e.y)?(e.y<-2||e.y>2)&&(t=1):$.isNumeric(e.x)&&e.y>=0&&e.y<=1&&(e.x<-2||e.x>2)&&(t=1),t}function G(e,t){var i=c(t.from,t.to);if(e)return i;var r={coefA:t.coefB,coefB:-t.coefA,coefC:t.coefA*i.y-t.coefB*i.x};return s(t,r)}function B(e,t,i,r,o){var a,n,s,l,d;i[e].from.id.indexOf("q")+1?(s=e-1,i[s]||(s=t-1),l=i[s].from,d=i[e].to,a=angular.copy(i[e].from)):i[e].to.id.indexOf("q")+1&&(s=e+1,i[s]||(s=0),l=i[e].from,d=i[s].to,a=angular.copy(i[e].to)),n=angular.copy(a);var u=E(r.t,l,a),p=E(r.t,n,d),g=c(l,r),m=c(r,d);a.x=u.x,a.y=u.y,a.xQ=g.x,a.yQ=g.y,n.x=p.x,n.y=p.y,n.xQ=m.x,n.yQ=m.y;for(var f=o.length;--f>-1;)o[f].id===a.id&&o.splice(f,1);var _=h(a,o);_&&o.push(a);var y=h(n,o);y&&o.push(n)}function V(e,t,i){var r,o=[];if(t?(r={type:"impost",id:i.impostAxis[2].id,dir:"curv"},o.push(i.impostOut[0],i.impostOut[1])):(r=angular.copy(i.impostOut[2]),o=i.impostIn.filter(function(t){return t.group===e&&"line"===t.dir?1:0})),2===o.length){var a,n={from:angular.copy(o[0]),to:angular.copy(o[1])},s=c(n.from,n.to);if(T(n),a=v(i.impostAxis[2].positionQ,n,2*i.impostAxis[2].heightQ),r.x=a.x,r.y=a.y,r.xQ=s.x,r.yQ=s.y,r.group=e,n.coefA||1!==i.impostAxis[2].positionQ?n.coefB||4!==i.impostAxis[2].positionQ||(r.x-=4*i.impostAxis[2].heightQ):r.y-=4*i.impostAxis[2].heightQ,t)return i.impostOut.push(r),r;i.impostIn.push(r)}}function U(e,t,i,r){var o,a,n,s=t.length;for(o=0;s>o;o+=1)n=_(e[0],e[1],t[o]),n>0?(a=0,r.length&&(a=y(t[o].id,r)),a||r.push(angular.copy(t[o]))):0>n&&(a=0,i.length&&(a=y(t[o].id,i)),a||i.push(angular.copy(t[o])))}function H(e,t,i){var r,o=e.length;for(r=0;o>r;r+=1)e[r].group?i.push(angular.copy(e[r])):t.push(angular.copy(e[r]))}function F(e,t,r,o,a){var n,s,l,d,c,u=[],p={x:o.y-a.y,y:a.x-o.x},g={x:e.x-2*t.x+r.x,y:e.y-2*t.y+r.y},m={x:2*(t.x-e.x),y:2*(t.y-e.y)},f={x:e.x,y:e.y},_=o.x*a.y-a.x*o.y,h=[];if(n=Math.abs(p.x)===Math.abs(p.y)?Math.abs(p.x*g.x)+Math.abs(p.y*g.y):Math.abs(p.x)?Math.abs(p.y)?p.x*g.x+p.y*g.y:p.x*g.x+g.y:g.x+p.y*g.y,s=(p.x*m.x+p.y*m.y)/n,l=(p.x*f.x+p.y*f.y+_)/n,d=s*s-4*l,d>0){var y=Math.sqrt(d);h.push(i.roundingValue((-s+y)/2),i.roundingValue((-s-y)/2))}else 0===d&&h.push(i.roundingValue(-s/2));for(c=0;c<h.length;c+=1){var E=h[c];if(E>0&&1>E){var v={t:E,x:b(e.x,t.x,r.x,E),y:b(e.y,t.y,r.y,E)},I=Math.min(o.x,a.x,e.x,t.x,r.x),A=Math.min(o.y,a.y,e.y,t.y,r.y),S=Math.max(o.x,a.x,e.x,t.x,r.x),T=Math.max(o.y,a.y,e.y,t.y,r.y);o.x===a.x&&v.y>=A&&v.y<=T?u.push(v):o.y===a.y&&v.x>=I&&v.x<=S?u.push(v):v.x>=I&&v.y>=A&&v.x<=S&&v.y<=T&&u.push(v)}}return u}function z(e,t,i,r,o){var a,n,s,l,d,c;return i[e].from.id.indexOf("q")+1?(c=e-1,i[c]||(c=t-1),a=i[c].from,n=i[e].from,s=i[e].to):i[e].to.id.indexOf("q")+1&&(c=e+1,i[c]||(c=0),a=i[e].from,n=i[e].to,s=i[c].to),l=r,d=o,F(a,n,s,l,d)}function Y(e,t,i,r,o,a,n,d,c){var u=s(o[i],a),p=l(u,o[i].to,o[i].from),g=k(p);if(g){var m=angular.copy(n);if(m.group=e,m.x=u.x,m.y=u.y,"curv"===o[i].dir){var f=G(t,a),_=z(i,r,o,f,u);_.length&&(m.x=_[0].x,m.y=_[0].y,m.t=_[0].t)}var y=h(m,d);y&&("curv"===o[i].dir&&t&&B(i,r,o,m,c),d.push(angular.copy(m)))}}function W(e,t,i){if(e.children.length){var r,o,a,n,s,l,d,c,u,p,g,m,f,_,h=t.length,y=e.impost.impostAxis.length,E=angular.copy(e.impost.impostAxis[0]),v=angular.copy(e.impost.impostAxis[1]),b=angular.copy(e.pointsOut);for("sash"===e.blockType?(r=angular.copy(e.sashPointsIn),o=e.sashLinesIn,a=angular.copy(e.sashPointsLight),n=angular.copy(e.sashLinesLight)):(r=angular.copy(e.pointsIn),o=e.linesIn,a=angular.copy(e.pointsLight),n=angular.copy(e.linesLight)),_=o.length,f=1;h>f;f+=1)t[f].id===e.children[0]?s=f:t[f].id===e.children[1]&&(l=f);for(d={type:"impost"===E.type?"impost":"shtulp",from:E,to:v},c={type:"impost"===E.type?"impost":"shtulp",from:v,to:E},T(d),T(c),u=angular.copy(d),p=angular.copy(c),u.coefC=L(i,u,"frame"),p.coefC=L(i,p,"frame"),g=angular.copy(d),m=angular.copy(c),g.coefC=L(i,g,"light"),m.coefC=L(i,m,"light"),f=0;_>f;f+=1)Y(0,0,f,_,o,u,E,e.impost.impostIn),Y(1,0,f,_,o,p,v,e.impost.impostIn),Y(0,1,f,_,o,d,E,e.impost.impostOut,r),Y(0,0,f,_,n,g,E,e.impost.impostLight),Y(1,0,f,_,n,m,v,e.impost.impostLight);if(3===y){var I,S=e.impost.impostOut.length;for(f=0;S>f;f+=1)e.impost.impostOut[f].fi=A(e.center,e.impost.impostOut[f]),e.impost.impostAxis[f].fi=A(e.center,e.impost.impostAxis[f]);e.impost.impostOut[0].fi!==e.impost.impostAxis[0].fi&&e.impost.impostOut.reverse(),I=V(0,1,e.impost),V(0,0,e.impost),V(1,0,e.impost),t[s].pointsOut.push(angular.copy(I)),t[l].pointsOut.push(angular.copy(I)),e.impost.impostAxis[2].midleX=I.xQ,e.impost.impostAxis[2].midleY=I.yQ,w(e.impost.impostAxis[2],e.impost.impostOut[0],I,e.impost.impostOut[1])}var x=angular.copy(e.impost.impostAxis);U(x,b,t[s].pointsOut,t[l].pointsOut),U(x,r,t[s].pointsIn,t[l].pointsIn),H(e.impost.impostIn,t[s].pointsIn,t[l].pointsIn),U(x,a,t[s].pointsLight,t[l].pointsLight),H(e.impost.impostLight,t[s].pointsLight,t[l].pointsLight);var N,D=e.linesOut.length;for(e.impost.impostAxis[2]&&(N=angular.copy(e.impost.impostAxis[2])),e.impost.impostAxis.length=0,f=0;D>f;f+=1)Y(0,0,f,D,e.linesOut,d,E,e.impost.impostAxis);for(N&&e.impost.impostAxis.push(N),f=0;2>f;f+=1)t[s].pointsOut.push(angular.copy(e.impost.impostAxis[f])),t[l].pointsOut.push(angular.copy(e.impost.impostAxis[f]))}}function q(e,t,i,r,o){e.points.push(t,i,r,o),"corner"!==t.type&&"corner"!==i.type||(e.type="corner"),t.sill&&i.sill&&(e.sill=1)}function Q(e){var t="M "+e[0].x+","+e[0].y,i=1,r=e.length;if(4===r)for(;r>i;i+=1)t+=" L "+e[i].x+","+e[i].y,i===r-1&&(t+=" Z");else if(6===r)for(;r>i;i+=1)3===i?t+=" L "+e[i].x+","+e[i].y:(t+=" Q "+e[i].x+","+e[i].y+" "+e[i+1].x+","+e[i+1].y,i+=1),i===r-1&&(t+=" Z");return t}function j(e){var t=e.length,r=0;if(2===t||4===t)r=i.roundingValue(Math.hypot(e[1].x-e[0].x,e[1].y-e[0].y),1);else if(3===t||6===t)for(var o=.01,a=0;1>=a;){var n=2*((1-a)*(e[1].x-e[0].x)+a*(e[2].x-e[1].x)),s=2*((1-a)*(e[1].y-e[0].y)+a*(e[2].y-e[1].y));r+=Math.hypot(n,s)*o,a+=o}return r}function K(e,t,r,n){var s,l,d,c=e.filter(function(e){return!("frame"===e.type&&!e.view)}),u=[],p=c.length,g={glassId:n,sizes:[]};for(d=0;p>d;d+=1)if(0!==d||"curv"!==c[d].dir){var m={type:c[d].type,dir:"line",points:[]};if(d===p-1){if("curv"===c[d].dir)break;"curv"===c[0].dir?(m.type="arc",m.points.push(c[d],c[0],c[1],t[1],t[0],t[d]),"corner"!==c[d].type&&"corner"!==c[1].type||(m.type="arc-corner"),m.dir="curv"):4!==o.product.construction_type||1!==a.design.doorConfig.doorShapeIndex&&2!==a.design.doorConfig.doorShapeIndex?4===o.product.construction_type&&3===a.design.doorConfig.doorShapeIndex&&"frame"===c[0].type&&"fp3"===c[0].id?(s=angular.copy(c[0]),s.y=1*t[0].y,q(m,c[d],s,t[0],t[d])):q(m,c[d],c[0],t[0],t[d]):"frame"===c[0].type&&"fp3"===c[0].id?(s=angular.copy(t[0]),s.y=1*c[0].y,q(m,c[d],c[0],s,t[d])):q(m,c[d],c[0],t[0],t[d])}else if("curv"===c[d].dir||"curv"===c[d+1].dir)m.type="arc",m.points.push(c[d],c[d+1]),c[d+2]?(m.points.push(c[d+2],t[d+2]),"corner"!==c[d].type&&"corner"!==c[d+2].type||(m.type="arc-corner")):(m.points.push(c[0],t[0]),"corner"!==c[d].type&&"corner"!==c[0].type||(m.type="arc-corner")),m.points.push(t[d+1],t[d]),m.dir="curv",d+=1;else if(4!==o.product.construction_type||1!==a.design.doorConfig.doorShapeIndex&&2!==a.design.doorConfig.doorShapeIndex)4===o.product.construction_type&&3===a.design.doorConfig.doorShapeIndex?("frame"===c[d].type&&"fp3"===c[d].id&&(s=angular.copy(t[d]),s.x=1*c[d].x,l=angular.copy(t[d+1]),l.x=1*c[d+1].x,q(m,c[d],c[d+1],l,s),m.doorstep=1),"frame"===c[d].type&&"fp4"===c[d].id?(s=angular.copy(c[d]),s.y=1*t[d].y,q(m,s,c[d+1],t[d+1],t[d])):("frame"===c[d].type&&"fp3"!==c[d].id||"frame"!==c[d].type)&&q(m,c[d],c[d+1],t[d+1],t[d])):q(m,c[d],c[d+1],t[d+1],t[d]);else{if(1===a.design.doorConfig.doorShapeIndex&&"frame"===c[d].type&&"fp3"===c[d].id)continue;2===a.design.doorConfig.doorShapeIndex&&"frame"===c[d].type&&"fp3"===c[d].id&&(s=angular.copy(c[d]),s.x=1*t[d].x,l=angular.copy(c[d+1]),l.x=1*t[d+1].x,q(m,s,l,t[d+1],t[d]),m.doorstep=1),"frame"===c[d].type&&"fp4"===c[d].id?(s=angular.copy(t[d]),s.y=1*c[d].y,q(m,c[d],c[d+1],t[d+1],s)):("frame"===c[d].type&&"fp3"!==c[d].id||"frame"!==c[d].type)&&q(m,c[d],c[d+1],t[d+1],t[d])}m.path=Q(m.points),m.size=j(m.points);var f=i.roundingValue(angular.copy(m.size)/1e3,3);"bead"===c[d].type?(m.type="bead",g.sizes.push(f)):"sash"===c[d].type?(m.type="sash",r.sashsSize.push(f)):"frame"===m.type&&(m.sill?r.frameSillSize.push(f):r.framesSize.push(f)),u.push(m)}return g.sizes.length&&r.beadsSize.push(g),u}function X(e){var t,i=0,r=e.length;for(t=0;r>t;t+=1)i+=e[t+1]?e[t].x*e[t+1].y-e[t].y*e[t+1].x:e[t].x*e[0].y-e[t].y*e[0].x;return i/=2e6}function Z(e){var t,r=e.length,o=[];for(t=0;r>t;t+=1){var a,n=0;if(0!==t||"curve"!==e[t].dir){if(a=e[t+1]?t+1:0,"curve"===e[a].dir){var s,l=.01,d=0;for(s=e[t+2]?t+2:1;1>=d;){var c=2*((1-d)*(e[a].x-e[t].x)+d*(e[s].x-e[a].x)),u=2*((1-d)*(e[a].y-e[t].y)+d*(e[s].y-e[a].y));n+=Math.hypot(c,u)*l,d+=l}t+=1}else n=i.roundingValue(Math.hypot(e[a].x-e[t].x,e[a].y-e[t].y),1);o.push(n)}}return o}function J(e,t,r){var o,a={type:"glass",points:e,path:"M ",square:0},n={elemId:r},s=e.length;for(o=0;s>o;o+=1)0===o&&("curv"===e[o].dir?a.path+=e[s-1].x+","+e[s-1].y:a.path+=e[o].x+","+e[o].y),"curv"===e[o].dir?(a.path+=" Q "+e[o].x+","+e[o].y+",",e[o+1]?a.path+=e[o+1].x+","+e[o+1].y:a.path+=e[0].x+","+e[0].y+" Z",o+=1):(a.path+=" L "+e[o].x+","+e[o].y,o===s-1&&(a.path+=" Z"));return a.square=X(e),a.sizes=Z(e),n.square=angular.copy(a.square),n.sizes=angular.copy(a.sizes).map(function(e){return i.roundingValue(e/1e3,3)}),t.glassSquares.push(n),a}function ee(e,t,i){return 0===i?"arc"!==e[t].type&&"frame"===e[i].type&&"arc"!==e[i+1].type?1:0:i===t?"arc"!==e[i-1].type&&"frame"===e[i].type&&"arc"!==e[0].type?1:0:"arc"!==e[i-1].type&&"frame"===e[i].type&&"arc"!==e[i+1].type?1:0}function te(e){var t,i=e.length;for(t=1;i>t;t+=1)if(1===e[t].level){var r,o=e[t].pointsOut.length;if("single"===e[t].position)for(r=0;o>r;r+=1)e[t].pointsOut[r].corner=ee(e[t].pointsOut,o-1,r);else if("first"===e[t].position)for(r=0;o>r;r+=1)e[t].pointsOut[r].fi>90&&e[t].pointsOut[r].fi<270&&(e[t].pointsOut[r].corner=ee(e[t].pointsOut,o-1,r));else if("last"===e[t].position)for(r=0;o>r;r+=1)(e[t].pointsOut[r].fi<90||e[t].pointsOut[r].fi>270)&&(e[t].pointsOut[r].corner=ee(e[t].pointsOut,o-1,r))}}function ie(e,t){for(var i=angular.copy(e),r=i.length;--r>-1;)i[r].type=t;return i}function re(e){var t,i=[],r=e.length;for(t=0;r>t;t+=1)if("curv"===e[t].dir){var o,a,n=.5,s={},l=t;0===t?(o=r-1,a=t+1):t===r-1?(o=t-1,a=0):(o=t-1,a=t+1),s.x=b(e[o].to.x,e[l].to.x,e[a].to.x,n),s.y=b(e[o].to.y,e[l].to.y,e[a].to.y,n),i.push(s)}else i.push(e[t].to);return i}function oe(e,t){var i=Math.tan(t*Math.PI/180),r={center:e,coefA:i,coefB:-1,coefC:e.y-i*e.x};return r}function ae(e,t,i){var r,o,a,n,d,c=i.length,u=[];for(r=0;c>r;r+=1)if(o=s(t,i[r]),o.x>=0&&o.y>=0&&(a=l(o,i[r].to,i[r].from),n=k(a))){if("curv"===i[r].dir&&(d=z(r,c,i,t.center,o),d.length&&(o.x=d[0].x,o.y=d[0].y)),o.fi=A(t.center,o),e)switch(e){case 1:o.id=o.fi>180?"head":"tail";break;case 2:o.id=o.fi>90&&o.fi<270?"head":"tail";break;case 3:o.id=o.fi<180?"head":"tail";break;case 4:o.id=o.fi>270||o.fi<90?"head":"tail"}u.push(o)}return u}function ne(e,t,i,r){var o=oe(t,i),a=ae(e,o,r);return a}function se(e,t){var i,r,o,a,n,s,l,d,c,u,p,g,m=[],f=re(t),_=I(f),h=e.length;for(i=0;h>i;i+=1){switch(r={type:"sash-dir",points:[]},e[i]){case 1:s=ne(3,_,90,t);break;case 2:s=ne(4,_,180,t);break;case 3:s=ne(1,_,270,t);break;case 4:s=ne(2,_,180,t)}for(l=s.length;--l>-1;)if("head"===s[l].id)u=s[l];else if("tail"===s[l].id)for(o=angular.copy(f),o.push(s[l]),o=S(o,_),a=o.length,n=0;a>n;n+=1)"tail"===o[n].id&&(d=n-1,c=n+1,0>d&&(d=a-1),c>=a&&(c=0),p=o[c],g=o[d]);r.points.push(p,u,g),m.push(r)}return m}function le(e,t,i,r){for(var o={sizes:[],openDir:t,type:e},a=i.length;--a>-1;)o.sizes.push(i[a].size);r.sashesBlock.push(o)}function de(e){var t,i,r,o,a,n=[],s=[],l=[],d=e.length;for(r=0;d>r;r+=1)e[r].id.indexOf("qi")+1&&(e[r].group?i=e[r]:t=e[r]);for(r=0;d>r;r+=1)if(!(e[r].id.indexOf("qi")+1)){var c=_(t,i,e[r]);c>0?s.push(e[r]):l.push(e[r])}for(o=0;o<s.length;o+=1)s[o].group?n.unshift(s[o]):n.push(s[o]);for(n.unshift(i),n.push(t),a=0;a<l.length;a+=1)l[a].group?n.unshift(l[a]):n.push(l[a]);return n}function ce(e,t){var i,r=[];if(4===e)for(;--e>-1;)t[e].group&&r.push(t[e]);else if(6===e){for(i=0;e>i;i+=1)t[i].group&&(t[i].id.indexOf("ip")+1||t[i].id.indexOf("sht")+1)&&r.push(t[i]);for(i=0;e>i;i+=1)t[i].group&&t[i].id.indexOf("qi")+1&&r.splice(1,0,t[i])}return r}function ue(e,t){var r=e[0].type,o=e.length,a={type:r,dir:"line"};if(4===o){var n=I(e);a.points=S(e,n)}else 6===o&&(a.dir="curv",a.points=de(e));a.path=Q(a.points);var s=ce(o,a.points);a.size=j(s);var l=i.roundingValue(angular.copy(a.size)/1e3,3);return"impost"===r?t.impostsSize.push(l):"shtulp"===r&&t.shtulpsSize.push(l),a}function pe(e,r,o,a,n,s){for(var l=o.length;--l>-1;){var d,c,u={blockId:r,level:e,dimId:o[l].id,minLimit:t.minRadiusHeight};for(d=1;s>d;d+=1)if(1===n[d].level&&n[d].pointsQ){var p=n[d].pointsQ.length;if(p)for(c=0;p>c;c+=1)if(n[d].pointsQ[c].id===u.dimId){switch(n[d].pointsQ[c].positionQ){case 1:u.axis="y",u.from=angular.copy(n[d].pointsQ[c].startY),u.to=angular.copy(n[d].pointsQ[c].midleY);break;case 2:u.axis="x",u.from=angular.copy(n[d].pointsQ[c].midleX),u.to=angular.copy(n[d].pointsQ[c].startX);break;case 3:u.axis="y",u.from=angular.copy(n[d].pointsQ[c].midleY),u.to=angular.copy(n[d].pointsQ[c].startY);break;case 4:u.axis="x",u.from=angular.copy(n[d].pointsQ[c].startX),u.to=angular.copy(n[d].pointsQ[c].midleX)}u.text=i.roundingValue(angular.copy(n[d].pointsQ[c].heightQ),1),u.maxLimit=n[d].pointsQ[c].lengthChord/4}}"x"===u.axis?a.dimX.push(u):a.dimY.push(u)}}function ge(e,t){for(var i=t.dimX.length,r=t.dimY.length;--i>-1;)t.dimX[i].level&&(e.w+=t.dimX[i].text);for(;--r>-1;)t.dimY[r].level&&(e.h+=t.dimY[r].text)}function me(e,t){for(var i=t.length;--i>-1;)t[i].t||"curv"===t[i].dir||t[i].id.indexOf("fp")+1&&!t[i].view||e.push(t[i])}function fe(e){var t=e.filter(function(e){return 1===e.level}),i=t.length,r=e.filter(function(e){var r,o=0;for(r=0;i>r;r+=1)e.level||e.from!==t[r].from||e.to!==t[r].to||(o+=1);return o?void 0:1});return r}function _e(e,r,o){var a,n={},s=r.length;for(a=0;s>a;a+=1)"x"===e.axis?r[a].x===e.to&&(n.minL=r[a-1]?i.roundingValue(r[a-1].x+t.minSizeLimit,1):t.minSizeLimit,n.maxL=r[a+1]?i.roundingValue(r[a+1].x-e.from-t.minSizeLimit,1):o):r[a].y===e.to&&(n.minL=r[a-1]?i.roundingValue(r[a-1].y+t.minSizeLimit,1):t.minSizeLimit,n.maxL=r[a+1]?i.roundingValue(r[a+1].y-e.from-t.minSizeLimit,1):o);return n}function he(e,t,i){var r,o=[],a=i.length;if("x"===e){for(r=0;a>r;r+=1)(t.y===i[r].y||i[r].id.indexOf("fp")+1)&&o.push(i[r]);u(1,o),o.sort(m)}else{for(r=0;a>r;r+=1)(t.x===i[r].x||i[r].id.indexOf("fp")+1)&&o.push(i[r]);u(2,o),o.sort(f)}return o}function ye(e,r,o,a,n){var s,l={},d=he(e,r,a),c=d.length;for(s=0;c>s;s+=1){var u,p=0;for(u=0;c>u;u+=1)if(d[u].id===r.id){var g=r.x-d[u].x,m=r.y-d[u].y;"x"===e&&g>0?p=1:"y"===e&&m>0&&(p=1)}"x"===e?d[s].x===r.x&&(d[s-1]&&p?r.id===d[s-1].id?l.minL=t.minSizeLimit:l.minL=i.roundingValue(r.x-d[s-1].x-t.minSizeLimit,1):l.minL=t.minSizeLimit,d[s+1]?l.maxL=i.roundingValue(d[s+1].x-o-t.minSizeLimit,1):d[s-2]&&(l.maxL=i.roundingValue(r.x-d[s-2].x-t.minSizeLimit,1))):d[s].y===r.y&&(d[s-1]&&p?r.id===d[s-1].id?l.minL=t.minSizeLimit:l.minL=i.roundingValue(r.y-d[s-1].y-t.minSizeLimit,1):l.minL=t.minSizeLimit,d[s+1]?l.maxL=i.roundingValue(d[s+1].y-o-t.minSizeLimit,1):d[s-2]&&(l.maxL=i.roundingValue(r.y-d[s-2].y-t.minSizeLimit,1)))}return l}function Ee(e,t,r,o,a,n,s,l){var d,c={blockId:s,level:e,axis:t,dimId:a[o].id,from:"x"===t?angular.copy(a[r].x):angular.copy(a[r].y),to:"x"===t?angular.copy(a[o].x):angular.copy(a[o].y)};return c.text=i.roundingValue(Math.abs(c.to-c.from),1),d=e?_e(c,n,l):ye(t,a[o],c.from,n,l),c.minLimit=d.minL,c.maxLimit=d.maxL,c}function ve(e,t,i,r,o,a,n){var s,l=i.length-1;for(s=0;l>s;s+=1)r.push(Ee(e,t,s,s+1,i,o,a,n))}function be(e){var t,i,o,a,n={dimX:[],dimY:[],dimQ:[]},s=e.length,l=r.global.maxSizeLimit;for(o=p(e),o=o.filter(function(e){return"curv"===e.dir||e.t?0:1}),t=angular.copy(o),i=angular.copy(o),u(1,t),u(2,i),t.sort(m),i.sort(f),a=1;s>a;a+=1){var d=e[a].pointsOut.length;if(1===e[a].level){var c,_,h=[],y=[],E={w:0,h:0};for(_=0;d>_;_+=1)e[a].pointsOut[_].id.indexOf("fp")+1?h.push(e[a].pointsOut[_]):e[a].pointsOut[_].id.indexOf("qa")+1&&y.push(e[a].pointsOut[_]);if(c=angular.copy(h),u(1,h),u(2,c),h.sort(m),c.sort(f),ve(1,"x",h,n.dimX,t,e[a].id,l),ve(1,"y",c,n.dimY,i,e[a].id,l),pe(1,e[a].id,y,n,e,s),e[a].pointsQ){var v=e[a].pointsQ.length;if(v)for(;--v>-1;)n.dimQ.push(e[a].pointsQ[v])}ge(E,n),E.square=X(e[a].pointsOut),e[0].overallDim.push(E)}if(!e[a].children.length){var b,I,A=[],S=[],T=1;for(me(A,e[a].pointsOut),I=1;s>I;I+=1)e[I].id===e[a].parent&&e[I].impost&&e[I].impost.impostAxis[2]&&n.dimQ.push(e[I].impost.impostAxis[2]);S=angular.copy(o),b=angular.copy(A),A.length>1&&(A=g(1,A),b=g(2,b),A.sort(m),b.sort(f),A[0].id.indexOf("fp")+1&&A[1].id.indexOf("fp")+1?T=0:A.length&&ve(0,"x",A,n.dimX,S,e[a].id,l),b[0].id.indexOf("fp")+1&&b[1].id.indexOf("fp")+1?T=0:b.length&&ve(0,"y",b,n.dimY,S,e[a].id,l))}}return n.dimX=angular.copy(fe(n.dimX)),n.dimY=angular.copy(fe(n.dimY)),n}function Ie(t,i){var r,o,a={},n=e.defer();for(a.details=angular.copy(t.details),a.priceElements={
framesSize:[],frameSillSize:[],sashsSize:[],impostsSize:[],shtulpsSize:[],glassSquares:[],beadsSize:[],sashesBlock:[]},o=a.details.length,r=0;o>r;r+=1)if(a.details[r].level)1===a.details[r].level&&a.details[r].pointsQ&&M(a.details[r]),a.details[r].center=I(a.details[r].pointsOut),a.details[r].pointsOut=S(a.details[r].pointsOut,a.details[r].center),a.details[r].linesOut=N(a.details[r].pointsOut),1===a.details[r].level?(a.details[r].pointsIn=R(a.details[r].linesOut,i,"frame"),a.details[r].pointsLight=R(a.details[r].linesOut,i,"light")):(a.details[r].center=I(a.details[r].pointsIn),a.details[r].pointsIn=S(a.details[r].pointsIn,a.details[r].center),a.details[r].pointsLight=S(a.details[r].pointsLight,I(a.details[r].pointsLight))),a.details[r].linesIn=N(a.details[r].pointsIn),a.details[r].linesLight=N(a.details[r].pointsLight),1===a.details[r].level&&(te(a.details),$.merge(a.details[r].parts,K(a.details[r].pointsOut,a.details[r].pointsIn,a.priceElements))),a.details[r].children.length?"sash"===a.details[r].blockType&&(a.details[r].sashPointsOut=ie(R(a.details[r].linesIn,i,"sash-out"),"sash"),a.details[r].sashLinesOut=N(a.details[r].sashPointsOut),a.details[r].sashPointsIn=R(a.details[r].sashLinesOut,i,"sash-in"),a.details[r].sashLinesIn=N(a.details[r].sashPointsIn),a.details[r].sashPointsLight=R(a.details[r].sashLinesOut,i,"sash-light"),a.details[r].sashLinesLight=N(a.details[r].sashPointsLight),a.details[r].hardwarePoints=R(a.details[r].sashLinesOut,i,"hardware"),a.details[r].hardwareLines=N(a.details[r].hardwarePoints),$.merge(a.details[r].parts,K(a.details[r].sashPointsOut,a.details[r].sashPointsIn,a.priceElements)),a.details[r].sashOpenDir=se(a.details[r].openDir,a.details[r].sashLinesIn),le(a.details[r].sashType,a.details[r].openDir,a.details[r].hardwareLines,a.priceElements)):"frame"===a.details[r].blockType?(a.details[r].beadPointsOut=ie(a.details[r].pointsIn,"bead"),a.details[r].beadLinesOut=N(a.details[r].beadPointsOut),a.details[r].beadPointsIn=R(a.details[r].beadLinesOut,i,"frame-bead"),a.details[r].glassPoints=R(a.details[r].beadLinesOut,i,"frame-glass"),a.details[r].parts.push(J(a.details[r].glassPoints,a.priceElements,a.details[r].glassId)),$.merge(a.details[r].parts,K(a.details[r].beadPointsOut,a.details[r].beadPointsIn,a.priceElements,a.details[r].glassId))):"sash"===a.details[r].blockType&&(a.details[r].sashPointsOut=ie(R(a.details[r].linesIn,i,"sash-out"),"sash"),a.details[r].sashLinesOut=N(a.details[r].sashPointsOut),a.details[r].sashPointsIn=R(a.details[r].sashLinesOut,i,"sash-in"),a.details[r].sashLinesIn=N(a.details[r].sashPointsIn),a.details[r].hardwarePoints=R(a.details[r].sashLinesOut,i,"hardware"),a.details[r].hardwareLines=N(a.details[r].hardwarePoints),a.details[r].beadPointsOut=ie(a.details[r].sashPointsIn,"bead"),a.details[r].beadLinesOut=N(a.details[r].beadPointsOut),a.details[r].beadPointsIn=R(a.details[r].beadLinesOut,i,"sash-bead"),a.details[r].beadLinesIn=N(a.details[r].beadPointsIn),a.details[r].glassPoints=R(a.details[r].beadLinesOut,i,"sash-glass"),$.merge(a.details[r].parts,K(a.details[r].sashPointsOut,a.details[r].sashPointsIn,a.priceElements)),a.details[r].parts.push(J(a.details[r].glassPoints,a.priceElements,a.details[r].glassId)),$.merge(a.details[r].parts,K(a.details[r].beadPointsOut,a.details[r].beadPointsIn,a.priceElements,a.details[r].glassId)),a.details[r].sashOpenDir=se(a.details[r].openDir,a.details[r].beadLinesIn),le(a.details[r].sashType,a.details[r].openDir,a.details[r].hardwareLines,a.priceElements)),W(a.details[r],a.details,i),a.details[r].children.length&&a.details[r].parts.push(ue(a.details[r].impost.impostIn,a.priceElements));else{var s,l=a.details[r].children.length;if(1===l)for(s=0;o>s;s+=1)a.details[r].children[0]===a.details[s].id&&(a.details[s].position="single");else if(l>1)for(s=0;o>s;s+=1)a.details[r].children[0]===a.details[s].id?a.details[s].position="first":a.details[r].children[l-1]===a.details[s].id&&(a.details[s].position="last");a.details[r].overallDim=[]}return a.dimension=be(a.details),n.resolve(a),n.promise}function Ae(t,i){var r=e.defer(),o=angular.copy(i),a=2;for(var n in o)for(var s in o[n])o[n][s]*=a;return Ie(t,o).then(function(e){r.resolve(e)}),r.promise}function Se(e,t,i,r){var o,a=e.maxX-e.minX+600,n=e.maxY-e.minY,s=d3.scale.linear().domain([0,1]).range([0,r]);return a>n?o=s(t>a?a/t:a>t?t/a:1):n>=a&&(o=s(i>n?n/i:n>i?i/n:1)),o}function Te(e){var t,i=d3.scale.linear().domain([0,1]).range([0,e]);return t=i(.38)}function xe(e,t,i,r){var o={x:(t-(e.minX+e.maxX)*r)/2,y:(i-(e.minY+e.maxY)*r)/2};return o}function Ne(e,t,i){var r=n.templatePoints(o.product.template),a=t-(e.minY+e.maxY)*i,s={};return 1!==o.product.construction_type&&3!==o.product.construction_type||(s.x=250,r.heightT<1648&&(s.y=a-310),1648<r.heightT&&(s.y=a-240),1848<r.heightT&&(s.y=a-190),2148<r.heightT&&(s.y=a-130)),4!==o.product.construction_type&&2!==o.product.construction_type||(s.x=276,s.y=a-110),s}var Le=this;return Le.publicObj={createSVGTemplate:Ie,createSVGTemplateIcon:Ae,collectAllPointsOut:p,setTemplateScale:Se,setTemplateScaleMAIN:Te,setTemplatePositionMAIN:Ne,setTemplatePosition:xe,centerBlock:I,sortingPoints:S,getAngelPoint:A,setLines:N,setLineCoef:T,getNewCoefC:L,setPointLocationToLine:_,intersectionQ:F,cteateLineByAngel:oe,getIntersectionInCurve:z,getCoordCrossPoint:s,checkLineOwnPoint:l,isInsidePointInLine:k,getCoordSideQPCurve:E,checkEqualPoints:h,setQPointCoord:v,getCenterLine:c,calcSquare:X,checkInsidePointInLineEasy:d,sortByX:m},Le.publicObj}])}(),function(){angular.module("MainModule").factory("TemplatesServ",["$filter","GeneralServ","MainServ","DesignServ","AnalyticsServ","GlobalStor","OrderStor","ProductStor","DesignStor","UserStor",function(e,t,i,r,o,a,n,s,l,d){function c(e){s.product.template_id=e,i.saveTemplateInProduct(e).then(function(){if(s.product.glass.length=0,i.setCurrentGlass(s.product),i.setCurrentHardware(s.product),"design"===a.global.currOpenPage)r.setDefaultConstruction();else{var e=s.product.hardware.id||0;i.preparePrice(s.product.template,s.product.profile.id,s.product.glass,e,s.product.lamination.lamination_in_id),o.sendAnalyticsData(d.userInfo.id,n.order.id,s.product.template_id,s.product.profile.id,1)}})}function u(e,t){t?(i.closeRoomSelectorDialog(),s.product.room_id=t-1,4===a.global.rooms[t-1].group_id&&a.global.noDoorExist?l.design.isNoDoors=1:s.product.construction_type!==a.global.rooms[t-1].group_id?(s.product.construction_type=a.global.rooms[t-1].group_id,i.setCurrentProfile(s.product,0),4===s.product.construction_type&&(r.setDoorConfigDefault(s.product),l.design=l.setDefaultDesign(),s.product.profile=angular.copy(i.fineItemById(l.design.sashShapeList[s.product.door_sash_shape_id].profileId,a.global.profiles))),i.downloadAllTemplates(s.product.construction_type).then(function(t){t&&(a.global.templatesSourceSTORE=angular.copy(t),a.global.templatesSource=angular.copy(t),c(e))})):c(e)):c(e)}function p(){var e=angular.copy(a.global.templatesSourceSTORE[s.product.template_id]);a.global.templatesSource[s.product.template_id]=e}function g(i,r){function o(){p(),a.global.isChangedTemplate=0,l.design.designSteps.length=0,u(i,r)}a.global.isTemplateTypeMenu=0,"design"===a.global.currOpenPage&&(a.global.isChangedTemplate=l.design.designSteps.length?1:0),a.global.isChangedTemplate?t.confirmAlert(e("translate")("common_words.NEW_TEMPLATE_TITLE"),e("translate")("common_words.TEMPLATE_CHANGES_LOST"),o):u(i,r)}function m(e){s.product.construction_type=e,s.product.template_id=0,i.prepareTemplates(e).then(function(){"design"===a.global.currOpenPage&&r.setDefaultConstruction()})}var f=this;return f.publicObj={selectNewTemplate:g,initNewTemplateType:m},f.publicObj}])}(),function(){angular.module("MainModule").factory("AuxStor",function(){function e(){return angular.copy(t.publicObj.auxiliarySource)}var t=this;return t.publicObj={auxiliarySource:{addElementsType:[],addElementsList:[],showAddElementsMenu:0,addElementsMenuStyle:0,isFocusedAddElement:0,isAddElement:0,currentAddElementId:0,auxParameter:0,tempSize:[],currAddElementPrice:0,isTabFrame:0,truefalse:0,trfal:-1,isAddElementListView:0,isWindowSchemeDialog:0,isGridSelectorDialog:0,selectedGrid:0,calculatorStyle:"",addElementGroups:[],searchingWord:""},setDefaultAuxiliary:e},t.publicObj.aux=e(),t.publicObj})}(),function(){angular.module("CartModule").factory("CartStor",["OrderStor",function(e){function t(){return angular.copy(r.publicObj.cartSource)}function i(){r.publicObj.cart.customer.customer_name=angular.copy(e.order.customer_name),r.publicObj.cart.customer.customer_location=angular.copy(e.order.customer_location),r.publicObj.cart.customer.customer_address=angular.copy(e.order.customer_address),r.publicObj.cart.customer.customer_house=angular.copy(e.order.customer_house),r.publicObj.cart.customer.customer_flat=angular.copy(e.order.customer_flat),r.publicObj.cart.customer.customer_floor=angular.copy(e.order.customer_floor),r.publicObj.cart.customer.customer_city=angular.copy(e.order.customer_city),r.publicObj.cart.customer.customer_city_id=angular.copy(e.order.customer_city_id),r.publicObj.cart.customer.customer_email=angular.copy(e.order.customer_email),r.publicObj.cart.customer.customer_phone=angular.copy(e.order.customer_phone),r.publicObj.cart.customer.customer_phone_city=angular.copy(e.order.customer_phone_city),r.publicObj.cart.customer.customer_itn=angular.copy(e.order.customer_itn),r.publicObj.cart.customer.customer_starttime=angular.copy(e.order.customer_starttime),r.publicObj.cart.customer.customer_endtime=angular.copy(e.order.customer_endtime),r.publicObj.cart.customer.customer_target=angular.copy(e.order.customer_target),r.publicObj.cart.customer.customer_sex=angular.copy(e.order.customer_sex),r.publicObj.cart.customer.customer_age=angular.copy(e.order.customer_age),r.publicObj.cart.customer.customer_education=angular.copy(e.order.customer_education),r.publicObj.cart.customer.customer_occupation=angular.copy(e.order.customer_occupation),r.publicObj.cart.customer.customer_infoSource=angular.copy(e.order.customer_infoSource)}var r=this;return r.publicObj={cartSource:{allAddElements:[],isShowDiscount:0,tempConstructDisc:0,tempAddelemDisc:0,discountPriceDiff:0,discountDeliveyPlant:0,marginDeliveyPlant:0,squareTotal:0,perimeterTotal:0,qtyTotal:0,isBox:-1,isExistAddElems:0,isAllAddElems:0,allAddElemsOrder:[],addElemsOrderPriceTOTAL:0,isSelectedProduct:0,selectedProducts:[],isMasterDialog:0,isOrderDialog:0,isCreditDialog:0,submitted:0,isCityBox:0,customer:{customer_sex:0}},optionAge:[{id:1,name:"20-30"},{id:2,name:"31-40"},{id:3,name:"41-50"},{id:4,name:"51-60"},{id:5,name:"cart.CLIENT_AGE_OLDER"}],optionEductaion:[{id:1,name:"cart.CLIENT_EDUC_MIDLE"},{id:2,name:"cart.CLIENT_EDUC_SPEC"},{id:3,name:"cart.CLIENT_EDUC_HIGH"},{id:4,name:"cart.CLIENT_EDUC_4"}],optionOccupation:[{id:1,name:"cart.CLIENT_OCCUP_WORKER"},{id:2,name:"cart.CLIENT_OCCUP_HOUSE"},{id:3,name:"cart.CLIENT_OCCUP_BOSS"},{id:4,name:"cart.CLIENT_OCCUP_STUD"},{id:5,name:"cart.CLIENT_OCCUP_PENSION"},{id:6,name:"cart.UNKNOWN"}],optionInfo:[{id:1,name:"TV"},{id:2,name:"InterNET"},{id:3,name:"cart.CLIENT_INFO_PRESS"},{id:4,name:"cart.CLIENT_INFO_FRIEND"},{id:5,name:"cart.CLIENT_INFO_ADV"}],setDefaultCart:t,fillOrderForm:i},r.publicObj.cart=t(),r.publicObj}])}(),function(){angular.module("DesignModule").factory("DesignStor",function(){function e(){return angular.copy(i.publicObj.designSource)}function t(){return angular.copy(i.publicObj.designSource.doorConfig)}var i=this;return i.publicObj={designSource:{templateSourceTEMP:{},templateTEMP:{},designSteps:[],activeMenuItem:0,activeSubMenuItem:0,isDropSubMenu:0,isImpostDelete:0,selectedGlass:[],selectedCorner:[],selectedImpost:[],selectedArc:[],openVoiceHelper:0,loudVoice:0,quietVoice:0,voiceTxt:"",selectedGlassId:0,isDimAnimate:0,oldSize:0,prevSize:0,tempSize:[],isMinSizeRestriction:0,isMaxSizeRestriction:0,minSizeLimit:0,maxSizeLimit:0,isDimExtra:0,isSquareExtra:0,extraGlass:[],isGlassExtra:0,extraHardware:[],isHardwareExtra:0,isNoDoors:0,doorShapeData:[{name:"panels.DOOR_TYPE1",icon:"img/door-config/doorstep.png",iconSelect:"img/door-config-selected/doorstep.png"},{name:"panels.DOOR_TYPE2",icon:"img/door-config/no-doorstep.png",iconSelect:"img/door-config-selected/no-doorstep.png"},{name:"panels.DOOR_TYPE3",icon:"img/door-config/doorstep-al1.png",iconSelect:"img/door-config-selected/doorstep-al1.png"},{name:"panels.DOOR_TYPE4",icon:"img/door-config/doorstep-al2.png",iconSelect:"img/door-config-selected/doorstep-al2.png"}],doorShapeList:[],sashShapeList:[],handleShapeList:[],lockShapeList:[],doorConfig:{doorShapeIndex:"",doorShapeName:"",sashShapeIndex:"",sashShapeName:"",handleShapeIndex:"",handleShape:{},lockShapeIndex:"",lockShape:{}}},setDefaultDesign:e,setDefaultDoor:t},i.publicObj.design=e(),i.publicObj})}(),function(){angular.module("BauVoiceApp").factory("GlobalStor",function(){function e(){return angular.copy(t.publicObj.globalSource)}var t=this;return t.publicObj={globalSource:{getPCPower:0,isDevice:0,loader:0,isLoader:0,isLoader2:0,gotoSettingsPage:0,startProgramm:1,isNavMenu:1,isConfigMenu:0,activePanel:0,configMenuTips:0,isCreatedNewProject:1,copyGlabalStorGlassesAll:[],isCreatedNewProduct:1,productEditNumber:0,orderEditNumber:0,prevOpenPage:"",currOpenPage:"main",isChangedTemplate:0,isVoiceHelper:0,voiceHelperLanguage:"",showGlassSelectorDialog:0,isShowCommentBlock:0,isTemplateTypeMenu:0,showRoomSelectorDialog:0,rooms:[],isRoomElements:0,templateLabel:"",templatesSource:[],templatesSourceSTORE:[],isSashesInTemplate:0,profiles:[],profilesType:[],glassesAll:[],glassTypes:[],glasses:[],selectGlassId:0,selectGlassName:"",prevGlassId:0,prevGlassName:"",hardwares:[],hardwareTypes:[],hardwareLimits:[],laminats:[],laminatCouples:[],lamGroupFiltered:[],typeMenu:55,typeMenuID:55,addElementsAll:[],tempAddElements:[],noDoorExist:0,doorKitsT1:[],doorKitsT2:[],doorHandlers:[],doorLocks:[],supplyData:[],assemblingData:[],instalmentsData:[],isInfoBox:0,infoTitle:"",infoImg:"",infoLink:"",infoDescrip:"",isReport:0,currencies:[],locations:{countries:[],regions:[],cities:[]},margins:{},deliveryCoeff:{},isAlert:0,alertTitle:"",alertDescr:"",isBox:0,isAlertHistory:0,isEditBox:0,confirmAction:0,confirmInActivity:0,isQtyCalculator:0,isSizeCalculator:0,isWidthCalculator:0,maxSizeLimit:3200,maxSquareLimit:6},setDefaultGlobal:e},t.publicObj.global=e(),t.publicObj})}(),function(){angular.module("HistoryModule").factory("HistoryStor",function(){function e(){return angular.copy(t.publicObj.historySource)}var t=this;return t.publicObj={historySource:{orders:[],ordersSource:[],isEmptyResult:0,"errorСhecking":0,isOrderSearch:0,searchingWord:"",isOrderDate:0,startDate:"",finishDate:"",isStartDate:0,isFinishDate:0,isAllPeriod:1,isBox:0,isArr:0,isOrderSort:0,isSortType:"last",isFilterType:void 0,isDraftView:0,orderEditNumber:0,drafts:[],draftsSource:[],isEmptyResultDraft:0,isOrderDateDraft:0,startDateDraft:"",finishDateDraft:"",isStartDateDraft:0,isFinishDateDraft:0,isAllPeriodDraft:1,isOrderSortDraft:0,isSortTypeDraft:"last",reverseDraft:1,listName:[],listNameGlass:[],listNameHardware:[],listNameProfiles:[]},setDefaultHistory:e},t.publicObj.history=e(),t.publicObj})}(),function(){angular.module("BauVoiceApp").factory("OrderStor",function(){function e(){return angular.copy(t.publicObj.orderSource)}var t=this;return t.publicObj={orderSource:{id:0,order_number:0,order_hz:"---",order_type:1,order_date:0,order_style:"",climatic_zone:0,heat_coef_min:0,discount_construct:0,discount_addelem:0,discount_construct_max:0,discount_addelem_max:0,delivery_user_id:0,mounting_user_id:0,default_term_plant:0,disc_term_plant:0,margin_plant:0,products_qty:0,products:[],templates_price:0,addelems_price:0,products_price:0,productsPriceDis:0,delivery_date:0,new_delivery_date:0,delivery_price:0,is_date_price_less:0,is_date_price_more:0,floor_id:0,floorName:"",floor_price:0,mounting_id:0,mountingName:"",mounting_price:0,is_instalment:0,instalment_id:0,selectedInstalmentPeriod:0,selectedInstalmentPercent:0,is_old_price:0,payment_first:0,payment_monthly:0,payment_first_primary:0,payment_monthly_primary:0,paymentFirstDis:0,paymentMonthlyDis:0,paymentFirstPrimaryDis:0,paymentMonthlyPrimaryDis:0,order_price:0,order_price_dis:0,order_price_primary:0,orderPricePrimaryDis:0,customer_name:"",customer_email:"",customer_phone:"",customer_phone_city:"",customer_address:"",customer_location:"",customer_city:"",customer_city_id:0,customer_itn:0,customer_starttime:"",customer_endtime:"",customer_target:"",customer_sex:0,customer_age:0,customer_education:0,customer_occupation:0,customer_infoSource:0},setDefaultOrder:e},t.publicObj.order=e(),t.publicObj})}(),function(){angular.module("BauVoiceApp").factory("ProductStor",["$filter",function(e){function t(){return angular.copy(i.publicObj.productSource)}var i=this;return i.publicObj={productSource:{product_id:0,is_addelem_only:0,room_id:0,construction_type:1,heat_coef_total:0,template_id:0,template_source:{},template:{},templateIcon:{},template_width:0,template_height:0,template_square:0,profile:{},glass:[],hardware:{},beadsData:[],profileDepths:{frameDepth:{},frameStillDepth:{},sashDepth:{},impostDepth:{},shtulpDepth:{}},lamination:{id:0,lamination_in_id:1,lamination_out_id:1,laminat_in_name:e("translate")("mainpage.WHITE_LAMINATION"),laminat_out_name:e("translate")("mainpage.WHITE_LAMINATION"),img_in_id:1,img_out_id:1},chosenAddElements:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],door_shape_id:0,door_sash_shape_id:0,door_handle_shape_id:0,door_lock_shape_id:0,doorName:"",doorSashName:"",doorHandle:{},doorLock:{},template_price:0,addelem_price:0,addelemPriceDis:0,product_price:0,productPriceDis:0,report:[],comment:"",product_qty:1},setDefaultProduct:t},i.publicObj.product=t(),i.publicObj}])}(),function(){angular.module("BauVoiceApp").factory("UserStor",function(){function e(){return angular.copy(t.publicObj.userInfoSource)}var t=this;return t.publicObj={userInfoSource:{cityName:"",regionName:"",countryName:"",fullLocation:"",climaticZone:0,heatTransfer:0,langLabel:"en",langName:"English",currencyId:0,currency:"",discountConstr:0,discountAddElem:0,discountConstrMax:0,discountAddElemMax:0,discConstrByWeek:[],discAddElemByWeek:[],factoryLink:""},setDefaultUser:e},t.publicObj.userInfo=e(),t.publicObj})}();var speechKit=new NuanceSpeechKitPlugin;